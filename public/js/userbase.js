var userbase=function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=27)}([function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Uint8Array(256),a=0;a<e.length;a++)s[e.charCodeAt(a)]=a;t.encode=function(t){var s,a=new Uint8Array(t),r=a.length,n="";for(s=0;s<r;s+=3)n+=e[a[s]>>2],n+=e[(3&a[s])<<4|a[s+1]>>4],n+=e[(15&a[s+1])<<2|a[s+2]>>6],n+=e[63&a[s+2]];return r%3==2?n=n.substring(0,n.length-1)+"=":r%3==1&&(n=n.substring(0,n.length-2)+"=="),n},t.decode=function(e){var t,a,r,n,i,o=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var d=new ArrayBuffer(o),h=new Uint8Array(d);for(t=0;t<c;t+=4)a=s[e.charCodeAt(t)],r=s[e.charCodeAt(t+1)],n=s[e.charCodeAt(t+2)],i=s[e.charCodeAt(t+3)],h[u++]=a<<2|r>>4,h[u++]=(15&r)<<4|n>>2,h[u++]=(3&n)<<6|63&i;return d}}()},function(e,t){e.exports=function(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},function(e,t,s){var a=s(13),r=s(14);e.exports=function(e,t,s){var n=t&&s||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||r(i)}},function(e,t){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var a=s(15),r=s(16),n=s(17);function i(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,s){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,s);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,s)}function u(e,t,s,a){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,s,a){if(t.byteLength,s<0||t.byteLength<s)throw new RangeError("'offset' is out of bounds");if(t.byteLength<s+(a||0))throw new RangeError("'length' is out of bounds");t=void 0===s&&void 0===a?new Uint8Array(t):void 0===a?new Uint8Array(t,s):new Uint8Array(t,s,a);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=l(e,t);return e}(e,t,s,a):"string"==typeof t?function(e,t,s){"string"==typeof s&&""!==s||(s="utf8");if(!c.isEncoding(s))throw new TypeError('"encoding" must be a valid string encoding');var a=0|m(t,s),r=(e=o(e,a)).write(t,s);r!==a&&(e=e.slice(0,r));return e}(e,t,s):function(e,t){if(c.isBuffer(t)){var s=0|f(t.length);return 0===(e=o(e,s)).length||t.copy(e,0,0,s),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(a=t.length)!=a?o(e,0):l(e,t);if("Buffer"===t.type&&n(t.data))return l(e,t.data)}var a;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(d(t),e=o(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var s=0;s<t;++s)e[s]=0;return e}function l(e,t){var s=t.length<0?0:0|f(t.length);e=o(e,s);for(var a=0;a<s;a+=1)e[a]=255&t[a];return e}function f(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function m(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var s=e.length;if(0===s)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":case void 0:return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return j(e).length;default:if(a)return L(e).length;t=(""+t).toLowerCase(),a=!0}}function p(e,t,s){var a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,s);case"utf8":case"utf-8":return B(this,t,s);case"ascii":return N(this,t,s);case"latin1":case"binary":return U(this,t,s);case"base64":return E(this,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,s);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function w(e,t,s){var a=e[t];e[t]=e[s],e[s]=a}function g(e,t,s,a,r){if(0===e.length)return-1;if("string"==typeof s?(a=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,isNaN(s)&&(s=r?0:e.length-1),s<0&&(s=e.length+s),s>=e.length){if(r)return-1;s=e.length-1}else if(s<0){if(!r)return-1;s=0}if("string"==typeof t&&(t=c.from(t,a)),c.isBuffer(t))return 0===t.length?-1:y(e,t,s,a,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,s):Uint8Array.prototype.lastIndexOf.call(e,t,s):y(e,[t],s,a,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,s,a,r){var n,i=1,o=e.length,c=t.length;if(void 0!==a&&("ucs2"===(a=String(a).toLowerCase())||"ucs-2"===a||"utf16le"===a||"utf-16le"===a)){if(e.length<2||t.length<2)return-1;i=2,o/=2,c/=2,s/=2}function u(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(r){var d=-1;for(n=s;n<o;n++)if(u(e,n)===u(t,-1===d?0:n-d)){if(-1===d&&(d=n),n-d+1===c)return d*i}else-1!==d&&(n-=n-d),d=-1}else for(s+c>o&&(s=o-c),n=s;n>=0;n--){for(var h=!0,l=0;l<c;l++)if(u(e,n+l)!==u(t,l)){h=!1;break}if(h)return n}return-1}function b(e,t,s,a){s=Number(s)||0;var r=e.length-s;a?(a=Number(a))>r&&(a=r):a=r;var n=t.length;if(n%2!=0)throw new TypeError("Invalid hex string");a>n/2&&(a=n/2);for(var i=0;i<a;++i){var o=parseInt(t.substr(2*i,2),16);if(isNaN(o))return i;e[s+i]=o}return i}function v(e,t,s,a){return q(L(t,e.length-s),e,s,a)}function M(e,t,s,a){return q(function(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}(t),e,s,a)}function S(e,t,s,a){return M(e,t,s,a)}function I(e,t,s,a){return q(j(t),e,s,a)}function P(e,t,s,a){return q(function(e,t){for(var s,a,r,n=[],i=0;i<e.length&&!((t-=2)<0);++i)s=e.charCodeAt(i),a=s>>8,r=s%256,n.push(r),n.push(a);return n}(t,e.length-s),e,s,a)}function E(e,t,s){return 0===t&&s===e.length?a.fromByteArray(e):a.fromByteArray(e.slice(t,s))}function B(e,t,s){s=Math.min(e.length,s);for(var a=[],r=t;r<s;){var n,i,o,c,u=e[r],d=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h<=s)switch(h){case 1:u<128&&(d=u);break;case 2:128==(192&(n=e[r+1]))&&(c=(31&u)<<6|63&n)>127&&(d=c);break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(c=(15&u)<<12|(63&n)<<6|63&i)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:n=e[r+1],i=e[r+2],o=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&o)&&(c=(15&u)<<18|(63&n)<<12|(63&i)<<6|63&o)>65535&&c<1114112&&(d=c)}null===d?(d=65533,h=1):d>65535&&(d-=65536,a.push(d>>>10&1023|55296),d=56320|1023&d),a.push(d),r+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var s="",a=0;for(;a<t;)s+=String.fromCharCode.apply(String,e.slice(a,a+=4096));return s}(a)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=i(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,s){return u(null,e,t,s)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,s){return function(e,t,s,a){return d(t),t<=0?o(e,t):void 0!==s?"string"==typeof a?o(e,t).fill(s,a):o(e,t).fill(s):o(e,t)}(null,e,t,s)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var s=e.length,a=t.length,r=0,n=Math.min(s,a);r<n;++r)if(e[r]!==t[r]){s=e[r],a=t[r];break}return s<a?-1:a<s?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!n(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var s;if(void 0===t)for(t=0,s=0;s<e.length;++s)t+=e[s].length;var a=c.allocUnsafe(t),r=0;for(s=0;s<e.length;++s){var i=e[s];if(!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(a,r),r+=i.length}return a},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)w(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)w(this,t,t+3),w(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)w(this,t,t+7),w(this,t+1,t+6),w(this,t+2,t+5),w(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?B(this,0,e):p.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",s=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,s,a,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===a&&(a=0),void 0===r&&(r=this.length),t<0||s>e.length||a<0||r>this.length)throw new RangeError("out of range index");if(a>=r&&t>=s)return 0;if(a>=r)return-1;if(t>=s)return 1;if(this===e)return 0;for(var n=(r>>>=0)-(a>>>=0),i=(s>>>=0)-(t>>>=0),o=Math.min(n,i),u=this.slice(a,r),d=e.slice(t,s),h=0;h<o;++h)if(u[h]!==d[h]){n=u[h],i=d[h];break}return n<i?-1:i<n?1:0},c.prototype.includes=function(e,t,s){return-1!==this.indexOf(e,t,s)},c.prototype.indexOf=function(e,t,s){return g(this,e,t,s,!0)},c.prototype.lastIndexOf=function(e,t,s){return g(this,e,t,s,!1)},c.prototype.write=function(e,t,s,a){if(void 0===t)a="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)a=t,s=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(s)?(s|=0,void 0===a&&(a="utf8")):(a=s,s=void 0)}var r=this.length-t;if((void 0===s||s>r)&&(s=r),e.length>0&&(s<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");a||(a="utf8");for(var n=!1;;)switch(a){case"hex":return b(this,e,t,s);case"utf8":case"utf-8":return v(this,e,t,s);case"ascii":return M(this,e,t,s);case"latin1":case"binary":return S(this,e,t,s);case"base64":return I(this,e,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,s);default:if(n)throw new TypeError("Unknown encoding: "+a);a=(""+a).toLowerCase(),n=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(e,t,s){var a="";s=Math.min(e.length,s);for(var r=t;r<s;++r)a+=String.fromCharCode(127&e[r]);return a}function U(e,t,s){var a="";s=Math.min(e.length,s);for(var r=t;r<s;++r)a+=String.fromCharCode(e[r]);return a}function A(e,t,s){var a=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>a)&&(s=a);for(var r="",n=t;n<s;++n)r+=F(e[n]);return r}function T(e,t,s){for(var a=e.slice(t,s),r="",n=0;n<a.length;n+=2)r+=String.fromCharCode(a[n]+256*a[n+1]);return r}function k(e,t,s){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>s)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,s,a,r,n){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<n)throw new RangeError('"value" argument is out of bounds');if(s+a>e.length)throw new RangeError("Index out of range")}function K(e,t,s,a){t<0&&(t=65535+t+1);for(var r=0,n=Math.min(e.length-s,2);r<n;++r)e[s+r]=(t&255<<8*(a?r:1-r))>>>8*(a?r:1-r)}function x(e,t,s,a){t<0&&(t=4294967295+t+1);for(var r=0,n=Math.min(e.length-s,4);r<n;++r)e[s+r]=t>>>8*(a?r:3-r)&255}function R(e,t,s,a,r,n){if(s+a>e.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function O(e,t,s,a,n){return n||R(e,0,s,4),r.write(e,t,s,a,23,4),s+4}function C(e,t,s,a,n){return n||R(e,0,s,8),r.write(e,t,s,a,52,8),s+8}c.prototype.slice=function(e,t){var s,a=this.length;if((e=~~e)<0?(e+=a)<0&&(e=0):e>a&&(e=a),(t=void 0===t?a:~~t)<0?(t+=a)<0&&(t=0):t>a&&(t=a),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(s=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;s=new c(r,void 0);for(var n=0;n<r;++n)s[n]=this[n+e]}return s},c.prototype.readUIntLE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e],r=1,n=0;++n<t&&(r*=256);)a+=this[e+n]*r;return a},c.prototype.readUIntBE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e+--t],r=1;t>0&&(r*=256);)a+=this[e+--t]*r;return a},c.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e],r=1,n=0;++n<t&&(r*=256);)a+=this[e+n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readIntBE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=t,r=1,n=this[e+--a];a>0&&(r*=256);)n+=this[e+--a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,s,a){(e=+e,t|=0,s|=0,a)||D(this,e,t,s,Math.pow(2,8*s)-1,0);var r=1,n=0;for(this[t]=255&e;++n<s&&(r*=256);)this[t+n]=e/r&255;return t+s},c.prototype.writeUIntBE=function(e,t,s,a){(e=+e,t|=0,s|=0,a)||D(this,e,t,s,Math.pow(2,8*s)-1,0);var r=s-1,n=1;for(this[t+r]=255&e;--r>=0&&(n*=256);)this[t+r]=e/n&255;return t+s},c.prototype.writeUInt8=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):x(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,s,a){if(e=+e,t|=0,!a){var r=Math.pow(2,8*s-1);D(this,e,t,s,r-1,-r)}var n=0,i=1,o=0;for(this[t]=255&e;++n<s&&(i*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/i>>0)-o&255;return t+s},c.prototype.writeIntBE=function(e,t,s,a){if(e=+e,t|=0,!a){var r=Math.pow(2,8*s-1);D(this,e,t,s,r-1,-r)}var n=s-1,i=1,o=0;for(this[t+n]=255&e;--n>=0&&(i*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/i>>0)-o&255;return t+s},c.prototype.writeInt8=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):x(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,s){return O(this,e,t,!0,s)},c.prototype.writeFloatBE=function(e,t,s){return O(this,e,t,!1,s)},c.prototype.writeDoubleLE=function(e,t,s){return C(this,e,t,!0,s)},c.prototype.writeDoubleBE=function(e,t,s){return C(this,e,t,!1,s)},c.prototype.copy=function(e,t,s,a){if(s||(s=0),a||0===a||(a=this.length),t>=e.length&&(t=e.length),t||(t=0),a>0&&a<s&&(a=s),a===s)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("sourceStart out of bounds");if(a<0)throw new RangeError("sourceEnd out of bounds");a>this.length&&(a=this.length),e.length-t<a-s&&(a=e.length-t+s);var r,n=a-s;if(this===e&&s<t&&t<a)for(r=n-1;r>=0;--r)e[r+t]=this[r+s];else if(n<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<n;++r)e[r+t]=this[r+s];else Uint8Array.prototype.set.call(e,this.subarray(s,s+n),t);return n},c.prototype.fill=function(e,t,s,a){if("string"==typeof e){if("string"==typeof t?(a=t,t=0,s=this.length):"string"==typeof s&&(a=s,s=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==a&&"string"!=typeof a)throw new TypeError("encoding must be a string");if("string"==typeof a&&!c.isEncoding(a))throw new TypeError("Unknown encoding: "+a)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<s)throw new RangeError("Out of range index");if(s<=t)return this;var n;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(n=t;n<s;++n)this[n]=e;else{var i=c.isBuffer(e)?e:L(new c(e,a).toString()),o=i.length;for(n=0;n<s-t;++n)this[n+t]=i[n%o]}return this};var _=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function L(e,t){var s;t=t||1/0;for(var a=e.length,r=null,n=[],i=0;i<a;++i){if((s=e.charCodeAt(i))>55295&&s<57344){if(!r){if(s>56319){(t-=3)>-1&&n.push(239,191,189);continue}if(i+1===a){(t-=3)>-1&&n.push(239,191,189);continue}r=s;continue}if(s<56320){(t-=3)>-1&&n.push(239,191,189),r=s;continue}s=65536+(r-55296<<10|s-56320)}else r&&(t-=3)>-1&&n.push(239,191,189);if(r=null,s<128){if((t-=1)<0)break;n.push(s)}else if(s<2048){if((t-=2)<0)break;n.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;n.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return n}function j(e){return a.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,s,a){for(var r=0;r<a&&!(r+s>=t.length||r>=e.length);++r)t[r+s]=e[r];return r}}).call(this,s(3))},function(e,t,s){(function(e){!function(e,t){"use strict";function a(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e}function n(e,t,s){if(n.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(s=t,t=10),this._init(e||0,t||10,s||"be"))}var i;"object"==typeof e?e.exports=n:t.BN=n,n.BN=n,n.wordSize=26;try{i=s(20).Buffer}catch(e){}function o(e,t,s){for(var a=0,r=Math.min(e.length,s),n=t;n<r;n++){var i=e.charCodeAt(n)-48;a<<=4,a|=i>=49&&i<=54?i-49+10:i>=17&&i<=22?i-17+10:15&i}return a}function c(e,t,s,a){for(var r=0,n=Math.min(e.length,s),i=t;i<n;i++){var o=e.charCodeAt(i)-48;r*=a,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}n.isBN=function(e){return e instanceof n||null!==e&&"object"==typeof e&&e.constructor.wordSize===n.wordSize&&Array.isArray(e.words)},n.max=function(e,t){return e.cmp(t)>0?e:t},n.min=function(e,t){return e.cmp(t)<0?e:t},n.prototype._init=function(e,t,s){if("number"==typeof e)return this._initNumber(e,t,s);if("object"==typeof e)return this._initArray(e,t,s);"hex"===t&&(t=16),a(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&r++,16===t?this._parseHex(e,r):this._parseBase(e,t,r),"-"===e[0]&&(this.negative=1),this.strip(),"le"===s&&this._initArray(this.toArray(),t,s)},n.prototype._initNumber=function(e,t,s){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(a(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===s&&this._initArray(this.toArray(),t,s)},n.prototype._initArray=function(e,t,s){if(a("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var n,i,o=0;if("be"===s)for(r=e.length-1,n=0;r>=0;r-=3)i=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[n]|=i<<o&67108863,this.words[n+1]=i>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);else if("le"===s)for(r=0,n=0;r<e.length;r+=3)i=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[n]|=i<<o&67108863,this.words[n+1]=i>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);return this.strip()},n.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var a,r,n=0;for(s=e.length-6,a=0;s>=t;s-=6)r=o(e,s,s+6),this.words[a]|=r<<n&67108863,this.words[a+1]|=r>>>26-n&4194303,(n+=24)>=26&&(n-=26,a++);s+6!==t&&(r=o(e,t,s+6),this.words[a]|=r<<n&67108863,this.words[a+1]|=r>>>26-n&4194303),this.strip()},n.prototype._parseBase=function(e,t,s){this.words=[0],this.length=1;for(var a=0,r=1;r<=67108863;r*=t)a++;a--,r=r/t|0;for(var n=e.length-s,i=n%a,o=Math.min(n,n-i)+s,u=0,d=s;d<o;d+=a)u=c(e,d,d+a,t),this.imuln(r),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==i){var h=1;for(u=c(e,d,e.length,t),d=0;d<i;d++)h*=t;this.imuln(h),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}},n.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},n.prototype.clone=function(){var e=new n(null);return this.copy(e),e},n.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},n.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function l(e,t,s){s.negative=t.negative^e.negative;var a=e.length+t.length|0;s.length=a,a=a-1|0;var r=0|e.words[0],n=0|t.words[0],i=r*n,o=67108863&i,c=i/67108864|0;s.words[0]=o;for(var u=1;u<a;u++){for(var d=c>>>26,h=67108863&c,l=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=l;f++){var m=u-f|0;d+=(i=(r=0|e.words[m])*(n=0|t.words[f])+h)/67108864|0,h=67108863&i}s.words[u]=0|h,c=0|d}return 0!==c?s.words[u]=0|c:s.length--,s.strip()}n.prototype.toString=function(e,t){var s;if(t=0|t||1,16===(e=e||10)||"hex"===e){s="";for(var r=0,n=0,i=0;i<this.length;i++){var o=this.words[i],c=(16777215&(o<<r|n)).toString(16);s=0!==(n=o>>>24-r&16777215)||i!==this.length-1?u[6-c.length]+c+s:c+s,(r+=2)>=26&&(r-=26,i--)}for(0!==n&&(s=n.toString(16)+s);s.length%t!=0;)s="0"+s;return 0!==this.negative&&(s="-"+s),s}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],f=h[e];s="";var m=this.clone();for(m.negative=0;!m.isZero();){var p=m.modn(f).toString(e);s=(m=m.idivn(f)).isZero()?p+s:u[l-p.length]+p+s}for(this.isZero()&&(s="0"+s);s.length%t!=0;)s="0"+s;return 0!==this.negative&&(s="-"+s),s}a(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&a(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(e,t){return a(void 0!==i),this.toArrayLike(i,e,t)},n.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},n.prototype.toArrayLike=function(e,t,s){var r=this.byteLength(),n=s||Math.max(1,r);a(r<=n,"byte array longer than desired length"),a(n>0,"Requested array length <= 0"),this.strip();var i,o,c="le"===t,u=new e(n),d=this.clone();if(c){for(o=0;!d.isZero();o++)i=d.andln(255),d.iushrn(8),u[o]=i;for(;o<n;o++)u[o]=0}else{for(o=0;o<n-r;o++)u[o]=0;for(o=0;!d.isZero();o++)i=d.andln(255),d.iushrn(8),u[n-o-1]=i}return u},Math.clz32?n.prototype._countBits=function(e){return 32-Math.clz32(e)}:n.prototype._countBits=function(e){var t=e,s=0;return t>=4096&&(s+=13,t>>>=13),t>=64&&(s+=7,t>>>=7),t>=8&&(s+=4,t>>>=4),t>=2&&(s+=2,t>>>=2),s+t},n.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,s=0;return 0==(8191&t)&&(s+=13,t>>>=13),0==(127&t)&&(s+=7,t>>>=7),0==(15&t)&&(s+=4,t>>>=4),0==(3&t)&&(s+=2,t>>>=2),0==(1&t)&&s++,s},n.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var s=this._zeroBits(this.words[t]);if(e+=s,26!==s)break}return e},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},n.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return 0!==this.negative},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},n.prototype.ior=function(e){return a(0==(this.negative|e.negative)),this.iuor(e)},n.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},n.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},n.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var s=0;s<t.length;s++)this.words[s]=this.words[s]&e.words[s];return this.length=t.length,this.strip()},n.prototype.iand=function(e){return a(0==(this.negative|e.negative)),this.iuand(e)},n.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},n.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},n.prototype.iuxor=function(e){var t,s;this.length>e.length?(t=this,s=e):(t=e,s=this);for(var a=0;a<s.length;a++)this.words[a]=t.words[a]^s.words[a];if(this!==t)for(;a<t.length;a++)this.words[a]=t.words[a];return this.length=t.length,this.strip()},n.prototype.ixor=function(e){return a(0==(this.negative|e.negative)),this.iuxor(e)},n.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},n.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},n.prototype.inotn=function(e){a("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),s=e%26;this._expand(t),s>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return s>0&&(this.words[r]=~this.words[r]&67108863>>26-s),this.strip()},n.prototype.notn=function(e){return this.clone().inotn(e)},n.prototype.setn=function(e,t){a("number"==typeof e&&e>=0);var s=e/26|0,r=e%26;return this._expand(s+1),this.words[s]=t?this.words[s]|1<<r:this.words[s]&~(1<<r),this.strip()},n.prototype.iadd=function(e){var t,s,a;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(s=this,a=e):(s=e,a=this);for(var r=0,n=0;n<a.length;n++)t=(0|s.words[n])+(0|a.words[n])+r,this.words[n]=67108863&t,r=t>>>26;for(;0!==r&&n<s.length;n++)t=(0|s.words[n])+r,this.words[n]=67108863&t,r=t>>>26;if(this.length=s.length,0!==r)this.words[this.length]=r,this.length++;else if(s!==this)for(;n<s.length;n++)this.words[n]=s.words[n];return this},n.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},n.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var s,a,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(s=this,a=e):(s=e,a=this);for(var n=0,i=0;i<a.length;i++)n=(t=(0|s.words[i])-(0|a.words[i])+n)>>26,this.words[i]=67108863&t;for(;0!==n&&i<s.length;i++)n=(t=(0|s.words[i])+n)>>26,this.words[i]=67108863&t;if(0===n&&i<s.length&&s!==this)for(;i<s.length;i++)this.words[i]=s.words[i];return this.length=Math.max(this.length,i),s!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,s){var a,r,n,i=e.words,o=t.words,c=s.words,u=0,d=0|i[0],h=8191&d,l=d>>>13,f=0|i[1],m=8191&f,p=f>>>13,w=0|i[2],g=8191&w,y=w>>>13,b=0|i[3],v=8191&b,M=b>>>13,S=0|i[4],I=8191&S,P=S>>>13,E=0|i[5],B=8191&E,N=E>>>13,U=0|i[6],A=8191&U,T=U>>>13,k=0|i[7],D=8191&k,K=k>>>13,x=0|i[8],R=8191&x,O=x>>>13,C=0|i[9],_=8191&C,F=C>>>13,L=0|o[0],j=8191&L,q=L>>>13,V=0|o[1],H=8191&V,G=V>>>13,J=0|o[2],W=8191&J,Y=J>>>13,z=0|o[3],Z=8191&z,X=z>>>13,Q=0|o[4],$=8191&Q,ee=Q>>>13,te=0|o[5],se=8191&te,ae=te>>>13,re=0|o[6],ne=8191&re,ie=re>>>13,oe=0|o[7],ce=8191&oe,ue=oe>>>13,de=0|o[8],he=8191&de,le=de>>>13,fe=0|o[9],me=8191&fe,pe=fe>>>13;s.negative=e.negative^t.negative,s.length=19;var we=(u+(a=Math.imul(h,j))|0)+((8191&(r=(r=Math.imul(h,q))+Math.imul(l,j)|0))<<13)|0;u=((n=Math.imul(l,q))+(r>>>13)|0)+(we>>>26)|0,we&=67108863,a=Math.imul(m,j),r=(r=Math.imul(m,q))+Math.imul(p,j)|0,n=Math.imul(p,q);var ge=(u+(a=a+Math.imul(h,H)|0)|0)+((8191&(r=(r=r+Math.imul(h,G)|0)+Math.imul(l,H)|0))<<13)|0;u=((n=n+Math.imul(l,G)|0)+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,a=Math.imul(g,j),r=(r=Math.imul(g,q))+Math.imul(y,j)|0,n=Math.imul(y,q),a=a+Math.imul(m,H)|0,r=(r=r+Math.imul(m,G)|0)+Math.imul(p,H)|0,n=n+Math.imul(p,G)|0;var ye=(u+(a=a+Math.imul(h,W)|0)|0)+((8191&(r=(r=r+Math.imul(h,Y)|0)+Math.imul(l,W)|0))<<13)|0;u=((n=n+Math.imul(l,Y)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,a=Math.imul(v,j),r=(r=Math.imul(v,q))+Math.imul(M,j)|0,n=Math.imul(M,q),a=a+Math.imul(g,H)|0,r=(r=r+Math.imul(g,G)|0)+Math.imul(y,H)|0,n=n+Math.imul(y,G)|0,a=a+Math.imul(m,W)|0,r=(r=r+Math.imul(m,Y)|0)+Math.imul(p,W)|0,n=n+Math.imul(p,Y)|0;var be=(u+(a=a+Math.imul(h,Z)|0)|0)+((8191&(r=(r=r+Math.imul(h,X)|0)+Math.imul(l,Z)|0))<<13)|0;u=((n=n+Math.imul(l,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,a=Math.imul(I,j),r=(r=Math.imul(I,q))+Math.imul(P,j)|0,n=Math.imul(P,q),a=a+Math.imul(v,H)|0,r=(r=r+Math.imul(v,G)|0)+Math.imul(M,H)|0,n=n+Math.imul(M,G)|0,a=a+Math.imul(g,W)|0,r=(r=r+Math.imul(g,Y)|0)+Math.imul(y,W)|0,n=n+Math.imul(y,Y)|0,a=a+Math.imul(m,Z)|0,r=(r=r+Math.imul(m,X)|0)+Math.imul(p,Z)|0,n=n+Math.imul(p,X)|0;var ve=(u+(a=a+Math.imul(h,$)|0)|0)+((8191&(r=(r=r+Math.imul(h,ee)|0)+Math.imul(l,$)|0))<<13)|0;u=((n=n+Math.imul(l,ee)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,a=Math.imul(B,j),r=(r=Math.imul(B,q))+Math.imul(N,j)|0,n=Math.imul(N,q),a=a+Math.imul(I,H)|0,r=(r=r+Math.imul(I,G)|0)+Math.imul(P,H)|0,n=n+Math.imul(P,G)|0,a=a+Math.imul(v,W)|0,r=(r=r+Math.imul(v,Y)|0)+Math.imul(M,W)|0,n=n+Math.imul(M,Y)|0,a=a+Math.imul(g,Z)|0,r=(r=r+Math.imul(g,X)|0)+Math.imul(y,Z)|0,n=n+Math.imul(y,X)|0,a=a+Math.imul(m,$)|0,r=(r=r+Math.imul(m,ee)|0)+Math.imul(p,$)|0,n=n+Math.imul(p,ee)|0;var Me=(u+(a=a+Math.imul(h,se)|0)|0)+((8191&(r=(r=r+Math.imul(h,ae)|0)+Math.imul(l,se)|0))<<13)|0;u=((n=n+Math.imul(l,ae)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,a=Math.imul(A,j),r=(r=Math.imul(A,q))+Math.imul(T,j)|0,n=Math.imul(T,q),a=a+Math.imul(B,H)|0,r=(r=r+Math.imul(B,G)|0)+Math.imul(N,H)|0,n=n+Math.imul(N,G)|0,a=a+Math.imul(I,W)|0,r=(r=r+Math.imul(I,Y)|0)+Math.imul(P,W)|0,n=n+Math.imul(P,Y)|0,a=a+Math.imul(v,Z)|0,r=(r=r+Math.imul(v,X)|0)+Math.imul(M,Z)|0,n=n+Math.imul(M,X)|0,a=a+Math.imul(g,$)|0,r=(r=r+Math.imul(g,ee)|0)+Math.imul(y,$)|0,n=n+Math.imul(y,ee)|0,a=a+Math.imul(m,se)|0,r=(r=r+Math.imul(m,ae)|0)+Math.imul(p,se)|0,n=n+Math.imul(p,ae)|0;var Se=(u+(a=a+Math.imul(h,ne)|0)|0)+((8191&(r=(r=r+Math.imul(h,ie)|0)+Math.imul(l,ne)|0))<<13)|0;u=((n=n+Math.imul(l,ie)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,a=Math.imul(D,j),r=(r=Math.imul(D,q))+Math.imul(K,j)|0,n=Math.imul(K,q),a=a+Math.imul(A,H)|0,r=(r=r+Math.imul(A,G)|0)+Math.imul(T,H)|0,n=n+Math.imul(T,G)|0,a=a+Math.imul(B,W)|0,r=(r=r+Math.imul(B,Y)|0)+Math.imul(N,W)|0,n=n+Math.imul(N,Y)|0,a=a+Math.imul(I,Z)|0,r=(r=r+Math.imul(I,X)|0)+Math.imul(P,Z)|0,n=n+Math.imul(P,X)|0,a=a+Math.imul(v,$)|0,r=(r=r+Math.imul(v,ee)|0)+Math.imul(M,$)|0,n=n+Math.imul(M,ee)|0,a=a+Math.imul(g,se)|0,r=(r=r+Math.imul(g,ae)|0)+Math.imul(y,se)|0,n=n+Math.imul(y,ae)|0,a=a+Math.imul(m,ne)|0,r=(r=r+Math.imul(m,ie)|0)+Math.imul(p,ne)|0,n=n+Math.imul(p,ie)|0;var Ie=(u+(a=a+Math.imul(h,ce)|0)|0)+((8191&(r=(r=r+Math.imul(h,ue)|0)+Math.imul(l,ce)|0))<<13)|0;u=((n=n+Math.imul(l,ue)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,a=Math.imul(R,j),r=(r=Math.imul(R,q))+Math.imul(O,j)|0,n=Math.imul(O,q),a=a+Math.imul(D,H)|0,r=(r=r+Math.imul(D,G)|0)+Math.imul(K,H)|0,n=n+Math.imul(K,G)|0,a=a+Math.imul(A,W)|0,r=(r=r+Math.imul(A,Y)|0)+Math.imul(T,W)|0,n=n+Math.imul(T,Y)|0,a=a+Math.imul(B,Z)|0,r=(r=r+Math.imul(B,X)|0)+Math.imul(N,Z)|0,n=n+Math.imul(N,X)|0,a=a+Math.imul(I,$)|0,r=(r=r+Math.imul(I,ee)|0)+Math.imul(P,$)|0,n=n+Math.imul(P,ee)|0,a=a+Math.imul(v,se)|0,r=(r=r+Math.imul(v,ae)|0)+Math.imul(M,se)|0,n=n+Math.imul(M,ae)|0,a=a+Math.imul(g,ne)|0,r=(r=r+Math.imul(g,ie)|0)+Math.imul(y,ne)|0,n=n+Math.imul(y,ie)|0,a=a+Math.imul(m,ce)|0,r=(r=r+Math.imul(m,ue)|0)+Math.imul(p,ce)|0,n=n+Math.imul(p,ue)|0;var Pe=(u+(a=a+Math.imul(h,he)|0)|0)+((8191&(r=(r=r+Math.imul(h,le)|0)+Math.imul(l,he)|0))<<13)|0;u=((n=n+Math.imul(l,le)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,a=Math.imul(_,j),r=(r=Math.imul(_,q))+Math.imul(F,j)|0,n=Math.imul(F,q),a=a+Math.imul(R,H)|0,r=(r=r+Math.imul(R,G)|0)+Math.imul(O,H)|0,n=n+Math.imul(O,G)|0,a=a+Math.imul(D,W)|0,r=(r=r+Math.imul(D,Y)|0)+Math.imul(K,W)|0,n=n+Math.imul(K,Y)|0,a=a+Math.imul(A,Z)|0,r=(r=r+Math.imul(A,X)|0)+Math.imul(T,Z)|0,n=n+Math.imul(T,X)|0,a=a+Math.imul(B,$)|0,r=(r=r+Math.imul(B,ee)|0)+Math.imul(N,$)|0,n=n+Math.imul(N,ee)|0,a=a+Math.imul(I,se)|0,r=(r=r+Math.imul(I,ae)|0)+Math.imul(P,se)|0,n=n+Math.imul(P,ae)|0,a=a+Math.imul(v,ne)|0,r=(r=r+Math.imul(v,ie)|0)+Math.imul(M,ne)|0,n=n+Math.imul(M,ie)|0,a=a+Math.imul(g,ce)|0,r=(r=r+Math.imul(g,ue)|0)+Math.imul(y,ce)|0,n=n+Math.imul(y,ue)|0,a=a+Math.imul(m,he)|0,r=(r=r+Math.imul(m,le)|0)+Math.imul(p,he)|0,n=n+Math.imul(p,le)|0;var Ee=(u+(a=a+Math.imul(h,me)|0)|0)+((8191&(r=(r=r+Math.imul(h,pe)|0)+Math.imul(l,me)|0))<<13)|0;u=((n=n+Math.imul(l,pe)|0)+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,a=Math.imul(_,H),r=(r=Math.imul(_,G))+Math.imul(F,H)|0,n=Math.imul(F,G),a=a+Math.imul(R,W)|0,r=(r=r+Math.imul(R,Y)|0)+Math.imul(O,W)|0,n=n+Math.imul(O,Y)|0,a=a+Math.imul(D,Z)|0,r=(r=r+Math.imul(D,X)|0)+Math.imul(K,Z)|0,n=n+Math.imul(K,X)|0,a=a+Math.imul(A,$)|0,r=(r=r+Math.imul(A,ee)|0)+Math.imul(T,$)|0,n=n+Math.imul(T,ee)|0,a=a+Math.imul(B,se)|0,r=(r=r+Math.imul(B,ae)|0)+Math.imul(N,se)|0,n=n+Math.imul(N,ae)|0,a=a+Math.imul(I,ne)|0,r=(r=r+Math.imul(I,ie)|0)+Math.imul(P,ne)|0,n=n+Math.imul(P,ie)|0,a=a+Math.imul(v,ce)|0,r=(r=r+Math.imul(v,ue)|0)+Math.imul(M,ce)|0,n=n+Math.imul(M,ue)|0,a=a+Math.imul(g,he)|0,r=(r=r+Math.imul(g,le)|0)+Math.imul(y,he)|0,n=n+Math.imul(y,le)|0;var Be=(u+(a=a+Math.imul(m,me)|0)|0)+((8191&(r=(r=r+Math.imul(m,pe)|0)+Math.imul(p,me)|0))<<13)|0;u=((n=n+Math.imul(p,pe)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863,a=Math.imul(_,W),r=(r=Math.imul(_,Y))+Math.imul(F,W)|0,n=Math.imul(F,Y),a=a+Math.imul(R,Z)|0,r=(r=r+Math.imul(R,X)|0)+Math.imul(O,Z)|0,n=n+Math.imul(O,X)|0,a=a+Math.imul(D,$)|0,r=(r=r+Math.imul(D,ee)|0)+Math.imul(K,$)|0,n=n+Math.imul(K,ee)|0,a=a+Math.imul(A,se)|0,r=(r=r+Math.imul(A,ae)|0)+Math.imul(T,se)|0,n=n+Math.imul(T,ae)|0,a=a+Math.imul(B,ne)|0,r=(r=r+Math.imul(B,ie)|0)+Math.imul(N,ne)|0,n=n+Math.imul(N,ie)|0,a=a+Math.imul(I,ce)|0,r=(r=r+Math.imul(I,ue)|0)+Math.imul(P,ce)|0,n=n+Math.imul(P,ue)|0,a=a+Math.imul(v,he)|0,r=(r=r+Math.imul(v,le)|0)+Math.imul(M,he)|0,n=n+Math.imul(M,le)|0;var Ne=(u+(a=a+Math.imul(g,me)|0)|0)+((8191&(r=(r=r+Math.imul(g,pe)|0)+Math.imul(y,me)|0))<<13)|0;u=((n=n+Math.imul(y,pe)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,a=Math.imul(_,Z),r=(r=Math.imul(_,X))+Math.imul(F,Z)|0,n=Math.imul(F,X),a=a+Math.imul(R,$)|0,r=(r=r+Math.imul(R,ee)|0)+Math.imul(O,$)|0,n=n+Math.imul(O,ee)|0,a=a+Math.imul(D,se)|0,r=(r=r+Math.imul(D,ae)|0)+Math.imul(K,se)|0,n=n+Math.imul(K,ae)|0,a=a+Math.imul(A,ne)|0,r=(r=r+Math.imul(A,ie)|0)+Math.imul(T,ne)|0,n=n+Math.imul(T,ie)|0,a=a+Math.imul(B,ce)|0,r=(r=r+Math.imul(B,ue)|0)+Math.imul(N,ce)|0,n=n+Math.imul(N,ue)|0,a=a+Math.imul(I,he)|0,r=(r=r+Math.imul(I,le)|0)+Math.imul(P,he)|0,n=n+Math.imul(P,le)|0;var Ue=(u+(a=a+Math.imul(v,me)|0)|0)+((8191&(r=(r=r+Math.imul(v,pe)|0)+Math.imul(M,me)|0))<<13)|0;u=((n=n+Math.imul(M,pe)|0)+(r>>>13)|0)+(Ue>>>26)|0,Ue&=67108863,a=Math.imul(_,$),r=(r=Math.imul(_,ee))+Math.imul(F,$)|0,n=Math.imul(F,ee),a=a+Math.imul(R,se)|0,r=(r=r+Math.imul(R,ae)|0)+Math.imul(O,se)|0,n=n+Math.imul(O,ae)|0,a=a+Math.imul(D,ne)|0,r=(r=r+Math.imul(D,ie)|0)+Math.imul(K,ne)|0,n=n+Math.imul(K,ie)|0,a=a+Math.imul(A,ce)|0,r=(r=r+Math.imul(A,ue)|0)+Math.imul(T,ce)|0,n=n+Math.imul(T,ue)|0,a=a+Math.imul(B,he)|0,r=(r=r+Math.imul(B,le)|0)+Math.imul(N,he)|0,n=n+Math.imul(N,le)|0;var Ae=(u+(a=a+Math.imul(I,me)|0)|0)+((8191&(r=(r=r+Math.imul(I,pe)|0)+Math.imul(P,me)|0))<<13)|0;u=((n=n+Math.imul(P,pe)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,a=Math.imul(_,se),r=(r=Math.imul(_,ae))+Math.imul(F,se)|0,n=Math.imul(F,ae),a=a+Math.imul(R,ne)|0,r=(r=r+Math.imul(R,ie)|0)+Math.imul(O,ne)|0,n=n+Math.imul(O,ie)|0,a=a+Math.imul(D,ce)|0,r=(r=r+Math.imul(D,ue)|0)+Math.imul(K,ce)|0,n=n+Math.imul(K,ue)|0,a=a+Math.imul(A,he)|0,r=(r=r+Math.imul(A,le)|0)+Math.imul(T,he)|0,n=n+Math.imul(T,le)|0;var Te=(u+(a=a+Math.imul(B,me)|0)|0)+((8191&(r=(r=r+Math.imul(B,pe)|0)+Math.imul(N,me)|0))<<13)|0;u=((n=n+Math.imul(N,pe)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,a=Math.imul(_,ne),r=(r=Math.imul(_,ie))+Math.imul(F,ne)|0,n=Math.imul(F,ie),a=a+Math.imul(R,ce)|0,r=(r=r+Math.imul(R,ue)|0)+Math.imul(O,ce)|0,n=n+Math.imul(O,ue)|0,a=a+Math.imul(D,he)|0,r=(r=r+Math.imul(D,le)|0)+Math.imul(K,he)|0,n=n+Math.imul(K,le)|0;var ke=(u+(a=a+Math.imul(A,me)|0)|0)+((8191&(r=(r=r+Math.imul(A,pe)|0)+Math.imul(T,me)|0))<<13)|0;u=((n=n+Math.imul(T,pe)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,a=Math.imul(_,ce),r=(r=Math.imul(_,ue))+Math.imul(F,ce)|0,n=Math.imul(F,ue),a=a+Math.imul(R,he)|0,r=(r=r+Math.imul(R,le)|0)+Math.imul(O,he)|0,n=n+Math.imul(O,le)|0;var De=(u+(a=a+Math.imul(D,me)|0)|0)+((8191&(r=(r=r+Math.imul(D,pe)|0)+Math.imul(K,me)|0))<<13)|0;u=((n=n+Math.imul(K,pe)|0)+(r>>>13)|0)+(De>>>26)|0,De&=67108863,a=Math.imul(_,he),r=(r=Math.imul(_,le))+Math.imul(F,he)|0,n=Math.imul(F,le);var Ke=(u+(a=a+Math.imul(R,me)|0)|0)+((8191&(r=(r=r+Math.imul(R,pe)|0)+Math.imul(O,me)|0))<<13)|0;u=((n=n+Math.imul(O,pe)|0)+(r>>>13)|0)+(Ke>>>26)|0,Ke&=67108863;var xe=(u+(a=Math.imul(_,me))|0)+((8191&(r=(r=Math.imul(_,pe))+Math.imul(F,me)|0))<<13)|0;return u=((n=Math.imul(F,pe))+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,c[0]=we,c[1]=ge,c[2]=ye,c[3]=be,c[4]=ve,c[5]=Me,c[6]=Se,c[7]=Ie,c[8]=Pe,c[9]=Ee,c[10]=Be,c[11]=Ne,c[12]=Ue,c[13]=Ae,c[14]=Te,c[15]=ke,c[16]=De,c[17]=Ke,c[18]=xe,0!==u&&(c[19]=u,s.length++),s};function m(e,t,s){return(new p).mulp(e,t,s)}function p(e,t){this.x=e,this.y=t}Math.imul||(f=l),n.prototype.mulTo=function(e,t){var s=this.length+e.length;return 10===this.length&&10===e.length?f(this,e,t):s<63?l(this,e,t):s<1024?function(e,t,s){s.negative=t.negative^e.negative,s.length=e.length+t.length;for(var a=0,r=0,n=0;n<s.length-1;n++){var i=r;r=0;for(var o=67108863&a,c=Math.min(n,t.length-1),u=Math.max(0,n-e.length+1);u<=c;u++){var d=n-u,h=(0|e.words[d])*(0|t.words[u]),l=67108863&h;o=67108863&(l=l+o|0),r+=(i=(i=i+(h/67108864|0)|0)+(l>>>26)|0)>>>26,i&=67108863}s.words[n]=o,a=i,i=r}return 0!==a?s.words[n]=a:s.length--,s.strip()}(this,e,t):m(this,e,t)},p.prototype.makeRBT=function(e){for(var t=new Array(e),s=n.prototype._countBits(e)-1,a=0;a<e;a++)t[a]=this.revBin(a,s,e);return t},p.prototype.revBin=function(e,t,s){if(0===e||e===s-1)return e;for(var a=0,r=0;r<t;r++)a|=(1&e)<<t-r-1,e>>=1;return a},p.prototype.permute=function(e,t,s,a,r,n){for(var i=0;i<n;i++)a[i]=t[e[i]],r[i]=s[e[i]]},p.prototype.transform=function(e,t,s,a,r,n){this.permute(n,e,t,s,a,r);for(var i=1;i<r;i<<=1)for(var o=i<<1,c=Math.cos(2*Math.PI/o),u=Math.sin(2*Math.PI/o),d=0;d<r;d+=o)for(var h=c,l=u,f=0;f<i;f++){var m=s[d+f],p=a[d+f],w=s[d+f+i],g=a[d+f+i],y=h*w-l*g;g=h*g+l*w,w=y,s[d+f]=m+w,a[d+f]=p+g,s[d+f+i]=m-w,a[d+f+i]=p-g,f!==o&&(y=c*h-u*l,l=c*l+u*h,h=y)}},p.prototype.guessLen13b=function(e,t){var s=1|Math.max(t,e),a=1&s,r=0;for(s=s/2|0;s;s>>>=1)r++;return 1<<r+1+a},p.prototype.conjugate=function(e,t,s){if(!(s<=1))for(var a=0;a<s/2;a++){var r=e[a];e[a]=e[s-a-1],e[s-a-1]=r,r=t[a],t[a]=-t[s-a-1],t[s-a-1]=-r}},p.prototype.normalize13b=function(e,t){for(var s=0,a=0;a<t/2;a++){var r=8192*Math.round(e[2*a+1]/t)+Math.round(e[2*a]/t)+s;e[a]=67108863&r,s=r<67108864?0:r/67108864|0}return e},p.prototype.convert13b=function(e,t,s,r){for(var n=0,i=0;i<t;i++)n+=0|e[i],s[2*i]=8191&n,n>>>=13,s[2*i+1]=8191&n,n>>>=13;for(i=2*t;i<r;++i)s[i]=0;a(0===n),a(0==(-8192&n))},p.prototype.stub=function(e){for(var t=new Array(e),s=0;s<e;s++)t[s]=0;return t},p.prototype.mulp=function(e,t,s){var a=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(a),n=this.stub(a),i=new Array(a),o=new Array(a),c=new Array(a),u=new Array(a),d=new Array(a),h=new Array(a),l=s.words;l.length=a,this.convert13b(e.words,e.length,i,a),this.convert13b(t.words,t.length,u,a),this.transform(i,n,o,c,a,r),this.transform(u,n,d,h,a,r);for(var f=0;f<a;f++){var m=o[f]*d[f]-c[f]*h[f];c[f]=o[f]*h[f]+c[f]*d[f],o[f]=m}return this.conjugate(o,c,a),this.transform(o,c,l,n,a,r),this.conjugate(l,n,a),this.normalize13b(l,a),s.negative=e.negative^t.negative,s.length=e.length+t.length,s.strip()},n.prototype.mul=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},n.prototype.mulf=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),m(this,e,t)},n.prototype.imul=function(e){return this.clone().mulTo(e,this)},n.prototype.imuln=function(e){a("number"==typeof e),a(e<67108864);for(var t=0,s=0;s<this.length;s++){var r=(0|this.words[s])*e,n=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=n>>>26,this.words[s]=67108863&n}return 0!==t&&(this.words[s]=t,this.length++),this},n.prototype.muln=function(e){return this.clone().imuln(e)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),s=0;s<t.length;s++){var a=s/26|0,r=s%26;t[s]=(e.words[a]&1<<r)>>>r}return t}(e);if(0===t.length)return new n(1);for(var s=this,a=0;a<t.length&&0===t[a];a++,s=s.sqr());if(++a<t.length)for(var r=s.sqr();a<t.length;a++,r=r.sqr())0!==t[a]&&(s=s.mul(r));return s},n.prototype.iushln=function(e){a("number"==typeof e&&e>=0);var t,s=e%26,r=(e-s)/26,n=67108863>>>26-s<<26-s;if(0!==s){var i=0;for(t=0;t<this.length;t++){var o=this.words[t]&n,c=(0|this.words[t])-o<<s;this.words[t]=c|i,i=o>>>26-s}i&&(this.words[t]=i,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},n.prototype.ishln=function(e){return a(0===this.negative),this.iushln(e)},n.prototype.iushrn=function(e,t,s){var r;a("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var n=e%26,i=Math.min((e-n)/26,this.length),o=67108863^67108863>>>n<<n,c=s;if(r-=i,r=Math.max(0,r),c){for(var u=0;u<i;u++)c.words[u]=this.words[u];c.length=i}if(0===i);else if(this.length>i)for(this.length-=i,u=0;u<this.length;u++)this.words[u]=this.words[u+i];else this.words[0]=0,this.length=1;var d=0;for(u=this.length-1;u>=0&&(0!==d||u>=r);u--){var h=0|this.words[u];this.words[u]=d<<26-n|h>>>n,d=h&o}return c&&0!==d&&(c.words[c.length++]=d),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(e,t,s){return a(0===this.negative),this.iushrn(e,t,s)},n.prototype.shln=function(e){return this.clone().ishln(e)},n.prototype.ushln=function(e){return this.clone().iushln(e)},n.prototype.shrn=function(e){return this.clone().ishrn(e)},n.prototype.ushrn=function(e){return this.clone().iushrn(e)},n.prototype.testn=function(e){a("number"==typeof e&&e>=0);var t=e%26,s=(e-t)/26,r=1<<t;return!(this.length<=s)&&!!(this.words[s]&r)},n.prototype.imaskn=function(e){a("number"==typeof e&&e>=0);var t=e%26,s=(e-t)/26;if(a(0===this.negative,"imaskn works only with positive numbers"),this.length<=s)return this;if(0!==t&&s++,this.length=Math.min(s,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},n.prototype.maskn=function(e){return this.clone().imaskn(e)},n.prototype.iaddn=function(e){return a("number"==typeof e),a(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},n.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},n.prototype.isubn=function(e){if(a("number"==typeof e),a(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},n.prototype.addn=function(e){return this.clone().iaddn(e)},n.prototype.subn=function(e){return this.clone().isubn(e)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(e,t,s){var r,n,i=e.length+s;this._expand(i);var o=0;for(r=0;r<e.length;r++){n=(0|this.words[r+s])+o;var c=(0|e.words[r])*t;o=((n-=67108863&c)>>26)-(c/67108864|0),this.words[r+s]=67108863&n}for(;r<this.length-s;r++)o=(n=(0|this.words[r+s])+o)>>26,this.words[r+s]=67108863&n;if(0===o)return this.strip();for(a(-1===o),o=0,r=0;r<this.length;r++)o=(n=-(0|this.words[r])+o)>>26,this.words[r]=67108863&n;return this.negative=1,this.strip()},n.prototype._wordDiv=function(e,t){var s=(this.length,e.length),a=this.clone(),r=e,i=0|r.words[r.length-1];0!==(s=26-this._countBits(i))&&(r=r.ushln(s),a.iushln(s),i=0|r.words[r.length-1]);var o,c=a.length-r.length;if("mod"!==t){(o=new n(null)).length=c+1,o.words=new Array(o.length);for(var u=0;u<o.length;u++)o.words[u]=0}var d=a.clone()._ishlnsubmul(r,1,c);0===d.negative&&(a=d,o&&(o.words[c]=1));for(var h=c-1;h>=0;h--){var l=67108864*(0|a.words[r.length+h])+(0|a.words[r.length+h-1]);for(l=Math.min(l/i|0,67108863),a._ishlnsubmul(r,l,h);0!==a.negative;)l--,a.negative=0,a._ishlnsubmul(r,1,h),a.isZero()||(a.negative^=1);o&&(o.words[h]=l)}return o&&o.strip(),a.strip(),"div"!==t&&0!==s&&a.iushrn(s),{div:o||null,mod:a}},n.prototype.divmod=function(e,t,s){return a(!e.isZero()),this.isZero()?{div:new n(0),mod:new n(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(i=o.mod.neg(),s&&0!==i.negative&&i.iadd(e)),{div:r,mod:i}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(i=o.mod.neg(),s&&0!==i.negative&&i.isub(e)),{div:o.div,mod:i}):e.length>this.length||this.cmp(e)<0?{div:new n(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new n(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new n(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,i,o},n.prototype.div=function(e){return this.divmod(e,"div",!1).div},n.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},n.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},n.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var s=0!==t.div.negative?t.mod.isub(e):t.mod,a=e.ushrn(1),r=e.andln(1),n=s.cmp(a);return n<0||1===r&&0===n?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},n.prototype.modn=function(e){a(e<=67108863);for(var t=(1<<26)%e,s=0,r=this.length-1;r>=0;r--)s=(t*s+(0|this.words[r]))%e;return s},n.prototype.idivn=function(e){a(e<=67108863);for(var t=0,s=this.length-1;s>=0;s--){var r=(0|this.words[s])+67108864*t;this.words[s]=r/e|0,t=r%e}return this.strip()},n.prototype.divn=function(e){return this.clone().idivn(e)},n.prototype.egcd=function(e){a(0===e.negative),a(!e.isZero());var t=this,s=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new n(1),i=new n(0),o=new n(0),c=new n(1),u=0;t.isEven()&&s.isEven();)t.iushrn(1),s.iushrn(1),++u;for(var d=s.clone(),h=t.clone();!t.isZero();){for(var l=0,f=1;0==(t.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(t.iushrn(l);l-- >0;)(r.isOdd()||i.isOdd())&&(r.iadd(d),i.isub(h)),r.iushrn(1),i.iushrn(1);for(var m=0,p=1;0==(s.words[0]&p)&&m<26;++m,p<<=1);if(m>0)for(s.iushrn(m);m-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(d),c.isub(h)),o.iushrn(1),c.iushrn(1);t.cmp(s)>=0?(t.isub(s),r.isub(o),i.isub(c)):(s.isub(t),o.isub(r),c.isub(i))}return{a:o,b:c,gcd:s.iushln(u)}},n.prototype._invmp=function(e){a(0===e.negative),a(!e.isZero());var t=this,s=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,i=new n(1),o=new n(0),c=s.clone();t.cmpn(1)>0&&s.cmpn(1)>0;){for(var u=0,d=1;0==(t.words[0]&d)&&u<26;++u,d<<=1);if(u>0)for(t.iushrn(u);u-- >0;)i.isOdd()&&i.iadd(c),i.iushrn(1);for(var h=0,l=1;0==(s.words[0]&l)&&h<26;++h,l<<=1);if(h>0)for(s.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);t.cmp(s)>=0?(t.isub(s),i.isub(o)):(s.isub(t),o.isub(i))}return(r=0===t.cmpn(1)?i:o).cmpn(0)<0&&r.iadd(e),r},n.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),s=e.clone();t.negative=0,s.negative=0;for(var a=0;t.isEven()&&s.isEven();a++)t.iushrn(1),s.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;s.isEven();)s.iushrn(1);var r=t.cmp(s);if(r<0){var n=t;t=s,s=n}else if(0===r||0===s.cmpn(1))break;t.isub(s)}return s.iushln(a)},n.prototype.invm=function(e){return this.egcd(e).a.umod(e)},n.prototype.isEven=function(){return 0==(1&this.words[0])},n.prototype.isOdd=function(){return 1==(1&this.words[0])},n.prototype.andln=function(e){return this.words[0]&e},n.prototype.bincn=function(e){a("number"==typeof e);var t=e%26,s=(e-t)/26,r=1<<t;if(this.length<=s)return this._expand(s+1),this.words[s]|=r,this;for(var n=r,i=s;0!==n&&i<this.length;i++){var o=0|this.words[i];n=(o+=n)>>>26,o&=67108863,this.words[i]=o}return 0!==n&&(this.words[i]=n,this.length++),this},n.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},n.prototype.cmpn=function(e){var t,s=e<0;if(0!==this.negative&&!s)return-1;if(0===this.negative&&s)return 1;if(this.strip(),this.length>1)t=1;else{s&&(e=-e),a(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},n.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},n.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,s=this.length-1;s>=0;s--){var a=0|this.words[s],r=0|e.words[s];if(a!==r){a<r?t=-1:a>r&&(t=1);break}}return t},n.prototype.gtn=function(e){return 1===this.cmpn(e)},n.prototype.gt=function(e){return 1===this.cmp(e)},n.prototype.gten=function(e){return this.cmpn(e)>=0},n.prototype.gte=function(e){return this.cmp(e)>=0},n.prototype.ltn=function(e){return-1===this.cmpn(e)},n.prototype.lt=function(e){return-1===this.cmp(e)},n.prototype.lten=function(e){return this.cmpn(e)<=0},n.prototype.lte=function(e){return this.cmp(e)<=0},n.prototype.eqn=function(e){return 0===this.cmpn(e)},n.prototype.eq=function(e){return 0===this.cmp(e)},n.red=function(e){return new S(e)},n.prototype.toRed=function(e){return a(!this.red,"Already a number in reduction context"),a(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},n.prototype.fromRed=function(){return a(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(e){return this.red=e,this},n.prototype.forceRed=function(e){return a(!this.red,"Already a number in reduction context"),this._forceRed(e)},n.prototype.redAdd=function(e){return a(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},n.prototype.redIAdd=function(e){return a(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},n.prototype.redSub=function(e){return a(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},n.prototype.redISub=function(e){return a(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},n.prototype.redShl=function(e){return a(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},n.prototype.redMul=function(e){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},n.prototype.redIMul=function(e){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},n.prototype.redSqr=function(){return a(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return a(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return a(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return a(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return a(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(e){return a(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};function g(e,t){this.name=e,this.p=new n(t,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function y(){g.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){g.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){g.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function M(){g.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(e){if("string"==typeof e){var t=n._prime(e);this.m=t.p,this.prime=t}else a(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function I(e){S.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g.prototype._tmp=function(){var e=new n(null);return e.words=new Array(Math.ceil(this.n/13)),e},g.prototype.ireduce=function(e){var t,s=e;do{this.split(s,this.tmp),t=(s=(s=this.imulK(s)).iadd(this.tmp)).bitLength()}while(t>this.n);var a=t<this.n?-1:s.ucmp(this.p);return 0===a?(s.words[0]=0,s.length=1):a>0?s.isub(this.p):void 0!==s.strip?s.strip():s._strip(),s},g.prototype.split=function(e,t){e.iushrn(this.n,0,t)},g.prototype.imulK=function(e){return e.imul(this.k)},r(y,g),y.prototype.split=function(e,t){for(var s=Math.min(e.length,9),a=0;a<s;a++)t.words[a]=e.words[a];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var r=e.words[9];for(t.words[t.length++]=4194303&r,a=10;a<e.length;a++){var n=0|e.words[a];e.words[a-10]=(4194303&n)<<4|r>>>22,r=n}r>>>=22,e.words[a-10]=r,0===r&&e.length>10?e.length-=10:e.length-=9},y.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,s=0;s<e.length;s++){var a=0|e.words[s];t+=977*a,e.words[s]=67108863&t,t=64*a+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(b,g),r(v,g),r(M,g),M.prototype.imulK=function(e){for(var t=0,s=0;s<e.length;s++){var a=19*(0|e.words[s])+t,r=67108863&a;a>>>=26,e.words[s]=r,t=a}return 0!==t&&(e.words[e.length++]=t),e},n._prime=function(e){if(w[e])return w[e];var t;if("k256"===e)t=new y;else if("p224"===e)t=new b;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new M}return w[e]=t,t},S.prototype._verify1=function(e){a(0===e.negative,"red works only with positives"),a(e.red,"red works only with red numbers")},S.prototype._verify2=function(e,t){a(0==(e.negative|t.negative),"red works only with positives"),a(e.red&&e.red===t.red,"red works only with red numbers")},S.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},S.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},S.prototype.add=function(e,t){this._verify2(e,t);var s=e.add(t);return s.cmp(this.m)>=0&&s.isub(this.m),s._forceRed(this)},S.prototype.iadd=function(e,t){this._verify2(e,t);var s=e.iadd(t);return s.cmp(this.m)>=0&&s.isub(this.m),s},S.prototype.sub=function(e,t){this._verify2(e,t);var s=e.sub(t);return s.cmpn(0)<0&&s.iadd(this.m),s._forceRed(this)},S.prototype.isub=function(e,t){this._verify2(e,t);var s=e.isub(t);return s.cmpn(0)<0&&s.iadd(this.m),s},S.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},S.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},S.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},S.prototype.isqr=function(e){return this.imul(e,e.clone())},S.prototype.sqr=function(e){return this.mul(e,e)},S.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(a(t%2==1),3===t){var s=this.m.add(new n(1)).iushrn(2);return this.pow(e,s)}for(var r=this.m.subn(1),i=0;!r.isZero()&&0===r.andln(1);)i++,r.iushrn(1);a(!r.isZero());var o=new n(1).toRed(this),c=o.redNeg(),u=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);0!==this.pow(d,u).cmp(c);)d.redIAdd(c);for(var h=this.pow(d,r),l=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),m=i;0!==f.cmp(o);){for(var p=f,w=0;0!==p.cmp(o);w++)p=p.redSqr();a(w<m);var g=this.pow(h,new n(1).iushln(m-w-1));l=l.redMul(g),h=g.redSqr(),f=f.redMul(h),m=w}return l},S.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},S.prototype.pow=function(e,t){if(t.isZero())return new n(1).toRed(this);if(0===t.cmpn(1))return e.clone();var s=new Array(16);s[0]=new n(1).toRed(this),s[1]=e;for(var a=2;a<s.length;a++)s[a]=this.mul(s[a-1],e);var r=s[0],i=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),a=t.length-1;a>=0;a--){for(var u=t.words[a],d=c-1;d>=0;d--){var h=u>>d&1;r!==s[0]&&(r=this.sqr(r)),0!==h||0!==i?(i<<=1,i|=h,(4===++o||0===a&&0===d)&&(r=this.mul(r,s[i]),o=0,i=0)):o=0}c=26}return r},S.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},S.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},n.mont=function(e){return new I(e)},r(I,S),I.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},I.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},I.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var s=e.imul(t),a=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=s.isub(a).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},I.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new n(0)._forceRed(this);var s=e.mul(t),a=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=s.isub(a).iushrn(this.shift),i=r;return r.cmp(this.m)>=0?i=r.isub(this.m):r.cmpn(0)<0&&(i=r.iadd(this.m)),i._forceRed(this)},I.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)}).call(this,s(19)(e))},function(e,t,s){var a=s(7);e.exports=y,y.simpleSieve=w,y.fermatTest=g;var r=s(5),n=new r(24),i=new(s(9)),o=new r(1),c=new r(2),u=new r(5),d=(new r(16),new r(8),new r(10)),h=new r(3),l=(new r(7),new r(11)),f=new r(4),m=(new r(12),null);function p(){if(null!==m)return m;var e=[];e[0]=2;for(var t=1,s=3;s<1048576;s+=2){for(var a=Math.ceil(Math.sqrt(s)),r=0;r<t&&e[r]<=a&&s%e[r]!=0;r++);t!==r&&e[r]<=a||(e[t++]=s)}return m=e,e}function w(e){for(var t=p(),s=0;s<t.length;s++)if(0===e.modn(t[s]))return 0===e.cmpn(t[s]);return!0}function g(e){var t=r.mont(e);return 0===c.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function y(e,t){if(e<16)return new r(2===t||5===t?[140,123]:[140,39]);var s,m;for(t=new r(t);;){for(s=new r(a(Math.ceil(e/8)));s.bitLength()>e;)s.ishrn(1);if(s.isEven()&&s.iadd(o),s.testn(1)||s.iadd(c),t.cmp(c)){if(!t.cmp(u))for(;s.mod(d).cmp(h);)s.iadd(f)}else for(;s.mod(n).cmp(l);)s.iadd(f);if(w(m=s.shrn(1))&&w(s)&&g(m)&&g(s)&&i.test(m)&&i.test(s))return s}}},function(e,t,s){"use strict";(function(t,a){var r=s(18).Buffer,n=t.crypto||t.msCrypto;n&&n.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var s=r.allocUnsafe(e);if(e>0)if(e>65536)for(var i=0;i<e;i+=65536)n.getRandomValues(s.slice(i,i+65536));else n.getRandomValues(s);if("function"==typeof t)return a.nextTick((function(){t(null,s)}));return s}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,s(3),s(8))},function(e,t){var s,a,r=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(s===setTimeout)return setTimeout(e,0);if((s===n||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:n}catch(e){s=n}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var c,u=[],d=!1,h=-1;function l(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=o(l);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];u.push(new m(e,t)),1!==u.length||d||o(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,s){var a=s(5),r=s(21);function n(e){this.rand=e||new r.Rand}e.exports=n,n.create=function(e){return new n(e)},n.prototype._randbelow=function(e){var t=e.bitLength(),s=Math.ceil(t/8);do{var r=new a(this.rand.generate(s))}while(r.cmp(e)>=0);return r},n.prototype._randrange=function(e,t){var s=t.sub(e);return e.add(this._randbelow(s))},n.prototype.test=function(e,t,s){var r=e.bitLength(),n=a.mont(e),i=new a(1).toRed(n);t||(t=Math.max(1,r/48|0));for(var o=e.subn(1),c=0;!o.testn(c);c++);for(var u=e.shrn(c),d=o.toRed(n);t>0;t--){var h=this._randrange(new a(2),o);s&&s(h);var l=h.toRed(n).redPow(u);if(0!==l.cmp(i)&&0!==l.cmp(d)){for(var f=1;f<c;f++){if(0===(l=l.redSqr()).cmp(i))return!1;if(0===l.cmp(d))break}if(f===c)return!1}}return!0},n.prototype.getDivisor=function(e,t){var s=e.bitLength(),r=a.mont(e),n=new a(1).toRed(r);t||(t=Math.max(1,s/48|0));for(var i=e.subn(1),o=0;!i.testn(o);o++);for(var c=e.shrn(o),u=i.toRed(r);t>0;t--){var d=this._randrange(new a(2),i),h=e.gcd(d);if(0!==h.cmpn(1))return h;var l=d.toRed(r).redPow(c);if(0!==l.cmp(n)&&0!==l.cmp(u)){for(var f=1;f<o;f++){if(0===(l=l.redSqr()).cmp(n))return l.fromRed().subn(1).gcd(e);if(0===l.cmp(u))break}if(f===o)return(l=l.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},function(e,t,s){(function(e){var a=s(6),r=s(23),n=s(24);var i={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(t){var s=new e(r[t].prime,"hex"),a=new e(r[t].gen,"hex");return new n(s,a)},t.createDiffieHellman=t.DiffieHellman=function t(s,r,o,c){return e.isBuffer(r)||void 0===i[r]?t(s,"binary",r,o):(r=r||"binary",c=c||"binary",o=o||new e([2]),e.isBuffer(o)||(o=new e(o,c)),"number"==typeof s?new n(a(s,o),o,!0):(e.isBuffer(s)||(s=new e(s,r)),new n(s,o,!0)))}}).call(this,s(4).Buffer)},function(e,t,s){"use strict";(function(t){!function(s){function a(e){const t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let s=1779033703,a=3144134277,r=1013904242,n=2773480762,i=1359893119,o=2600822924,c=528734635,u=1541459225;const d=new Uint32Array(64);function h(e){let h=0,l=e.length;for(;l>=64;){let f,m,p,w,g,y=s,b=a,v=r,M=n,S=i,I=o,P=c,E=u;for(m=0;m<16;m++)p=h+4*m,d[m]=(255&e[p])<<24|(255&e[p+1])<<16|(255&e[p+2])<<8|255&e[p+3];for(m=16;m<64;m++)f=d[m-2],w=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,f=d[m-15],g=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,d[m]=(w+d[m-7]|0)+(g+d[m-16]|0)|0;for(m=0;m<64;m++)w=(((S>>>6|S<<26)^(S>>>11|S<<21)^(S>>>25|S<<7))+(S&I^~S&P)|0)+(E+(t[m]+d[m]|0)|0)|0,g=((y>>>2|y<<30)^(y>>>13|y<<19)^(y>>>22|y<<10))+(y&b^y&v^b&v)|0,E=P,P=I,I=S,S=M+w|0,M=v,v=b,b=y,y=w+g|0;s=s+y|0,a=a+b|0,r=r+v|0,n=n+M|0,i=i+S|0,o=o+I|0,c=c+P|0,u=u+E|0,h+=64,l-=64}}h(e);let l,f=e.length%64,m=e.length/536870912|0,p=e.length<<3,w=f<56?56:120,g=e.slice(e.length-f,e.length);for(g.push(128),l=f+1;l<w;l++)g.push(0);return g.push(m>>>24&255),g.push(m>>>16&255),g.push(m>>>8&255),g.push(m>>>0&255),g.push(p>>>24&255),g.push(p>>>16&255),g.push(p>>>8&255),g.push(p>>>0&255),h(g),[s>>>24&255,s>>>16&255,s>>>8&255,s>>>0&255,a>>>24&255,a>>>16&255,a>>>8&255,a>>>0&255,r>>>24&255,r>>>16&255,r>>>8&255,r>>>0&255,n>>>24&255,n>>>16&255,n>>>8&255,n>>>0&255,i>>>24&255,i>>>16&255,i>>>8&255,i>>>0&255,o>>>24&255,o>>>16&255,o>>>8&255,o>>>0&255,c>>>24&255,c>>>16&255,c>>>8&255,c>>>0&255,u>>>24&255,u>>>16&255,u>>>8&255,u>>>0&255]}function r(e,t,s){e=e.length<=64?e:a(e);const r=64+t.length+4,n=new Array(r),i=new Array(64);let o,c=[];for(o=0;o<64;o++)n[o]=54;for(o=0;o<e.length;o++)n[o]^=e[o];for(o=0;o<t.length;o++)n[64+o]=t[o];for(o=r-4;o<r;o++)n[o]=0;for(o=0;o<64;o++)i[o]=92;for(o=0;o<e.length;o++)i[o]^=e[o];function u(){for(let e=r-1;e>=r-4;e--){if(n[e]++,n[e]<=255)return;n[e]=0}}for(;s>=32;)u(),c=c.concat(a(i.concat(a(n)))),s-=32;return s>0&&(u(),c=c.concat(a(i.concat(a(n))).slice(0,s))),c}function n(e,t,s,a,r){let n;for(u(e,16*(2*s-1),r,0,16),n=0;n<2*s;n++)c(e,16*n,r,16),o(r,a),u(r,0,e,t+16*n,16);for(n=0;n<s;n++)u(e,t+2*n*16,e,16*n,16);for(n=0;n<s;n++)u(e,t+16*(2*n+1),e,16*(n+s),16)}function i(e,t){return e<<t|e>>>32-t}function o(e,t){u(e,0,t,0,16);for(let e=8;e>0;e-=2)t[4]^=i(t[0]+t[12],7),t[8]^=i(t[4]+t[0],9),t[12]^=i(t[8]+t[4],13),t[0]^=i(t[12]+t[8],18),t[9]^=i(t[5]+t[1],7),t[13]^=i(t[9]+t[5],9),t[1]^=i(t[13]+t[9],13),t[5]^=i(t[1]+t[13],18),t[14]^=i(t[10]+t[6],7),t[2]^=i(t[14]+t[10],9),t[6]^=i(t[2]+t[14],13),t[10]^=i(t[6]+t[2],18),t[3]^=i(t[15]+t[11],7),t[7]^=i(t[3]+t[15],9),t[11]^=i(t[7]+t[3],13),t[15]^=i(t[11]+t[7],18),t[1]^=i(t[0]+t[3],7),t[2]^=i(t[1]+t[0],9),t[3]^=i(t[2]+t[1],13),t[0]^=i(t[3]+t[2],18),t[6]^=i(t[5]+t[4],7),t[7]^=i(t[6]+t[5],9),t[4]^=i(t[7]+t[6],13),t[5]^=i(t[4]+t[7],18),t[11]^=i(t[10]+t[9],7),t[8]^=i(t[11]+t[10],9),t[9]^=i(t[8]+t[11],13),t[10]^=i(t[9]+t[8],18),t[12]^=i(t[15]+t[14],7),t[13]^=i(t[12]+t[15],9),t[14]^=i(t[13]+t[12],13),t[15]^=i(t[14]+t[13],18);for(let s=0;s<16;++s)e[s]+=t[s]}function c(e,t,s,a){for(let r=0;r<a;r++)s[r]^=e[t+r]}function u(e,t,s,a,r){for(;r--;)s[a++]=e[t++]}function d(e){if(!e||"number"!=typeof e.length)return!1;for(let t=0;t<e.length;t++){const s=e[t];if("number"!=typeof s||s%1||s<0||s>=256)return!1}return!0}function h(e,t){if("number"!=typeof e||e%1)throw new Error("invalid "+t);return e}function l(e,s,a,i,o,l,f){if(a=h(a,"N"),i=h(i,"r"),o=h(o,"p"),l=h(l,"dkLen"),0===a||0!=(a&a-1))throw new Error("N must be power of 2");if(a>2147483647/128/i)throw new Error("N too large");if(i>2147483647/128/o)throw new Error("r too large");if(!d(e))throw new Error("password must be an array or buffer");if(e=Array.prototype.slice.call(e),!d(s))throw new Error("salt must be an array or buffer");s=Array.prototype.slice.call(s);let m=r(e,s,128*o*i);const p=new Uint32Array(32*o*i);for(let e=0;e<p.length;e++){const t=4*e;p[e]=(255&m[t+3])<<24|(255&m[t+2])<<16|(255&m[t+1])<<8|(255&m[t+0])<<0}const w=new Uint32Array(64*i),g=new Uint32Array(32*i*a),y=32*i,b=new Uint32Array(16),v=new Uint32Array(16),M=o*a*2;let S,I,P=0,E=null,B=!1,N=0,U=0;const A=f?parseInt(1e3/i):4294967295,T=void 0!==t?t:setTimeout,k=function(){if(B)return f(new Error("cancelled"),P/M);let t;switch(N){case 0:I=32*U*i,u(p,I,w,0,y),N=1,S=0;case 1:t=a-S,t>A&&(t=A);for(let e=0;e<t;e++)u(w,0,g,(S+e)*y,y),n(w,y,i,b,v);if(S+=t,P+=t,f){const e=parseInt(1e3*P/M);if(e!==E){if(B=f(null,P/M),B)break;E=e}}if(S<a)break;S=0,N=2;case 2:t=a-S,t>A&&(t=A);for(let e=0;e<t;e++){const e=w[16*(2*i-1)]&a-1;c(g,e*y,w,y),n(w,y,i,b,v)}if(S+=t,P+=t,f){const e=parseInt(1e3*P/M);if(e!==E){if(B=f(null,P/M),B)break;E=e}}if(S<a)break;if(u(w,0,p,I,y),U++,U<o){N=0;break}m=[];for(let e=0;e<p.length;e++)m.push(p[e]>>0&255),m.push(p[e]>>8&255),m.push(p[e]>>16&255),m.push(p[e]>>24&255);const s=r(e,m,l);return f&&f(null,1,s),s}f&&T(k)};if(!f)for(;;){const e=k();if(null!=e)return e}k()}const f={scrypt:function(e,t,s,a,r,n,i){return new Promise((function(o,c){let u=0;i&&i(0),l(e,t,s,a,r,n,(function(e,t,s){if(e)c(e);else if(s)i&&1!==u&&i(1),o(new Uint8Array(s));else if(i&&t!==u)return u=t,i(t)}))}))},syncScrypt:function(e,t,s,a,r,n){return new Uint8Array(l(e,t,s,a,r,n))}};e.exports=f}()}).call(this,s(25).setImmediate)},function(e,t,s){var a,r=function(){var e,t,s=((t=(e={constructor:function(e,t){this.array=[],this.compare=t||a;for(var s=e.length,r=0;r<s;)this.insert(e[r++])},insert:function(e){for(var t,s,a=this.array,r=this.compare,n=a.length-1,i=0,o=-1;n>=i;)if((s=r(a[t=(n+i)/2>>>0],e))<0)i=t+1;else{if(!(s>0)){o=t;break}n=t-1}for(-1===o&&(o=n),o++,n=a.length-1;o<n&&0===r(e,a[o]);)o++;for(t=a.length,a.push(e);t>o;)a[t]=a[--t];return a[o]=e,this},search:function(e){for(var t,s,a=this.array,r=this.compare,n=a.length-1,i=0;n>=i;)if((s=r(a[t=(n+i)/2>>>0],e))<0)i=t+1;else{if(!(s>0))return t;n=t-1}return-1},remove:function(e){var t=this.search(e);return t>=0&&this.array.splice(t,1),this}}).constructor).prototype=e,t);return s.comparing=function(e,t){return new s(t,(function(t,s){return a(t[e],s[e])}))},s;function a(e,t){return e<t?-1:e>t?1:0}}();e.exports=r,void 0===(a=function(){return r}.call(t,s,t,e))||(e.exports=a)},function(e,t){var s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(s){var a=new Uint8Array(16);e.exports=function(){return s(a),a}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var s=[],a=0;a<256;++a)s[a]=(a+256).toString(16).substr(1);e.exports=function(e,t){var a=t||0,r=s;return[r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]]].join("")}},function(e,t,s){"use strict";t.byteLength=function(e){var t=u(e),s=t[0],a=t[1];return 3*(s+a)/4-a},t.toByteArray=function(e){var t,s,a=u(e),i=a[0],o=a[1],c=new n(function(e,t,s){return 3*(t+s)/4-s}(0,i,o)),d=0,h=o>0?i-4:i;for(s=0;s<h;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===o&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,c[d++]=255&t);1===o&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,s=e.length,r=s%3,n=[],i=0,o=s-r;i<o;i+=16383)n.push(d(e,i,i+16383>o?o:i+16383));1===r?(t=e[s-1],n.push(a[t>>2]+a[t<<4&63]+"==")):2===r&&(t=(e[s-2]<<8)+e[s-1],n.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return n.join("")};for(var a=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=i.length;o<c;++o)a[o]=i[o],r[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}function d(e,t,s){for(var r,n,i=[],o=t;o<s;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(a[(n=r)>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,s,a,r){var n,i,o=8*r-a-1,c=(1<<o)-1,u=c>>1,d=-7,h=s?r-1:0,l=s?-1:1,f=e[t+h];for(h+=l,n=f&(1<<-d)-1,f>>=-d,d+=o;d>0;n=256*n+e[t+h],h+=l,d-=8);for(i=n&(1<<-d)-1,n>>=-d,d+=a;d>0;i=256*i+e[t+h],h+=l,d-=8);if(0===n)n=1-u;else{if(n===c)return i?NaN:1/0*(f?-1:1);i+=Math.pow(2,a),n-=u}return(f?-1:1)*i*Math.pow(2,n-a)},t.write=function(e,t,s,a,r,n){var i,o,c,u=8*n-r-1,d=(1<<u)-1,h=d>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=a?0:n-1,m=a?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,i=d):(i=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-i))<1&&(i--,c*=2),(t+=i+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(i++,c/=2),i+h>=d?(o=0,i=d):i+h>=1?(o=(t*c-1)*Math.pow(2,r),i+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,r),i=0));r>=8;e[s+f]=255&o,f+=m,o/=256,r-=8);for(i=i<<r|o,u+=r;u>0;e[s+f]=255&i,f+=m,i/=256,u-=8);e[s+f-m]|=128*p}},function(e,t){var s={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==s.call(e)}},function(e,t,s){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var a=s(4),r=a.Buffer;function n(e,t){for(var s in e)t[s]=e[s]}function i(e,t,s){return r(e,t,s)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=a:(n(a,t),t.Buffer=i),i.prototype=Object.create(r.prototype),n(r,i),i.from=function(e,t,s){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,s)},i.alloc=function(e,t,s){if("number"!=typeof e)throw new TypeError("Argument must be a number");var a=r(e);return void 0!==t?"string"==typeof s?a.fill(t,s):a.fill(t):a.fill(0),a},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a.SlowBuffer(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){},function(e,t,s){var a;function r(e){this.rand=e}if(e.exports=function(e){return a||(a=new r(null)),a.generate(e)},e.exports.Rand=r,r.prototype.generate=function(e){return this._rand(e)},r.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),s=0;s<t.length;s++)t[s]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(r.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var n=s(22);if("function"!=typeof n.randomBytes)throw new Error("Not supported");r.prototype._rand=function(e){return n.randomBytes(e)}}catch(e){}},function(e,t){},function(e){e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},function(e,t,s){(function(t){var a=s(5),r=new(s(9)),n=new a(24),i=new a(11),o=new a(10),c=new a(3),u=new a(7),d=s(6),h=s(7);function l(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this._pub=new a(e),this}function f(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this._priv=new a(e),this}e.exports=p;var m={};function p(e,t,s){this.setGenerator(t),this.__prime=new a(e),this._prime=a.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,s?(this.setPublicKey=l,this.setPrivateKey=f):this._primeCode=8}function w(e,s){var a=new t(e.toArray());return s?a.toString(s):a}Object.defineProperty(p.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var s=t.toString("hex"),a=[s,e.toString(16)].join("_");if(a in m)return m[a];var h,l=0;if(e.isEven()||!d.simpleSieve||!d.fermatTest(e)||!r.test(e))return l+=1,l+="02"===s||"05"===s?8:4,m[a]=l,l;switch(r.test(e.shrn(1))||(l+=2),s){case"02":e.mod(n).cmp(i)&&(l+=8);break;case"05":(h=e.mod(o)).cmp(c)&&h.cmp(u)&&(l+=8);break;default:l+=4}return m[a]=l,l}(this.__prime,this.__gen)),this._primeCode}}),p.prototype.generateKeys=function(){return this._priv||(this._priv=new a(h(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},p.prototype.computeSecret=function(e){var s=(e=(e=new a(e)).toRed(this._prime)).redPow(this._priv).fromRed(),r=new t(s.toArray()),n=this.getPrime();if(r.length<n.length){var i=new t(n.length-r.length);i.fill(0),r=t.concat([i,r])}return r},p.prototype.getPublicKey=function(e){return w(this._pub,e)},p.prototype.getPrivateKey=function(e){return w(this._priv,e)},p.prototype.getPrime=function(e){return w(this.__prime,e)},p.prototype.getGenerator=function(e){return w(this._gen,e)},p.prototype.setGenerator=function(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this.__gen=e,this._gen=new a(e),this}}).call(this,s(4).Buffer)},function(e,t,s){(function(e){var a=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(r.call(setTimeout,a,arguments),clearTimeout)},t.setInterval=function(){return new n(r.call(setInterval,a,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(a,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},s(26),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,s(3))},function(e,t,s){(function(e,t){!function(e,s){"use strict";if(!e.setImmediate){var a,r,n,i,o,c=1,u={},d=!1,h=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick((function(){m(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,s=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=s,t}}()?e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){m(e.data)},a=function(e){n.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,a=function(e){var t=h.createElement("script");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):a=function(e){setTimeout(m,0,e)}:(i="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&m(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),a=function(t){e.postMessage(i+t,"*")}),l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),s=0;s<t.length;s++)t[s]=arguments[s+1];var r={callback:e,args:t};return u[c]=r,a(c),c++},l.clearImmediate=f}function f(e){delete u[e]}function m(e){if(d)setTimeout(m,0,e);else{var t=u[e];if(t){d=!0;try{!function(e){var t=e.callback,s=e.args;switch(s.length){case 0:t();break;case 1:t(s[0]);break;case 2:t(s[0],s[1]);break;case 3:t(s[0],s[1],s[2]);break;default:t.apply(void 0,s)}}(t)}finally{f(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,s(3),s(8))},function(e,t,s){"use strict";s.r(t);var a=s(1),r=s.n(a),n=s(0),i=s.n(n),o=200,c=400,u=401,d=402,h=403,l=404,f=409,m=429,p=500,w=503,g=504,y=1012,b=3e3,v=3001;class M extends Error{constructor(...e){super(...e),this.name="UsernameAlreadyExists",this.message="Username already exists.",this.status=f}}class S extends Error{constructor(...e){super(...e),this.name="UsernameMissing",this.message="Username missing.",this.status=c}}class I extends Error{constructor(...e){super(...e),this.name="UsernameCannotBeBlank",this.message="Username cannot be blank.",this.status=c}}class P extends Error{constructor(e,...t){super(e,...t),this.name="UsernameTooLong",this.message="Username too long. Must be a max of ".concat(e," characters."),this.status=c}}class E extends Error{constructor(...e){super(...e),this.name="UsernameMustBeString",this.message="Username must be a string.",this.status=c}}class B extends Error{constructor(...e){super(...e),this.name="PasswordMissing",this.message="Password missing.",this.status=c}}class N extends Error{constructor(...e){super(...e),this.name="PasswordCannotBeBlank",this.message="Password cannot be blank.",this.status=c}}class U extends Error{constructor(e,...t){super(e,...t),this.name="PasswordTooShort",this.message="Password too short. Must be a minimum of ".concat(e," characters."),this.status=c}}class A extends Error{constructor(e,...t){super(e,...t),this.name="PasswordTooLong",this.message="Password too long. Must be a max of ".concat(e," characters."),this.status=c}}class T extends Error{constructor(...e){super(...e),this.name="PasswordMustBeString",this.message="Password must be a string.",this.status=c}}class k extends Error{constructor(e,...t){super(e,...t),this.name="PasswordAttemptLimitExceeded",this.message="Password attempt limit exceeded. Must wait ".concat(e," to attempt to use password again."),this.status=u}}class D extends Error{constructor(...e){super(...e),this.name="UsernameOrPasswordMismatch",this.message="Username or password mismatch.",this.status=u}}class K extends Error{constructor(...e){super(...e),this.name="SessionLengthMustBeNumber",this.message="Session length must be a number.",this.status=c}}class x extends Error{constructor(e,...t){super(e,...t),this.name="SessionLengthTooShort",this.message="Session length cannot be shorter than ".concat(e,"."),this.status=c}}class R extends Error{constructor(e,...t){super(e,...t),this.name="SessionLengthTooLong",this.message="Session length cannot be longer than ".concat(e,"."),this.status=c}}class O extends Error{constructor(...e){super(...e),this.name="AllowServerSideEncryptionMustBeBoolean",this.message="Allow server-side encryption value must be a boolean.",this.status=c}}class C extends Error{constructor(e,...t){super(...t),this.name="UserAlreadySignedIn",this.message="Already signed in.",this.status=c,this.username=e}}class _ extends Error{constructor(...e){super(...e),this.name="UserPendingDeletion",this.message="User is pending deletion.",this.status=h}}class F extends Error{constructor(...e){super(...e),this.name="AppIdNotValid",this.message="App ID not valid.",this.status=u}}class L extends Error{constructor(e,...t){super(e,...t),this.name="DomainNotWhitelisted",this.message="Domain not whitelisted. Whitelist the domain ".concat(e?"'".concat(e,"' "):"","in your admin panel."),this.status=u}}class j extends Error{constructor(...e){super(...e),this.name="UserNotSignedIn",this.message="Not signed in.",this.status=c}}class q extends Error{constructor(e,...t){super(e,...t),e&&(this.username=e),this.name="UserNotFound",this.message="User not found.",this.status=l}}class V extends Error{constructor(...e){super(...e),this.name="UserEmailNotFound",this.message="User does not have an email saved.",this.status=l}}class H extends Error{constructor(...e){super(...e),this.name="UserMustChangePassword",this.message="Must change password first.",this.status=h}}class G extends Error{constructor(...e){super(...e),this.name="EmailNotValid",this.message="Email not valid.",this.status=c}}class J extends Error{constructor(...e){super(...e),this.name="ProfileMustBeObject",this.message="Profile must be a flat JSON object.",this.status=c}}class W extends Error{constructor(...e){super(...e),this.name="ProfileCannotBeEmpty",this.message="Profile cannot be empty.",this.status=c}}class Y extends Error{constructor(e,...t){super(e,...t),this.name="ProfileHasTooManyKeys",this.message="Profile has too many keys. Must have a max of ".concat(e," keys."),this.status=c}}class z extends Error{constructor(e,t,...s){super(e,t,...s),this.name="ProfileKeyTooLong",this.message="Profile key too long. Must be a max of ".concat(e," characters."),this.status=c,this.key=t}}class Z extends Error{constructor(e,t,...s){super(e,t,...s),this.name="ProfileValueMustBeString",this.message="Profile value must be a string.",this.status=c,this.key=e,this.value=t}}class X extends Error{constructor(e,...t){super(e,...t),this.name="ProfileValueCannotBeBlank",this.message="Profile value cannot be blank.",this.status=c,this.key=e}}class Q extends Error{constructor(e,t,s,...a){super(e,t,s,...a),this.name="ProfileValueTooLong",this.message="Profile value too long. Must be a max of ".concat(e," characters."),this.status=c,this.key=t,this.value=s}}class $ extends Error{constructor(e,...t){super(e,...t),this.name="RememberMeValueNotValid",this.message="Remember me value must be one of ".concat(JSON.stringify(Object.keys(e)),"."),this.status=c}}class ee extends Error{constructor(...e){super(...e),this.name="ParamsMissing",this.message="Parameters expected are missing.",this.status=c}}class te extends Error{constructor(...e){super(...e),this.name="TrialExceededLimit",this.message="Trial exceeded limit of users.",this.status=d}}class se extends Error{constructor(...e){super(...e),this.name="CurrentPasswordMissing",this.message="Current password missing.",this.status=c}}class ae extends Error{constructor(...e){super(...e),this.name="CurrentPasswordIncorrect",this.message="Current password is incorrect.",this.status=u}}class re extends Error{constructor(e,...t){super(e,...t),this.name="KeyNotFound",this.message=e,this.status=l}}class ne extends Error{constructor(...e){super(...e),this.name="DeleteEndToEndEncryptedDataMustBeBoolean",this.message="Delete end-to-end encrypted data value must be a boolean.",this.status=c}}var ie={UsernameAlreadyExists:M,UsernameMissing:S,UsernameCannotBeBlank:I,UsernameTooLong:P,UsernameMustBeString:E,PasswordMissing:B,PasswordCannotBeBlank:N,PasswordTooShort:U,PasswordTooLong:A,PasswordMustBeString:T,PasswordAttemptLimitExceeded:k,UsernameOrPasswordMismatch:D,SessionLengthMustBeNumber:K,SessionLengthTooShort:x,SessionLengthTooLong:R,AllowServerSideEncryptionMustBeBoolean:O,UserAlreadySignedIn:C,UserPendingDeletion:_,AppIdNotValid:F,DomainNotWhitelisted:L,UserNotSignedIn:j,UserNotFound:q,UserEmailNotFound:V,UserMustChangePassword:H,EmailNotValid:G,ProfileMustBeObject:J,ProfileCannotBeEmpty:W,ProfileHasTooManyKeys:Y,ProfileKeyTooLong:z,ProfileValueMustBeString:Z,ProfileValueCannotBeBlank:X,ProfileValueTooLong:Q,RememberMeValueNotValid:$,ParamsMissing:ee,TrialExceededLimit:te,CurrentPasswordMissing:se,CurrentPasswordIncorrect:ae,KeyNotFound:re,DeleteEndToEndEncryptedDataMustBeBoolean:ne};class oe extends Error{constructor(...e){super(...e),this.name="DatabaseNameMissing",this.message="Database name missing.",this.status=c}}class ce extends Error{constructor(...e){super(...e),this.name="DatabaseNameCannotBeBlank",this.message="Database name cannot be blank.",this.status=c}}class ue extends Error{constructor(...e){super(...e),this.name="DatabaseNameMustBeString",this.message="Database name must be a string.",this.status=c}}class de extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseNameTooLong",this.message="Database name cannot be more than ".concat(e," characters."),this.status=c}}class he extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseNameRestricted",this.message="Database name '".concat(e,"' is restricted. It is used internally by userbase-js."),this.status=h}}class le extends Error{constructor(...e){super(...e),this.name="DatabaseAlreadyOpening",this.message="Already attempting to open database.",this.status=c}}class fe extends Error{constructor(...e){super(...e),this.name="ChangeHandlerMissing",this.message="Change handler missing.",this.status=c}}class me extends Error{constructor(...e){super(...e),this.name="ChangeHandlerMustBeFunction",this.message="Change handler must be a function.",this.status=c}}class pe extends Error{constructor(e,...t){super(e,...t),this.name="EncryptionModeNotValid",this.message="Encryption mode must be one of ".concat(JSON.stringify(Object.keys(e)),"."),this.status=c}}class we extends Error{constructor(...e){super(...e),this.name="ServerSideEncryptionNotEnabledInClient",this.message="Server-side encryption must be enabled in the client to use it. To enable it, set allowServerSideEncryption to true in init().",this.status=h}}class ge extends Error{constructor(...e){super(...e),this.name="DatabaseNotOpen",this.message="Database is not open.",this.status=c}}class ye extends Error{constructor(...e){super(...e),this.name="DatabaseNotFound",this.message="Database not found. Find available databases using getDatabases().",this.status=l}}class be extends Error{constructor(...e){super(...e),this.name="DatabaseIsReadOnly",this.message="Database is read only. Must have permission to write to database.",this.status=h}}class ve extends Error{constructor(...e){super(...e),this.name="DatabaseIdMustBeString",this.message="Database id must be a string.",this.status=c}}class Me extends Error{constructor(...e){super(...e),this.name="DatabaseIdCannotBeBlank",this.message="Database id cannot be blank.",this.status=c}}class Se extends Error{constructor(...e){super(...e),this.name="DatabaseIdNotAllowed",this.message="Database id not allowed. Cannot provide both databaseName and databaseId, can only provide one.",this.status=c}}class Ie extends Error{constructor(...e){super(...e),this.name="DatabaseIdNotAllowedForOwnDatabase",this.message="Tried to open the user's own database using its databaseId rather than its databaseName. The databaseId should only be used to open databases shared from other users.",this.status=h}}class Pe extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseIdInvalidLength",this.message="Database id invalid length. Must be ".concat(e," characters."),this.status=c}}class Ee extends Error{constructor(...e){super(...e),this.name="ShareTokenInvalid",this.message="Share token invalid.",this.status=c}}class Be extends Error{constructor(...e){super(...e),this.name="ShareTokenNotFound",this.message="Share token not found. Perhaps the database owner has generated a new share token.",this.status=l}}class Ne extends Error{constructor(e,...t){super(e,...t),this.name="ShareTokenNotAllowed",this.message="Share token not allowed.",this.status=c}}class Ue extends Error{constructor(...e){super(...e),this.name="ShareTokenNotAllowedForOwnDatabase",this.message="Tried to open the user's own database using its shareToken rather than its databaseName. The shareToken should only be used to open databases shared from other users.",this.status=h}}class Ae extends Error{constructor(...e){super(...e),this.name="ReadOnlyMustBeBoolean",this.message="Read only value must be a boolean.",this.status=c}}class Te extends Error{constructor(...e){super(...e),this.name="ReadOnlyParamNotAllowed",this.message="Read only parameter not allowed when revoking access to a database.",this.status=c}}class ke extends Error{constructor(e,...t){super(e,...t),this.name="ResharingAllowedParamNotAllowed",this.message="Resharing allowed parameter not allowed ".concat(e,"."),this.status=c}}class De extends Error{constructor(...e){super(...e),this.name="ResharingAllowedMustBeBoolean",this.message="Resharing allowed value must be a boolean.",this.status=c}}class Ke extends Error{constructor(e,...t){super(e,...t),this.name="ResharingNotAllowed",this.message="Resharing not allowed. ".concat(e,"."),this.status=h}}class xe extends Error{constructor(...e){super(...e),this.name="ResharingWithWriteAccessNotAllowed",this.message="Resharing with write access not allowed. Must have permission to write to the database to reshare the database with write access another user.",this.status=h}}class Re extends Error{constructor(...e){super(...e),this.name="SharingWithSelfNotAllowed",this.message="Sharing database with self is not allowed. Must share database with another user.",this.status=c}}class Oe extends Error{constructor(...e){super(...e),this.name="ModifyingOwnPermissionsNotAllowed",this.message="Modifying own database permissions not allowed. Must modify another user's permissions.",this.status=c}}class Ce extends Error{constructor(...e){super(...e),this.name="ModifyingOwnerPermissionsNotAllowed",this.message="Modifying the owner of a database's permissions is not allowed.",this.status=h}}class _e extends Error{constructor(...e){super(...e),this.name="ModifyingPermissionsNotAllowed",this.message="Modifying another user's permissions is not allowed. Must have permission to reshare the database with another user.",this.status=h}}class Fe extends Error{constructor(...e){super(...e),this.name="GrantingWriteAccessNotAllowed",this.message="Granting write access not allowed. Must have permission to write to the database to grant write access to another user.",this.status=h}}class Le extends Error{constructor(...e){super(...e),this.name="RequireVerifiedMustBeBoolean",this.message="Require verified value must be a boolean.",this.status=c}}class je extends Error{constructor(...e){super(...e),this.name="RequireVerifiedParamNotNecessary",this.message="Require verified parameter not necessary when sharing database without a username.",this.status=c}}class qe extends Error{constructor(...e){super(...e),this.name="RevokeMustBeBoolean",this.message="Revoke value must be a boolean.",this.status=c}}class Ve extends Error{constructor(...e){super(...e),this.name="ItemMissing",this.message="Item missing.",this.status=c}}class He extends Error{constructor(...e){super(...e),this.name="ItemInvalid",this.message="Item must be serializable to JSON.",this.status=c}}class Ge extends Error{constructor(e,...t){super(e,...t),this.name="ItemTooLarge",this.message="Item must be less than ".concat(e," KB."),this.status=c}}class Je extends Error{constructor(...e){super(...e),this.name="ItemIdMustBeString",this.message="Item id must be a string.",this.status=c}}class We extends Error{constructor(e,...t){super(e,...t),this.name="ItemIdTooLong",this.message="Item id cannot be more than ".concat(e," characters."),this.status=c}}class Ye extends Error{constructor(...e){super(...e),this.name="ItemIdMissing",this.message="Item id missing.",this.status=c}}class ze extends Error{constructor(...e){super(...e),this.name="ItemIdCannotBeBlank",this.message="Item id cannot be blank.",this.status=c}}class Ze extends Error{constructor(...e){super(...e),this.name="ItemAlreadyExists",this.message="Item with the same id already exists.",this.status=f}}class Xe extends Error{constructor(...e){super(...e),this.name="ItemDoesNotExist",this.message="Item with the provided id does not exist.",this.status=l}}class Qe extends Error{constructor(...e){super(...e),this.name="ItemUpdateConflict",this.message="Item update conflict.",this.status=f}}class $e extends Error{constructor(...e){super(...e),this.name="FileMissing",this.message="File missing.",this.status=c}}class et extends Error{constructor(...e){super(...e),this.name="FileMustBeFile",this.message="File must be a file.",this.status=c}}class tt extends Error{constructor(...e){super(...e),this.name="FileCannotBeEmpty",this.message="File cannot be empty.",this.status=c}}class st extends Error{constructor(...e){super(...e),this.name="FileUploadConflict",this.message="File upload conflict.",this.status=f}}class at extends Error{constructor(...e){super(...e),this.name="FileNotFound",this.message="File not found.",this.status=l}}class rt extends Error{constructor(...e){super(...e),this.name="FileIdMissing",this.message="File id missing.",this.status=c}}class nt extends Error{constructor(...e){super(...e),this.name="FileIdMustBeString",this.message="File id must be a string.",this.status=c}}class it extends Error{constructor(...e){super(...e),this.name="FileIdCannotBeBlank",this.message="File id cannot be blank.",this.status=c}}class ot extends Error{constructor(e,...t){super(e,...t),this.name="FileIdTooLong",this.message="File id cannot be more than ".concat(e," characters."),this.status=c}}class ct extends Error{constructor(...e){super(...e),this.name="RangeMustBeObject",this.message="Range param provided must be object.",this.status=c}}class ut extends Error{constructor(...e){super(...e),this.name="RangeMissingStart",this.message="Range param missing start.",this.status=c}}class dt extends Error{constructor(...e){super(...e),this.name="RangeMissingEnd",this.message="Range param missing end.",this.status=c}}class ht extends Error{constructor(...e){super(...e),this.name="RangeStartMustBeNumber",this.message="Range start provided must be a number.",this.status=c}}class lt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeNumber",this.message="Range end provided must be a number.",this.status=c}}class ft extends Error{constructor(...e){super(...e),this.name="RangeStartMustBeGreaterThanZero",this.message="Range start provided must be greater than 0.",this.status=c}}class mt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeGreaterThanRangeStart",this.message="Range end provided must be greater than range start.",this.status=c}}class pt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeLessThanFileSize",this.message="Range end provided must be less than file size.",this.status=c}}class wt extends Error{constructor(...e){super(...e),this.name="OperationsMissing",this.message="Operations missing.",this.status=c}}class gt extends Error{constructor(...e){super(...e),this.name="OperationsMustBeArray",this.message="Operations provided must be an array.",this.status=c}}class yt extends Error{constructor(e,...t){super(e,...t),this.name="CommandNotRecognized",this.message="Command '".concat(e,"' not recognized."),this.status=c}}class bt extends Error{constructor(...e){super(...e),this.name="OperationsConflict",this.message="Operations conflict. Only allowed 1 operation per item.",this.status=f}}class vt extends Error{constructor(e,...t){super(e,...t),this.name="OperationsExceedLimit",this.message="Operations exceed limit. Only allowed ".concat(e," operations."),this.status=c}}class Mt extends Error{constructor(...e){super(...e),this.name="UserNotVerified",this.message="User not verified. Either verify user before sharing database, or set requireVerified to false.",this.status=h}}class St extends Error{constructor(...e){super(...e),this.name="UserMustBeReverified",this.message="User must be reverified.",this.status=h}}class It extends Error{constructor(...e){super(...e),this.name="UserUnableToReceiveDatabase",this.message="User unable to receive database. User must sign in with an updated userbase-js client to be able to receive database.",this.status=h}}class Pt extends Error{constructor(...e){super(...e),this.name="VerificationMessageMissing",this.message="Verification message missing.",this.status=c}}class Et extends Error{constructor(...e){super(...e),this.name="VerificationMessageCannotBeBlank",this.message="Verification message cannot be blank.",this.status=c}}class Bt extends Error{constructor(...e){super(...e),this.name="VerificationMessageMustBeString",this.message="Verification message must be a string.",this.status=c}}class Nt extends Error{constructor(e,...t){super(e,...t),this.name="VerificationMessageInvalid",this.message="Verification message invalid.",this.status=c}}class Ut extends Error{constructor(e,...t){super(e,...t),this.name="VerifyingSelfNotAllowed",this.message="Verifying self not allowed. Can only verify other users.",this.status=c}}class At extends Error{constructor(...e){super(...e),this.name="ProgressHandlerMustBeFunction",this.message="Progress handler must be a function.",this.status=c}}class Tt extends Error{constructor(e,...t){super(e,...t),this.name="TransactionUnauthorized",this.message="Calling '".concat(e,"' on this item is unauthorized."),this.status=h}}class kt extends Error{constructor(e,...t){super(e,...t),this.name="WriteAccessParamNotAllowed",this.message="Write access parameter not allowed. Only the item creator or database owner can change an item's write access settings.",this.status=h}}var Dt={DatabaseNameMissing:oe,DatabaseNameCannotBeBlank:ce,DatabaseNameMustBeString:ue,DatabaseNameTooLong:de,DatabaseNameRestricted:he,DatabaseNotFound:ye,DatabaseIsReadOnly:be,DatabaseAlreadyOpening:le,DatabaseIdMustBeString:ve,DatabaseIdCannotBeBlank:Me,DatabaseIdNotAllowed:Se,DatabaseIdNotAllowedForOwnDatabase:Ie,DatabaseIdInvalidLength:Pe,ShareTokenInvalid:Ee,ShareTokenNotFound:Be,ShareTokenNotAllowed:Ne,ShareTokenNotAllowedForOwnDatabase:Ue,ReadOnlyMustBeBoolean:Ae,ReadOnlyParamNotAllowed:Te,ResharingAllowedMustBeBoolean:De,ResharingNotAllowed:Ke,ResharingWithWriteAccessNotAllowed:xe,ResharingAllowedParamNotAllowed:ke,SharingWithSelfNotAllowed:Re,ModifyingOwnPermissionsNotAllowed:Oe,ModifyingOwnerPermissionsNotAllowed:Ce,ModifyingPermissionsNotAllowed:_e,GrantingWriteAccessNotAllowed:Fe,RequireVerifiedMustBeBoolean:Le,RequireVerifiedParamNotNecessary:je,RevokeMustBeBoolean:qe,ChangeHandlerMissing:fe,ChangeHandlerMustBeFunction:me,EncryptionModeNotValid:pe,ServerSideEncryptionNotEnabledInClient:we,DatabaseNotOpen:ge,ItemMissing:Ve,ItemInvalid:He,ItemTooLarge:Ge,ItemIdMustBeString:Je,ItemIdTooLong:We,ItemIdMissing:Ye,ItemIdCannotBeBlank:ze,ItemAlreadyExists:Ze,ItemDoesNotExist:Xe,ItemUpdateConflict:Qe,FileMissing:$e,FileMustBeFile:et,FileCannotBeEmpty:tt,FileUploadConflict:st,FileNotFound:at,FileIdMissing:rt,FileIdMustBeString:nt,FileIdCannotBeBlank:it,FileIdTooLong:ot,RangeMustBeObject:ct,RangeMissingStart:ut,RangeMissingEnd:dt,RangeStartMustBeNumber:ht,RangeEndMustBeNumber:lt,RangeStartMustBeGreaterThanZero:ft,RangeEndMustBeGreaterThanRangeStart:mt,RangeEndMustBeLessThanFileSize:pt,OperationsMissing:wt,OperationsMustBeArray:gt,OperationsConflict:bt,OperationsExceedLimit:vt,CommandNotRecognized:yt,UserNotVerified:Mt,UserMustBeReverified:St,UserUnableToReceiveDatabase:It,VerificationMessageMissing:Pt,VerificationMessageMustBeString:Bt,VerificationMessageCannotBeBlank:Et,VerificationMessageInvalid:Nt,VerifyingSelfNotAllowed:Ut,ProgressHandlerMustBeFunction:At,TransactionUnauthorized:Tt,WriteAccessParamNotAllowed:kt};class Kt extends Error{constructor(e,...t){super(e,...t),this.name="AppIdAlreadySet",this.message="Application ID already set.",this.status=f,this.appId=e}}class xt extends Error{constructor(...e){super(...e),this.name="AppIdMustBeString",this.message="Application ID must be a string.",this.status=c}}class Rt extends Error{constructor(...e){super(...e),this.name="AppIdMissing",this.message="Application ID missing.",this.status=c}}class Ot extends Error{constructor(...e){super(...e),this.name="AppIdCannotBeBlank",this.message="Application ID cannot be blank.",this.status=c}}class Ct extends Error{constructor(...e){super(...e),this.name="WebCryptoUnavailable",this.message="The WebCrypto API is unavailable. Please make sure your website uses https.",this.status=c}}class _t extends Error{constructor(...e){super(...e),this.name="UpdateUserHandlerMustBeFunction",this.message="Update user handler must be a function.",this.status=c}}var Ft={AppIdAlreadySet:Kt,AppIdMustBeString:xt,AppIdMissing:Rt,AppIdCannotBeBlank:Ot,WebCryptoUnavailable:Ct,UpdateUserHandlerMustBeFunction:_t};class Lt extends Error{constructor(...e){super(...e),this.name="SuccessUrlMissing",this.message="Success url missing to let Stripe know where to redirect users on successful payment.",this.status=c}}class jt extends Error{constructor(...e){super(...e),this.name="SuccessUrlMustBeString",this.message="Success url must be a string.",this.status=c}}class qt extends Error{constructor(e,...t){super(e,...t),this.name="SuccessUrlInvalid",this.message=e?"Success url must start with http or https.":"Success url invalid.",this.status=c}}class Vt extends Error{constructor(...e){super(...e),this.name="CancelUrlMissing",this.message="Cancel url missing to let Stripe know where to redirect users on canceled payment.",this.status=c}}class Ht extends Error{constructor(...e){super(...e),this.name="CancelUrlMustBeString",this.message="Cancel url must be a string.",this.status=c}}class Gt extends Error{constructor(e,...t){super(e,...t),this.name="CancelUrlInvalid",this.message=e?"Cancel url must start with http or https.":"Cancel url invalid.",this.status=c}}class Jt extends Error{constructor(...e){super(...e),this.name="StripeLibraryMissing",this.message="Stripe.js library missing. Be sure to include the script in your html file (https://stripe.com/docs/stripe-js#setup).",this.status=c}}class Wt extends Error{constructor(...e){super(...e),this.name="PaymentsDisabled",this.message="Payments on this app are disabled. Enable payments in the admin panel.",this.status=h}}class Yt extends Error{constructor(...e){super(...e),this.name="PriceIdOrPlanIdAllowed",this.message="Only one of priceId or planId allowed.",this.status=c}}class zt extends Error{constructor(...e){super(...e),this.name="PriceIdOrPlanIdMissing",this.message="Please provide a priceId or planId. You can create a product in the Stripe dashboard and find its priceId there.",this.status=c}}class Zt extends Error{constructor(...e){super(...e),this.name="SubscriptionPlanAlreadyPurchased",this.message="Subscription plan already purchased. Cancel subscription to purchase another.",this.status=f}}class Xt extends Error{constructor(...e){super(...e),this.name="StripeAccountNotConnected",this.message="Stripe account not connected. Connect a Stripe account in the admin panel.",this.status=h}}class Qt extends Error{constructor(...e){super(...e),this.name="SubscriptionNotFound",this.message="Subscription not found. User must purchase a subscription.",this.status=d}}class $t extends Error{constructor(e,...t){super(...t),this.name="SubscriptionInactive",this.message="The user's subscription is inactive.",this.subscriptionStatus=e,this.status=d}}class es extends Error{constructor(...e){super(...e),this.name="SubscriptionNotPurchased",this.message="Subscription not purchased. User must purchase a subscription.",this.status=d}}class ts extends Error{constructor(...e){super(...e),this.name="SubscriptionAlreadyCanceled",this.message="Subscription already canceled. User must purchase a new subscription.",this.status=c}}class ss extends Error{constructor(...e){super(...e),this.name="TrialExpired",this.message="Trial expired. User must purchase a subscription.",this.status=d}}class as extends Error{constructor(e,...t){super(e,...t);const{status:s,type:a,message:r}=e;this.name="StripeError",this.message=r,this.type=a,this.status=s}}var rs={SuccessUrlMissing:Lt,SuccessUrlMustBeString:jt,SuccessUrlInvalid:qt,CancelUrlMissing:Vt,CancelUrlMustBeString:Ht,CancelUrlInvalid:Gt,StripeJsLibraryMissing:Jt,PaymentsDisabled:Wt,PriceIdOrPlanIdAllowed:Yt,PriceIdOrPlanIdMissing:zt,SubscriptionPlanAlreadyPurchased:Zt,StripeAccountNotConnected:Xt,SubscriptionNotFound:Qt,SubscriptionInactive:$t,SubscriptionNotPurchased:es,SubscriptionAlreadyCanceled:ts,TrialExpired:ss,StripeError:as};function ns(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function is(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ns(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class os extends Error{constructor(...e){super(...e),this.name="AppIdNotSet",this.message="App ID not set yet. Make sure to configure app ID.",this.status=c}}class cs extends Error{constructor(...e){super(...e),this.name="ServiceUnavailable",this.message="Service unavailable.",this.status=w}}class us extends Error{constructor(...e){super(...e),this.name="ParamsMustBeObject",this.message="Parameters passed to function must be placed inside an object.",this.status=c}}class ds extends Error{constructor(e,...t){super(e,...t);const s=Math.floor(e/1e3);this.name="TooManyRequests",this.message="Too many requests in a row. Please try again in ".concat(s," second").concat(1!==s?"s":"","."),this.status=m}}var hs=is(is(is(is(is({},ie),Dt),Ft),rs),{},{AppIdNotSet:os,InternalServerError:class extends cs{constructor(...e){super(...e),this.status=p}},ServiceUnavailable:cs,Timeout:class extends cs{constructor(...e){super(...e),this.status=g}},Reconnecting:class extends cs{constructor(...e){super(...e),this.message="Reconnecting."}},UnknownServiceUnavailable:class extends cs{constructor(e,...t){super(e,...t),console.error("Userbase error. Please report this to support@userbase.com.\n\n",e)}},ParamsMustBeObject:us,TooManyRequests:ds});let ls=null,fs=null,ms=!1;var ps="2.8.0",ws=()=>{if(!ls)throw new hs.AppIdNotSet;return ls},gs=()=>fs,ys=()=>window._userbaseEndpoint||"https://v1.userbase.com/v1",bs=({appId:e,updateUserHandler:t,allowServerSideEncryption:s})=>{if(ls&&ls!==e)throw new hs.AppIdAlreadySet(ls);ls=e,fs=t,ms=s},vs=e=>e?window._USERBASE_STRIPE_PRODUCTION_PUBLISHABLE_KEY||"pk_live_jI6lbsAIQlu2u4uTkDXFrSEW":window._USERBASE_STRIPE_TEST_PUBLISHABLE_KEY||"pk_test_rYANrLdNfdJXJ2d808wW4pqY",Ms=()=>ms;class Ss extends Error{constructor(e,t,s,...a){super(e,t,s,...a),this.response={data:e,status:t,statusText:s},this.message="Request failed with status code "+t}}class Is extends Error{constructor(e,...t){super(e,...t),this.message="timeout of ".concat(e,"ms exceeded")}}const Ps=(e,t,s,a=1e4)=>{e.timeout=a,e.onload=()=>((e,t,s)=>{let a;try{a=JSON.parse(e.response)}catch(t){a=e.response}e.status>=200&&e.status<300?t(a):s(new Ss(a,e.status,e.statusText))})(e,t,s),e.onerror=()=>s(new hs.ServiceUnavailable),e.ontimeout=()=>s(new Is(a))};var Es=(e,t,s,a,r,n,i,o,c)=>new Promise((u,d)=>{const h=new XMLHttpRequest,l="".concat(ys(),"/api/auth/sign-up?appId=").concat(ws(),"&userbaseJsVersion=").concat(ps),f=JSON.stringify({username:e,passwordToken:t,ecKeyData:s,passwordSalts:a,keySalts:r,email:n,profile:i,passwordBasedBackup:o,sessionLength:c});h.open("POST",l),h.setRequestHeader("Content-Type","application/json"),h.send(f),Ps(h,u,d)}),Bs=e=>new Promise((t,s)=>{const a=new XMLHttpRequest,r="".concat(ys(),"/api/auth/get-password-salts?appId=").concat(ws(),"&username=").concat(encodeURIComponent(e),"&userbaseJsVersion=").concat(ps);a.open("GET",r),a.send(),Ps(a,t,s)}),Ns=async(e,t,s)=>new Promise((a,r)=>{const n=new XMLHttpRequest,i="".concat(ys(),"/api/auth/sign-in?appId=").concat(ws(),"&userbaseJsVersion=").concat(ps),o=JSON.stringify({username:e,passwordToken:t,sessionLength:s});n.open("POST",i),n.setRequestHeader("Content-Type","application/json"),n.send(o),Ps(n,a,r)}),Us=(e,t)=>new Promise((s,a)=>{const r=new XMLHttpRequest,n="".concat(ys(),"/api/auth/sign-in-with-session?appId=").concat(ws(),"&sessionId=").concat(e,"&userbaseJsVersion=").concat(ps),i=JSON.stringify({sessionLength:t});r.open("POST",n),r.setRequestHeader("Content-Type","application/json"),r.send(i),Ps(r,s,a)}),As=async()=>new Promise((e,t)=>{const s=new XMLHttpRequest,a="".concat(ys(),"/api/auth/server-public-key?&userbaseJsVersion=").concat(ps);s.open("GET",a),s.responseType="arraybuffer",s.send(),Ps(s,e,t)}),Ts=e=>new Promise((t,s)=>{const a=new XMLHttpRequest,r="".concat(ys(),"/api/public-key?appId=").concat(ws(),"&username=").concat(encodeURIComponent(e),"&userbaseJsVersion=").concat(ps);a.open("GET",r),a.send(),Ps(a,t,s)}),ks=s(2),Ds=s.n(ks);function Ks(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function xs(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ks(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ks(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const Rs=e=>(...t)=>{try{return e(...t)}catch(e){console.warn("Error accessing browser storage. Defaulting to memory.\n\n",e)}},Os=(e,t)=>"userbaseSeed.".concat(e,".").concat(t),Cs=Rs((e,t,s,a,r,n)=>{const i={username:t,signedIn:s,sessionId:a,creationDate:r,expirationDate:n},o=JSON.stringify(i);"local"===e?localStorage.setItem("userbaseCurrentSession",o):"session"===e&&sessionStorage.setItem("userbaseCurrentSession",o)});var _s={signInSession:(e,t,s,a,r)=>{Cs(e,t,!0,s,a,r)},signOutSession:(e,t)=>{Cs(e,t,!1)},getCurrentSession:Rs(()=>{const e=sessionStorage.getItem("userbaseCurrentSession");if(e){if(!JSON.parse(e).signedIn){const e=localStorage.getItem("userbaseCurrentSession");if(e){const t=JSON.parse(e);if(t.signedIn)return xs(xs({},t),{},{rememberMe:"local"})}}return xs(xs({},JSON.parse(e)),{},{rememberMe:"session"})}const t=localStorage.getItem("userbaseCurrentSession");return t&&xs(xs({},JSON.parse(t)),{},{rememberMe:"local"})}),saveSeedString:Rs((e,t,s,a)=>{"local"===e?localStorage.setItem(Os(t,s),a):"session"===e&&sessionStorage.setItem(Os(t,s),a)}),removeSeedString:Rs((e,t)=>{const s=Os(e,t);sessionStorage.removeItem(s),localStorage.removeItem(s)}),getSeedString:Rs((e,t)=>{const s=Os(e,t);return sessionStorage.getItem(s)||localStorage.getItem(s)}),removeCurrentSession:Rs(()=>{sessionStorage.removeItem("userbaseCurrentSession"),localStorage.removeItem("userbaseCurrentSession")})};const Fs=(e,t)=>{const s=t?new Uint8Array(e):new Uint16Array(e),a=s.length;let r="",n=10240;for(var i=0;i<a;i+=n){i+n>a&&(n=a-i);const e=s.subarray(i,i+n);r+=String.fromCharCode.apply(null,e)}return r},Ls=(e,t=!1)=>{let s=new ArrayBuffer(e.length*(t?1:2)),a=t?new Uint8Array(s):new Uint16Array(s);for(let t=0,s=e.length;t<s;t++)a[t]=e.charCodeAt(t);return s},js=(e,t)=>{const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s.buffer},qs=async e=>await window.crypto.subtle.digest({name:"SHA-256"},e);var Vs={BYTE_SIZE:32,HASH_ALGORITHM_NAME:"SHA-256",hash:qs,hashBase64String:async e=>{const t=i.a.decode(e),s=await qs(t);return i.a.encode(s)},hashString:async e=>{const t=Ls(e),s=await qs(t);return i.a.encode(s)}};const Hs=["deriveKey","deriveBits"],Gs=async e=>await window.crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,Hs),Js=Vs.BYTE_SIZE,Ws=(e,t)=>({name:"HKDF",info:Ls(e),hash:Vs.HASH_ALGORITHM_NAME,salt:t});var Ys={importHkdfKeyFromString:async e=>{const t=Ls(e);return await Gs(t)},importHkdfKey:Gs,generateSalt:()=>window.crypto.getRandomValues(new Uint8Array(Js)),getParams:Ws,getPasswordToken:async(e,t)=>{const s=await window.crypto.subtle.deriveBits(Ws("password-token",t),e,256);return i.a.encode(s)}};const zs=["encrypt","decrypt"],Zs=()=>"undefined"!=typeof window?window:self,Xs=()=>({name:"AES-GCM",length:256}),Qs=e=>({name:"AES-GCM",tagLength:128,iv:e}),$s=()=>window.crypto.getRandomValues(new Uint8Array(12)),ea=e=>{const t=e.byteLength-12;return{ciphertextArrayBuffer:e.slice(0,t),iv:e.slice(t)}},ta=async()=>await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,zs),sa=async e=>await Zs().crypto.subtle.importKey("raw",e,{name:"AES-GCM"},!0,zs),aa=async e=>await Zs().crypto.subtle.exportKey("raw",e),ra=async(e,t)=>{const s=$s(),a=await Zs().crypto.subtle.encrypt(Qs(s),e,t);return js(a,s)},na=async(e,t)=>{const s=Ls(t),a=await ra(e,s);return i.a.encode(a)},ia=async(e,t)=>{const{ciphertextArrayBuffer:s,iv:a}=ea(t);return await Zs().crypto.subtle.decrypt(Qs(a),e,s)},oa=async(e,t)=>{const s=i.a.decode(t),a=await ia(e,s);return Fs(a)};var ca={getEncryptionKeyParams:Xs,getCiphertextParams:Qs,generateIv:$s,sliceEncryptedArrayBuffer:ea,importKeyFromMaster:async(e,t,s="encryption")=>await window.crypto.subtle.deriveKey(Ys.getParams(s,t),e,{name:"AES-GCM",length:256},!0,zs),generateKey:ta,getKeyStringFromKey:async e=>{const t=await window.crypto.subtle.exportKey("raw",e);return i.a.encode(t)},getKeyFromKeyString:async e=>{const t=i.a.decode(e);return await sa(t)},getRawKeyFromKey:aa,getKeyFromRawKey:sa,encrypt:ra,encryptJson:async(e,t)=>{const s=JSON.stringify(t);return await na(e,s)},encryptString:na,decrypt:ia,decryptJson:async(e,t)=>{const s=await oa(e,t);return JSON.parse(s)},decryptString:oa,getPasswordBasedEncryptionKey:async(e,t)=>await window.crypto.subtle.deriveKey(Ys.getParams("password-based-encryption",t),e,{name:"AES-GCM",length:256},!1,zs),generateAndEncryptKeyEncryptionKey:async e=>{const t=await ta(),s=await aa(t);return[t,await ra(e,s)]},RAW_KEY_TYPE:"raw",KEY_WILL_BE_USED_TO:zs},ua=s(10),da=s.n(ua);const ha=["encrypt"],la=(e=>{if(e.length%2!=0)throw new Error("Hex string must be even length");const t=e.length/2,s=[];for(let a=0;a<t;a++){const t=2*a,r=e.substring(t,t+2),n=parseInt(r,16);s.push(n)}return new Uint8Array(s)})("ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"),fa=[2];let ma=null;const pa=e=>((e,t)=>(e.setPrivateKey(t),e.generateKeys(),e))(da.a.createDiffieHellman(la,fa),e),wa=async(e,t)=>{const s=pa(e).computeSecret(t),a=await Vs.hash(s);return await ca.getKeyFromRawKey(a)};var ga={getPublicKey:e=>pa(e).getPublicKey(),getSharedKey:wa,getSharedKeyWithServer:async e=>await wa(e,new Uint8Array(await(async()=>ma||(ma=await As(),ma))())),importKeyFromMaster:async(e,t)=>{const s=await window.crypto.subtle.deriveKey(Ys.getParams("diffie-hellman",t),e,ca.getEncryptionKeyParams(),!0,ha);return await ca.getRawKeyFromKey(s)}};const ya=["sign","verify"],ba=["sign"],va=["verify"],Ma={name:"ECDSA",namedCurve:"P-256"},Sa={name:"ECDSA",hash:{name:Vs.HASH_ALGORITHM_NAME}},Ia=async e=>await window.crypto.subtle.exportKey("spki",e),Pa=async e=>{const t=await Ia(e);return i.a.encode(t)},Ea=async(e,t)=>await ca.importKeyFromMaster(e,t,"ecdsa-key-encryption-key"),Ba=async(e,t)=>await window.crypto.subtle.sign(Sa,e,t),Na=async(e,t,s)=>await window.crypto.subtle.verify(Sa,e,t,s);var Ua={generateEcdsaKeyData:async e=>{const t=await(async()=>await window.crypto.subtle.generateKey(Ma,!0,ya))(),s=Ys.generateSalt(),a=await Ea(e,s),r=await(async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);return Ls(JSON.stringify(t))})(t.privateKey),n=await ca.encrypt(a,r);return{ecdsaPrivateKey:t.privateKey,ecdsaPublicKey:await Pa(t.publicKey),encryptedEcdsaPrivateKey:i.a.encode(n),ecdsaKeyEncryptionKeySalt:i.a.encode(s)}},importEcdsaKeyEncryptionKeyFromMaster:Ea,getPrivateKeyFromRawPrivateKey:async e=>{const t=JSON.parse(Fs(e));return await window.crypto.subtle.importKey("jwk",t,Ma,!0,ba)},getPublicKeyFromRawPublicKey:async e=>await window.crypto.subtle.importKey("spki",e,Ma,!0,va),getRawPublicKeyFromPublicKey:Ia,getPublicKeyStringFromPublicKey:Pa,getPublicKeyFromPrivateKey:async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);delete t.d,t.key_ops=va;return await window.crypto.subtle.importKey("jwk",t,Ma,!0,va)},sign:Ba,signString:async(e,t)=>{const s=Ls(t),a=await Ba(e,s);return i.a.encode(a)},verify:Na,verifyString:async(e,t,s)=>{const a=Ls(s),r=i.a.decode(t);return await Na(e,r,a)}};const Aa=["deriveKey","deriveBits"],Ta={name:"ECDH",namedCurve:"P-256"},ka=async()=>await window.crypto.subtle.generateKey(Ta,!0,Aa),Da=async e=>await window.crypto.subtle.exportKey("spki",e),Ka=async(e,t)=>await ca.importKeyFromMaster(e,t,"ecdh-key-encryption-key");var xa={generateKeyPair:ka,generateEcdhKeyData:async(e,t)=>{const s=await ka(),a=Ys.generateSalt(),r=await Ka(e,a),n=await(async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);return Ls(JSON.stringify(t))})(s.privateKey),o=await ca.encrypt(r,n),c=await Da(s.publicKey),u=await Ua.sign(t,c);return{ecdhPrivateKey:s.privateKey,ecdhPublicKey:i.a.encode(c),encryptedEcdhPrivateKey:i.a.encode(o),signedEcdhPublicKey:i.a.encode(u),ecdhKeyEncryptionKeySalt:i.a.encode(a)}},importEcdhKeyEncryptionKeyFromMaster:Ka,getPrivateKeyFromRawPrivateKey:async e=>{const t=JSON.parse(Fs(e));return await window.crypto.subtle.importKey("jwk",t,Ta,!0,Aa)},getRawPublicKeyFromPublicKey:Da,getPublicKeyFromRawPublicKey:async e=>await window.crypto.subtle.importKey("spki",e,Ta,!0,[]),computeSharedKeyEncryptionKey:async(e,t)=>await window.crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:e},t,ca.getEncryptionKeyParams(),!1,ca.KEY_WILL_BE_USED_TO)};const Ra=["sign"],Oa=["sign","verify"],Ca=async(e,t)=>await window.crypto.subtle.sign({name:"HMAC"},e,t);var _a={importKeyFromMaster:async(e,t)=>await window.crypto.subtle.deriveKey(Ys.getParams("authentication",t),e,{name:"HMAC",hash:{name:Vs.HASH_ALGORITHM_NAME},length:512},!1,Ra),importKeyFromRawBits:async e=>await window.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:Vs.HASH_ALGORITHM_NAME},length:256},!1,Oa),sign:Ca,signString:async(e,t)=>{const s=await Ca(e,Ls(t));return i.a.encode(s)}},Fa=s(11),La=s.n(Fa);var ja={generateSeed:()=>window.crypto.getRandomValues(new Uint8Array(32)),aesGcm:ca,diffieHellman:ga,ecdsa:Ua,ecdh:xa,sha256:Vs,hmac:_a,hkdf:Ys,scrypt:{generateSalt:()=>window.crypto.getRandomValues(new Uint8Array(16)),hash:async(e,t,s=La.a.scrypt)=>{const a=new Uint8Array(Ls(e)),r=await s(a,t,16384,8,1,32);return i.a.encode(r)}}};const qa=e=>e.split(":")[0],Va=e=>{const t=(e=>"http://"===e.substring(0,"http://".length)?e.substring("http://".length):"https://"===e.substring(0,"https://".length)?e.substring("https://".length):e)(e);return("https"===qa(e)?"wss://":"ws://")+t},Ha=e=>2*e.length,Ga=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function Ja(){let e=[],t=0;this.getLength=()=>e.length-t,this.isEmpty=()=>0===e.length,this.enqueue=t=>(e.push(t),this.getLength()),this.dequeue=()=>{const s=e[t];return t+=1,2*t>e.length&&(e=e.slice(t),t=0),s},this.peek=()=>e[t]}const Wa=()=>{const e=URL.createObjectURL(new Blob(["(",function(){self.onmessage=function(e){const{compress:t,decompress:s,data:a}=e.data,r=function(){function e(e,t){if(!r[e]){r[e]={};for(var s=0;s<e.length;s++)r[e][e.charAt(s)]=s}return r[e][t]}var t=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},n={compressToBase64:function(e){if(null==e)return"";var t=n._compress(e,6,(function(e){return s.charAt(e)}));switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,(function(a){return e(s,t.charAt(a))}))},compressToUTF16:function(e){return null==e?"":n._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=n.compress(e),s=new Uint8Array(2*t.length),a=0,r=t.length;r>a;a++){var i=t.charCodeAt(a);s[2*a]=i>>>8,s[2*a+1]=i%256}return s},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var s=new Array(e.length/2),a=0,r=s.length;r>a;a++)s[a]=256*e[2*a]+e[2*a+1];var i=[];return s.forEach((function(e){i.push(t(e))})),n.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,(function(e){return a.charAt(e)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,(function(s){return e(a,t.charAt(s))})))},compress:function(e){return n._compress(e,16,(function(e){return t(e)}))},_compress:function(e,t,s){if(null==e)return"";var a,r,n,i={},o={},c="",u="",d="",h=2,l=3,f=2,m=[],p=0,w=0;for(n=0;n<e.length;n+=1)if(c=e.charAt(n),Object.prototype.hasOwnProperty.call(i,c)||(i[c]=l++,o[c]=!0),u=d+c,Object.prototype.hasOwnProperty.call(i,u))d=u;else{if(Object.prototype.hasOwnProperty.call(o,d)){if(d.charCodeAt(0)<256){for(a=0;f>a;a++)p<<=1,w==t-1?(w=0,m.push(s(p)),p=0):w++;for(r=d.charCodeAt(0),a=0;8>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}else{for(r=1,a=0;f>a;a++)p=p<<1|r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r=0;for(r=d.charCodeAt(0),a=0;16>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}0==--h&&(h=Math.pow(2,f),f++),delete o[d]}else for(r=i[d],a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;0==--h&&(h=Math.pow(2,f),f++),i[u]=l++,d=String(c)}if(""!==d){if(Object.prototype.hasOwnProperty.call(o,d)){if(d.charCodeAt(0)<256){for(a=0;f>a;a++)p<<=1,w==t-1?(w=0,m.push(s(p)),p=0):w++;for(r=d.charCodeAt(0),a=0;8>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}else{for(r=1,a=0;f>a;a++)p=p<<1|r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r=0;for(r=d.charCodeAt(0),a=0;16>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}0==--h&&(h=Math.pow(2,f),f++),delete o[d]}else for(r=i[d],a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(r=2,a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;for(;;){if(p<<=1,w==t-1){m.push(s(p));break}w++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(e,s,a){var r,n,i,o,c,u,d,h=[],l=4,f=4,m=3,p="",w=[],g={val:a(0),position:s,index:1};for(r=0;3>r;r+=1)h[r]=r;for(i=0,c=Math.pow(2,2),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;switch(i){case 0:for(i=0,c=Math.pow(2,8),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;d=t(i);break;case 1:for(i=0,c=Math.pow(2,16),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;d=t(i);break;case 2:return""}for(h[3]=d,n=d,w.push(d);;){if(g.index>e)return"";for(i=0,c=Math.pow(2,m),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;switch(d=i){case 0:for(i=0,c=Math.pow(2,8),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;h[f++]=t(i),d=f-1,l--;break;case 1:for(i=0,c=Math.pow(2,16),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;h[f++]=t(i),d=f-1,l--;break;case 2:return w.join("")}if(0==l&&(l=Math.pow(2,m),m++),h[d])p=h[d];else{if(d!==f)return null;p=n+n.charAt(0)}w.push(p),h[f++]=n+p.charAt(0),n=p,0==--l&&(l=Math.pow(2,m),m++)}}};return n}();t?postMessage(r.compress(a)):s&&postMessage(r.decompress(a))}}.toString(),")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t},Ya=async e=>{const t=Wa();return new Promise(s=>{t.onmessage=e=>{s(e.data),t.terminate()},t.postMessage({compress:!0,data:e})})},za=async e=>{const t=Wa();return new Promise(s=>{t.onmessage=e=>{s(e.data),t.terminate()},t.postMessage({decompress:!0,data:e})})},Za=async(e,t,s,a,r,n)=>new Promise((i,o)=>{const c=new XMLHttpRequest,u="".concat(ys(),"/api/bundle-chunk?userbaseJsVersion=").concat(ps,"&")+"userId=".concat(e,"&")+"databaseId=".concat(t,"&")+"seqNo=".concat(s,"&")+"bundleId=".concat(a,"&")+"chunkNumber=".concat(r);c.open("POST",u),c.send(new Uint8Array(n)),Ps(c,i,o,3e4)});function Xa(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Qa(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Xa(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Xa(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const $a=Ds()();class er extends Error{constructor(e,t,...s){super(...s),this.name="RequestFailed: ".concat(e),this.message=t.message,this.status=t.status||"timeout"===t.message&&g,this.response=t.status&&t}}class tr extends Error{constructor(e,t,s,...a){super(...a),this.name="WebSocket error",this.message=e,this.username=t,this.e=s}}var sr=new class{constructor(){this.init()}init(e,t,s,a,r,n,i,o){this.pingTimeout&&clearTimeout(this.pingTimeout);for(const e of Object.keys(this))delete this[e];this.ws=null,this.connected=!1,this.resolveConnection=e,this.rejectConnection=t,this.connectionResolved=!1,this.session={username:s&&s.username,sessionId:s&&s.sessionId,creationDate:s&&s.creationDate,expirationDate:s&&s.expirationDate,userId:s&&s.userId,authToken:s&&s.authToken},this.seedString=a,this.changePassword=n,this.keys={init:!1,salts:{}},this.userData={stripeData:{}},this.rememberMe=r,this.requests={},this.state=i||{dbNameToHash:{},databases:{},databasesByDbId:{},shareTokenIdToDbId:{}},this.encryptionMode=o}connect(e,t=null,s,a,r,n){if(this.connected)throw new tr("Web Socket already connected",this.session.username);return new Promise((i,c)=>{let u=!1;const d=setTimeout(()=>{this.connected||this.reconnecting||(u=!0,c(new tr("timeout")))},1e4),h="".concat(Va(ys()),"/api?appId=").concat(ws(),"&sessionId=").concat(e.sessionId,"&clientId=").concat($a,"&userbaseJsVersion=").concat(ps),l=new WebSocket(h);l.onopen=async()=>{u||clearTimeout(d)},l.onmessage=async r=>{if(!u)try{const u=JSON.parse(r.data);switch(u.route){case"Ping":{this.heartbeat();const e="Pong";this.ws.send(JSON.stringify({action:e}));break}case"Connection":{const{encryptionMode:o}=u;if(this.init(i,c,e,t,s,a,n,o),this.ws=l,this.heartbeat(),this.connected=!0,t){const{keySalts:e,validationMessage:t,ecKeyData:s,encryptedValidationMessage:a}=u;this.keys.salts=e,this.validationMessage=t,this.ecKeyData=s,a&&(this.encryptedValidationMessage=new Uint8Array(a.data));try{await this.setKeys(this.seedString);const e=await this.validateKey();this.userData=e}catch(r){throw r&&"OperationError"===r.name||r instanceof DOMException?new Error("Invalid seed"):r}this.keys.init=!0}this.resolveConnection(),this.connectionResolved=!0;break}case"ApplyTransactions":{const e=u.dbId,t=u.dbNameHash,s=u.isOwner?this.state.databases[t]:this.state.databasesByDbId[e];if(!s)throw new Error("Missing database");s.applyTransactionsQueue.isEmpty()?s.applyTransactionsQueue.enqueue(null):await new Promise(e=>{const t=e;s.applyTransactionsQueue.enqueue(t)});if((u.dbNameHash&&(u.dbKey||u.plaintextDbKey)||u.shareTokenEncryptedDbKey)&&(!s.dbKeyString||!s.dbKey)){const e=u.plaintextDbKey||(u.dbKey?await ja.aesGcm.decryptString(this.keys.encryptionKey,u.dbKey):await s.decryptShareTokenEncryptedDbKey(u.shareTokenEncryptedDbKey,u.shareTokenEncryptionKeySalt));s.dbKeyString=e,s.dbKey=await ja.aesGcm.getKeyFromKeyString(e)}if(!s.dbKey)throw new Error("Missing db key");if(u.writers){s.attributionEnabled=!0;for(const{userId:e,username:t}of u.writers)s.usernamesByUserId.set(e,t)}if(u.waitForFullBundle){s.finishedWaitingForBundle||await new Promise(e=>s.finishedWaitingForBundle=e);try{const e=await this.rebuildBundle(s,u.bundleSeqNo,u.encryptedBundleEncryptionKey);await s.applyBundle(e,u.bundleSeqNo)}catch(r){throw window.alert("Oops! Something went wrong. Please contact the site administrator with this issue (".concat(e,").\n\n")+r),r}}const a=u.transactionLog;if(await s.applyTransactions(a,u.ownerId,e,t),u.buildBundle&&this.buildBundle(s),s.applyTransactionsQueue.dequeue(),!s.applyTransactionsQueue.isEmpty()){s.applyTransactionsQueue.peek()()}break}case"DownloadBundleChunk":{const{dbId:e,dbNameHash:t,isOwner:s,bundleSeqNo:a,isFirstChunk:r,isLastChunk:n,chunk:i}=u,o=s?this.state.databases[t]:this.state.databasesByDbId[e];if(!o)throw new Error("Missing database");r&&(o.bundleChunks[a]=[]),o.bundleChunks[a].push(i),n&&(o.finishedWaitingForBundle?o.finishedWaitingForBundle():o.finishedWaitingForBundle=!0);break}case"UpdatedUser":this.handleUpdateUser(u.updatedUser);break;case"SignOut":case"UpdateUser":case"DeleteUser":case"CreateDatabase":case"OpenDatabase":case"OpenDatabaseByDatabaseId":case"GetDatabases":case"GetDatabaseUsers":case"Insert":case"Update":case"Delete":case"BatchTransaction":case"InitBundleUpload":case"CompleteBundleUpload":case"GenerateFileId":case"UploadFileChunk":case"CompleteFileUpload":case"GetChunk":case"ValidateKey":case"GetPasswordSalts":case"PurchaseSubscription":case"CancelSubscription":case"ResumeSubscription":case"UpdatePaymentMethod":case"ShareDatabase":case"ShareDatabaseToken":case"AuthenticateShareToken":case"SaveDatabase":case"ModifyDatabasePermissions":case"VerifyUser":{const e=u.requestId;if(!e)return console.warn("Missing request id");const t=this.requests[e];if(!t)return console.warn("Request ".concat(e," no longer exists!"));if(!t.promiseResolve||!t.promiseReject)return;const s=u.response;return s&&s.status===o?t.promiseResolve(s):t.promiseReject(s)}default:console.log("Received unknown message from backend:"+JSON.stringify(u))}}catch(r){this.connectionResolved?console.warn("Error handling message: ",r):(this.close(),c(new tr(r.message,e.username,r)))}},l.onclose=async o=>{if(u)return;const d=o.code===y,h=o.code===b;if(d||h||!o.wasClean){const o=d&&!r?0:r?r+1e3:1e3;this.reconnecting=!0,await this.reconnect(i,c,e,this.seedString||t,s,a,o,!this.reconnected&&n)}else o.code===v?c(new tr("Web Socket already connected",e.username,o)):this.init()},l.onerror=()=>{}})}async reconnect(e,t,s,a,r,n,i,o){try{const t=Math.min(i,3e4);console.log("Connection to server lost. Attempting to reconnect in ".concat(t/1e3," second").concat(1e3!==t?"s":"","..."));const c=[],u=[];e(await new Promise((e,d)=>setTimeout(async()=>{try{const t=o||{dbNameToHash:Qa({},this.state.dbNameToHash),databases:Qa({},this.state.databases),databasesByDbId:Qa({},this.state.databasesByDbId),shareTokenIdToDbId:Qa({},this.state.shareTokenIdToDbId)};for(const e in t.databases)t.databases[e].init=!1,t.databases[e].finishedWaitingForBundle=!1,c.push(e);for(const e in t.databasesByDbId)t.databasesByDbId[e].init=!1,t.databasesByDbId[e].finishedWaitingForBundle=!1,u.push(e);this.init(),this.reconnecting=!0;const d=await this.connect(s,a,r,n,i,t);this.reconnected=!0,o||(await this.reopenDatabases(c,u,1e3),console.log("Reconnected!")),e(d)}catch(e){d(e)}},t)))}catch(e){t(e)}}async reopenDatabases(e,t,s){try{const s=[];for(const t of e){const e=this.state.databases[t];if(!e.init){const a="OpenDatabase",r={dbNameHash:t,reopenAtSeqNo:e.lastSeqNo};s.push(this.request(a,r))}}for(const e of t){const t=this.state.databasesByDbId[e];if(!t.init){const a=t.shareTokenHkdfKey,r=a?await this.authenticateShareToken(t.shareTokenId,a):{},n="OpenDatabaseByDatabaseId",i=Qa({databaseId:e,reopenAtSeqNo:t.lastSeqNo},r);s.push(this.request(n,i))}}await Promise.all(s)}catch(a){await new Promise(a=>setTimeout(async()=>{await this.reopenDatabases(e,t,s+1e3),a()},Math.min(s,3e4)))}}heartbeat(){clearTimeout(this.pingTimeout);this.pingTimeout=setTimeout(()=>{this.ws&&this.ws.close(b)},33e3)}close(e){this.ws?this.ws.close(e):this.init()}async signOut(){const e=this.session.username,t=this.connectionResolved,s=this.rejectConnection;try{_s.signOutSession(this.rememberMe,e);const a=this.session.sessionId;if(this.reconnecting)throw new hs.Reconnecting;const r="SignOut",n={sessionId:a};await this.request(r,n),this.close(),!t&&s&&s(new tr("Canceled",e))}catch(a){throw!t&&s&&s(new tr("Canceled",e)),a}}async setKeys(e){if(this.keys.init)return;if(!e)throw new tr("Missing seed",this.session.username);if(!this.keys.salts)throw new tr("Missing salts",this.session.username);this.seedString||(this.seedString=e);const t=i.a.decode(e),s=await ja.hkdf.importHkdfKey(t),a=this.keys.salts;if(this.keys.encryptionKey=await ja.aesGcm.importKeyFromMaster(s,i.a.decode(a.encryptionKeySalt)),this.keys.hmacKey=await ja.hmac.importKeyFromMaster(s,i.a.decode(a.hmacKeySalt)),a.ecdsaKeyEncryptionKeySalt){const e=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(s,i.a.decode(a.ecdsaKeyEncryptionKeySalt)),t=i.a.decode(this.ecKeyData.encryptedEcdsaPrivateKey),r=await ja.aesGcm.decrypt(e,t);this.keys.ecdsaPrivateKey=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(r);const n=await ja.ecdh.importEcdhKeyEncryptionKeyFromMaster(s,i.a.decode(a.ecdhKeyEncryptionKeySalt)),o=i.a.decode(this.ecKeyData.encryptedEcdhPrivateKey),c=await ja.aesGcm.decrypt(n,o);this.keys.ecdhPrivateKey=await ja.ecdh.getPrivateKeyFromRawPrivateKey(c)}else a.dhKeySalt&&(this.keys.dhPrivateKey=await ja.diffieHellman.importKeyFromMaster(s,i.a.decode(a.dhKeySalt)));if(a.dhKeySalt||a.ecdsaKeyWrapperSalt){const e=await ja.ecdsa.generateEcdsaKeyData(s),t=await ja.ecdh.generateEcdhKeyData(s,e.ecdsaPrivateKey);this.keys.ecdsaPrivateKey=e.ecdsaPrivateKey,this.keys.ecdhPrivateKey=t.ecdhPrivateKey,delete e.ecdsaPrivateKey,delete t.ecdhPrivateKey,this.newEcKeyData={ecdsaKeyData:e,ecdhKeyData:t}}}async validateKey(){let e;if(this.keys.ecdsaPrivateKey&&!this.keys.dhPrivateKey)e=await ja.ecdsa.sign(this.keys.ecdsaPrivateKey,i.a.decode(this.validationMessage));else if(this.keys.dhPrivateKey){const t=await ja.diffieHellman.getSharedKeyWithServer(this.keys.dhPrivateKey);e=await ja.aesGcm.decrypt(t,this.encryptedValidationMessage),delete this.keys.dhPrivateKey}const t={validationMessage:i.a.encode(e),ecKeyData:this.newEcKeyData};return(await this.request("ValidateKey",t)).data}async request(e,t){const s=Ds()();this.requests[s]={};const a=this.watch(s);this.ws.send(JSON.stringify({requestId:s,action:e,params:t}));try{return await a}catch(t){throw t.status===m?new hs.TooManyRequests(t.data.retryDelay):new er(e,t)}}async watch(e){const t=await new Promise((t,s)=>{this.requests[e].promiseResolve=t,this.requests[e].promiseReject=s,setTimeout(()=>{s(new Error("timeout"))},3e4)});return delete this.requests[e],t}async rebuildBundle(e,t,s){const a=[];for(let s=0;s<e.bundleChunks[t].length;s++){const r=e.bundleChunks[t][s],n=Ls(r);a.push(n)}const r=(e=>{const t=e.map(e=>e.byteLength),s=t.reduce((e,t)=>e+t),a=new Uint8Array(s);let r=0;for(let s=0;s<e.length;s++)a.set(new Uint8Array(e[s]),r),r+=t[s];return{buffer:a.buffer,byteLengths:t}})(a).buffer,{encrypted:n,plaintextMetadata:o}=JSON.parse(Fs(r)),c=await ja.aesGcm.decrypt(e.dbKey,i.a.decode(s)),u=await ja.aesGcm.getKeyFromRawKey(c),d=await ja.aesGcm.decrypt(u,Ls(n)),h=Fs(d),[l,f]=await Promise.all([za(h),za(o)]),m=Qa(Qa({},JSON.parse(l)),JSON.parse(f));return delete e.bundleChunks[t],m}async uploadBundle(e,t,s,a,r){let n=0,i=0,o=[];for(;n<r.byteLength;){const c=r.slice(n,n+524288);if(o.push(Za(e,t,s,a,i,c)),10===o.length){try{await Promise.all(o)}catch(e){return 0}o=[]}i+=1,n+=524288}try{await Promise.all(o)}catch(e){return 0}return i}async initBundleUpload(e,t,s){const a={dbId:e,seqNo:t};let r;try{r=await this.request("InitBundleUpload",a)}catch(e){return{}}const{bundleId:n}=r.data,[o,c]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(s);return{bundleId:n,bundleEncryptionKey:o,encryptedBundleEncryptionKey:i.a.encode(c)}}orderedItems(e,t){const s=[];for(let a=0;a<t.array.length;a++){const r=t.array[a].itemId;s.push(e[r])}return s}prepareBundle(e){const{items:t,itemsIndex:s,itemsPlaintextMetadata:a}=e;return{encrypted:JSON.stringify({items:this.orderedItems(t,s),itemsIndex:s.array}),plaintextMetadata:JSON.stringify({itemsPlaintextMetadata:this.orderedItems(a,s)})}}async buildBundle(e){const t=e.dbId,s=e.lastSeqNo,a=e.dbKey,r=this.session.userId;if(e.bundledAtSeqNo&&e.bundledAtSeqNo>=s)return;e.bundledAtSeqNo=s;const n=this.prepareBundle(e),i=e.attributionEnabled?[...e.usernamesByUserId.keys()].join(","):void 0,{bundleId:o,bundleEncryptionKey:c,encryptedBundleEncryptionKey:u}=await this.initBundleUpload(t,s,a);if(!o)return;const[d,h]=await Promise.all([Ya(n.encrypted),Ya(n.plaintextMetadata)]),l=Ls(d),f=await ja.aesGcm.encrypt(c,l);n.encrypted=Fs(f),n.plaintextMetadata=h;const m=Ls(JSON.stringify(n)),p=await this.uploadBundle(r,t,s,o,m);if(!p)return;const w={dbId:t,seqNo:s,bundleId:o,writers:i,numChunks:p,encryptedBundleEncryptionKey:u};try{await this.request("CompleteBundleUpload",w)}catch(e){return}}buildUserResult({username:e,userId:t,authToken:s,email:a,profile:r,protectedProfile:n,usedTempPassword:i,changePassword:o,passwordChanged:c,userData:u}){const d={username:e,userId:t,authToken:s};if(a&&(d.email=a),r&&(d.profile=r),n&&(d.protectedProfile=n),i&&(d.usedTempPassword=i),o&&(d.changePassword=o),c&&(d.passwordChanged=c),u){const{creationDate:e,stripeData:t}=u;if(e&&(d.creationDate=e),t){const{paymentsMode:e,subscriptionStatus:s,cancelSubscriptionAt:a,subscriptionPlanId:r,trialExpirationDate:n}=t;e&&(d.paymentsMode=e),s&&(d.subscriptionStatus=s),a&&(d.cancelSubscriptionAt=a),r&&(d.subscriptionPlanId=r),n&&(d.trialExpirationDate=n)}}return d}handleUpdateUser(e){if(this.session&&this.session.userId===e.userId){this.session.username=e.username,this.userData=e.userData;const t=gs();t&&t({user:this.buildUserResult(Qa({authToken:this.session.authToken},e))})}}async rotateKeys(e,t){const{keySalts:s,ecKeyData:a}=t,{ecdsaKeyData:r,ecdhKeyData:n}=a;s.ecdsaKeyEncryptionKeySalt=r.ecdsaKeyEncryptionKeySalt,s.ecdhKeyEncryptionKeySalt=n.ecdhKeyEncryptionKeySalt,this.keys.salts=s,this.ecKeyData=Qa(Qa({},r),n),await this.setKeys(e),this.keys.init=!0}async authenticateShareToken(e,t){const s={shareTokenId:e};let a;try{a=await this.request("AuthenticateShareToken",s)}catch(e){if(e.response&&"ShareTokenNotFound"===e.response.data)throw new hs.ShareTokenNotFound;throw e}const{databaseId:r,shareTokenAuthKeyData:n,validationMessage:o}=a.data;let c;try{const e=i.a.decode(n.shareTokenEcdsaKeyEncryptionKeySalt),s=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(t,e),a=i.a.decode(n.shareTokenEncryptedEcdsaPrivateKey),r=await ja.aesGcm.decrypt(s,a);c=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(r)}catch(e){throw new hs.ShareTokenInvalid}const u=await ja.ecdsa.sign(c,i.a.decode(o));return{databaseId:r,validationMessage:o,signedValidationMessage:i.a.encode(u)}}};function ar(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function rr(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ar(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ar(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const nr={local:!0,session:!0,none:!0},ir="Device not recognized. This temporary password can only be used to sign in from a device you've signed in from before.",or="Device not recognized. Forgot password only works from a device you've signed in from before.",cr=e=>{if(e.response){if("Domain not whitelisted"===e.response.data)throw new hs.DomainNotWhitelisted(window.location.origin);if("App ID not valid"===e.response.data)throw new hs.AppIdNotValid;if("UserNotFound"===e.response.data)throw new hs.UserNotFound;if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout},ur=async(e,t,s,a)=>{try{await sr.connect(e,t,s,a)}catch(e){if(cr(e),"Web Socket already connected"===e.message)throw new hs.UserAlreadySignedIn(e.username);throw e}},dr=e=>{if(e.response&&"UsernameTooLong"===e.response.data.error)throw new hs.UsernameTooLong(e.response.data.maxLen);if(e.response&&"PasswordAttemptLimitExceeded"===e.response.data.error)throw new hs.PasswordAttemptLimitExceeded(e.response.data.delay)},hr=e=>{if(e.response&&e.response.data){const t=e.response.data;switch(t.error){case"SessionLengthTooShort":throw new hs.SessionLengthTooShort(t.minLen);case"SessionLengthTooLong":throw new hs.SessionLengthTooLong(t.maxLen)}}},lr=(e,t)=>{if(cr(e),dr(e),e.response){const s=e.response.data;switch(s){case"UsernameAlreadyExists":throw new hs.UsernameAlreadyExists(t);case"TrialExceededLimit":throw new hs.TrialExceededLimit;case"CurrentPasswordIncorrect":throw new hs.CurrentPasswordIncorrect}switch(s.error){case"EmailNotValid":throw new hs.EmailNotValid;case"ProfileMustBeObject":throw new hs.ProfileMustBeObject;case"ProfileKeyTooLong":throw new hs.ProfileKeyTooLong(s.maxLen,s.key);case"ProfileValueMustBeString":throw new hs.ProfileValueMustBeString(s.key,s.value);case"ProfileValueCannotBeBlank":throw new hs.ProfileValueCannotBeBlank(s.key);case"ProfileValueTooLong":throw new hs.ProfileValueTooLong(s.maxLen,s.key,s.value);case"ProfileHasTooManyKeys":throw new hs.ProfileHasTooManyKeys(s.maxKeys);case"ProfileCannotBeEmpty":throw new hs.ProfileCannotBeEmpty}}throw e},fr=e=>e&&60*e*60*1e3,mr=e=>{if("string"!=typeof e)throw new hs.UsernameMustBeString;if(0===e.length)throw new hs.UsernameCannotBeBlank},pr=e=>{if("string"!=typeof e)throw new hs.PasswordMustBeString;if(0===e.length)throw new hs.PasswordCannotBeBlank;if(e.length<6)throw new hs.PasswordTooShort(6);if(e.length>1e3)throw new hs.PasswordTooLong(1e3)},wr=e=>{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"username"))throw new hs.UsernameMissing;if(!Ga(e,"password"))throw new hs.PasswordMissing;if(mr(e.username),pr(e.password),Ga(e,"rememberMe")&&!nr[e.rememberMe])throw new hs.RememberMeValueNotValid(nr);if(Ga(e,"sessionLength")&&"number"!=typeof e.sessionLength)throw new hs.SessionLengthMustBeNumber},gr=async(e,t,s)=>{const a=ja.scrypt.generateSalt(),r=await ja.scrypt.hash(e,a,s),n=await ja.hkdf.importHkdfKeyFromString(r),o=ja.hkdf.generateSalt(),c=await ja.hkdf.getPasswordToken(n,o),u=ja.hkdf.generateSalt(),d=await ja.aesGcm.getPasswordBasedEncryptionKey(n,u),h=await ja.aesGcm.encrypt(d,t);return{passwordToken:c,passwordSalts:{passwordSalt:i.a.encode(a),passwordTokenSalt:i.a.encode(o)},passwordBasedBackup:{passwordBasedEncryptionKeySalt:i.a.encode(u),passwordEncryptedSeed:i.a.encode(h)}}},yr=async e=>{const t=await ja.hkdf.importHkdfKey(e),s=ja.hkdf.generateSalt(),a=ja.hkdf.generateSalt(),r={encryptionKeySalt:i.a.encode(s),hmacKeySalt:i.a.encode(a)},n=await ja.ecdsa.generateEcdsaKeyData(t),o=await ja.ecdh.generateEcdhKeyData(t,n.ecdsaPrivateKey);delete n.ecdsaPrivateKey,delete o.ecdhPrivateKey;return{ecKeyData:{ecdsaKeyData:n,ecdhKeyData:o},keySalts:r}},br=e=>{if("object"!=typeof e)throw new hs.ProfileMustBeObject;let t=!1;for(const s in e){t=!0;const a=e[s];if("string"!=typeof a)throw new hs.ProfileValueMustBeString(s,a);if(!a)throw new hs.ProfileValueCannotBeBlank(s)}if(!t)throw new hs.ProfileCannotBeEmpty},vr=async()=>{try{const e="GetPasswordSalts";return(await sr.request(e)).data}catch(e){throw cr(e),e}},Mr=async(e,t,s)=>{const{passwordSalt:a,passwordTokenSalt:r}=t,n=await ja.scrypt.hash(e,new Uint8Array(i.a.decode(a)),s),o=await ja.hkdf.importHkdfKeyFromString(n);return{passwordHkdfKey:o,passwordToken:await ja.hkdf.getPasswordToken(o,i.a.decode(r))}},Sr=async(e,t)=>{let s;try{const a=_s.getCurrentSession();if(!a)return{};const{signedIn:r,sessionId:n,creationDate:i,expirationDate:o,rememberMe:c}=a;s=a.username;const u=_s.getSeedString(e,s);if(!r||!u||new Date>new Date(o))return{lastUsedUsername:s};let d;try{d=await Us(n,t)}catch(e){if(cr(e),hr(e),e.response&&"Session invalid"===e.response.data)return{lastUsedUsername:s};throw e}const{userId:h,authToken:l,username:f,email:m,profile:p,protectedProfile:w}=d;if(f!==s&&(_s.saveSeedString(c,e,f,u),_s.removeSeedString(e,s)),_s.signInSession(c,f,n,i,d.expirationDate),sr.connectionResolved){if(sr.session.sessionId===n)return{user:sr.buildUserResult({username:f,userId:h,authToken:sr.session.authToken,email:m,profile:p,protectedProfile:w,userData:sr.userData})};throw new hs.UserAlreadySignedIn(sr.session.username)}const g=rr(rr({},a),{},{username:f,userId:h,authToken:l});return await ur(g,u,c),{user:sr.buildUserResult({username:f,userId:h,authToken:l,email:m,profile:p,protectedProfile:w,userData:sr.userData})}}catch(e){if("Invalid seed"===e.message)return{lastUsedUsername:s};throw cr(e),e}},Ir=async(e,t)=>{const s=_s.getSeedString(e,t);if(!s)throw new hs.KeyNotFound(or);const a=i.a.decode(s);return await ja.hkdf.importHkdfKey(a)};var Pr={signUp:async e=>{try{(e=>{if(wr(e),e.profile&&br(e.profile),e.email&&"string"!=typeof e.email)throw new hs.EmailNotValid})(e);const{password:t,profile:s,passwordHashAlgo:a,rememberMe:r="session"}=e,n=e.username.toLowerCase(),o=e.email&&e.email.toLowerCase(),c=ws(),u=await ja.generateSeed(),d=fr(e.sessionLength),{sessionId:h,creationDate:l,expirationDate:f,userId:m,authToken:p}=await(async(e,t,s,a,r,n,i)=>{const{passwordToken:o,passwordSalts:c,passwordBasedBackup:u}=await gr(t,s,a),{ecKeyData:d,keySalts:h}=await yr(s);try{return await Es(e,o,d,c,h,r,n,u,i)}catch(t){hr(t),lr(t,e)}})(n,t,u,a,o,s,d),w={username:n,userId:m,sessionId:h,creationDate:l,expirationDate:f,authToken:p},g=i.a.encode(u);return _s.saveSeedString(r,c,n,g),_s.signInSession(r,n,h,l,f),await ur(w,g,r),sr.buildUserResult({username:n,userId:m,authToken:p,email:o,profile:s,userData:sr.userData})}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameAlreadyExists":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"UsernameTooLong":case"PasswordMissing":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"PasswordMustBeString":case"EmailNotValid":case"ProfileMustBeObject":case"ProfileCannotBeEmpty":case"ProfileHasTooManyKeys":case"ProfileKeyTooLong":case"ProfileValueMustBeString":case"ProfileValueCannotBeBlank":case"ProfileValueTooLong":case"RememberMeValueNotValid":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"TrialExceededLimit":case"AppIdNotSet":case"AppIdNotValid":case"DomainNotWhitelisted":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},signOut:async()=>{try{if(!sr.session.username)throw new hs.UserNotSignedIn;try{await sr.signOut()}catch(e){throw cr(e),e}}catch(e){switch(e.name){case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},signIn:async e=>{try{wr(e);const t=e.username.toLowerCase(),{password:s,passwordHashAlgo:a,rememberMe:r="session"}=e,n=ws(),o=await(async e=>{try{return await Bs(e)}catch(e){if(cr(e),dr(e),e.response&&"User not found"===e.response.data)throw new hs.UsernameOrPasswordMismatch;throw e}})(t),{passwordHkdfKey:c,passwordToken:u}=await Mr(s,o,a),d=fr(e.sessionLength),h=await(async(e,t,s)=>{try{return await Ns(e,t,s)}catch(e){if(cr(e),dr(e),hr(e),e.response&&"Invalid password"===e.response.data)throw new hs.UsernameOrPasswordMismatch;if(e.response&&"User pending deletion"===e.response.data)throw new hs.UserPendingDeletion;throw e}})(t,u,d),{userId:l,email:f,profile:m,passwordBasedBackup:p,protectedProfile:w,usedTempPassword:g,changePassword:y}=h,b=rr(rr({},h.session),{},{username:t,userId:l});let v;if(!y){const e=_s.getSeedString(n,t);let s;if(!e&&g)throw new hs.KeyNotFound(ir);g||(s=await(async(e,t)=>{const{passwordBasedEncryptionKeySalt:s,passwordEncryptedSeed:a}=t,r=await ja.aesGcm.getPasswordBasedEncryptionKey(e,i.a.decode(s)),n=await ja.aesGcm.decrypt(r,i.a.decode(a));return i.a.encode(n)})(c,p),_s.saveSeedString(r,n,t,s)),v=s||e}_s.signInSession(r,t,b.sessionId,b.creationDate,b.expirationDate);try{await ur(b,v,r,y)}catch(e){if(g&&"Invalid seed"===e.message)throw new hs.KeyNotFound(ir);throw e}return sr.buildUserResult({username:t,userId:l,authToken:b.authToken,email:f,profile:m,protectedProfile:w,usedTempPassword:g,changePassword:y,userData:sr.userData})}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameOrPasswordMismatch":case"UserPendingDeletion":case"UsernameCannotBeBlank":case"UsernameTooLong":case"UsernameMustBeString":case"PasswordMissing":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"PasswordMustBeString":case"PasswordAttemptLimitExceeded":case"RememberMeValueNotValid":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"KeyNotFound":case"AppIdNotSet":case"AppIdNotValid":case"DomainNotWhitelisted":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},init:async e=>{try{if(!window.crypto.subtle)throw new hs.WebCryptoUnavailable;if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"appId"))throw new hs.AppIdMissing;if("string"!=typeof e.appId)throw new hs.AppIdMustBeString;if(0===e.appId.length)throw new hs.AppIdCannotBeBlank;if(Ga(e,"updateUserHandler")&&"function"!=typeof e.updateUserHandler)throw new hs.UpdateUserHandlerMustBeFunction;if(Ga(e,"sessionLength")&&"number"!=typeof e.sessionLength)throw new hs.SessionLengthMustBeNumber;if(Ga(e,"allowServerSideEncryption")&&"boolean"!=typeof e.allowServerSideEncryption)throw new hs.AllowServerSideEncryptionMustBeBoolean;bs(e);return await Sr(e.appId,fr(e.sessionLength))}catch(e){switch(e.name){case"WebCryptoUnavailable":case"ParamsMustBeObject":case"AppIdMissing":case"AppIdAlreadySet":case"AppIdMustBeString":case"AppIdCannotBeBlank":case"AppIdNotValid":case"DomainNotWhitelisted":case"UpdateUserHandlerMustBeFunction":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"AllowServerSideEncryptionMustBeBoolean":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},updateUser:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if((e=>{if(!(Ga(e,"username")||Ga(e,"newPassword")||Ga(e,"email")||Ga(e,"profile")))throw new hs.ParamsMissing;const{username:t,currentPassword:s,newPassword:a,email:r,profile:n}=e;if(Ga(e,"username")&&mr(t),Ga(e,"newPassword")){if(!Ga(e,"currentPassword"))throw new hs.CurrentPasswordMissing;pr(s),pr(a)}if(r&&"string"!=typeof r)throw new hs.EmailNotValid;n&&br(n)})(e),sr.reconnecting)throw new hs.Reconnecting;if(!sr.connectionResolved)throw new hs.UserNotSignedIn;const t=sr.session.userId,s=e.newPassword&&!sr.keys.init&&sr.changePassword&&await ja.generateSeed(),a="UpdateUser",r=await(async(e,t)=>{if(e.username&&(e.username=e.username.toLowerCase()),e.newPassword){const[s,a,r]=await Promise.all([vr(),gr(e.newPassword,t||i.a.decode(sr.seedString)),t&&yr(t)]),{passwordToken:n}=await Mr(e.currentPassword,s,e.passwordHashAlgo);e.currentPasswordToken=n,delete e.currentPassword,e.passwordToken=a.passwordToken,e.passwordSalts=a.passwordSalts,e.passwordBasedBackup=a.passwordBasedBackup,delete e.newPassword,r&&(e.newKeyData=r)}return e.email?e.email=e.email.toLowerCase():Ga(e,"email")&&(e.email=!1),!e.profile&&Ga(e,"profile")&&(e.profile=!1),e})(rr({},e),s);if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.connectionResolved)throw new hs.UserNotSignedIn;if(!sr.session||t!==sr.session.userId)throw new hs.ServiceUnavailable;try{r.username&&_s.saveSeedString(sr.rememberMe,ws(),r.username,sr.seedString);const e=(await sr.request(a,r)).data.updatedUser;if(sr.handleUpdateUser(e),s&&sr.session&&t===sr.session.userId){const t=i.a.encode(s);await sr.rotateKeys(t,r.newKeyData),_s.saveSeedString(sr.rememberMe,ws(),e.username,t);const{sessionId:a,creationDate:n,expirationDate:o}=sr.session;_s.signInSession(sr.rememberMe,e.username,a,n,o)}}catch(e){lr(e,r.username)}}catch(e){switch(e.name){case"ParamsMustBeObject":case"ParamsMissing":case"UsernameAlreadyExists":case"UsernameMustBeString":case"UsernameCannotBeBlank":case"UsernameTooLong":case"CurrentPasswordMissing":case"CurrentPasswordIncorrect":case"PasswordAttemptLimitExceeded":case"PasswordMustBeString":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"EmailNotValid":case"ProfileMustBeObject":case"ProfileCannotBeEmpty":case"ProfileHasTooManyKeys":case"ProfileKeyTooLong":case"ProfileValueMustBeString":case"ProfileValueCannotBeBlank":case"ProfileValueTooLong":case"AppIdNotSet":case"AppIdNotValid":case"UserNotFound":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},deleteUser:async()=>{try{(()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init)throw new hs.UserNotSignedIn})();const e=sr.session.username;_s.removeSeedString(ws(),e),_s.removeCurrentSession();try{const e="DeleteUser";await sr.request(e)}catch(e){throw cr(e),e}sr.close()}catch(e){switch(e.name){case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},forgotPassword:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Ga(e,"deleteEndToEndEncryptedData")&&"boolean"!=typeof e.deleteEndToEndEncryptedData)throw new hs.DeleteEndToEndEncryptedDataMustBeBoolean;if(!Ga(e,"username"))throw new hs.UsernameMissing;mr(e.username);const t=e.username.toLowerCase(),s=ws(),a="".concat(Va(ys()),"/api/auth/forgot-password?appId=").concat(s,"&username=").concat(encodeURIComponent(t),"&userbaseJsVersion=").concat(ps),r=new WebSocket(a+(Ga(e,"deleteEndToEndEncryptedData")?"&deleteEndToEndEncryptedData=".concat(e.deleteEndToEndEncryptedData):""));await new Promise((e,a)=>{setTimeout(()=>a(new hs.Timeout),15e3),r.onerror=()=>a(new hs.ServiceUnavailable),r.onmessage=async n=>{try{const o=JSON.parse(n.data);switch(o.route){case"ReceiveEncryptedToken":{const e=await Ir(s,t),a=new Uint8Array(o.encryptedForgotPasswordToken.data),n=await ja.diffieHellman.importKeyFromMaster(e,i.a.decode(o.dhKeySalt)),c=await ja.diffieHellman.getSharedKeyWithServer(n);let u;try{u=i.a.encode(await ja.aesGcm.decrypt(c,a))}catch(e){throw new hs.KeyNotFound(or)}r.send(JSON.stringify({action:"ForgotPassword",params:{forgotPasswordToken:u}}));break}case"ReceiveToken":{const e=await Ir(s,t),{ecdsaKeyEncryptionKeySalt:a,encryptedEcdsaPrivateKey:n,forgotPasswordToken:c}=o,u=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(e,i.a.decode(a));let d;try{const e=await ja.aesGcm.decrypt(u,i.a.decode(n));d=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(e)}catch(e){throw new hs.KeyNotFound(or)}const h=i.a.encode(await ja.ecdsa.sign(d,i.a.decode(c)));r.send(JSON.stringify({action:"ForgotPassword",params:{signedForgotPasswordToken:h}}));break}case"SuccessfullyForgotPassword":e();break;case"Error":{const e=o.data;switch(e.name){case"UsernameTooLong":throw new hs.UsernameTooLong(e.maxLen);case"AppIdNotValid":throw new hs.AppIdNotValid;case"UserNotFound":throw new hs.UserNotFound;case"UserEmailNotFound":throw new hs.UserEmailNotFound;default:throw o.status===p?new hs.ServiceUnavailable:new hs.UnknownServiceUnavailable(e)}}case"Ping":break;default:a(new Error("Received unknown message from userbase-server: ".concat(n.data)))}}catch(n){a(n)}}}),r.close()}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameMustBeString":case"UsernameCannotBeBlank":case"UsernameTooLong":case"AppIdNotSet":case"AppIdNotValid":case"KeyNotFound":case"UserNotFound":case"UserEmailNotFound":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}},Er=s(12),Br=s.n(Er);function Nr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Ur(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Nr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const Ar={"end-to-end":!0,"server-side":!0},Tr=()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init||!Ar[sr.encryptionMode])throw new hs.UserNotSignedIn},kr=e=>{if(e.response){if("UserNotFound"===e.response.data)throw new hs.UserNotFound;if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout};class Dr{constructor(e){this.startSeqNo=e,this.txSeqNo=null,this.transactions={},this.promiseResolve=null,this.promiseReject=null,this.index=null}getStartSeqNo(){return this.startSeqNo}getIndex(){return this.index}setIndex(e){this.index=e}async getResult(e){this.txSeqNo=e;const t=new Promise((e,t)=>{this.promiseResolve=e,this.promiseReject=t,setTimeout(()=>{t(new Error("timeout"))},3e4)});return this.verifyPromise(),t}verifyPromise(){(this.txSeqNo||0==this.txSeqNo)&&this.promiseResolve&&this.promiseReject&&this.transactions[this.txSeqNo]&&("Success"==this.transactions[this.txSeqNo]?this.promiseResolve():this.promiseReject(this.transactions[this.txSeqNo]))}addTransaction(e,t){this.transactions[e.seqNo]||(this.transactions[e.seqNo]=t,this.verifyPromise())}}class Kr{constructor(e,t,s,a){this.onChange=xr(e),this.items={},this.itemsPlaintextMetadata={},this.fileIds={};this.itemsIndex=new Br.a([],(e,t)=>e.seqNo<t.seqNo||e.seqNo===t.seqNo&&e.operationIndex<t.operationIndex?-1:e.seqNo>t.seqNo||e.seqNo===t.seqNo&&e.operationIndex>t.operationIndex?1:0),this.unverifiedTransactions=[],this.lastSeqNo=0,this.init=!1,this.dbKey=null,this.receivedMessage=t,this.usernamesByUserId=new Map,this.attributionEnabled=!1,this.shareTokenId=s,this.shareTokenHkdfKey=a,this.applyTransactionsQueue=new Ja,this.bundleChunks={}}async applyTransactions(e,t,s,a){for(let s=0;s<e.length;s++){const a=e[s],r=a.seqNo;if(r!==this.lastSeqNo+1){console.warn("Client attempted to apply transaction with seq no ".concat(r," when last seq no is ").concat(this.lastSeqNo));continue}const n=await this.applyTransaction(this.dbKey,a,t);this.lastSeqNo=r;for(let t=0;t<this.unverifiedTransactions.length;t++)!this.unverifiedTransactions[t]||r<this.unverifiedTransactions[t].getStartSeqNo()||this.unverifiedTransactions[t].addTransaction(e[s],n);this.init&&"Success"===n&&this.onChange(this.getItems())}this.init||(this.init=!0,this.dbId=s,this.dbNameHash=a,this.onChange(this.getItems()),this.receivedMessage())}async applyBundle(e,t){if(0===this.lastSeqNo){for(let t=0;t<e.itemsIndex.length;t++){const s=e.itemsIndex[t],a=e.itemsIndex[t].itemId,r=e.items[t],n=e.itemsPlaintextMetadata[t];r.file&&r.file.fileEncryptionKeyString&&(r.file.fileEncryptionKey=await ja.aesGcm.getKeyFromKeyString(r.file.fileEncryptionKeyString),this.fileIds[r.file.fileId]=a),this.items[a]=r,this.itemsPlaintextMetadata[a]=n,this.itemsIndex.insert(s)}this.lastSeqNo=t}else console.warn("Client attempted to apply bundle when last seq no is ".concat(this.lastSeqNo))}async applyTransaction(e,t,s){const a=t.seqNo,r=t.command;switch(r){case"Insert":try{const s=await ja.aesGcm.decryptJson(e,t.record),r=s.id,n=s.item,i=this.attributionFromTransaction(t),o=t.writeAccess;return this.validateInsert(r),this.applyInsert(r,a,n,i,o)}catch(e){return e}case"Update":try{const a=await ja.aesGcm.decryptJson(e,t.record),r=a.id,n=a.item,i=this.attributionFromTransaction(t),o=a.__v,c=t.writeAccess;return this.validateUpdate(r,o,i,s,c,"updateItem"),this.applyUpdate(r,n,o,i,c)}catch(e){return e}case"Delete":try{const a=await ja.aesGcm.decryptJson(e,t.record),r=a.id,n=this.attributionFromTransaction(t),i=a.__v;return this.validateUpdateOrDelete(r,i,n,s,"deleteItem"),this.applyDelete(r)}catch(e){return e}case"BatchTransaction":try{const r=t.operations,n=this.attributionFromTransaction(t),i=[];for(const t of r)i.push(t.record&&ja.aesGcm.decryptJson(e,t.record));const o=await Promise.all(i);return this.validateBatchTransaction(r,o,n,s),this.applyBatchTransaction(a,r,o,n)}catch(e){return e}case"UploadFile":try{const a=await ja.aesGcm.decrypt(e,i.a.decode(t.fileEncryptionKey)),r=await ja.aesGcm.getKeyFromRawKey(a),n=await ja.aesGcm.getKeyStringFromKey(r),o=await ja.aesGcm.decryptJson(r,t.fileMetadata),c=o.itemId,u=o.__v,{fileName:d,fileSize:h,fileType:l}=o,f=t.fileId,m=this.attributionFromTransaction(t);return this.validateUploadFile(c,u,m,s,"uploadFile"),this.applyUploadFile(c,m,u,r,n,d,f,h,l)}catch(e){return e}case"Rollback":return;default:return void console.warn("Unknown command: ".concat(r))}}attributionFromTransaction(e){if(this.attributionEnabled)return{timestamp:e.timestamp,userId:e.userId}}validateInsert(e){if(this.items[e])throw new hs.ItemAlreadyExists}validateUpdate(e,t,s,a,r,n){this.validateUpdateOrDelete(e,t,s,a,n);const{createdBy:i}=this.itemsPlaintextMetadata[e];if(r||!1===r){if(!i)return;const e=i.userId,t=s.userId;if(e!==t&&t!==a)throw new hs.WriteAccessParamNotAllowed}}validateUpdateOrDelete(e,t,s,a,r){if(!this.items[e])throw new hs.ItemDoesNotExist;if(t<=this.getItemVersionNumber(e))throw new hs.ItemUpdateConflict;this.validateAccessPermissions(e,s,a,r)}validateUploadFile(e,t,s,a,r){if(!this.items[e])throw new hs.ItemDoesNotExist;if(t<=this.getFileVersionNumber(e))throw new hs.FileUploadConflict;this.validateAccessPermissions(e,s,a,r)}validateAccessPermissions(e,t,s,a){const{createdBy:r,writeAccess:n}=this.itemsPlaintextMetadata[e];if(r&&t&&n){const e=r.userId,i=t.userId;let o=!1;const{onlyCreator:c,users:u}=n;if(i===s||i===e)o=!0;else if(!c&&u)for(const{userId:e}of u)if(o=i===e,o)break;if(!o)throw new hs.TransactionUnauthorized(a)}}itemExists(e){return Ga(this.items,e)}applyInsert(e,t,s,a,r,n){const i={seqNo:t};if("number"==typeof n&&(i.operationIndex=n),this.items[e]=Ur(Ur({},i),{},{record:s,__v:0}),this.itemsPlaintextMetadata[e]={createdBy:a,writeAccess:r},this.itemsIndex.insert(Ur(Ur({},i),{},{itemId:e})),r&&r.users)for(const{userId:e,username:t}of r.users)this.usernamesByUserId.set(e,t);return"Success"}applyUpdate(e,t,s,a,r){if(this.items[e].record=t,this.items[e].__v=s,this.itemsPlaintextMetadata[e].updatedBy=a,!1===r)delete this.itemsPlaintextMetadata[e].writeAccess;else if(r&&(this.itemsPlaintextMetadata[e].writeAccess=r,r.users))for(const{userId:e,username:t}of r.users)this.usernamesByUserId.set(e,t);return"Success"}applyUploadFile(e,t,s,a,r,n,i,o,c){const u=this.items[e].file;return u&&delete this.fileIds[u.fileId],this.items[e].file={fileName:n,fileId:i,fileSize:o,fileType:c,fileEncryptionKey:a,fileEncryptionKeyString:r,__v:s},this.itemsPlaintextMetadata[e].fileUploadedBy=t,this.fileIds[i]=e,"Success"}applyDelete(e){return this.itemsIndex.remove(this.items[e]),delete this.items[e],delete this.itemsPlaintextMetadata[e],"Success"}validateBatchTransaction(e,t,s,a){const r={};for(let n=0;n<e.length;n++){const i=e[n],{command:o,writeAccess:c}=i,u=t[n].id,d=t[n].__v;if(r[u])throw new hs.OperationsConflict;switch(r[u]=!0,o){case"Insert":this.validateInsert(u);break;case"Update":this.validateUpdate(u,d,s,a,c,o);break;case"Delete":this.validateUpdateOrDelete(u,d,s,a,o)}}}applyBatchTransaction(e,t,s,a){for(let r=0;r<t.length;r++){const n=t[r],i=s[r].id,o=s[r].item,c=s[r].__v,u=n.writeAccess;switch(n.command){case"Insert":this.applyInsert(i,e,o,a,u,r);break;case"Update":this.applyUpdate(i,o,c,a,u);break;case"Delete":this.applyDelete(i,c)}}return"Success"}registerUnverifiedTransaction(){const e=new Dr(this.lastSeqNo),t=this.unverifiedTransactions.push(e);return e.setIndex(t-1),e}unregisterUnverifiedTransaction(e){delete this.unverifiedTransactions[e.getIndex()]}getItems(){const e=[];for(let t=0;t<this.itemsIndex.array.length;t++){const s=this.itemsIndex.array[t].itemId,a={itemId:s,item:this.items[s].record};if(this.items[s].file){const{fileId:e,fileName:t,fileSize:r}=this.items[s].file;a.fileId=e,a.fileName=t,a.fileSize=r}for(const e of["createdBy","updatedBy","fileUploadedBy"])if(this.itemsPlaintextMetadata[s][e]){const{timestamp:t,userId:r}=this.itemsPlaintextMetadata[s][e],n={timestamp:t},i=this.usernamesByUserId.get(r);null==i?n.userDeleted=!0:n.username=i,a[e]=n}if(this.itemsPlaintextMetadata[s].writeAccess){const{onlyCreator:e,users:t}=this.itemsPlaintextMetadata[s].writeAccess,r={};if(e&&(r.onlyCreator=e),t){r.users=[];for(const{userId:e}of t){const t=this.usernamesByUserId.get(e);t&&r.users.push({username:t})}}a.writeAccess=r}e.push(a)}return e}getItemVersionNumber(e){return this.items[e].__v}getFileVersionNumber(e){return this.items[e].file&&this.items[e].file.__v}async decryptShareTokenEncryptedDbKey(e,t){const s=await ja.aesGcm.importKeyFromMaster(this.shareTokenHkdfKey,i.a.decode(t));return await ja.aesGcm.decryptString(s,e)}}const xr=e=>t=>{try{e(t)}catch(e){console.error("There was an error in your changeHandler.\n\n",e)}},Rr=(e,t,s)=>{e.onChange=xr(t);const a=e.receivedMessage;return e.receivedMessage=()=>{a(),s()},!!e.init&&(e.onChange(e.getItems()),e.receivedMessage(),!0)},Or=e=>{const t=e.slice(0,36),s=Fs(t,!0);if(!s||36!==s.length)throw new hs.ShareTokenInvalid;return s},Cr=async(e,t,s)=>{let a,r;try{a=(e=>{const t=i.a.decode(e);return{shareTokenId:Or(t),shareTokenSeed:t.slice(36)}})(e),r=await ja.hkdf.importHkdfKey(a.shareTokenSeed)}catch(e){throw new hs.ShareTokenInvalid}const{shareTokenId:n}=a,{databaseId:o,validationMessage:c,signedValidationMessage:u}=await sr.authenticateShareToken(n,r);sr.state.shareTokenIdToDbId[n]=o,await _r(o,t,s,n,r,c,u)},_r=async(e,t,s,a,r,n,i)=>{const o=sr.state.databasesByDbId[e];if(o){if(Rr(o,t,s))return}else sr.state.databasesByDbId[e]=new Kr(t,s,a,r);const c={databaseId:e,validationMessage:n,signedValidationMessage:i};await sr.request("OpenDatabaseByDatabaseId",c)},Fr=async(e,t)=>{try{let s,a;const r=new Promise((e,t)=>{s=e,a=setTimeout(()=>t(new Error("timeout")),3e4)}),{dbNameHash:n,newDatabaseParams:i,databaseId:o,shareToken:c}=t;try{n?await(async(e,t,s,a)=>{const r=sr.state.databases[e];if(r){if(Rr(r,s,a))return}else sr.state.databases[e]=new Kr(s,a);const n={dbNameHash:e,newDatabaseParams:t};await sr.request("OpenDatabase",n)})(n,i,e,s):o?await _r(o,e,s):c&&await Cr(c,e,s),await r}catch(e){if(clearTimeout(a),e.response&&e.response.data){const t=e.response.data;if("Database already creating"===t)throw new hs.DatabaseAlreadyOpening;if("Database is owned by user"===t){if(o)throw new hs.DatabaseIdNotAllowedForOwnDatabase;if(c)throw new hs.ShareTokenNotAllowedForOwnDatabase}else if("Database key not found"===t||"Database not found"===t)throw new hs.DatabaseNotFound;switch(t.name){case"SubscriptionNotFound":throw new hs.SubscriptionNotFound;case"SubscriptionInactive":throw new hs.SubscriptionInactive(t.subscriptionStatus);case"TrialExpired":throw new hs.TrialExpired}}throw e}}catch(e){throw kr(e),e}},Lr=e=>{if("server-side"===e&&!Ms())throw new hs.ServerSideEncryptionNotEnabledInClient},jr=e=>{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Ga(e,"databaseName")){if((e=>{if("string"!=typeof e)throw new hs.DatabaseNameMustBeString;if(0===e.length)throw new hs.DatabaseNameCannotBeBlank;if(e.length>100)throw new hs.DatabaseNameTooLong(100)})(e.databaseName),Ga(e,"databaseId"))throw new hs.DatabaseIdNotAllowed;if(Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;if(!e.allowVerifiedUsersDatabase&&"__userbase_verified_users"===e.databaseName)throw new hs.DatabaseNameRestricted("__userbase_verified_users")}else if(Ga(e,"databaseId")){if((e=>{if("string"!=typeof e)throw new hs.DatabaseIdMustBeString;if(0===e.length)throw new hs.DatabaseIdCannotBeBlank;if(36!==e.length)throw new hs.DatabaseIdInvalidLength(36)})(e.databaseId),Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed}else{if(!Ga(e,"shareToken"))throw new hs.DatabaseNameMissing;if("string"!=typeof e.shareToken)throw new hs.ShareTokenInvalid}if(Ga(e,"encryptionMode")&&!Ar[e.encryptionMode])throw new hs.EncryptionModeNotValid(Ar);Tr()},qr=async e=>{try{if(jr(e),!Ga(e,"changeHandler"))throw new hs.ChangeHandlerMissing;const{databaseName:t,databaseId:s,shareToken:a,changeHandler:r,encryptionMode:n=sr.encryptionMode}=e;if("function"!=typeof r)throw new hs.ChangeHandlerMustBeFunction;if(Lr(n),t){const e="server-side"===n?t:sr.state.dbNameToHash[t]||await ja.hmac.signString(sr.keys.hmacKey,t);"end-to-end"===n&&(sr.state.dbNameToHash[t]=e);const s={dbNameHash:e,newDatabaseParams:await(async(e,t)=>{const s=Ds()(),a=await ja.aesGcm.generateKey(),r=await ja.aesGcm.getKeyStringFromKey(a),[n,i]=await Promise.all([ja.aesGcm.encryptString(sr.keys.encryptionKey,r),ja.aesGcm.encryptString(a,e)]),o={dbId:s,encryptedDbKey:n,encryptedDbName:i,attribution:!0};return"server-side"===t&&(o.plaintextDbKey=r),o.fingerprint=await ln(),o})(t,n)};await Fr(r,s)}else if(s){const e={databaseId:s};await Fr(r,e)}else{const e={shareToken:a};await Fr(r,e)}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseAlreadyOpening":case"DatabaseNameMustBeString":case"DatabaseNameMissing":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"DatabaseIdNotAllowedForOwnDatabase":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"ShareTokenNotFound":case"ShareTokenNotAllowedForOwnDatabase":case"DatabaseNotFound":case"ChangeHandlerMissing":case"ChangeHandlerMustBeFunction":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"SubscriptionNotFound":case"SubscriptionInactive":case"TrialExpired":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Vr=(e,t,s,a="end-to-end")=>{Lr(a);const r=s&&Or(i.a.decode(s)),n="server-side"===a?e:sr.state.dbNameToHash[e],o=e?sr.state.databases[n]:sr.state.databasesByDbId[t||sr.state.shareTokenIdToDbId[r]];if(!o||!o.init)throw new hs.DatabaseNotOpen;return o},Hr=async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Insert",a=await Gr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemAlreadyExists":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Gr=async(e,t)=>{if(!Ga(t,"item"))throw new hs.ItemMissing;const{item:s,itemId:a,writeAccess:r}=t;if(Ga(t,"itemId")){if("string"!=typeof a)throw new hs.ItemIdMustBeString;if(0===a.length)throw new hs.ItemIdCannotBeBlank;if(a.length>100)throw new hs.ItemIdTooLong(100)}const n=JSON.stringify(s);if(!n)throw new hs.ItemInvalid;if(Ha(n)>10240)throw new hs.ItemTooLarge(10);const i=a||Ds()(),o={id:i,item:s};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,i),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,o),writeAccess:r}},Jr=async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Update",a=await Wr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemDoesNotExist":case"ItemUpdateConflict":case"WriteAccessParamNotAllowed":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Wr=async(e,t)=>{if(!Ga(t,"item"))throw new hs.ItemMissing;if(!Ga(t,"itemId"))throw new hs.ItemIdMissing;!t.writeAccess&&Ga(t,"writeAccess")&&(t.writeAccess=!1);const{item:s,itemId:a,writeAccess:r}=t;if("string"!=typeof a)throw new hs.ItemIdMustBeString;if(0===a.length)throw new hs.ItemIdCannotBeBlank;if(a.length>100)throw new hs.ItemIdTooLong(100);if(!e.itemExists(a))throw new hs.ItemDoesNotExist;const n=JSON.stringify(s);if(!n)throw new hs.ItemInvalid;if(Ha(n)>10240)throw new hs.ItemTooLarge(10);const i={id:a,item:s,__v:e.getItemVersionNumber(a)+1};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,a),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,i),writeAccess:r}},Yr=async(e,t)=>{if(!Ga(t,"itemId"))throw new hs.ItemIdMissing;const{itemId:s}=t;if("string"!=typeof s)throw new hs.ItemIdMustBeString;if(0===s.length)throw new hs.ItemIdCannotBeBlank;if(s.length>100)throw new hs.ItemIdTooLong(100);if(!e.itemExists(s))throw new hs.ItemDoesNotExist;const a={id:s,__v:e.getItemVersionNumber(s)+1};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,s),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,a)}},zr=async(e,t,s)=>{try{const a=e.registerUnverifiedTransaction(),r=Ur(Ur({},s),{},{dbId:e.dbId,dbNameHash:e.dbNameHash}),n=(await sr.request(t,r)).data.sequenceNo;return await a.getResult(n),e.unregisterUnverifiedTransaction(a),n}catch(e){if(kr(e),e.response){if("DatabaseIsReadOnly"===e.response.data.name)throw new hs.DatabaseIsReadOnly;if("UserNotFound"===e.response.data.message)throw new hs.UserNotFound(e.response.data.username)}throw e}},Zr=async(e,t,s,a,r,n,i,o)=>{const c=await(async e=>{const t=new FileReader;return new Promise((s,a)=>{t.onload=e=>{e.target.error?a(e.target.error):s(e.target.result)},t.readAsArrayBuffer(e)})})(t),[u,d]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(r),h=await ja.aesGcm.encrypt(u,c),l={dbId:s,chunkNumber:n,fileId:a,chunk:Fs(new Uint8Array(h)),chunkEncryptionKey:Fs(new Uint8Array(d))},f=(async(e,t,s,a)=>{await e,t.bytesTransferred+=a,s&&s(Ur({},t))})(sr.request("UploadFileChunk",l),i,o,t.size);e.push(f),10===e.length&&(await Promise.all(e),e.length=0)},Xr=async(e,t,s,a)=>{try{const r="GetChunk",n={dbId:e,fileId:t,chunkNumber:s},i=(await sr.request(r,n)).data,o=new Uint8Array(new Uint16Array(Ls(i.chunk))).buffer,c=new Uint8Array(new Uint16Array(Ls(i.chunkEncryptionKey))).buffer,u=await ja.aesGcm.decrypt(a,c),d=await ja.aesGcm.getKeyFromRawKey(u);return await ja.aesGcm.decrypt(d,o)}catch(e){throw kr(e),e}},Qr=async(e,t,s)=>{const{username:a,senderUsername:r,verificationValues:n}=s,{sentSignature:o,receivedSignature:c,senderEcdsaPublicKey:u}=n,d=t[a]&&t[a].record.fingerprint,h=i.a.decode(u),l=t[r]&&t[r].record.fingerprint||await hn(h),f=await ja.ecdsa.getPublicKeyFromRawPublicKey(h),m=await rn(e,d),p=await ja.ecdsa.verifyString(f,o,m),w=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(n.recipientEcdsaPublicKey)),g=await rn(e,l),y=await ja.ecdsa.verifyString(w,c,g);return p&&y},$r=async(e,t,s,a,r)=>{const{mySentSignature:n,myReceivedSignature:o}=r,c=await rn(e,t),u=await ja.ecdsa.verifyString(a,o,c);if(!u)return u;const d=await rn(e,s),h=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(r.mySenderEcdsaPublicKey));return await ja.ecdsa.verifyString(h,n,d)&&u},en=async(e,t,s,a,r)=>{const{sentSignature:n,receivedSignature:o}=r,c=await rn(e,t),u=await ja.ecdsa.verifyString(a,n,c);if(!u)return u;const d=await rn(e,s),h=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(r.recipientEcdsaPublicKey)),l=await ja.ecdsa.verifyString(h,o,d);return u&&l},tn=async(e,t,s,a,r)=>{const n=await ja.ecdsa.getPublicKeyFromPrivateKey(sr.keys.ecdsaPrivateKey),i=await ln();for(let o=0;o<t.length;o++){const c=t[o],{username:u,isOwner:d,senderUsername:h,verificationValues:l}=c;try{const a=s[u]&&s[u].record.fingerprint,f=l.isChild,m=r===u;if(a)if(f)t[o].verified=await en(e,a,i,n,l);else if(m){const r=await $r(e,a,i,n,l);if(r&&h){const a=await Qr(e,s,c);t[o].verified=a}else t[o].verified=r}else if(d)t[o].verified=d;else{const a=await Qr(e,s,c);t[o].verified=a}}catch(e){}delete t[o].senderUsername,d||(l&&l.isChild?t[o].receivedFromUsername=a:h&&(t[o].receivedFromUsername=h)),delete t[o].verificationValues}return t},sn=async(e,t,s,a,r)=>{const{databaseId:n,databaseNameHash:o,isOwner:c,readOnly:u,resharingAllowed:d,senderUsername:h}=e;let l,f;if(e.encryptedDbKey||e.plaintextDbKey){const s=e.plaintextDbKey||await ja.aesGcm.decryptString(t,e.encryptedDbKey);if(l=await ja.aesGcm.getKeyFromKeyString(s),f=await ja.aesGcm.decryptString(l,e.databaseName),c&&"__userbase_verified_users"===f)return null}else{if(e.wrappedDbKey)return null;{let a;try{const{ephemeralPublicKey:t,signedEphemeralPublicKey:r,sharedEncryptedDbKey:n}=e;a=i.a.decode(e.senderEcdsaPublicKey);const o=await ja.ecdsa.getPublicKeyFromRawPublicKey(a);if(!await ja.ecdsa.verify(o,i.a.decode(r),i.a.decode(t)))throw new hs.ServiceUnavailable;const c=await ja.ecdh.getPublicKeyFromRawPublicKey(i.a.decode(t)),u=await ja.ecdh.computeSharedKeyEncryptionKey(c,s),d=await ja.aesGcm.decryptString(u,n);l=await ja.aesGcm.getKeyFromKeyString(d),f=await ja.aesGcm.decryptString(l,e.databaseName)}catch(e){return null}const r=await hn(a),n=await nn(l,r),c=await ja.aesGcm.getKeyStringFromKey(l),u="SaveDatabase",d={databaseNameHash:o,encryptedDbKey:await ja.aesGcm.encryptString(t,c),receivedSignature:n};sr.request(u,d)}}const m={databaseName:f,databaseId:n,isOwner:c,readOnly:u,resharingAllowed:d,encryptionMode:e.plaintextDbKey?"server-side":"end-to-end"},p=await(async(e,t,s,a,r,n)=>{const i=[],o={databaseId:e,databaseNameHash:t};let c=await sr.request("GetDatabaseUsers",o);for(i.push(...await tn(s,c.data.users,a,r,n));c.data.nextPageTokenLessThanUserId||c.data.nextPageTokenMoreThanUserId;)o.nextPageTokenLessThanUserId=c.data.nextPageTokenLessThanUserId,o.nextPageTokenMoreThanUserId=c.data.nextPageTokenMoreThanUserId,c=await sr.request("GetDatabaseUsers",o),i.push(...await tn(s,c.data.users,a,r,n));return i})(n,o,l,a,r,h);return c||(e=>{for(let t=0;t<e.length;t++){if(e[t].isOwner)return!0}return!1})(p)?(m.users=p,!c&&h&&(m.receivedFromUsername=h),m):null},an=async(e,t,s="end-to-end")=>{let a;Lr(s);try{a=Vr(e,t,null,s)}catch(r){const n="GetDatabases",i=e?{dbNameHash:"server-side"===s?e:await ja.hmac.signString(sr.keys.hmacKey,e)}:{databaseId:t},o=(await sr.request(n,i)).data.databases;if(!o||!o.length)throw new hs.DatabaseNotFound;a=o[0],a.dbNameHash=a.databaseNameHash,a.dbId=a.databaseId}return a},rn=async(e,t)=>{const s=await ja.aesGcm.getRawKeyFromKey(e),a=await ja.sha256.hash(s),r=await ja.hmac.importKeyFromRawBits(a);return await ja.hmac.signString(r,t)},nn=async(e,t)=>{const s=await rn(e,t);return await ja.ecdsa.signString(sr.keys.ecdsaPrivateKey,s)},on=async e=>{let t;return e.dbKey?t=await ja.aesGcm.getKeyStringFromKey(e.dbKey):(t=e.plaintextDbKey||await ja.aesGcm.decryptString(sr.keys.encryptionKey,e.encryptedDbKey),e.dbKey=await ja.aesGcm.getKeyFromKeyString(t)),t},cn=async(e,t,s,a,r)=>{const{databaseName:n,databaseId:o}=e,c=e.username.toLowerCase();try{const[e,u,d]=await Promise.all([Ts(c),a&&fn(),an(n,o,r)]);if(!e.ecdhPublicKey||!e.ecdsaPublicKey)throw new hs.UserUnableToReceiveDatabase;const h=i.a.decode(e.ecdsaPublicKey),l=await hn(h);a&&await(async(e,t,s)=>{let a,r;const n=Object.keys(s);for(let i=0;i<n.length;i++){const o=n[i],c=s[o].record.fingerprint;if(e===o&&t===c){a=c;break}c===t&&(r=!0)}if(!a&&r)throw new hs.UserMustBeReverified;if(!a)throw new hs.UserNotVerified})(c,l,u);const f=await ja.ecdsa.getPublicKeyFromRawPublicKey(h),{signedEcdhPublicKey:m,ecdhPublicKey:p}=e;if(!await ja.ecdsa.verify(f,i.a.decode(m),i.a.decode(p)))throw new hs.ServiceUnavailable;const w=await ja.ecdh.getPublicKeyFromRawPublicKey(i.a.decode(e.ecdhPublicKey)),g=await ja.ecdh.generateKeyPair(),y=await ja.ecdh.getRawPublicKeyFromPublicKey(g.publicKey),b=await ja.ecdsa.sign(sr.keys.ecdsaPrivateKey,y),v=await ja.ecdh.computeSharedKeyEncryptionKey(w,g.privateKey),M=await on(d),S=await ja.aesGcm.encryptString(v,M),I="ShareDatabase",P={databaseId:d.dbId,databaseNameHash:d.dbNameHash,username:c,readOnly:t,resharingAllowed:s,sharedEncryptedDbKey:S,ephemeralPublicKey:i.a.encode(y),signedEphemeralPublicKey:i.a.encode(b),sentSignature:await nn(d.dbKey,l),recipientEcdsaPublicKey:e.ecdsaPublicKey};await sr.request(I,P)}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"SharingWithSelfNotAllowed":throw new hs.SharingWithSelfNotAllowed;case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"ResharingNotAllowed":throw new hs.ResharingNotAllowed("Must have permission to reshare the database with another user");case"ResharingWithWriteAccessNotAllowed":throw new hs.ResharingWithWriteAccessNotAllowed;case"UserNotFound":throw new hs.UserNotFound;case"DatabaseAlreadyShared":return}throw e}},un=e=>{if("string"!=typeof e)throw new hs.UsernameMustBeString;if(0===e.length)throw new hs.UsernameCannotBeBlank},dn=e=>{if(Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;if(Ga(e,"username")&&un(e.username),Ga(e,"readOnly")&&"boolean"!=typeof e.readOnly)throw new hs.ReadOnlyMustBeBoolean;if(Ga(e,"resharingAllowed")&&"boolean"!=typeof e.resharingAllowed)throw new hs.ResharingAllowedMustBeBoolean;if(Ga(e,"requireVerified")&&"boolean"!=typeof e.requireVerified)throw new hs.RequireVerifiedMustBeBoolean},hn=async e=>{const t=await ja.sha256.hash(e);return i.a.encode(t)},ln=async()=>{const e=await ja.ecdsa.getPublicKeyFromPrivateKey(sr.keys.ecdsaPrivateKey),t=await ja.ecdsa.getRawPublicKeyFromPublicKey(e);return await hn(t)},fn=async()=>{await qr({databaseName:"__userbase_verified_users",changeHandler:()=>{},allowVerifiedUsersDatabase:!0,encryptionMode:"end-to-end"});const e=sr.state.dbNameToHash.__userbase_verified_users;return sr.state.databases[e].items};var mn={openDatabase:qr,getDatabases:async e=>{try{void 0!==e&&jr(e),Tr();const{encryptionKey:t,ecdhPrivateKey:s}=sr.keys,a=sr.session.username;if(e&&Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;const r=e&&e.encryptionMode||sr.encryptionMode;Lr(r);try{const n=[],i="GetDatabases",o=e&&{databaseId:e.databaseId,dbNameHash:"server-side"===r?e.databaseName:e.databaseName&&await ja.hmac.signString(sr.keys.hmacKey,e.databaseName)};let[c,u]=await Promise.all([sr.request(i,o),fn()]),d=await Promise.all(c.data.databases.map(e=>sn(e,t,s,u,a)));for(n.push(...d);c.data.nextPageToken;){const e={nextPageToken:c.data.nextPageToken};c=await sr.request(i,e),d=await Promise.all(c.data.databases.map(e=>sn(e,t,s,u,a))),n.push(...d)}return{databases:n.filter(e=>null!==e)}}catch(e){throw kr(e),e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},insertItem:Hr,updateItem:Jr,deleteItem:async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Delete",a=await Yr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemDoesNotExist":case"ItemUpdateConflict":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},putTransaction:async e=>{try{if(jr(e),!Ga(e,"operations"))throw new hs.OperationsMissing;const{databaseName:t,databaseId:s,shareToken:a,operations:r,encryptionMode:n=sr.encryptionMode}=e;if(!Array.isArray(r))throw new hs.OperationsMustBeArray;const i=Vr(t,s,a,n),o="BatchTransaction",c=await Promise.all(r.map(e=>{const t=e.command;switch(t){case"Insert":return Gr(i,e);case"Update":return Wr(i,e);case"Delete":return Yr(i,e);default:throw new hs.CommandNotRecognized(t)}})),u=await Promise.all(c),d={operations:r.map((e,t)=>Ur({command:e.command},u[t]))};try{await zr(i,o,d)}catch(e){if(e.response&&"OperationsExceedLimit"===e.response.data.error)throw new hs.OperationsExceedLimit(e.response.data.limit);throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"OperationsMissing":case"OperationsMustBeArray":case"OperationsConflict":case"OperationsExceedLimit":case"CommandNotRecognized":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemAlreadyExists":case"ItemDoesNotExist":case"ItemUpdateConflict":case"WriteAccessParamNotAllowed":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},uploadFile:async e=>{try{(e=>{if(jr(e),Ga(e,"progressHandler")&&"function"!=typeof e.progressHandler)throw new hs.ProgressHandlerMustBeFunction})(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),{dbId:s}=t;try{const{itemKey:a,fileMetadata:r}=await(async(e,t)=>{if(!Ga(e,"itemId"))throw new hs.ItemIdMissing;if(!Ga(e,"file"))throw new hs.FileMissing;const{itemId:s,file:a}=e;if("string"!=typeof s)throw new hs.ItemIdMustBeString;if(0===s.length)throw new hs.ItemIdCannotBeBlank;if(s.length>100)throw new hs.ItemIdTooLong(100);if(!t.itemExists(s))throw new hs.ItemDoesNotExist;if(!(a instanceof File))throw new hs.FileMustBeFile;if(0===a.size)throw new hs.FileCannotBeEmpty;const r=await ja.hmac.signString(sr.keys.hmacKey,s),n=t.getFileVersionNumber(s);return{itemKey:r,fileMetadata:{itemId:s,__v:void 0===n?0:n+1,fileName:a.name,fileSize:a.size,fileType:a.type}}})(e,t),[n,o]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(t.dbKey),c=await ja.aesGcm.encryptJson(n,r),{data:{fileId:u}}=await sr.request("GenerateFileId",{dbId:t.dbId}),d=e.file;let h=0,l=0,f=[];const m={bytesTransferred:0};for(;h<d.size;){const t=d.slice(h,h+524288);await Zr(f,t,s,u,n,l,m,e.progressHandler),l+=1,h+=524288}await Promise.all(f),await(async(e,t,s,a,r)=>{const n={dbId:e.dbId,fileId:t,itemKey:s,fileMetadata:a,fileEncryptionKey:i.a.encode(r)};await zr(e,"CompleteFileUpload",n)})(t,u,a,c,o)}catch(e){if(kr(e),e.response&&"DatabaseIsReadOnly"===e.response.data)throw new hs.DatabaseIsReadOnly;throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemDoesNotExist":case"TransactionUnauthorized":case"FileMustBeFile":case"FileCannotBeEmpty":case"FileMissing":case"FileUploadConflict":case"ProgressHandlerMustBeFunction":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},getFile:async e=>{try{(e=>{if(jr(e),!Ga(e,"fileId"))throw new hs.FileIdMissing;const{fileId:t,range:s}=e;if("string"!=typeof t)throw new hs.FileIdMustBeString;if(0===t.length)throw new hs.FileIdCannotBeBlank;if(t.length>100)throw new hs.FileIdTooLong(100);if(Ga(e,"range")){if("object"!=typeof s)throw new hs.RangeMustBeObject;if(!Ga(s,"start"))throw new hs.RangeMissingStart;if(!Ga(s,"end"))throw new hs.RangeMissingEnd;const{start:e,end:t}=s;if("number"!=typeof e)throw new hs.RangeStartMustBeNumber;if("number"!=typeof t)throw new hs.RangeEndMustBeNumber;if(e<0)throw new hs.RangeStartMustBeGreaterThanZero;if(t<=e)throw new hs.RangeEndMustBeGreaterThanRangeStart}})(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),{dbId:s}=t,{fileId:a,range:r}=e,n=t.fileIds[a],i=t.items[n];if(!i||!i.file)throw new hs.FileNotFound;const{file:{fileName:o,fileSize:c,fileType:u,fileEncryptionKey:d}}=i;if(r&&r.end>c)throw new hs.RangeEndMustBeLessThanFileSize;const h=r?await(async(e,t,s,a)=>{const{start:r,end:n}=a,i=[],o=Math.floor(r/524288),c=Math.floor(n/524288)-(n%524288==0?1:0);let u=o;for(;u<=c;){let a=await Xr(e,t,u,s);u===o&&u===c&&n%524288?a=a.slice(r%524288,n%524288):u===o?a=a.slice(r%524288):u===c&&n%524288&&(a=a.slice(0,n%524288)),i.push(a),u+=1}return i})(s,a,d,r):await(async(e,t,s,a)=>{const r=[];let n=0;const i=a<524288?0:Math.floor(a/524288)-(a%524288==0?1:0);for(;n<=i;){const a=await Xr(e,t,n,s);r.push(a),n+=1}return r})(s,a,d,c);return{file:new File(h,o,{type:u})}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"FileIdMissing":case"FileIdMustBeString":case"FileIdCannotBeBlank":case"FileIdTooLong":case"FileNotFound":case"RangeMustBeObject":case"RangeMissingStart":case"RangeMissingEnd":case"RangeStartMustBeNumber":case"RangeEndMustBeNumber":case"RangeStartMustBeGreaterThanZero":case"RangeEndMustBeGreaterThanRangeStart":case"RangeEndMustBeLessThanFileSize":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},shareDatabase:async e=>{try{jr(e),dn(e);const t=!Ga(e,"readOnly")||e.readOnly,s=!!Ga(e,"resharingAllowed")&&e.resharingAllowed,a=!Ga(e,"requireVerified")||e.requireVerified,r=e.encryptionMode||sr.encryptionMode;Lr(r);let n={};return Ga(e,"username")?await cn(e,t,s,a,r):n.shareToken=await(async(e,t,s)=>{try{const{databaseName:a,databaseId:r}=e;if(Ga(e,"requireVerified"))throw new hs.RequireVerifiedParamNotNecessary;if(Ga(e,"resharingAllowed"))throw new hs.ResharingAllowedParamNotAllowed("when retrieving a share token");const n=ja.generateSeed(),o=await ja.hkdf.importHkdfKey(n),c=ja.hkdf.generateSalt(),u=await ja.aesGcm.importKeyFromMaster(o,c),d=await an(a,r,s),h=await on(d),l=await ja.aesGcm.encryptString(u,h),{ecdsaPublicKey:f,encryptedEcdsaPrivateKey:m,ecdsaKeyEncryptionKeySalt:p}=await ja.ecdsa.generateEcdsaKeyData(o),w="ShareDatabaseToken",g={databaseId:d.dbId,databaseNameHash:d.dbNameHash,readOnly:t,keyData:{shareTokenEncryptedDbKey:l,shareTokenEncryptionKeySalt:i.a.encode(c),shareTokenPublicKey:f,shareTokenEncryptedEcdsaPrivateKey:m,shareTokenEcdsaKeyEncryptionKeySalt:p}},y=await sr.request(w,g),{shareTokenId:b}=y.data,v=Ls(b,!0);return i.a.encode(js(v,n))}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"ResharingNotAllowed":throw new hs.ResharingNotAllowed("Only the owner can generate a share token")}throw e}})(e,t,r),n}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"DatabaseNotFound":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"ReadOnlyMustBeBoolean":case"ResharingAllowedMustBeBoolean":case"ResharingNotAllowed":case"ResharingWithWriteAccessNotAllowed":case"ResharingAllowedParamNotAllowed":case"RequireVerifiedMustBeBoolean":case"RequireVerifiedParamNotNecessary":case"SharingWithSelfNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"UserUnableToReceiveDatabase":case"UserNotFound":case"UserNotVerified":case"UserMustBeReverified":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},modifyDatabasePermissions:async e=>{try{if(jr(e),dn(e),!Ga(e,"username"))throw new hs.UsernameMissing;if(Ga(e,"revoke")){if("boolean"!=typeof e.revoke)throw new hs.RevokeMustBeBoolean;if(e.revoke){if(Ga(e,"readOnly"))throw new hs.ReadOnlyParamNotAllowed;if(Ga(e,"resharingAllowed"))throw new hs.ResharingAllowedParamNotAllowed("when revoking access to a database")}}else if(!Ga(e,"readOnly")&&!Ga(e,"resharingAllowed"))throw new hs.ParamsMissing;const{databaseName:t,databaseId:s,readOnly:a,resharingAllowed:r,revoke:n,encryptionMode:i=sr.encryptionMode}=e,o=e.username.toLowerCase();try{const e=await an(t,s,i),c="ModifyDatabasePermissions",u={databaseId:e.dbId,databaseNameHash:e.dbNameHash,username:o,readOnly:a,resharingAllowed:r,revoke:n};await sr.request(c,u)}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"SharingWithSelfNotAllowed":throw new hs.ModifyingOwnPermissionsNotAllowed;case"ModifyingOwnerPermissionsNotAllowed":throw new hs.ModifyingOwnerPermissionsNotAllowed;case"ResharingNotAllowed":throw new hs.ModifyingPermissionsNotAllowed;case"ResharingWithWriteAccessNotAllowed":throw new hs.GrantingWriteAccessNotAllowed;case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"UserNotFound":throw new hs.UserNotFound}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"ParamsMissing":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"DatabaseNotFound":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UsernameMissing":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"ReadOnlyMustBeBoolean":case"ReadOnlyParamNotAllowed":case"ResharingAllowedMustBeBoolean":case"ResharingAllowedParamNotAllowed":case"RevokeMustBeBoolean":case"ModifyingOwnPermissionsNotAllowed":case"ModifyingOwnerPermissionsNotAllowed":case"ModifyingPermissionsNotAllowed":case"GrantingWriteAccessNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},getVerificationMessage:async()=>{try{Tr();const e=sr.session.username,t=await ln();return{verificationMessage:((e,t)=>btoa(JSON.stringify({username:e,fingerprint:t})))(e,t)}}catch(e){switch(e.name){case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},verifyUser:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Tr(),!Ga(e,"verificationMessage"))throw new hs.VerificationMessageMissing;const{verificationMessage:t}=e;if("string"!=typeof t)throw new hs.VerificationMessageMustBeString;if(0===t.length)throw new hs.VerificationMessageCannotBeBlank;const{username:s,fingerprint:a}=(e=>{try{const{username:t,fingerprint:s}=JSON.parse(atob(e));if(un(t),!s)throw new hs.VerificationMessageInvalid;return{username:t,fingerprint:s}}catch(e){throw new hs.VerificationMessageInvalid}})(t);if(s===sr.session.username||a===await ln())throw new hs.VerifyingSelfNotAllowed;await fn();const r="__userbase_verified_users",n=!0,i=s,o={fingerprint:a};try{await Hr({databaseName:r,itemId:i,item:o,allowVerifiedUsersDatabase:n})}catch(e){if("ItemAlreadyExists"!==e.name)throw e;await Jr({databaseName:r,itemId:i,item:o,allowVerifiedUsersDatabase:n})}}catch(e){switch(e.name){case"ParamsMustBeObject":case"VerificationMessageMissing":case"VerificationMessageMustBeString":case"VerificationMessageCannotBeBlank":case"VerificationMessageInvalid":case"VerifyingSelfNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}};const pn=()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init)throw new hs.UserNotSignedIn},wn=e=>{if(e.response){if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout},gn=e=>{pn();const t=sr.userData.stripeData;if(!t.stripeAccountId)throw new hs.StripeAccountNotConnected;if("disabled"===t.paymentsMode)throw new hs.PaymentsDisabled;if(!Ga(window,"Stripe"))throw new hs.StripeJsLibraryMissing;if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"successUrl"))throw new hs.SuccessUrlMissing;if("string"!=typeof e.successUrl)throw new hs.SuccessUrlMustBeString;const s=qa(e.successUrl);if("http"!==s&&"https"!==s){const e=!0;throw new hs.SuccessUrlInvalid(e)}if(!Ga(e,"cancelUrl"))throw new hs.CancelUrlMissing;if("string"!=typeof e.cancelUrl)throw new hs.CancelUrlMustBeString;const a=qa(e.cancelUrl);if("http"!==a&&"https"!==a){const e=!0;throw new hs.CancelUrlInvalid(e)}},yn=()=>{pn();const e=sr.userData.stripeData;if(!e.stripeAccountId)throw new hs.StripeAccountNotConnected;if("disabled"===e.paymentsMode)throw new hs.PaymentsDisabled;if("canceled"===e.subscriptionStatus)throw new hs.SubscriptionAlreadyCanceled};var bn={purchaseSubscription:async e=>{try{const t=sr.userData.stripeData;if(!t.cancelSubscriptionAt&&t.subscriptionStatus&&"canceled"!==t.subscriptionStatus)throw new hs.SubscriptionPlanAlreadyPurchased;gn(e);try{const s="PurchaseSubscription",a=(await sr.request(s,e)).data,r=vs("prod"===t.paymentsMode),n=await window.Stripe(r,{stripeAccount:t.stripeAccountId}).redirectToCheckout({sessionId:a});if(n.error)throw n.error}catch(e){if(wn(e),e.response)switch(e.response.data){case"PriceIdOrPlanIdAllowed":throw new hs.PriceIdOrPlanIdAllowed;case"PriceIdOrPlanIdMissing":throw new hs.PriceIdOrPlanIdMissing;case"SubscriptionPlanAlreadyPurchased":throw new hs.SubscriptionPlanAlreadyPurchased;case"SuccessUrlInvalid":throw new hs.SuccessUrlInvalid;case"CancelUrlInvalid":throw new hs.CancelUrlInvalid;default:if(e.response.data&&"StripeError"===e.response.data.name)throw new hs.StripeError(e.response.data)}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"SuccessUrlMissing":case"SuccessUrlMustBeString":case"SuccessUrlInvalid":case"CancelUrlMissing":case"CancelUrlMustBeString":case"CancelUrlInvalid":case"StripeError":case"StripeJsLibraryMissing":case"PriceIdOrPlanIdAllowed":case"PriceIdOrPlanIdMissing":case"SubscriptionPlanAlreadyPurchased":case"StripeAccountNotConnected":case"PaymentsDisabled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},cancelSubscription:async()=>{try{yn();try{const e="CancelSubscription",t=(await sr.request(e)).data;return sr.userData.stripeData.cancelSubscriptionAt=t,{cancelSubscriptionAt:t}}catch(e){if(wn(e),e.response&&"SubscriptionNotFound"===e.response.data)throw new hs.SubscriptionNotFound;throw e}}catch(e){switch(e.name){case"SubscriptionNotFound":case"StripeAccountNotConnected":case"PaymentsDisabled":case"SubscriptionAlreadyCanceled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},resumeSubscription:async()=>{try{yn();try{const e="ResumeSubscription";await sr.request(e),delete sr.userData.stripeData.cancelSubscriptionAt}catch(e){if(wn(e),e.response&&"SubscriptionNotFound"===e.response.data)throw new hs.SubscriptionNotFound;throw e}}catch(e){switch(e.name){case"SubscriptionNotFound":case"StripeAccountNotConnected":case"PaymentsDisabled":case"SubscriptionAlreadyCanceled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},updatePaymentMethod:async e=>{try{gn(e);const t=sr.userData.stripeData;if(!t.subscriptionStatus)throw new hs.SubscriptionNotPurchased;try{const s="UpdatePaymentMethod",a=(await sr.request(s,e)).data,r=vs("prod"===t.paymentsMode),n=await window.Stripe(r,{stripeAccount:t.stripeAccountId}).redirectToCheckout({sessionId:a});if(n.error)throw n.error}catch(e){if(wn(e),e.response){if("SuccessUrlInvalid"===e.response.data)throw new hs.SuccessUrlInvalid;if("CancelUrlInvalid"===e.response.data)throw new hs.CancelUrlInvalid}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"SuccessUrlMissing":case"SuccessUrlMustBeString":case"SuccessUrlInvalid":case"CancelUrlMissing":case"CancelUrlMustBeString":case"CancelUrlInvalid":case"StripeJsLibraryMissing":case"SubscriptionNotPurchased":case"StripeAccountNotConnected":case"PaymentsDisabled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}};t.default={init:Pr.init,signUp:Pr.signUp,signIn:Pr.signIn,signOut:Pr.signOut,updateUser:Pr.updateUser,deleteUser:Pr.deleteUser,forgotPassword:Pr.forgotPassword,openDatabase:mn.openDatabase,insertItem:mn.insertItem,updateItem:mn.updateItem,deleteItem:mn.deleteItem,putTransaction:mn.putTransaction,uploadFile:mn.uploadFile,getFile:mn.getFile,getDatabases:mn.getDatabases,shareDatabase:mn.shareDatabase,modifyDatabasePermissions:mn.modifyDatabasePermissions,getVerificationMessage:mn.getVerificationMessage,verifyUser:mn.verifyUser,purchaseSubscription:bn.purchaseSubscription,cancelSubscription:bn.cancelSubscription,resumeSubscription:bn.resumeSubscription,updatePaymentMethod:bn.updatePaymentMethod}}]).default;
//# sourceMappingURL=userbase.js.map
var userbase=function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=27)}([function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Uint8Array(256),a=0;a<e.length;a++)s[e.charCodeAt(a)]=a;t.encode=function(t){var s,a=new Uint8Array(t),r=a.length,n="";for(s=0;s<r;s+=3)n+=e[a[s]>>2],n+=e[(3&a[s])<<4|a[s+1]>>4],n+=e[(15&a[s+1])<<2|a[s+2]>>6],n+=e[63&a[s+2]];return r%3==2?n=n.substring(0,n.length-1)+"=":r%3==1&&(n=n.substring(0,n.length-2)+"=="),n},t.decode=function(e){var t,a,r,n,i,o=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var d=new ArrayBuffer(o),h=new Uint8Array(d);for(t=0;t<c;t+=4)a=s[e.charCodeAt(t)],r=s[e.charCodeAt(t+1)],n=s[e.charCodeAt(t+2)],i=s[e.charCodeAt(t+3)],h[u++]=a<<2|r>>4,h[u++]=(15&r)<<4|n>>2,h[u++]=(3&n)<<6|63&i;return d}}()},function(e,t){e.exports=function(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},function(e,t,s){var a=s(13),r=s(14);e.exports=function(e,t,s){var n=t&&s||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||r(i)}},function(e,t){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var a=s(15),r=s(16),n=s(17);function i(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,s){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,s);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,s)}function u(e,t,s,a){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,s,a){if(t.byteLength,s<0||t.byteLength<s)throw new RangeError("'offset' is out of bounds");if(t.byteLength<s+(a||0))throw new RangeError("'length' is out of bounds");t=void 0===s&&void 0===a?new Uint8Array(t):void 0===a?new Uint8Array(t,s):new Uint8Array(t,s,a);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=l(e,t);return e}(e,t,s,a):"string"==typeof t?function(e,t,s){"string"==typeof s&&""!==s||(s="utf8");if(!c.isEncoding(s))throw new TypeError('"encoding" must be a valid string encoding');var a=0|m(t,s),r=(e=o(e,a)).write(t,s);r!==a&&(e=e.slice(0,r));return e}(e,t,s):function(e,t){if(c.isBuffer(t)){var s=0|f(t.length);return 0===(e=o(e,s)).length||t.copy(e,0,0,s),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(a=t.length)!=a?o(e,0):l(e,t);if("Buffer"===t.type&&n(t.data))return l(e,t.data)}var a;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(d(t),e=o(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var s=0;s<t;++s)e[s]=0;return e}function l(e,t){var s=t.length<0?0:0|f(t.length);e=o(e,s);for(var a=0;a<s;a+=1)e[a]=255&t[a];return e}function f(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function m(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var s=e.length;if(0===s)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":case void 0:return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return j(e).length;default:if(a)return L(e).length;t=(""+t).toLowerCase(),a=!0}}function p(e,t,s){var a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,s);case"utf8":case"utf-8":return B(this,t,s);case"ascii":return N(this,t,s);case"latin1":case"binary":return U(this,t,s);case"base64":return E(this,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,s);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function w(e,t,s){var a=e[t];e[t]=e[s],e[s]=a}function g(e,t,s,a,r){if(0===e.length)return-1;if("string"==typeof s?(a=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,isNaN(s)&&(s=r?0:e.length-1),s<0&&(s=e.length+s),s>=e.length){if(r)return-1;s=e.length-1}else if(s<0){if(!r)return-1;s=0}if("string"==typeof t&&(t=c.from(t,a)),c.isBuffer(t))return 0===t.length?-1:y(e,t,s,a,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,s):Uint8Array.prototype.lastIndexOf.call(e,t,s):y(e,[t],s,a,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,s,a,r){var n,i=1,o=e.length,c=t.length;if(void 0!==a&&("ucs2"===(a=String(a).toLowerCase())||"ucs-2"===a||"utf16le"===a||"utf-16le"===a)){if(e.length<2||t.length<2)return-1;i=2,o/=2,c/=2,s/=2}function u(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(r){var d=-1;for(n=s;n<o;n++)if(u(e,n)===u(t,-1===d?0:n-d)){if(-1===d&&(d=n),n-d+1===c)return d*i}else-1!==d&&(n-=n-d),d=-1}else for(s+c>o&&(s=o-c),n=s;n>=0;n--){for(var h=!0,l=0;l<c;l++)if(u(e,n+l)!==u(t,l)){h=!1;break}if(h)return n}return-1}function b(e,t,s,a){s=Number(s)||0;var r=e.length-s;a?(a=Number(a))>r&&(a=r):a=r;var n=t.length;if(n%2!=0)throw new TypeError("Invalid hex string");a>n/2&&(a=n/2);for(var i=0;i<a;++i){var o=parseInt(t.substr(2*i,2),16);if(isNaN(o))return i;e[s+i]=o}return i}function v(e,t,s,a){return q(L(t,e.length-s),e,s,a)}function M(e,t,s,a){return q(function(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}(t),e,s,a)}function S(e,t,s,a){return M(e,t,s,a)}function I(e,t,s,a){return q(j(t),e,s,a)}function P(e,t,s,a){return q(function(e,t){for(var s,a,r,n=[],i=0;i<e.length&&!((t-=2)<0);++i)s=e.charCodeAt(i),a=s>>8,r=s%256,n.push(r),n.push(a);return n}(t,e.length-s),e,s,a)}function E(e,t,s){return 0===t&&s===e.length?a.fromByteArray(e):a.fromByteArray(e.slice(t,s))}function B(e,t,s){s=Math.min(e.length,s);for(var a=[],r=t;r<s;){var n,i,o,c,u=e[r],d=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h<=s)switch(h){case 1:u<128&&(d=u);break;case 2:128==(192&(n=e[r+1]))&&(c=(31&u)<<6|63&n)>127&&(d=c);break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(c=(15&u)<<12|(63&n)<<6|63&i)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:n=e[r+1],i=e[r+2],o=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&o)&&(c=(15&u)<<18|(63&n)<<12|(63&i)<<6|63&o)>65535&&c<1114112&&(d=c)}null===d?(d=65533,h=1):d>65535&&(d-=65536,a.push(d>>>10&1023|55296),d=56320|1023&d),a.push(d),r+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var s="",a=0;for(;a<t;)s+=String.fromCharCode.apply(String,e.slice(a,a+=4096));return s}(a)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=i(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,s){return u(null,e,t,s)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,s){return function(e,t,s,a){return d(t),t<=0?o(e,t):void 0!==s?"string"==typeof a?o(e,t).fill(s,a):o(e,t).fill(s):o(e,t)}(null,e,t,s)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var s=e.length,a=t.length,r=0,n=Math.min(s,a);r<n;++r)if(e[r]!==t[r]){s=e[r],a=t[r];break}return s<a?-1:a<s?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!n(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var s;if(void 0===t)for(t=0,s=0;s<e.length;++s)t+=e[s].length;var a=c.allocUnsafe(t),r=0;for(s=0;s<e.length;++s){var i=e[s];if(!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(a,r),r+=i.length}return a},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)w(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)w(this,t,t+3),w(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)w(this,t,t+7),w(this,t+1,t+6),w(this,t+2,t+5),w(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?B(this,0,e):p.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",s=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,s,a,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===a&&(a=0),void 0===r&&(r=this.length),t<0||s>e.length||a<0||r>this.length)throw new RangeError("out of range index");if(a>=r&&t>=s)return 0;if(a>=r)return-1;if(t>=s)return 1;if(this===e)return 0;for(var n=(r>>>=0)-(a>>>=0),i=(s>>>=0)-(t>>>=0),o=Math.min(n,i),u=this.slice(a,r),d=e.slice(t,s),h=0;h<o;++h)if(u[h]!==d[h]){n=u[h],i=d[h];break}return n<i?-1:i<n?1:0},c.prototype.includes=function(e,t,s){return-1!==this.indexOf(e,t,s)},c.prototype.indexOf=function(e,t,s){return g(this,e,t,s,!0)},c.prototype.lastIndexOf=function(e,t,s){return g(this,e,t,s,!1)},c.prototype.write=function(e,t,s,a){if(void 0===t)a="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)a=t,s=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(s)?(s|=0,void 0===a&&(a="utf8")):(a=s,s=void 0)}var r=this.length-t;if((void 0===s||s>r)&&(s=r),e.length>0&&(s<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");a||(a="utf8");for(var n=!1;;)switch(a){case"hex":return b(this,e,t,s);case"utf8":case"utf-8":return v(this,e,t,s);case"ascii":return M(this,e,t,s);case"latin1":case"binary":return S(this,e,t,s);case"base64":return I(this,e,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,s);default:if(n)throw new TypeError("Unknown encoding: "+a);a=(""+a).toLowerCase(),n=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(e,t,s){var a="";s=Math.min(e.length,s);for(var r=t;r<s;++r)a+=String.fromCharCode(127&e[r]);return a}function U(e,t,s){var a="";s=Math.min(e.length,s);for(var r=t;r<s;++r)a+=String.fromCharCode(e[r]);return a}function A(e,t,s){var a=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>a)&&(s=a);for(var r="",n=t;n<s;++n)r+=F(e[n]);return r}function T(e,t,s){for(var a=e.slice(t,s),r="",n=0;n<a.length;n+=2)r+=String.fromCharCode(a[n]+256*a[n+1]);return r}function k(e,t,s){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>s)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,s,a,r,n){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<n)throw new RangeError('"value" argument is out of bounds');if(s+a>e.length)throw new RangeError("Index out of range")}function K(e,t,s,a){t<0&&(t=65535+t+1);for(var r=0,n=Math.min(e.length-s,2);r<n;++r)e[s+r]=(t&255<<8*(a?r:1-r))>>>8*(a?r:1-r)}function x(e,t,s,a){t<0&&(t=4294967295+t+1);for(var r=0,n=Math.min(e.length-s,4);r<n;++r)e[s+r]=t>>>8*(a?r:3-r)&255}function R(e,t,s,a,r,n){if(s+a>e.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function O(e,t,s,a,n){return n||R(e,0,s,4),r.write(e,t,s,a,23,4),s+4}function C(e,t,s,a,n){return n||R(e,0,s,8),r.write(e,t,s,a,52,8),s+8}c.prototype.slice=function(e,t){var s,a=this.length;if((e=~~e)<0?(e+=a)<0&&(e=0):e>a&&(e=a),(t=void 0===t?a:~~t)<0?(t+=a)<0&&(t=0):t>a&&(t=a),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(s=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;s=new c(r,void 0);for(var n=0;n<r;++n)s[n]=this[n+e]}return s},c.prototype.readUIntLE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e],r=1,n=0;++n<t&&(r*=256);)a+=this[e+n]*r;return a},c.prototype.readUIntBE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e+--t],r=1;t>0&&(r*=256);)a+=this[e+--t]*r;return a},c.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=this[e],r=1,n=0;++n<t&&(r*=256);)a+=this[e+n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readIntBE=function(e,t,s){e|=0,t|=0,s||k(e,t,this.length);for(var a=t,r=1,n=this[e+--a];a>0&&(r*=256);)n+=this[e+--a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?4294901760|s:s},c.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,s,a){(e=+e,t|=0,s|=0,a)||D(this,e,t,s,Math.pow(2,8*s)-1,0);var r=1,n=0;for(this[t]=255&e;++n<s&&(r*=256);)this[t+n]=e/r&255;return t+s},c.prototype.writeUIntBE=function(e,t,s,a){(e=+e,t|=0,s|=0,a)||D(this,e,t,s,Math.pow(2,8*s)-1,0);var r=s-1,n=1;for(this[t+r]=255&e;--r>=0&&(n*=256);)this[t+r]=e/n&255;return t+s},c.prototype.writeUInt8=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):x(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,s,a){if(e=+e,t|=0,!a){var r=Math.pow(2,8*s-1);D(this,e,t,s,r-1,-r)}var n=0,i=1,o=0;for(this[t]=255&e;++n<s&&(i*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/i>>0)-o&255;return t+s},c.prototype.writeIntBE=function(e,t,s,a){if(e=+e,t|=0,!a){var r=Math.pow(2,8*s-1);D(this,e,t,s,r-1,-r)}var n=s-1,i=1,o=0;for(this[t+n]=255&e;--n>=0&&(i*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/i>>0)-o&255;return t+s},c.prototype.writeInt8=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):x(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,s){return e=+e,t|=0,s||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,s){return O(this,e,t,!0,s)},c.prototype.writeFloatBE=function(e,t,s){return O(this,e,t,!1,s)},c.prototype.writeDoubleLE=function(e,t,s){return C(this,e,t,!0,s)},c.prototype.writeDoubleBE=function(e,t,s){return C(this,e,t,!1,s)},c.prototype.copy=function(e,t,s,a){if(s||(s=0),a||0===a||(a=this.length),t>=e.length&&(t=e.length),t||(t=0),a>0&&a<s&&(a=s),a===s)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("sourceStart out of bounds");if(a<0)throw new RangeError("sourceEnd out of bounds");a>this.length&&(a=this.length),e.length-t<a-s&&(a=e.length-t+s);var r,n=a-s;if(this===e&&s<t&&t<a)for(r=n-1;r>=0;--r)e[r+t]=this[r+s];else if(n<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<n;++r)e[r+t]=this[r+s];else Uint8Array.prototype.set.call(e,this.subarray(s,s+n),t);return n},c.prototype.fill=function(e,t,s,a){if("string"==typeof e){if("string"==typeof t?(a=t,t=0,s=this.length):"string"==typeof s&&(a=s,s=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==a&&"string"!=typeof a)throw new TypeError("encoding must be a string");if("string"==typeof a&&!c.isEncoding(a))throw new TypeError("Unknown encoding: "+a)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<s)throw new RangeError("Out of range index");if(s<=t)return this;var n;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(n=t;n<s;++n)this[n]=e;else{var i=c.isBuffer(e)?e:L(new c(e,a).toString()),o=i.length;for(n=0;n<s-t;++n)this[n+t]=i[n%o]}return this};var _=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function L(e,t){var s;t=t||1/0;for(var a=e.length,r=null,n=[],i=0;i<a;++i){if((s=e.charCodeAt(i))>55295&&s<57344){if(!r){if(s>56319){(t-=3)>-1&&n.push(239,191,189);continue}if(i+1===a){(t-=3)>-1&&n.push(239,191,189);continue}r=s;continue}if(s<56320){(t-=3)>-1&&n.push(239,191,189),r=s;continue}s=65536+(r-55296<<10|s-56320)}else r&&(t-=3)>-1&&n.push(239,191,189);if(r=null,s<128){if((t-=1)<0)break;n.push(s)}else if(s<2048){if((t-=2)<0)break;n.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;n.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return n}function j(e){return a.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,s,a){for(var r=0;r<a&&!(r+s>=t.length||r>=e.length);++r)t[r+s]=e[r];return r}}).call(this,s(3))},function(e,t,s){(function(e){!function(e,t){"use strict";function a(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e}function n(e,t,s){if(n.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(s=t,t=10),this._init(e||0,t||10,s||"be"))}var i;"object"==typeof e?e.exports=n:t.BN=n,n.BN=n,n.wordSize=26;try{i=s(20).Buffer}catch(e){}function o(e,t,s){for(var a=0,r=Math.min(e.length,s),n=t;n<r;n++){var i=e.charCodeAt(n)-48;a<<=4,a|=i>=49&&i<=54?i-49+10:i>=17&&i<=22?i-17+10:15&i}return a}function c(e,t,s,a){for(var r=0,n=Math.min(e.length,s),i=t;i<n;i++){var o=e.charCodeAt(i)-48;r*=a,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}n.isBN=function(e){return e instanceof n||null!==e&&"object"==typeof e&&e.constructor.wordSize===n.wordSize&&Array.isArray(e.words)},n.max=function(e,t){return e.cmp(t)>0?e:t},n.min=function(e,t){return e.cmp(t)<0?e:t},n.prototype._init=function(e,t,s){if("number"==typeof e)return this._initNumber(e,t,s);if("object"==typeof e)return this._initArray(e,t,s);"hex"===t&&(t=16),a(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&r++,16===t?this._parseHex(e,r):this._parseBase(e,t,r),"-"===e[0]&&(this.negative=1),this.strip(),"le"===s&&this._initArray(this.toArray(),t,s)},n.prototype._initNumber=function(e,t,s){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(a(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===s&&this._initArray(this.toArray(),t,s)},n.prototype._initArray=function(e,t,s){if(a("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var n,i,o=0;if("be"===s)for(r=e.length-1,n=0;r>=0;r-=3)i=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[n]|=i<<o&67108863,this.words[n+1]=i>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);else if("le"===s)for(r=0,n=0;r<e.length;r+=3)i=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[n]|=i<<o&67108863,this.words[n+1]=i>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);return this.strip()},n.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var a,r,n=0;for(s=e.length-6,a=0;s>=t;s-=6)r=o(e,s,s+6),this.words[a]|=r<<n&67108863,this.words[a+1]|=r>>>26-n&4194303,(n+=24)>=26&&(n-=26,a++);s+6!==t&&(r=o(e,t,s+6),this.words[a]|=r<<n&67108863,this.words[a+1]|=r>>>26-n&4194303),this.strip()},n.prototype._parseBase=function(e,t,s){this.words=[0],this.length=1;for(var a=0,r=1;r<=67108863;r*=t)a++;a--,r=r/t|0;for(var n=e.length-s,i=n%a,o=Math.min(n,n-i)+s,u=0,d=s;d<o;d+=a)u=c(e,d,d+a,t),this.imuln(r),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==i){var h=1;for(u=c(e,d,e.length,t),d=0;d<i;d++)h*=t;this.imuln(h),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}},n.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},n.prototype.clone=function(){var e=new n(null);return this.copy(e),e},n.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},n.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function l(e,t,s){s.negative=t.negative^e.negative;var a=e.length+t.length|0;s.length=a,a=a-1|0;var r=0|e.words[0],n=0|t.words[0],i=r*n,o=67108863&i,c=i/67108864|0;s.words[0]=o;for(var u=1;u<a;u++){for(var d=c>>>26,h=67108863&c,l=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=l;f++){var m=u-f|0;d+=(i=(r=0|e.words[m])*(n=0|t.words[f])+h)/67108864|0,h=67108863&i}s.words[u]=0|h,c=0|d}return 0!==c?s.words[u]=0|c:s.length--,s.strip()}n.prototype.toString=function(e,t){var s;if(t=0|t||1,16===(e=e||10)||"hex"===e){s="";for(var r=0,n=0,i=0;i<this.length;i++){var o=this.words[i],c=(16777215&(o<<r|n)).toString(16);s=0!==(n=o>>>24-r&16777215)||i!==this.length-1?u[6-c.length]+c+s:c+s,(r+=2)>=26&&(r-=26,i--)}for(0!==n&&(s=n.toString(16)+s);s.length%t!=0;)s="0"+s;return 0!==this.negative&&(s="-"+s),s}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],f=h[e];s="";var m=this.clone();for(m.negative=0;!m.isZero();){var p=m.modn(f).toString(e);s=(m=m.idivn(f)).isZero()?p+s:u[l-p.length]+p+s}for(this.isZero()&&(s="0"+s);s.length%t!=0;)s="0"+s;return 0!==this.negative&&(s="-"+s),s}a(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&a(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(e,t){return a(void 0!==i),this.toArrayLike(i,e,t)},n.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},n.prototype.toArrayLike=function(e,t,s){var r=this.byteLength(),n=s||Math.max(1,r);a(r<=n,"byte array longer than desired length"),a(n>0,"Requested array length <= 0"),this.strip();var i,o,c="le"===t,u=new e(n),d=this.clone();if(c){for(o=0;!d.isZero();o++)i=d.andln(255),d.iushrn(8),u[o]=i;for(;o<n;o++)u[o]=0}else{for(o=0;o<n-r;o++)u[o]=0;for(o=0;!d.isZero();o++)i=d.andln(255),d.iushrn(8),u[n-o-1]=i}return u},Math.clz32?n.prototype._countBits=function(e){return 32-Math.clz32(e)}:n.prototype._countBits=function(e){var t=e,s=0;return t>=4096&&(s+=13,t>>>=13),t>=64&&(s+=7,t>>>=7),t>=8&&(s+=4,t>>>=4),t>=2&&(s+=2,t>>>=2),s+t},n.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,s=0;return 0==(8191&t)&&(s+=13,t>>>=13),0==(127&t)&&(s+=7,t>>>=7),0==(15&t)&&(s+=4,t>>>=4),0==(3&t)&&(s+=2,t>>>=2),0==(1&t)&&s++,s},n.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var s=this._zeroBits(this.words[t]);if(e+=s,26!==s)break}return e},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},n.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return 0!==this.negative},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},n.prototype.ior=function(e){return a(0==(this.negative|e.negative)),this.iuor(e)},n.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},n.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},n.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var s=0;s<t.length;s++)this.words[s]=this.words[s]&e.words[s];return this.length=t.length,this.strip()},n.prototype.iand=function(e){return a(0==(this.negative|e.negative)),this.iuand(e)},n.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},n.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},n.prototype.iuxor=function(e){var t,s;this.length>e.length?(t=this,s=e):(t=e,s=this);for(var a=0;a<s.length;a++)this.words[a]=t.words[a]^s.words[a];if(this!==t)for(;a<t.length;a++)this.words[a]=t.words[a];return this.length=t.length,this.strip()},n.prototype.ixor=function(e){return a(0==(this.negative|e.negative)),this.iuxor(e)},n.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},n.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},n.prototype.inotn=function(e){a("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),s=e%26;this._expand(t),s>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return s>0&&(this.words[r]=~this.words[r]&67108863>>26-s),this.strip()},n.prototype.notn=function(e){return this.clone().inotn(e)},n.prototype.setn=function(e,t){a("number"==typeof e&&e>=0);var s=e/26|0,r=e%26;return this._expand(s+1),this.words[s]=t?this.words[s]|1<<r:this.words[s]&~(1<<r),this.strip()},n.prototype.iadd=function(e){var t,s,a;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(s=this,a=e):(s=e,a=this);for(var r=0,n=0;n<a.length;n++)t=(0|s.words[n])+(0|a.words[n])+r,this.words[n]=67108863&t,r=t>>>26;for(;0!==r&&n<s.length;n++)t=(0|s.words[n])+r,this.words[n]=67108863&t,r=t>>>26;if(this.length=s.length,0!==r)this.words[this.length]=r,this.length++;else if(s!==this)for(;n<s.length;n++)this.words[n]=s.words[n];return this},n.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},n.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var s,a,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(s=this,a=e):(s=e,a=this);for(var n=0,i=0;i<a.length;i++)n=(t=(0|s.words[i])-(0|a.words[i])+n)>>26,this.words[i]=67108863&t;for(;0!==n&&i<s.length;i++)n=(t=(0|s.words[i])+n)>>26,this.words[i]=67108863&t;if(0===n&&i<s.length&&s!==this)for(;i<s.length;i++)this.words[i]=s.words[i];return this.length=Math.max(this.length,i),s!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,s){var a,r,n,i=e.words,o=t.words,c=s.words,u=0,d=0|i[0],h=8191&d,l=d>>>13,f=0|i[1],m=8191&f,p=f>>>13,w=0|i[2],g=8191&w,y=w>>>13,b=0|i[3],v=8191&b,M=b>>>13,S=0|i[4],I=8191&S,P=S>>>13,E=0|i[5],B=8191&E,N=E>>>13,U=0|i[6],A=8191&U,T=U>>>13,k=0|i[7],D=8191&k,K=k>>>13,x=0|i[8],R=8191&x,O=x>>>13,C=0|i[9],_=8191&C,F=C>>>13,L=0|o[0],j=8191&L,q=L>>>13,V=0|o[1],H=8191&V,G=V>>>13,J=0|o[2],W=8191&J,Y=J>>>13,z=0|o[3],Z=8191&z,X=z>>>13,Q=0|o[4],$=8191&Q,ee=Q>>>13,te=0|o[5],se=8191&te,ae=te>>>13,re=0|o[6],ne=8191&re,ie=re>>>13,oe=0|o[7],ce=8191&oe,ue=oe>>>13,de=0|o[8],he=8191&de,le=de>>>13,fe=0|o[9],me=8191&fe,pe=fe>>>13;s.negative=e.negative^t.negative,s.length=19;var we=(u+(a=Math.imul(h,j))|0)+((8191&(r=(r=Math.imul(h,q))+Math.imul(l,j)|0))<<13)|0;u=((n=Math.imul(l,q))+(r>>>13)|0)+(we>>>26)|0,we&=67108863,a=Math.imul(m,j),r=(r=Math.imul(m,q))+Math.imul(p,j)|0,n=Math.imul(p,q);var ge=(u+(a=a+Math.imul(h,H)|0)|0)+((8191&(r=(r=r+Math.imul(h,G)|0)+Math.imul(l,H)|0))<<13)|0;u=((n=n+Math.imul(l,G)|0)+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,a=Math.imul(g,j),r=(r=Math.imul(g,q))+Math.imul(y,j)|0,n=Math.imul(y,q),a=a+Math.imul(m,H)|0,r=(r=r+Math.imul(m,G)|0)+Math.imul(p,H)|0,n=n+Math.imul(p,G)|0;var ye=(u+(a=a+Math.imul(h,W)|0)|0)+((8191&(r=(r=r+Math.imul(h,Y)|0)+Math.imul(l,W)|0))<<13)|0;u=((n=n+Math.imul(l,Y)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,a=Math.imul(v,j),r=(r=Math.imul(v,q))+Math.imul(M,j)|0,n=Math.imul(M,q),a=a+Math.imul(g,H)|0,r=(r=r+Math.imul(g,G)|0)+Math.imul(y,H)|0,n=n+Math.imul(y,G)|0,a=a+Math.imul(m,W)|0,r=(r=r+Math.imul(m,Y)|0)+Math.imul(p,W)|0,n=n+Math.imul(p,Y)|0;var be=(u+(a=a+Math.imul(h,Z)|0)|0)+((8191&(r=(r=r+Math.imul(h,X)|0)+Math.imul(l,Z)|0))<<13)|0;u=((n=n+Math.imul(l,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,a=Math.imul(I,j),r=(r=Math.imul(I,q))+Math.imul(P,j)|0,n=Math.imul(P,q),a=a+Math.imul(v,H)|0,r=(r=r+Math.imul(v,G)|0)+Math.imul(M,H)|0,n=n+Math.imul(M,G)|0,a=a+Math.imul(g,W)|0,r=(r=r+Math.imul(g,Y)|0)+Math.imul(y,W)|0,n=n+Math.imul(y,Y)|0,a=a+Math.imul(m,Z)|0,r=(r=r+Math.imul(m,X)|0)+Math.imul(p,Z)|0,n=n+Math.imul(p,X)|0;var ve=(u+(a=a+Math.imul(h,$)|0)|0)+((8191&(r=(r=r+Math.imul(h,ee)|0)+Math.imul(l,$)|0))<<13)|0;u=((n=n+Math.imul(l,ee)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,a=Math.imul(B,j),r=(r=Math.imul(B,q))+Math.imul(N,j)|0,n=Math.imul(N,q),a=a+Math.imul(I,H)|0,r=(r=r+Math.imul(I,G)|0)+Math.imul(P,H)|0,n=n+Math.imul(P,G)|0,a=a+Math.imul(v,W)|0,r=(r=r+Math.imul(v,Y)|0)+Math.imul(M,W)|0,n=n+Math.imul(M,Y)|0,a=a+Math.imul(g,Z)|0,r=(r=r+Math.imul(g,X)|0)+Math.imul(y,Z)|0,n=n+Math.imul(y,X)|0,a=a+Math.imul(m,$)|0,r=(r=r+Math.imul(m,ee)|0)+Math.imul(p,$)|0,n=n+Math.imul(p,ee)|0;var Me=(u+(a=a+Math.imul(h,se)|0)|0)+((8191&(r=(r=r+Math.imul(h,ae)|0)+Math.imul(l,se)|0))<<13)|0;u=((n=n+Math.imul(l,ae)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,a=Math.imul(A,j),r=(r=Math.imul(A,q))+Math.imul(T,j)|0,n=Math.imul(T,q),a=a+Math.imul(B,H)|0,r=(r=r+Math.imul(B,G)|0)+Math.imul(N,H)|0,n=n+Math.imul(N,G)|0,a=a+Math.imul(I,W)|0,r=(r=r+Math.imul(I,Y)|0)+Math.imul(P,W)|0,n=n+Math.imul(P,Y)|0,a=a+Math.imul(v,Z)|0,r=(r=r+Math.imul(v,X)|0)+Math.imul(M,Z)|0,n=n+Math.imul(M,X)|0,a=a+Math.imul(g,$)|0,r=(r=r+Math.imul(g,ee)|0)+Math.imul(y,$)|0,n=n+Math.imul(y,ee)|0,a=a+Math.imul(m,se)|0,r=(r=r+Math.imul(m,ae)|0)+Math.imul(p,se)|0,n=n+Math.imul(p,ae)|0;var Se=(u+(a=a+Math.imul(h,ne)|0)|0)+((8191&(r=(r=r+Math.imul(h,ie)|0)+Math.imul(l,ne)|0))<<13)|0;u=((n=n+Math.imul(l,ie)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,a=Math.imul(D,j),r=(r=Math.imul(D,q))+Math.imul(K,j)|0,n=Math.imul(K,q),a=a+Math.imul(A,H)|0,r=(r=r+Math.imul(A,G)|0)+Math.imul(T,H)|0,n=n+Math.imul(T,G)|0,a=a+Math.imul(B,W)|0,r=(r=r+Math.imul(B,Y)|0)+Math.imul(N,W)|0,n=n+Math.imul(N,Y)|0,a=a+Math.imul(I,Z)|0,r=(r=r+Math.imul(I,X)|0)+Math.imul(P,Z)|0,n=n+Math.imul(P,X)|0,a=a+Math.imul(v,$)|0,r=(r=r+Math.imul(v,ee)|0)+Math.imul(M,$)|0,n=n+Math.imul(M,ee)|0,a=a+Math.imul(g,se)|0,r=(r=r+Math.imul(g,ae)|0)+Math.imul(y,se)|0,n=n+Math.imul(y,ae)|0,a=a+Math.imul(m,ne)|0,r=(r=r+Math.imul(m,ie)|0)+Math.imul(p,ne)|0,n=n+Math.imul(p,ie)|0;var Ie=(u+(a=a+Math.imul(h,ce)|0)|0)+((8191&(r=(r=r+Math.imul(h,ue)|0)+Math.imul(l,ce)|0))<<13)|0;u=((n=n+Math.imul(l,ue)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,a=Math.imul(R,j),r=(r=Math.imul(R,q))+Math.imul(O,j)|0,n=Math.imul(O,q),a=a+Math.imul(D,H)|0,r=(r=r+Math.imul(D,G)|0)+Math.imul(K,H)|0,n=n+Math.imul(K,G)|0,a=a+Math.imul(A,W)|0,r=(r=r+Math.imul(A,Y)|0)+Math.imul(T,W)|0,n=n+Math.imul(T,Y)|0,a=a+Math.imul(B,Z)|0,r=(r=r+Math.imul(B,X)|0)+Math.imul(N,Z)|0,n=n+Math.imul(N,X)|0,a=a+Math.imul(I,$)|0,r=(r=r+Math.imul(I,ee)|0)+Math.imul(P,$)|0,n=n+Math.imul(P,ee)|0,a=a+Math.imul(v,se)|0,r=(r=r+Math.imul(v,ae)|0)+Math.imul(M,se)|0,n=n+Math.imul(M,ae)|0,a=a+Math.imul(g,ne)|0,r=(r=r+Math.imul(g,ie)|0)+Math.imul(y,ne)|0,n=n+Math.imul(y,ie)|0,a=a+Math.imul(m,ce)|0,r=(r=r+Math.imul(m,ue)|0)+Math.imul(p,ce)|0,n=n+Math.imul(p,ue)|0;var Pe=(u+(a=a+Math.imul(h,he)|0)|0)+((8191&(r=(r=r+Math.imul(h,le)|0)+Math.imul(l,he)|0))<<13)|0;u=((n=n+Math.imul(l,le)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,a=Math.imul(_,j),r=(r=Math.imul(_,q))+Math.imul(F,j)|0,n=Math.imul(F,q),a=a+Math.imul(R,H)|0,r=(r=r+Math.imul(R,G)|0)+Math.imul(O,H)|0,n=n+Math.imul(O,G)|0,a=a+Math.imul(D,W)|0,r=(r=r+Math.imul(D,Y)|0)+Math.imul(K,W)|0,n=n+Math.imul(K,Y)|0,a=a+Math.imul(A,Z)|0,r=(r=r+Math.imul(A,X)|0)+Math.imul(T,Z)|0,n=n+Math.imul(T,X)|0,a=a+Math.imul(B,$)|0,r=(r=r+Math.imul(B,ee)|0)+Math.imul(N,$)|0,n=n+Math.imul(N,ee)|0,a=a+Math.imul(I,se)|0,r=(r=r+Math.imul(I,ae)|0)+Math.imul(P,se)|0,n=n+Math.imul(P,ae)|0,a=a+Math.imul(v,ne)|0,r=(r=r+Math.imul(v,ie)|0)+Math.imul(M,ne)|0,n=n+Math.imul(M,ie)|0,a=a+Math.imul(g,ce)|0,r=(r=r+Math.imul(g,ue)|0)+Math.imul(y,ce)|0,n=n+Math.imul(y,ue)|0,a=a+Math.imul(m,he)|0,r=(r=r+Math.imul(m,le)|0)+Math.imul(p,he)|0,n=n+Math.imul(p,le)|0;var Ee=(u+(a=a+Math.imul(h,me)|0)|0)+((8191&(r=(r=r+Math.imul(h,pe)|0)+Math.imul(l,me)|0))<<13)|0;u=((n=n+Math.imul(l,pe)|0)+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,a=Math.imul(_,H),r=(r=Math.imul(_,G))+Math.imul(F,H)|0,n=Math.imul(F,G),a=a+Math.imul(R,W)|0,r=(r=r+Math.imul(R,Y)|0)+Math.imul(O,W)|0,n=n+Math.imul(O,Y)|0,a=a+Math.imul(D,Z)|0,r=(r=r+Math.imul(D,X)|0)+Math.imul(K,Z)|0,n=n+Math.imul(K,X)|0,a=a+Math.imul(A,$)|0,r=(r=r+Math.imul(A,ee)|0)+Math.imul(T,$)|0,n=n+Math.imul(T,ee)|0,a=a+Math.imul(B,se)|0,r=(r=r+Math.imul(B,ae)|0)+Math.imul(N,se)|0,n=n+Math.imul(N,ae)|0,a=a+Math.imul(I,ne)|0,r=(r=r+Math.imul(I,ie)|0)+Math.imul(P,ne)|0,n=n+Math.imul(P,ie)|0,a=a+Math.imul(v,ce)|0,r=(r=r+Math.imul(v,ue)|0)+Math.imul(M,ce)|0,n=n+Math.imul(M,ue)|0,a=a+Math.imul(g,he)|0,r=(r=r+Math.imul(g,le)|0)+Math.imul(y,he)|0,n=n+Math.imul(y,le)|0;var Be=(u+(a=a+Math.imul(m,me)|0)|0)+((8191&(r=(r=r+Math.imul(m,pe)|0)+Math.imul(p,me)|0))<<13)|0;u=((n=n+Math.imul(p,pe)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863,a=Math.imul(_,W),r=(r=Math.imul(_,Y))+Math.imul(F,W)|0,n=Math.imul(F,Y),a=a+Math.imul(R,Z)|0,r=(r=r+Math.imul(R,X)|0)+Math.imul(O,Z)|0,n=n+Math.imul(O,X)|0,a=a+Math.imul(D,$)|0,r=(r=r+Math.imul(D,ee)|0)+Math.imul(K,$)|0,n=n+Math.imul(K,ee)|0,a=a+Math.imul(A,se)|0,r=(r=r+Math.imul(A,ae)|0)+Math.imul(T,se)|0,n=n+Math.imul(T,ae)|0,a=a+Math.imul(B,ne)|0,r=(r=r+Math.imul(B,ie)|0)+Math.imul(N,ne)|0,n=n+Math.imul(N,ie)|0,a=a+Math.imul(I,ce)|0,r=(r=r+Math.imul(I,ue)|0)+Math.imul(P,ce)|0,n=n+Math.imul(P,ue)|0,a=a+Math.imul(v,he)|0,r=(r=r+Math.imul(v,le)|0)+Math.imul(M,he)|0,n=n+Math.imul(M,le)|0;var Ne=(u+(a=a+Math.imul(g,me)|0)|0)+((8191&(r=(r=r+Math.imul(g,pe)|0)+Math.imul(y,me)|0))<<13)|0;u=((n=n+Math.imul(y,pe)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,a=Math.imul(_,Z),r=(r=Math.imul(_,X))+Math.imul(F,Z)|0,n=Math.imul(F,X),a=a+Math.imul(R,$)|0,r=(r=r+Math.imul(R,ee)|0)+Math.imul(O,$)|0,n=n+Math.imul(O,ee)|0,a=a+Math.imul(D,se)|0,r=(r=r+Math.imul(D,ae)|0)+Math.imul(K,se)|0,n=n+Math.imul(K,ae)|0,a=a+Math.imul(A,ne)|0,r=(r=r+Math.imul(A,ie)|0)+Math.imul(T,ne)|0,n=n+Math.imul(T,ie)|0,a=a+Math.imul(B,ce)|0,r=(r=r+Math.imul(B,ue)|0)+Math.imul(N,ce)|0,n=n+Math.imul(N,ue)|0,a=a+Math.imul(I,he)|0,r=(r=r+Math.imul(I,le)|0)+Math.imul(P,he)|0,n=n+Math.imul(P,le)|0;var Ue=(u+(a=a+Math.imul(v,me)|0)|0)+((8191&(r=(r=r+Math.imul(v,pe)|0)+Math.imul(M,me)|0))<<13)|0;u=((n=n+Math.imul(M,pe)|0)+(r>>>13)|0)+(Ue>>>26)|0,Ue&=67108863,a=Math.imul(_,$),r=(r=Math.imul(_,ee))+Math.imul(F,$)|0,n=Math.imul(F,ee),a=a+Math.imul(R,se)|0,r=(r=r+Math.imul(R,ae)|0)+Math.imul(O,se)|0,n=n+Math.imul(O,ae)|0,a=a+Math.imul(D,ne)|0,r=(r=r+Math.imul(D,ie)|0)+Math.imul(K,ne)|0,n=n+Math.imul(K,ie)|0,a=a+Math.imul(A,ce)|0,r=(r=r+Math.imul(A,ue)|0)+Math.imul(T,ce)|0,n=n+Math.imul(T,ue)|0,a=a+Math.imul(B,he)|0,r=(r=r+Math.imul(B,le)|0)+Math.imul(N,he)|0,n=n+Math.imul(N,le)|0;var Ae=(u+(a=a+Math.imul(I,me)|0)|0)+((8191&(r=(r=r+Math.imul(I,pe)|0)+Math.imul(P,me)|0))<<13)|0;u=((n=n+Math.imul(P,pe)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,a=Math.imul(_,se),r=(r=Math.imul(_,ae))+Math.imul(F,se)|0,n=Math.imul(F,ae),a=a+Math.imul(R,ne)|0,r=(r=r+Math.imul(R,ie)|0)+Math.imul(O,ne)|0,n=n+Math.imul(O,ie)|0,a=a+Math.imul(D,ce)|0,r=(r=r+Math.imul(D,ue)|0)+Math.imul(K,ce)|0,n=n+Math.imul(K,ue)|0,a=a+Math.imul(A,he)|0,r=(r=r+Math.imul(A,le)|0)+Math.imul(T,he)|0,n=n+Math.imul(T,le)|0;var Te=(u+(a=a+Math.imul(B,me)|0)|0)+((8191&(r=(r=r+Math.imul(B,pe)|0)+Math.imul(N,me)|0))<<13)|0;u=((n=n+Math.imul(N,pe)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,a=Math.imul(_,ne),r=(r=Math.imul(_,ie))+Math.imul(F,ne)|0,n=Math.imul(F,ie),a=a+Math.imul(R,ce)|0,r=(r=r+Math.imul(R,ue)|0)+Math.imul(O,ce)|0,n=n+Math.imul(O,ue)|0,a=a+Math.imul(D,he)|0,r=(r=r+Math.imul(D,le)|0)+Math.imul(K,he)|0,n=n+Math.imul(K,le)|0;var ke=(u+(a=a+Math.imul(A,me)|0)|0)+((8191&(r=(r=r+Math.imul(A,pe)|0)+Math.imul(T,me)|0))<<13)|0;u=((n=n+Math.imul(T,pe)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,a=Math.imul(_,ce),r=(r=Math.imul(_,ue))+Math.imul(F,ce)|0,n=Math.imul(F,ue),a=a+Math.imul(R,he)|0,r=(r=r+Math.imul(R,le)|0)+Math.imul(O,he)|0,n=n+Math.imul(O,le)|0;var De=(u+(a=a+Math.imul(D,me)|0)|0)+((8191&(r=(r=r+Math.imul(D,pe)|0)+Math.imul(K,me)|0))<<13)|0;u=((n=n+Math.imul(K,pe)|0)+(r>>>13)|0)+(De>>>26)|0,De&=67108863,a=Math.imul(_,he),r=(r=Math.imul(_,le))+Math.imul(F,he)|0,n=Math.imul(F,le);var Ke=(u+(a=a+Math.imul(R,me)|0)|0)+((8191&(r=(r=r+Math.imul(R,pe)|0)+Math.imul(O,me)|0))<<13)|0;u=((n=n+Math.imul(O,pe)|0)+(r>>>13)|0)+(Ke>>>26)|0,Ke&=67108863;var xe=(u+(a=Math.imul(_,me))|0)+((8191&(r=(r=Math.imul(_,pe))+Math.imul(F,me)|0))<<13)|0;return u=((n=Math.imul(F,pe))+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,c[0]=we,c[1]=ge,c[2]=ye,c[3]=be,c[4]=ve,c[5]=Me,c[6]=Se,c[7]=Ie,c[8]=Pe,c[9]=Ee,c[10]=Be,c[11]=Ne,c[12]=Ue,c[13]=Ae,c[14]=Te,c[15]=ke,c[16]=De,c[17]=Ke,c[18]=xe,0!==u&&(c[19]=u,s.length++),s};function m(e,t,s){return(new p).mulp(e,t,s)}function p(e,t){this.x=e,this.y=t}Math.imul||(f=l),n.prototype.mulTo=function(e,t){var s=this.length+e.length;return 10===this.length&&10===e.length?f(this,e,t):s<63?l(this,e,t):s<1024?function(e,t,s){s.negative=t.negative^e.negative,s.length=e.length+t.length;for(var a=0,r=0,n=0;n<s.length-1;n++){var i=r;r=0;for(var o=67108863&a,c=Math.min(n,t.length-1),u=Math.max(0,n-e.length+1);u<=c;u++){var d=n-u,h=(0|e.words[d])*(0|t.words[u]),l=67108863&h;o=67108863&(l=l+o|0),r+=(i=(i=i+(h/67108864|0)|0)+(l>>>26)|0)>>>26,i&=67108863}s.words[n]=o,a=i,i=r}return 0!==a?s.words[n]=a:s.length--,s.strip()}(this,e,t):m(this,e,t)},p.prototype.makeRBT=function(e){for(var t=new Array(e),s=n.prototype._countBits(e)-1,a=0;a<e;a++)t[a]=this.revBin(a,s,e);return t},p.prototype.revBin=function(e,t,s){if(0===e||e===s-1)return e;for(var a=0,r=0;r<t;r++)a|=(1&e)<<t-r-1,e>>=1;return a},p.prototype.permute=function(e,t,s,a,r,n){for(var i=0;i<n;i++)a[i]=t[e[i]],r[i]=s[e[i]]},p.prototype.transform=function(e,t,s,a,r,n){this.permute(n,e,t,s,a,r);for(var i=1;i<r;i<<=1)for(var o=i<<1,c=Math.cos(2*Math.PI/o),u=Math.sin(2*Math.PI/o),d=0;d<r;d+=o)for(var h=c,l=u,f=0;f<i;f++){var m=s[d+f],p=a[d+f],w=s[d+f+i],g=a[d+f+i],y=h*w-l*g;g=h*g+l*w,w=y,s[d+f]=m+w,a[d+f]=p+g,s[d+f+i]=m-w,a[d+f+i]=p-g,f!==o&&(y=c*h-u*l,l=c*l+u*h,h=y)}},p.prototype.guessLen13b=function(e,t){var s=1|Math.max(t,e),a=1&s,r=0;for(s=s/2|0;s;s>>>=1)r++;return 1<<r+1+a},p.prototype.conjugate=function(e,t,s){if(!(s<=1))for(var a=0;a<s/2;a++){var r=e[a];e[a]=e[s-a-1],e[s-a-1]=r,r=t[a],t[a]=-t[s-a-1],t[s-a-1]=-r}},p.prototype.normalize13b=function(e,t){for(var s=0,a=0;a<t/2;a++){var r=8192*Math.round(e[2*a+1]/t)+Math.round(e[2*a]/t)+s;e[a]=67108863&r,s=r<67108864?0:r/67108864|0}return e},p.prototype.convert13b=function(e,t,s,r){for(var n=0,i=0;i<t;i++)n+=0|e[i],s[2*i]=8191&n,n>>>=13,s[2*i+1]=8191&n,n>>>=13;for(i=2*t;i<r;++i)s[i]=0;a(0===n),a(0==(-8192&n))},p.prototype.stub=function(e){for(var t=new Array(e),s=0;s<e;s++)t[s]=0;return t},p.prototype.mulp=function(e,t,s){var a=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(a),n=this.stub(a),i=new Array(a),o=new Array(a),c=new Array(a),u=new Array(a),d=new Array(a),h=new Array(a),l=s.words;l.length=a,this.convert13b(e.words,e.length,i,a),this.convert13b(t.words,t.length,u,a),this.transform(i,n,o,c,a,r),this.transform(u,n,d,h,a,r);for(var f=0;f<a;f++){var m=o[f]*d[f]-c[f]*h[f];c[f]=o[f]*h[f]+c[f]*d[f],o[f]=m}return this.conjugate(o,c,a),this.transform(o,c,l,n,a,r),this.conjugate(l,n,a),this.normalize13b(l,a),s.negative=e.negative^t.negative,s.length=e.length+t.length,s.strip()},n.prototype.mul=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},n.prototype.mulf=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),m(this,e,t)},n.prototype.imul=function(e){return this.clone().mulTo(e,this)},n.prototype.imuln=function(e){a("number"==typeof e),a(e<67108864);for(var t=0,s=0;s<this.length;s++){var r=(0|this.words[s])*e,n=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=n>>>26,this.words[s]=67108863&n}return 0!==t&&(this.words[s]=t,this.length++),this},n.prototype.muln=function(e){return this.clone().imuln(e)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),s=0;s<t.length;s++){var a=s/26|0,r=s%26;t[s]=(e.words[a]&1<<r)>>>r}return t}(e);if(0===t.length)return new n(1);for(var s=this,a=0;a<t.length&&0===t[a];a++,s=s.sqr());if(++a<t.length)for(var r=s.sqr();a<t.length;a++,r=r.sqr())0!==t[a]&&(s=s.mul(r));return s},n.prototype.iushln=function(e){a("number"==typeof e&&e>=0);var t,s=e%26,r=(e-s)/26,n=67108863>>>26-s<<26-s;if(0!==s){var i=0;for(t=0;t<this.length;t++){var o=this.words[t]&n,c=(0|this.words[t])-o<<s;this.words[t]=c|i,i=o>>>26-s}i&&(this.words[t]=i,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},n.prototype.ishln=function(e){return a(0===this.negative),this.iushln(e)},n.prototype.iushrn=function(e,t,s){var r;a("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var n=e%26,i=Math.min((e-n)/26,this.length),o=67108863^67108863>>>n<<n,c=s;if(r-=i,r=Math.max(0,r),c){for(var u=0;u<i;u++)c.words[u]=this.words[u];c.length=i}if(0===i);else if(this.length>i)for(this.length-=i,u=0;u<this.length;u++)this.words[u]=this.words[u+i];else this.words[0]=0,this.length=1;var d=0;for(u=this.length-1;u>=0&&(0!==d||u>=r);u--){var h=0|this.words[u];this.words[u]=d<<26-n|h>>>n,d=h&o}return c&&0!==d&&(c.words[c.length++]=d),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(e,t,s){return a(0===this.negative),this.iushrn(e,t,s)},n.prototype.shln=function(e){return this.clone().ishln(e)},n.prototype.ushln=function(e){return this.clone().iushln(e)},n.prototype.shrn=function(e){return this.clone().ishrn(e)},n.prototype.ushrn=function(e){return this.clone().iushrn(e)},n.prototype.testn=function(e){a("number"==typeof e&&e>=0);var t=e%26,s=(e-t)/26,r=1<<t;return!(this.length<=s)&&!!(this.words[s]&r)},n.prototype.imaskn=function(e){a("number"==typeof e&&e>=0);var t=e%26,s=(e-t)/26;if(a(0===this.negative,"imaskn works only with positive numbers"),this.length<=s)return this;if(0!==t&&s++,this.length=Math.min(s,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},n.prototype.maskn=function(e){return this.clone().imaskn(e)},n.prototype.iaddn=function(e){return a("number"==typeof e),a(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},n.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},n.prototype.isubn=function(e){if(a("number"==typeof e),a(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},n.prototype.addn=function(e){return this.clone().iaddn(e)},n.prototype.subn=function(e){return this.clone().isubn(e)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(e,t,s){var r,n,i=e.length+s;this._expand(i);var o=0;for(r=0;r<e.length;r++){n=(0|this.words[r+s])+o;var c=(0|e.words[r])*t;o=((n-=67108863&c)>>26)-(c/67108864|0),this.words[r+s]=67108863&n}for(;r<this.length-s;r++)o=(n=(0|this.words[r+s])+o)>>26,this.words[r+s]=67108863&n;if(0===o)return this.strip();for(a(-1===o),o=0,r=0;r<this.length;r++)o=(n=-(0|this.words[r])+o)>>26,this.words[r]=67108863&n;return this.negative=1,this.strip()},n.prototype._wordDiv=function(e,t){var s=(this.length,e.length),a=this.clone(),r=e,i=0|r.words[r.length-1];0!==(s=26-this._countBits(i))&&(r=r.ushln(s),a.iushln(s),i=0|r.words[r.length-1]);var o,c=a.length-r.length;if("mod"!==t){(o=new n(null)).length=c+1,o.words=new Array(o.length);for(var u=0;u<o.length;u++)o.words[u]=0}var d=a.clone()._ishlnsubmul(r,1,c);0===d.negative&&(a=d,o&&(o.words[c]=1));for(var h=c-1;h>=0;h--){var l=67108864*(0|a.words[r.length+h])+(0|a.words[r.length+h-1]);for(l=Math.min(l/i|0,67108863),a._ishlnsubmul(r,l,h);0!==a.negative;)l--,a.negative=0,a._ishlnsubmul(r,1,h),a.isZero()||(a.negative^=1);o&&(o.words[h]=l)}return o&&o.strip(),a.strip(),"div"!==t&&0!==s&&a.iushrn(s),{div:o||null,mod:a}},n.prototype.divmod=function(e,t,s){return a(!e.isZero()),this.isZero()?{div:new n(0),mod:new n(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(i=o.mod.neg(),s&&0!==i.negative&&i.iadd(e)),{div:r,mod:i}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(i=o.mod.neg(),s&&0!==i.negative&&i.isub(e)),{div:o.div,mod:i}):e.length>this.length||this.cmp(e)<0?{div:new n(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new n(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new n(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,i,o},n.prototype.div=function(e){return this.divmod(e,"div",!1).div},n.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},n.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},n.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var s=0!==t.div.negative?t.mod.isub(e):t.mod,a=e.ushrn(1),r=e.andln(1),n=s.cmp(a);return n<0||1===r&&0===n?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},n.prototype.modn=function(e){a(e<=67108863);for(var t=(1<<26)%e,s=0,r=this.length-1;r>=0;r--)s=(t*s+(0|this.words[r]))%e;return s},n.prototype.idivn=function(e){a(e<=67108863);for(var t=0,s=this.length-1;s>=0;s--){var r=(0|this.words[s])+67108864*t;this.words[s]=r/e|0,t=r%e}return this.strip()},n.prototype.divn=function(e){return this.clone().idivn(e)},n.prototype.egcd=function(e){a(0===e.negative),a(!e.isZero());var t=this,s=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new n(1),i=new n(0),o=new n(0),c=new n(1),u=0;t.isEven()&&s.isEven();)t.iushrn(1),s.iushrn(1),++u;for(var d=s.clone(),h=t.clone();!t.isZero();){for(var l=0,f=1;0==(t.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(t.iushrn(l);l-- >0;)(r.isOdd()||i.isOdd())&&(r.iadd(d),i.isub(h)),r.iushrn(1),i.iushrn(1);for(var m=0,p=1;0==(s.words[0]&p)&&m<26;++m,p<<=1);if(m>0)for(s.iushrn(m);m-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(d),c.isub(h)),o.iushrn(1),c.iushrn(1);t.cmp(s)>=0?(t.isub(s),r.isub(o),i.isub(c)):(s.isub(t),o.isub(r),c.isub(i))}return{a:o,b:c,gcd:s.iushln(u)}},n.prototype._invmp=function(e){a(0===e.negative),a(!e.isZero());var t=this,s=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,i=new n(1),o=new n(0),c=s.clone();t.cmpn(1)>0&&s.cmpn(1)>0;){for(var u=0,d=1;0==(t.words[0]&d)&&u<26;++u,d<<=1);if(u>0)for(t.iushrn(u);u-- >0;)i.isOdd()&&i.iadd(c),i.iushrn(1);for(var h=0,l=1;0==(s.words[0]&l)&&h<26;++h,l<<=1);if(h>0)for(s.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);t.cmp(s)>=0?(t.isub(s),i.isub(o)):(s.isub(t),o.isub(i))}return(r=0===t.cmpn(1)?i:o).cmpn(0)<0&&r.iadd(e),r},n.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),s=e.clone();t.negative=0,s.negative=0;for(var a=0;t.isEven()&&s.isEven();a++)t.iushrn(1),s.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;s.isEven();)s.iushrn(1);var r=t.cmp(s);if(r<0){var n=t;t=s,s=n}else if(0===r||0===s.cmpn(1))break;t.isub(s)}return s.iushln(a)},n.prototype.invm=function(e){return this.egcd(e).a.umod(e)},n.prototype.isEven=function(){return 0==(1&this.words[0])},n.prototype.isOdd=function(){return 1==(1&this.words[0])},n.prototype.andln=function(e){return this.words[0]&e},n.prototype.bincn=function(e){a("number"==typeof e);var t=e%26,s=(e-t)/26,r=1<<t;if(this.length<=s)return this._expand(s+1),this.words[s]|=r,this;for(var n=r,i=s;0!==n&&i<this.length;i++){var o=0|this.words[i];n=(o+=n)>>>26,o&=67108863,this.words[i]=o}return 0!==n&&(this.words[i]=n,this.length++),this},n.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},n.prototype.cmpn=function(e){var t,s=e<0;if(0!==this.negative&&!s)return-1;if(0===this.negative&&s)return 1;if(this.strip(),this.length>1)t=1;else{s&&(e=-e),a(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},n.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},n.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,s=this.length-1;s>=0;s--){var a=0|this.words[s],r=0|e.words[s];if(a!==r){a<r?t=-1:a>r&&(t=1);break}}return t},n.prototype.gtn=function(e){return 1===this.cmpn(e)},n.prototype.gt=function(e){return 1===this.cmp(e)},n.prototype.gten=function(e){return this.cmpn(e)>=0},n.prototype.gte=function(e){return this.cmp(e)>=0},n.prototype.ltn=function(e){return-1===this.cmpn(e)},n.prototype.lt=function(e){return-1===this.cmp(e)},n.prototype.lten=function(e){return this.cmpn(e)<=0},n.prototype.lte=function(e){return this.cmp(e)<=0},n.prototype.eqn=function(e){return 0===this.cmpn(e)},n.prototype.eq=function(e){return 0===this.cmp(e)},n.red=function(e){return new S(e)},n.prototype.toRed=function(e){return a(!this.red,"Already a number in reduction context"),a(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},n.prototype.fromRed=function(){return a(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(e){return this.red=e,this},n.prototype.forceRed=function(e){return a(!this.red,"Already a number in reduction context"),this._forceRed(e)},n.prototype.redAdd=function(e){return a(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},n.prototype.redIAdd=function(e){return a(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},n.prototype.redSub=function(e){return a(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},n.prototype.redISub=function(e){return a(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},n.prototype.redShl=function(e){return a(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},n.prototype.redMul=function(e){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},n.prototype.redIMul=function(e){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},n.prototype.redSqr=function(){return a(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return a(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return a(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return a(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return a(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(e){return a(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};function g(e,t){this.name=e,this.p=new n(t,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function y(){g.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){g.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){g.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function M(){g.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(e){if("string"==typeof e){var t=n._prime(e);this.m=t.p,this.prime=t}else a(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function I(e){S.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g.prototype._tmp=function(){var e=new n(null);return e.words=new Array(Math.ceil(this.n/13)),e},g.prototype.ireduce=function(e){var t,s=e;do{this.split(s,this.tmp),t=(s=(s=this.imulK(s)).iadd(this.tmp)).bitLength()}while(t>this.n);var a=t<this.n?-1:s.ucmp(this.p);return 0===a?(s.words[0]=0,s.length=1):a>0?s.isub(this.p):void 0!==s.strip?s.strip():s._strip(),s},g.prototype.split=function(e,t){e.iushrn(this.n,0,t)},g.prototype.imulK=function(e){return e.imul(this.k)},r(y,g),y.prototype.split=function(e,t){for(var s=Math.min(e.length,9),a=0;a<s;a++)t.words[a]=e.words[a];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var r=e.words[9];for(t.words[t.length++]=4194303&r,a=10;a<e.length;a++){var n=0|e.words[a];e.words[a-10]=(4194303&n)<<4|r>>>22,r=n}r>>>=22,e.words[a-10]=r,0===r&&e.length>10?e.length-=10:e.length-=9},y.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,s=0;s<e.length;s++){var a=0|e.words[s];t+=977*a,e.words[s]=67108863&t,t=64*a+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(b,g),r(v,g),r(M,g),M.prototype.imulK=function(e){for(var t=0,s=0;s<e.length;s++){var a=19*(0|e.words[s])+t,r=67108863&a;a>>>=26,e.words[s]=r,t=a}return 0!==t&&(e.words[e.length++]=t),e},n._prime=function(e){if(w[e])return w[e];var t;if("k256"===e)t=new y;else if("p224"===e)t=new b;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new M}return w[e]=t,t},S.prototype._verify1=function(e){a(0===e.negative,"red works only with positives"),a(e.red,"red works only with red numbers")},S.prototype._verify2=function(e,t){a(0==(e.negative|t.negative),"red works only with positives"),a(e.red&&e.red===t.red,"red works only with red numbers")},S.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},S.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},S.prototype.add=function(e,t){this._verify2(e,t);var s=e.add(t);return s.cmp(this.m)>=0&&s.isub(this.m),s._forceRed(this)},S.prototype.iadd=function(e,t){this._verify2(e,t);var s=e.iadd(t);return s.cmp(this.m)>=0&&s.isub(this.m),s},S.prototype.sub=function(e,t){this._verify2(e,t);var s=e.sub(t);return s.cmpn(0)<0&&s.iadd(this.m),s._forceRed(this)},S.prototype.isub=function(e,t){this._verify2(e,t);var s=e.isub(t);return s.cmpn(0)<0&&s.iadd(this.m),s},S.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},S.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},S.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},S.prototype.isqr=function(e){return this.imul(e,e.clone())},S.prototype.sqr=function(e){return this.mul(e,e)},S.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(a(t%2==1),3===t){var s=this.m.add(new n(1)).iushrn(2);return this.pow(e,s)}for(var r=this.m.subn(1),i=0;!r.isZero()&&0===r.andln(1);)i++,r.iushrn(1);a(!r.isZero());var o=new n(1).toRed(this),c=o.redNeg(),u=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);0!==this.pow(d,u).cmp(c);)d.redIAdd(c);for(var h=this.pow(d,r),l=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),m=i;0!==f.cmp(o);){for(var p=f,w=0;0!==p.cmp(o);w++)p=p.redSqr();a(w<m);var g=this.pow(h,new n(1).iushln(m-w-1));l=l.redMul(g),h=g.redSqr(),f=f.redMul(h),m=w}return l},S.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},S.prototype.pow=function(e,t){if(t.isZero())return new n(1).toRed(this);if(0===t.cmpn(1))return e.clone();var s=new Array(16);s[0]=new n(1).toRed(this),s[1]=e;for(var a=2;a<s.length;a++)s[a]=this.mul(s[a-1],e);var r=s[0],i=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),a=t.length-1;a>=0;a--){for(var u=t.words[a],d=c-1;d>=0;d--){var h=u>>d&1;r!==s[0]&&(r=this.sqr(r)),0!==h||0!==i?(i<<=1,i|=h,(4===++o||0===a&&0===d)&&(r=this.mul(r,s[i]),o=0,i=0)):o=0}c=26}return r},S.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},S.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},n.mont=function(e){return new I(e)},r(I,S),I.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},I.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},I.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var s=e.imul(t),a=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=s.isub(a).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},I.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new n(0)._forceRed(this);var s=e.mul(t),a=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=s.isub(a).iushrn(this.shift),i=r;return r.cmp(this.m)>=0?i=r.isub(this.m):r.cmpn(0)<0&&(i=r.iadd(this.m)),i._forceRed(this)},I.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)}).call(this,s(19)(e))},function(e,t,s){var a=s(7);e.exports=y,y.simpleSieve=w,y.fermatTest=g;var r=s(5),n=new r(24),i=new(s(9)),o=new r(1),c=new r(2),u=new r(5),d=(new r(16),new r(8),new r(10)),h=new r(3),l=(new r(7),new r(11)),f=new r(4),m=(new r(12),null);function p(){if(null!==m)return m;var e=[];e[0]=2;for(var t=1,s=3;s<1048576;s+=2){for(var a=Math.ceil(Math.sqrt(s)),r=0;r<t&&e[r]<=a&&s%e[r]!=0;r++);t!==r&&e[r]<=a||(e[t++]=s)}return m=e,e}function w(e){for(var t=p(),s=0;s<t.length;s++)if(0===e.modn(t[s]))return 0===e.cmpn(t[s]);return!0}function g(e){var t=r.mont(e);return 0===c.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function y(e,t){if(e<16)return new r(2===t||5===t?[140,123]:[140,39]);var s,m;for(t=new r(t);;){for(s=new r(a(Math.ceil(e/8)));s.bitLength()>e;)s.ishrn(1);if(s.isEven()&&s.iadd(o),s.testn(1)||s.iadd(c),t.cmp(c)){if(!t.cmp(u))for(;s.mod(d).cmp(h);)s.iadd(f)}else for(;s.mod(n).cmp(l);)s.iadd(f);if(w(m=s.shrn(1))&&w(s)&&g(m)&&g(s)&&i.test(m)&&i.test(s))return s}}},function(e,t,s){"use strict";(function(t,a){var r=s(18).Buffer,n=t.crypto||t.msCrypto;n&&n.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var s=r.allocUnsafe(e);if(e>0)if(e>65536)for(var i=0;i<e;i+=65536)n.getRandomValues(s.slice(i,i+65536));else n.getRandomValues(s);if("function"==typeof t)return a.nextTick((function(){t(null,s)}));return s}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,s(3),s(8))},function(e,t){var s,a,r=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(s===setTimeout)return setTimeout(e,0);if((s===n||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:n}catch(e){s=n}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var c,u=[],d=!1,h=-1;function l(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=o(l);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];u.push(new m(e,t)),1!==u.length||d||o(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,s){var a=s(5),r=s(21);function n(e){this.rand=e||new r.Rand}e.exports=n,n.create=function(e){return new n(e)},n.prototype._randbelow=function(e){var t=e.bitLength(),s=Math.ceil(t/8);do{var r=new a(this.rand.generate(s))}while(r.cmp(e)>=0);return r},n.prototype._randrange=function(e,t){var s=t.sub(e);return e.add(this._randbelow(s))},n.prototype.test=function(e,t,s){var r=e.bitLength(),n=a.mont(e),i=new a(1).toRed(n);t||(t=Math.max(1,r/48|0));for(var o=e.subn(1),c=0;!o.testn(c);c++);for(var u=e.shrn(c),d=o.toRed(n);t>0;t--){var h=this._randrange(new a(2),o);s&&s(h);var l=h.toRed(n).redPow(u);if(0!==l.cmp(i)&&0!==l.cmp(d)){for(var f=1;f<c;f++){if(0===(l=l.redSqr()).cmp(i))return!1;if(0===l.cmp(d))break}if(f===c)return!1}}return!0},n.prototype.getDivisor=function(e,t){var s=e.bitLength(),r=a.mont(e),n=new a(1).toRed(r);t||(t=Math.max(1,s/48|0));for(var i=e.subn(1),o=0;!i.testn(o);o++);for(var c=e.shrn(o),u=i.toRed(r);t>0;t--){var d=this._randrange(new a(2),i),h=e.gcd(d);if(0!==h.cmpn(1))return h;var l=d.toRed(r).redPow(c);if(0!==l.cmp(n)&&0!==l.cmp(u)){for(var f=1;f<o;f++){if(0===(l=l.redSqr()).cmp(n))return l.fromRed().subn(1).gcd(e);if(0===l.cmp(u))break}if(f===o)return(l=l.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},function(e,t,s){(function(e){var a=s(6),r=s(23),n=s(24);var i={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(t){var s=new e(r[t].prime,"hex"),a=new e(r[t].gen,"hex");return new n(s,a)},t.createDiffieHellman=t.DiffieHellman=function t(s,r,o,c){return e.isBuffer(r)||void 0===i[r]?t(s,"binary",r,o):(r=r||"binary",c=c||"binary",o=o||new e([2]),e.isBuffer(o)||(o=new e(o,c)),"number"==typeof s?new n(a(s,o),o,!0):(e.isBuffer(s)||(s=new e(s,r)),new n(s,o,!0)))}}).call(this,s(4).Buffer)},function(e,t,s){"use strict";(function(t){!function(s){function a(e){const t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let s=1779033703,a=3144134277,r=1013904242,n=2773480762,i=1359893119,o=2600822924,c=528734635,u=1541459225;const d=new Uint32Array(64);function h(e){let h=0,l=e.length;for(;l>=64;){let f,m,p,w,g,y=s,b=a,v=r,M=n,S=i,I=o,P=c,E=u;for(m=0;m<16;m++)p=h+4*m,d[m]=(255&e[p])<<24|(255&e[p+1])<<16|(255&e[p+2])<<8|255&e[p+3];for(m=16;m<64;m++)f=d[m-2],w=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,f=d[m-15],g=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,d[m]=(w+d[m-7]|0)+(g+d[m-16]|0)|0;for(m=0;m<64;m++)w=(((S>>>6|S<<26)^(S>>>11|S<<21)^(S>>>25|S<<7))+(S&I^~S&P)|0)+(E+(t[m]+d[m]|0)|0)|0,g=((y>>>2|y<<30)^(y>>>13|y<<19)^(y>>>22|y<<10))+(y&b^y&v^b&v)|0,E=P,P=I,I=S,S=M+w|0,M=v,v=b,b=y,y=w+g|0;s=s+y|0,a=a+b|0,r=r+v|0,n=n+M|0,i=i+S|0,o=o+I|0,c=c+P|0,u=u+E|0,h+=64,l-=64}}h(e);let l,f=e.length%64,m=e.length/536870912|0,p=e.length<<3,w=f<56?56:120,g=e.slice(e.length-f,e.length);for(g.push(128),l=f+1;l<w;l++)g.push(0);return g.push(m>>>24&255),g.push(m>>>16&255),g.push(m>>>8&255),g.push(m>>>0&255),g.push(p>>>24&255),g.push(p>>>16&255),g.push(p>>>8&255),g.push(p>>>0&255),h(g),[s>>>24&255,s>>>16&255,s>>>8&255,s>>>0&255,a>>>24&255,a>>>16&255,a>>>8&255,a>>>0&255,r>>>24&255,r>>>16&255,r>>>8&255,r>>>0&255,n>>>24&255,n>>>16&255,n>>>8&255,n>>>0&255,i>>>24&255,i>>>16&255,i>>>8&255,i>>>0&255,o>>>24&255,o>>>16&255,o>>>8&255,o>>>0&255,c>>>24&255,c>>>16&255,c>>>8&255,c>>>0&255,u>>>24&255,u>>>16&255,u>>>8&255,u>>>0&255]}function r(e,t,s){e=e.length<=64?e:a(e);const r=64+t.length+4,n=new Array(r),i=new Array(64);let o,c=[];for(o=0;o<64;o++)n[o]=54;for(o=0;o<e.length;o++)n[o]^=e[o];for(o=0;o<t.length;o++)n[64+o]=t[o];for(o=r-4;o<r;o++)n[o]=0;for(o=0;o<64;o++)i[o]=92;for(o=0;o<e.length;o++)i[o]^=e[o];function u(){for(let e=r-1;e>=r-4;e--){if(n[e]++,n[e]<=255)return;n[e]=0}}for(;s>=32;)u(),c=c.concat(a(i.concat(a(n)))),s-=32;return s>0&&(u(),c=c.concat(a(i.concat(a(n))).slice(0,s))),c}function n(e,t,s,a,r){let n;for(u(e,16*(2*s-1),r,0,16),n=0;n<2*s;n++)c(e,16*n,r,16),o(r,a),u(r,0,e,t+16*n,16);for(n=0;n<s;n++)u(e,t+2*n*16,e,16*n,16);for(n=0;n<s;n++)u(e,t+16*(2*n+1),e,16*(n+s),16)}function i(e,t){return e<<t|e>>>32-t}function o(e,t){u(e,0,t,0,16);for(let e=8;e>0;e-=2)t[4]^=i(t[0]+t[12],7),t[8]^=i(t[4]+t[0],9),t[12]^=i(t[8]+t[4],13),t[0]^=i(t[12]+t[8],18),t[9]^=i(t[5]+t[1],7),t[13]^=i(t[9]+t[5],9),t[1]^=i(t[13]+t[9],13),t[5]^=i(t[1]+t[13],18),t[14]^=i(t[10]+t[6],7),t[2]^=i(t[14]+t[10],9),t[6]^=i(t[2]+t[14],13),t[10]^=i(t[6]+t[2],18),t[3]^=i(t[15]+t[11],7),t[7]^=i(t[3]+t[15],9),t[11]^=i(t[7]+t[3],13),t[15]^=i(t[11]+t[7],18),t[1]^=i(t[0]+t[3],7),t[2]^=i(t[1]+t[0],9),t[3]^=i(t[2]+t[1],13),t[0]^=i(t[3]+t[2],18),t[6]^=i(t[5]+t[4],7),t[7]^=i(t[6]+t[5],9),t[4]^=i(t[7]+t[6],13),t[5]^=i(t[4]+t[7],18),t[11]^=i(t[10]+t[9],7),t[8]^=i(t[11]+t[10],9),t[9]^=i(t[8]+t[11],13),t[10]^=i(t[9]+t[8],18),t[12]^=i(t[15]+t[14],7),t[13]^=i(t[12]+t[15],9),t[14]^=i(t[13]+t[12],13),t[15]^=i(t[14]+t[13],18);for(let s=0;s<16;++s)e[s]+=t[s]}function c(e,t,s,a){for(let r=0;r<a;r++)s[r]^=e[t+r]}function u(e,t,s,a,r){for(;r--;)s[a++]=e[t++]}function d(e){if(!e||"number"!=typeof e.length)return!1;for(let t=0;t<e.length;t++){const s=e[t];if("number"!=typeof s||s%1||s<0||s>=256)return!1}return!0}function h(e,t){if("number"!=typeof e||e%1)throw new Error("invalid "+t);return e}function l(e,s,a,i,o,l,f){if(a=h(a,"N"),i=h(i,"r"),o=h(o,"p"),l=h(l,"dkLen"),0===a||0!=(a&a-1))throw new Error("N must be power of 2");if(a>2147483647/128/i)throw new Error("N too large");if(i>2147483647/128/o)throw new Error("r too large");if(!d(e))throw new Error("password must be an array or buffer");if(e=Array.prototype.slice.call(e),!d(s))throw new Error("salt must be an array or buffer");s=Array.prototype.slice.call(s);let m=r(e,s,128*o*i);const p=new Uint32Array(32*o*i);for(let e=0;e<p.length;e++){const t=4*e;p[e]=(255&m[t+3])<<24|(255&m[t+2])<<16|(255&m[t+1])<<8|(255&m[t+0])<<0}const w=new Uint32Array(64*i),g=new Uint32Array(32*i*a),y=32*i,b=new Uint32Array(16),v=new Uint32Array(16),M=o*a*2;let S,I,P=0,E=null,B=!1,N=0,U=0;const A=f?parseInt(1e3/i):4294967295,T=void 0!==t?t:setTimeout,k=function(){if(B)return f(new Error("cancelled"),P/M);let t;switch(N){case 0:I=32*U*i,u(p,I,w,0,y),N=1,S=0;case 1:t=a-S,t>A&&(t=A);for(let e=0;e<t;e++)u(w,0,g,(S+e)*y,y),n(w,y,i,b,v);if(S+=t,P+=t,f){const e=parseInt(1e3*P/M);if(e!==E){if(B=f(null,P/M),B)break;E=e}}if(S<a)break;S=0,N=2;case 2:t=a-S,t>A&&(t=A);for(let e=0;e<t;e++){const e=w[16*(2*i-1)]&a-1;c(g,e*y,w,y),n(w,y,i,b,v)}if(S+=t,P+=t,f){const e=parseInt(1e3*P/M);if(e!==E){if(B=f(null,P/M),B)break;E=e}}if(S<a)break;if(u(w,0,p,I,y),U++,U<o){N=0;break}m=[];for(let e=0;e<p.length;e++)m.push(p[e]>>0&255),m.push(p[e]>>8&255),m.push(p[e]>>16&255),m.push(p[e]>>24&255);const s=r(e,m,l);return f&&f(null,1,s),s}f&&T(k)};if(!f)for(;;){const e=k();if(null!=e)return e}k()}const f={scrypt:function(e,t,s,a,r,n,i){return new Promise((function(o,c){let u=0;i&&i(0),l(e,t,s,a,r,n,(function(e,t,s){if(e)c(e);else if(s)i&&1!==u&&i(1),o(new Uint8Array(s));else if(i&&t!==u)return u=t,i(t)}))}))},syncScrypt:function(e,t,s,a,r,n){return new Uint8Array(l(e,t,s,a,r,n))}};e.exports=f}()}).call(this,s(25).setImmediate)},function(e,t,s){var a,r=function(){var e,t,s=((t=(e={constructor:function(e,t){this.array=[],this.compare=t||a;for(var s=e.length,r=0;r<s;)this.insert(e[r++])},insert:function(e){for(var t,s,a=this.array,r=this.compare,n=a.length-1,i=0,o=-1;n>=i;)if((s=r(a[t=(n+i)/2>>>0],e))<0)i=t+1;else{if(!(s>0)){o=t;break}n=t-1}for(-1===o&&(o=n),o++,n=a.length-1;o<n&&0===r(e,a[o]);)o++;for(t=a.length,a.push(e);t>o;)a[t]=a[--t];return a[o]=e,this},search:function(e){for(var t,s,a=this.array,r=this.compare,n=a.length-1,i=0;n>=i;)if((s=r(a[t=(n+i)/2>>>0],e))<0)i=t+1;else{if(!(s>0))return t;n=t-1}return-1},remove:function(e){var t=this.search(e);return t>=0&&this.array.splice(t,1),this}}).constructor).prototype=e,t);return s.comparing=function(e,t){return new s(t,(function(t,s){return a(t[e],s[e])}))},s;function a(e,t){return e<t?-1:e>t?1:0}}();e.exports=r,void 0===(a=function(){return r}.call(t,s,t,e))||(e.exports=a)},function(e,t){var s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(s){var a=new Uint8Array(16);e.exports=function(){return s(a),a}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var s=[],a=0;a<256;++a)s[a]=(a+256).toString(16).substr(1);e.exports=function(e,t){var a=t||0,r=s;return[r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]]].join("")}},function(e,t,s){"use strict";t.byteLength=function(e){var t=u(e),s=t[0],a=t[1];return 3*(s+a)/4-a},t.toByteArray=function(e){var t,s,a=u(e),i=a[0],o=a[1],c=new n(function(e,t,s){return 3*(t+s)/4-s}(0,i,o)),d=0,h=o>0?i-4:i;for(s=0;s<h;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===o&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,c[d++]=255&t);1===o&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,s=e.length,r=s%3,n=[],i=0,o=s-r;i<o;i+=16383)n.push(d(e,i,i+16383>o?o:i+16383));1===r?(t=e[s-1],n.push(a[t>>2]+a[t<<4&63]+"==")):2===r&&(t=(e[s-2]<<8)+e[s-1],n.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return n.join("")};for(var a=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=i.length;o<c;++o)a[o]=i[o],r[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}function d(e,t,s){for(var r,n,i=[],o=t;o<s;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(a[(n=r)>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,s,a,r){var n,i,o=8*r-a-1,c=(1<<o)-1,u=c>>1,d=-7,h=s?r-1:0,l=s?-1:1,f=e[t+h];for(h+=l,n=f&(1<<-d)-1,f>>=-d,d+=o;d>0;n=256*n+e[t+h],h+=l,d-=8);for(i=n&(1<<-d)-1,n>>=-d,d+=a;d>0;i=256*i+e[t+h],h+=l,d-=8);if(0===n)n=1-u;else{if(n===c)return i?NaN:1/0*(f?-1:1);i+=Math.pow(2,a),n-=u}return(f?-1:1)*i*Math.pow(2,n-a)},t.write=function(e,t,s,a,r,n){var i,o,c,u=8*n-r-1,d=(1<<u)-1,h=d>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=a?0:n-1,m=a?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,i=d):(i=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-i))<1&&(i--,c*=2),(t+=i+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(i++,c/=2),i+h>=d?(o=0,i=d):i+h>=1?(o=(t*c-1)*Math.pow(2,r),i+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,r),i=0));r>=8;e[s+f]=255&o,f+=m,o/=256,r-=8);for(i=i<<r|o,u+=r;u>0;e[s+f]=255&i,f+=m,i/=256,u-=8);e[s+f-m]|=128*p}},function(e,t){var s={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==s.call(e)}},function(e,t,s){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var a=s(4),r=a.Buffer;function n(e,t){for(var s in e)t[s]=e[s]}function i(e,t,s){return r(e,t,s)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=a:(n(a,t),t.Buffer=i),i.prototype=Object.create(r.prototype),n(r,i),i.from=function(e,t,s){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,s)},i.alloc=function(e,t,s){if("number"!=typeof e)throw new TypeError("Argument must be a number");var a=r(e);return void 0!==t?"string"==typeof s?a.fill(t,s):a.fill(t):a.fill(0),a},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a.SlowBuffer(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){},function(e,t,s){var a;function r(e){this.rand=e}if(e.exports=function(e){return a||(a=new r(null)),a.generate(e)},e.exports.Rand=r,r.prototype.generate=function(e){return this._rand(e)},r.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),s=0;s<t.length;s++)t[s]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(r.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var n=s(22);if("function"!=typeof n.randomBytes)throw new Error("Not supported");r.prototype._rand=function(e){return n.randomBytes(e)}}catch(e){}},function(e,t){},function(e){e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},function(e,t,s){(function(t){var a=s(5),r=new(s(9)),n=new a(24),i=new a(11),o=new a(10),c=new a(3),u=new a(7),d=s(6),h=s(7);function l(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this._pub=new a(e),this}function f(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this._priv=new a(e),this}e.exports=p;var m={};function p(e,t,s){this.setGenerator(t),this.__prime=new a(e),this._prime=a.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,s?(this.setPublicKey=l,this.setPrivateKey=f):this._primeCode=8}function w(e,s){var a=new t(e.toArray());return s?a.toString(s):a}Object.defineProperty(p.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var s=t.toString("hex"),a=[s,e.toString(16)].join("_");if(a in m)return m[a];var h,l=0;if(e.isEven()||!d.simpleSieve||!d.fermatTest(e)||!r.test(e))return l+=1,l+="02"===s||"05"===s?8:4,m[a]=l,l;switch(r.test(e.shrn(1))||(l+=2),s){case"02":e.mod(n).cmp(i)&&(l+=8);break;case"05":(h=e.mod(o)).cmp(c)&&h.cmp(u)&&(l+=8);break;default:l+=4}return m[a]=l,l}(this.__prime,this.__gen)),this._primeCode}}),p.prototype.generateKeys=function(){return this._priv||(this._priv=new a(h(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},p.prototype.computeSecret=function(e){var s=(e=(e=new a(e)).toRed(this._prime)).redPow(this._priv).fromRed(),r=new t(s.toArray()),n=this.getPrime();if(r.length<n.length){var i=new t(n.length-r.length);i.fill(0),r=t.concat([i,r])}return r},p.prototype.getPublicKey=function(e){return w(this._pub,e)},p.prototype.getPrivateKey=function(e){return w(this._priv,e)},p.prototype.getPrime=function(e){return w(this.__prime,e)},p.prototype.getGenerator=function(e){return w(this._gen,e)},p.prototype.setGenerator=function(e,s){return s=s||"utf8",t.isBuffer(e)||(e=new t(e,s)),this.__gen=e,this._gen=new a(e),this}}).call(this,s(4).Buffer)},function(e,t,s){(function(e){var a=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(r.call(setTimeout,a,arguments),clearTimeout)},t.setInterval=function(){return new n(r.call(setInterval,a,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(a,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},s(26),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,s(3))},function(e,t,s){(function(e,t){!function(e,s){"use strict";if(!e.setImmediate){var a,r,n,i,o,c=1,u={},d=!1,h=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick((function(){m(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,s=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=s,t}}()?e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){m(e.data)},a=function(e){n.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,a=function(e){var t=h.createElement("script");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):a=function(e){setTimeout(m,0,e)}:(i="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&m(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),a=function(t){e.postMessage(i+t,"*")}),l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),s=0;s<t.length;s++)t[s]=arguments[s+1];var r={callback:e,args:t};return u[c]=r,a(c),c++},l.clearImmediate=f}function f(e){delete u[e]}function m(e){if(d)setTimeout(m,0,e);else{var t=u[e];if(t){d=!0;try{!function(e){var t=e.callback,s=e.args;switch(s.length){case 0:t();break;case 1:t(s[0]);break;case 2:t(s[0],s[1]);break;case 3:t(s[0],s[1],s[2]);break;default:t.apply(void 0,s)}}(t)}finally{f(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,s(3),s(8))},function(e,t,s){"use strict";s.r(t);var a=s(1),r=s.n(a),n=s(0),i=s.n(n),o=200,c=400,u=401,d=402,h=403,l=404,f=409,m=429,p=500,w=503,g=504,y=1012,b=3e3,v=3001;class M extends Error{constructor(...e){super(...e),this.name="UsernameAlreadyExists",this.message="Username already exists.",this.status=f}}class S extends Error{constructor(...e){super(...e),this.name="UsernameMissing",this.message="Username missing.",this.status=c}}class I extends Error{constructor(...e){super(...e),this.name="UsernameCannotBeBlank",this.message="Username cannot be blank.",this.status=c}}class P extends Error{constructor(e,...t){super(e,...t),this.name="UsernameTooLong",this.message="Username too long. Must be a max of ".concat(e," characters."),this.status=c}}class E extends Error{constructor(...e){super(...e),this.name="UsernameMustBeString",this.message="Username must be a string.",this.status=c}}class B extends Error{constructor(...e){super(...e),this.name="PasswordMissing",this.message="Password missing.",this.status=c}}class N extends Error{constructor(...e){super(...e),this.name="PasswordCannotBeBlank",this.message="Password cannot be blank.",this.status=c}}class U extends Error{constructor(e,...t){super(e,...t),this.name="PasswordTooShort",this.message="Password too short. Must be a minimum of ".concat(e," characters."),this.status=c}}class A extends Error{constructor(e,...t){super(e,...t),this.name="PasswordTooLong",this.message="Password too long. Must be a max of ".concat(e," characters."),this.status=c}}class T extends Error{constructor(...e){super(...e),this.name="PasswordMustBeString",this.message="Password must be a string.",this.status=c}}class k extends Error{constructor(e,...t){super(e,...t),this.name="PasswordAttemptLimitExceeded",this.message="Password attempt limit exceeded. Must wait ".concat(e," to attempt to use password again."),this.status=u}}class D extends Error{constructor(...e){super(...e),this.name="UsernameOrPasswordMismatch",this.message="Username or password mismatch.",this.status=u}}class K extends Error{constructor(...e){super(...e),this.name="SessionLengthMustBeNumber",this.message="Session length must be a number.",this.status=c}}class x extends Error{constructor(e,...t){super(e,...t),this.name="SessionLengthTooShort",this.message="Session length cannot be shorter than ".concat(e,"."),this.status=c}}class R extends Error{constructor(e,...t){super(e,...t),this.name="SessionLengthTooLong",this.message="Session length cannot be longer than ".concat(e,"."),this.status=c}}class O extends Error{constructor(...e){super(...e),this.name="AllowServerSideEncryptionMustBeBoolean",this.message="Allow server-side encryption value must be a boolean.",this.status=c}}class C extends Error{constructor(e,...t){super(...t),this.name="UserAlreadySignedIn",this.message="Already signed in.",this.status=c,this.username=e}}class _ extends Error{constructor(...e){super(...e),this.name="UserPendingDeletion",this.message="User is pending deletion.",this.status=h}}class F extends Error{constructor(...e){super(...e),this.name="AppIdNotValid",this.message="App ID not valid.",this.status=u}}class L extends Error{constructor(e,...t){super(e,...t),this.name="DomainNotWhitelisted",this.message="Domain not whitelisted. Whitelist the domain ".concat(e?"'".concat(e,"' "):"","in your admin panel."),this.status=u}}class j extends Error{constructor(...e){super(...e),this.name="UserNotSignedIn",this.message="Not signed in.",this.status=c}}class q extends Error{constructor(e,...t){super(e,...t),e&&(this.username=e),this.name="UserNotFound",this.message="User not found.",this.status=l}}class V extends Error{constructor(...e){super(...e),this.name="UserEmailNotFound",this.message="User does not have an email saved.",this.status=l}}class H extends Error{constructor(...e){super(...e),this.name="UserMustChangePassword",this.message="Must change password first.",this.status=h}}class G extends Error{constructor(...e){super(...e),this.name="EmailNotValid",this.message="Email not valid.",this.status=c}}class J extends Error{constructor(...e){super(...e),this.name="ProfileMustBeObject",this.message="Profile must be a flat JSON object.",this.status=c}}class W extends Error{constructor(...e){super(...e),this.name="ProfileCannotBeEmpty",this.message="Profile cannot be empty.",this.status=c}}class Y extends Error{constructor(e,...t){super(e,...t),this.name="ProfileHasTooManyKeys",this.message="Profile has too many keys. Must have a max of ".concat(e," keys."),this.status=c}}class z extends Error{constructor(e,t,...s){super(e,t,...s),this.name="ProfileKeyTooLong",this.message="Profile key too long. Must be a max of ".concat(e," characters."),this.status=c,this.key=t}}class Z extends Error{constructor(e,t,...s){super(e,t,...s),this.name="ProfileValueMustBeString",this.message="Profile value must be a string.",this.status=c,this.key=e,this.value=t}}class X extends Error{constructor(e,...t){super(e,...t),this.name="ProfileValueCannotBeBlank",this.message="Profile value cannot be blank.",this.status=c,this.key=e}}class Q extends Error{constructor(e,t,s,...a){super(e,t,s,...a),this.name="ProfileValueTooLong",this.message="Profile value too long. Must be a max of ".concat(e," characters."),this.status=c,this.key=t,this.value=s}}class $ extends Error{constructor(e,...t){super(e,...t),this.name="RememberMeValueNotValid",this.message="Remember me value must be one of ".concat(JSON.stringify(Object.keys(e)),"."),this.status=c}}class ee extends Error{constructor(...e){super(...e),this.name="ParamsMissing",this.message="Parameters expected are missing.",this.status=c}}class te extends Error{constructor(...e){super(...e),this.name="TrialExceededLimit",this.message="Trial exceeded limit of users.",this.status=d}}class se extends Error{constructor(...e){super(...e),this.name="CurrentPasswordMissing",this.message="Current password missing.",this.status=c}}class ae extends Error{constructor(...e){super(...e),this.name="CurrentPasswordIncorrect",this.message="Current password is incorrect.",this.status=u}}class re extends Error{constructor(e,...t){super(e,...t),this.name="KeyNotFound",this.message=e,this.status=l}}class ne extends Error{constructor(...e){super(...e),this.name="DeleteEndToEndEncryptedDataMustBeBoolean",this.message="Delete end-to-end encrypted data value must be a boolean.",this.status=c}}var ie={UsernameAlreadyExists:M,UsernameMissing:S,UsernameCannotBeBlank:I,UsernameTooLong:P,UsernameMustBeString:E,PasswordMissing:B,PasswordCannotBeBlank:N,PasswordTooShort:U,PasswordTooLong:A,PasswordMustBeString:T,PasswordAttemptLimitExceeded:k,UsernameOrPasswordMismatch:D,SessionLengthMustBeNumber:K,SessionLengthTooShort:x,SessionLengthTooLong:R,AllowServerSideEncryptionMustBeBoolean:O,UserAlreadySignedIn:C,UserPendingDeletion:_,AppIdNotValid:F,DomainNotWhitelisted:L,UserNotSignedIn:j,UserNotFound:q,UserEmailNotFound:V,UserMustChangePassword:H,EmailNotValid:G,ProfileMustBeObject:J,ProfileCannotBeEmpty:W,ProfileHasTooManyKeys:Y,ProfileKeyTooLong:z,ProfileValueMustBeString:Z,ProfileValueCannotBeBlank:X,ProfileValueTooLong:Q,RememberMeValueNotValid:$,ParamsMissing:ee,TrialExceededLimit:te,CurrentPasswordMissing:se,CurrentPasswordIncorrect:ae,KeyNotFound:re,DeleteEndToEndEncryptedDataMustBeBoolean:ne};class oe extends Error{constructor(...e){super(...e),this.name="DatabaseNameMissing",this.message="Database name missing.",this.status=c}}class ce extends Error{constructor(...e){super(...e),this.name="DatabaseNameCannotBeBlank",this.message="Database name cannot be blank.",this.status=c}}class ue extends Error{constructor(...e){super(...e),this.name="DatabaseNameMustBeString",this.message="Database name must be a string.",this.status=c}}class de extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseNameTooLong",this.message="Database name cannot be more than ".concat(e," characters."),this.status=c}}class he extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseNameRestricted",this.message="Database name '".concat(e,"' is restricted. It is used internally by userbase-js."),this.status=h}}class le extends Error{constructor(...e){super(...e),this.name="DatabaseAlreadyOpening",this.message="Already attempting to open database.",this.status=c}}class fe extends Error{constructor(...e){super(...e),this.name="ChangeHandlerMissing",this.message="Change handler missing.",this.status=c}}class me extends Error{constructor(...e){super(...e),this.name="ChangeHandlerMustBeFunction",this.message="Change handler must be a function.",this.status=c}}class pe extends Error{constructor(e,...t){super(e,...t),this.name="EncryptionModeNotValid",this.message="Encryption mode must be one of ".concat(JSON.stringify(Object.keys(e)),"."),this.status=c}}class we extends Error{constructor(...e){super(...e),this.name="ServerSideEncryptionNotEnabledInClient",this.message="Server-side encryption must be enabled in the client to use it. To enable it, set allowServerSideEncryption to true in init().",this.status=h}}class ge extends Error{constructor(...e){super(...e),this.name="DatabaseNotOpen",this.message="Database is not open.",this.status=c}}class ye extends Error{constructor(...e){super(...e),this.name="DatabaseNotFound",this.message="Database not found. Find available databases using getDatabases().",this.status=l}}class be extends Error{constructor(...e){super(...e),this.name="DatabaseIsReadOnly",this.message="Database is read only. Must have permission to write to database.",this.status=h}}class ve extends Error{constructor(...e){super(...e),this.name="DatabaseIdMustBeString",this.message="Database id must be a string.",this.status=c}}class Me extends Error{constructor(...e){super(...e),this.name="DatabaseIdCannotBeBlank",this.message="Database id cannot be blank.",this.status=c}}class Se extends Error{constructor(...e){super(...e),this.name="DatabaseIdNotAllowed",this.message="Database id not allowed. Cannot provide both databaseName and databaseId, can only provide one.",this.status=c}}class Ie extends Error{constructor(...e){super(...e),this.name="DatabaseIdNotAllowedForOwnDatabase",this.message="Tried to open the user's own database using its databaseId rather than its databaseName. The databaseId should only be used to open databases shared from other users.",this.status=h}}class Pe extends Error{constructor(e,...t){super(e,...t),this.name="DatabaseIdInvalidLength",this.message="Database id invalid length. Must be ".concat(e," characters."),this.status=c}}class Ee extends Error{constructor(...e){super(...e),this.name="ShareTokenInvalid",this.message="Share token invalid.",this.status=c}}class Be extends Error{constructor(...e){super(...e),this.name="ShareTokenNotFound",this.message="Share token not found. Perhaps the database owner has generated a new share token.",this.status=l}}class Ne extends Error{constructor(e,...t){super(e,...t),this.name="ShareTokenNotAllowed",this.message="Share token not allowed.",this.status=c}}class Ue extends Error{constructor(...e){super(...e),this.name="ShareTokenNotAllowedForOwnDatabase",this.message="Tried to open the user's own database using its shareToken rather than its databaseName. The shareToken should only be used to open databases shared from other users.",this.status=h}}class Ae extends Error{constructor(...e){super(...e),this.name="ReadOnlyMustBeBoolean",this.message="Read only value must be a boolean.",this.status=c}}class Te extends Error{constructor(...e){super(...e),this.name="ReadOnlyParamNotAllowed",this.message="Read only parameter not allowed when revoking access to a database.",this.status=c}}class ke extends Error{constructor(e,...t){super(e,...t),this.name="ResharingAllowedParamNotAllowed",this.message="Resharing allowed parameter not allowed ".concat(e,"."),this.status=c}}class De extends Error{constructor(...e){super(...e),this.name="ResharingAllowedMustBeBoolean",this.message="Resharing allowed value must be a boolean.",this.status=c}}class Ke extends Error{constructor(e,...t){super(e,...t),this.name="ResharingNotAllowed",this.message="Resharing not allowed. ".concat(e,"."),this.status=h}}class xe extends Error{constructor(...e){super(...e),this.name="ResharingWithWriteAccessNotAllowed",this.message="Resharing with write access not allowed. Must have permission to write to the database to reshare the database with write access another user.",this.status=h}}class Re extends Error{constructor(...e){super(...e),this.name="SharingWithSelfNotAllowed",this.message="Sharing database with self is not allowed. Must share database with another user.",this.status=c}}class Oe extends Error{constructor(...e){super(...e),this.name="ModifyingOwnPermissionsNotAllowed",this.message="Modifying own database permissions not allowed. Must modify another user's permissions.",this.status=c}}class Ce extends Error{constructor(...e){super(...e),this.name="ModifyingOwnerPermissionsNotAllowed",this.message="Modifying the owner of a database's permissions is not allowed.",this.status=h}}class _e extends Error{constructor(...e){super(...e),this.name="ModifyingPermissionsNotAllowed",this.message="Modifying another user's permissions is not allowed. Must have permission to reshare the database with another user.",this.status=h}}class Fe extends Error{constructor(...e){super(...e),this.name="GrantingWriteAccessNotAllowed",this.message="Granting write access not allowed. Must have permission to write to the database to grant write access to another user.",this.status=h}}class Le extends Error{constructor(...e){super(...e),this.name="RequireVerifiedMustBeBoolean",this.message="Require verified value must be a boolean.",this.status=c}}class je extends Error{constructor(...e){super(...e),this.name="RequireVerifiedParamNotNecessary",this.message="Require verified parameter not necessary when sharing database without a username.",this.status=c}}class qe extends Error{constructor(...e){super(...e),this.name="RevokeMustBeBoolean",this.message="Revoke value must be a boolean.",this.status=c}}class Ve extends Error{constructor(...e){super(...e),this.name="ItemMissing",this.message="Item missing.",this.status=c}}class He extends Error{constructor(...e){super(...e),this.name="ItemInvalid",this.message="Item must be serializable to JSON.",this.status=c}}class Ge extends Error{constructor(e,...t){super(e,...t),this.name="ItemTooLarge",this.message="Item must be less than ".concat(e," KB."),this.status=c}}class Je extends Error{constructor(...e){super(...e),this.name="ItemIdMustBeString",this.message="Item id must be a string.",this.status=c}}class We extends Error{constructor(e,...t){super(e,...t),this.name="ItemIdTooLong",this.message="Item id cannot be more than ".concat(e," characters."),this.status=c}}class Ye extends Error{constructor(...e){super(...e),this.name="ItemIdMissing",this.message="Item id missing.",this.status=c}}class ze extends Error{constructor(...e){super(...e),this.name="ItemIdCannotBeBlank",this.message="Item id cannot be blank.",this.status=c}}class Ze extends Error{constructor(...e){super(...e),this.name="ItemAlreadyExists",this.message="Item with the same id already exists.",this.status=f}}class Xe extends Error{constructor(...e){super(...e),this.name="ItemDoesNotExist",this.message="Item with the provided id does not exist.",this.status=l}}class Qe extends Error{constructor(...e){super(...e),this.name="ItemUpdateConflict",this.message="Item update conflict.",this.status=f}}class $e extends Error{constructor(...e){super(...e),this.name="FileMissing",this.message="File missing.",this.status=c}}class et extends Error{constructor(...e){super(...e),this.name="FileMustBeFile",this.message="File must be a file.",this.status=c}}class tt extends Error{constructor(...e){super(...e),this.name="FileCannotBeEmpty",this.message="File cannot be empty.",this.status=c}}class st extends Error{constructor(...e){super(...e),this.name="FileUploadConflict",this.message="File upload conflict.",this.status=f}}class at extends Error{constructor(...e){super(...e),this.name="FileNotFound",this.message="File not found.",this.status=l}}class rt extends Error{constructor(...e){super(...e),this.name="FileIdMissing",this.message="File id missing.",this.status=c}}class nt extends Error{constructor(...e){super(...e),this.name="FileIdMustBeString",this.message="File id must be a string.",this.status=c}}class it extends Error{constructor(...e){super(...e),this.name="FileIdCannotBeBlank",this.message="File id cannot be blank.",this.status=c}}class ot extends Error{constructor(e,...t){super(e,...t),this.name="FileIdTooLong",this.message="File id cannot be more than ".concat(e," characters."),this.status=c}}class ct extends Error{constructor(...e){super(...e),this.name="RangeMustBeObject",this.message="Range param provided must be object.",this.status=c}}class ut extends Error{constructor(...e){super(...e),this.name="RangeMissingStart",this.message="Range param missing start.",this.status=c}}class dt extends Error{constructor(...e){super(...e),this.name="RangeMissingEnd",this.message="Range param missing end.",this.status=c}}class ht extends Error{constructor(...e){super(...e),this.name="RangeStartMustBeNumber",this.message="Range start provided must be a number.",this.status=c}}class lt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeNumber",this.message="Range end provided must be a number.",this.status=c}}class ft extends Error{constructor(...e){super(...e),this.name="RangeStartMustBeGreaterThanZero",this.message="Range start provided must be greater than 0.",this.status=c}}class mt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeGreaterThanRangeStart",this.message="Range end provided must be greater than range start.",this.status=c}}class pt extends Error{constructor(...e){super(...e),this.name="RangeEndMustBeLessThanFileSize",this.message="Range end provided must be less than file size.",this.status=c}}class wt extends Error{constructor(...e){super(...e),this.name="OperationsMissing",this.message="Operations missing.",this.status=c}}class gt extends Error{constructor(...e){super(...e),this.name="OperationsMustBeArray",this.message="Operations provided must be an array.",this.status=c}}class yt extends Error{constructor(e,...t){super(e,...t),this.name="CommandNotRecognized",this.message="Command '".concat(e,"' not recognized."),this.status=c}}class bt extends Error{constructor(...e){super(...e),this.name="OperationsConflict",this.message="Operations conflict. Only allowed 1 operation per item.",this.status=f}}class vt extends Error{constructor(e,...t){super(e,...t),this.name="OperationsExceedLimit",this.message="Operations exceed limit. Only allowed ".concat(e," operations."),this.status=c}}class Mt extends Error{constructor(...e){super(...e),this.name="UserNotVerified",this.message="User not verified. Either verify user before sharing database, or set requireVerified to false.",this.status=h}}class St extends Error{constructor(...e){super(...e),this.name="UserMustBeReverified",this.message="User must be reverified.",this.status=h}}class It extends Error{constructor(...e){super(...e),this.name="UserUnableToReceiveDatabase",this.message="User unable to receive database. User must sign in with an updated userbase-js client to be able to receive database.",this.status=h}}class Pt extends Error{constructor(...e){super(...e),this.name="VerificationMessageMissing",this.message="Verification message missing.",this.status=c}}class Et extends Error{constructor(...e){super(...e),this.name="VerificationMessageCannotBeBlank",this.message="Verification message cannot be blank.",this.status=c}}class Bt extends Error{constructor(...e){super(...e),this.name="VerificationMessageMustBeString",this.message="Verification message must be a string.",this.status=c}}class Nt extends Error{constructor(e,...t){super(e,...t),this.name="VerificationMessageInvalid",this.message="Verification message invalid.",this.status=c}}class Ut extends Error{constructor(e,...t){super(e,...t),this.name="VerifyingSelfNotAllowed",this.message="Verifying self not allowed. Can only verify other users.",this.status=c}}class At extends Error{constructor(...e){super(...e),this.name="ProgressHandlerMustBeFunction",this.message="Progress handler must be a function.",this.status=c}}class Tt extends Error{constructor(e,...t){super(e,...t),this.name="TransactionUnauthorized",this.message="Calling '".concat(e,"' on this item is unauthorized."),this.status=h}}class kt extends Error{constructor(e,...t){super(e,...t),this.name="WriteAccessParamNotAllowed",this.message="Write access parameter not allowed. Only the item creator or database owner can change an item's write access settings.",this.status=h}}var Dt={DatabaseNameMissing:oe,DatabaseNameCannotBeBlank:ce,DatabaseNameMustBeString:ue,DatabaseNameTooLong:de,DatabaseNameRestricted:he,DatabaseNotFound:ye,DatabaseIsReadOnly:be,DatabaseAlreadyOpening:le,DatabaseIdMustBeString:ve,DatabaseIdCannotBeBlank:Me,DatabaseIdNotAllowed:Se,DatabaseIdNotAllowedForOwnDatabase:Ie,DatabaseIdInvalidLength:Pe,ShareTokenInvalid:Ee,ShareTokenNotFound:Be,ShareTokenNotAllowed:Ne,ShareTokenNotAllowedForOwnDatabase:Ue,ReadOnlyMustBeBoolean:Ae,ReadOnlyParamNotAllowed:Te,ResharingAllowedMustBeBoolean:De,ResharingNotAllowed:Ke,ResharingWithWriteAccessNotAllowed:xe,ResharingAllowedParamNotAllowed:ke,SharingWithSelfNotAllowed:Re,ModifyingOwnPermissionsNotAllowed:Oe,ModifyingOwnerPermissionsNotAllowed:Ce,ModifyingPermissionsNotAllowed:_e,GrantingWriteAccessNotAllowed:Fe,RequireVerifiedMustBeBoolean:Le,RequireVerifiedParamNotNecessary:je,RevokeMustBeBoolean:qe,ChangeHandlerMissing:fe,ChangeHandlerMustBeFunction:me,EncryptionModeNotValid:pe,ServerSideEncryptionNotEnabledInClient:we,DatabaseNotOpen:ge,ItemMissing:Ve,ItemInvalid:He,ItemTooLarge:Ge,ItemIdMustBeString:Je,ItemIdTooLong:We,ItemIdMissing:Ye,ItemIdCannotBeBlank:ze,ItemAlreadyExists:Ze,ItemDoesNotExist:Xe,ItemUpdateConflict:Qe,FileMissing:$e,FileMustBeFile:et,FileCannotBeEmpty:tt,FileUploadConflict:st,FileNotFound:at,FileIdMissing:rt,FileIdMustBeString:nt,FileIdCannotBeBlank:it,FileIdTooLong:ot,RangeMustBeObject:ct,RangeMissingStart:ut,RangeMissingEnd:dt,RangeStartMustBeNumber:ht,RangeEndMustBeNumber:lt,RangeStartMustBeGreaterThanZero:ft,RangeEndMustBeGreaterThanRangeStart:mt,RangeEndMustBeLessThanFileSize:pt,OperationsMissing:wt,OperationsMustBeArray:gt,OperationsConflict:bt,OperationsExceedLimit:vt,CommandNotRecognized:yt,UserNotVerified:Mt,UserMustBeReverified:St,UserUnableToReceiveDatabase:It,VerificationMessageMissing:Pt,VerificationMessageMustBeString:Bt,VerificationMessageCannotBeBlank:Et,VerificationMessageInvalid:Nt,VerifyingSelfNotAllowed:Ut,ProgressHandlerMustBeFunction:At,TransactionUnauthorized:Tt,WriteAccessParamNotAllowed:kt};class Kt extends Error{constructor(e,...t){super(e,...t),this.name="AppIdAlreadySet",this.message="Application ID already set.",this.status=f,this.appId=e}}class xt extends Error{constructor(...e){super(...e),this.name="AppIdMustBeString",this.message="Application ID must be a string.",this.status=c}}class Rt extends Error{constructor(...e){super(...e),this.name="AppIdMissing",this.message="Application ID missing.",this.status=c}}class Ot extends Error{constructor(...e){super(...e),this.name="AppIdCannotBeBlank",this.message="Application ID cannot be blank.",this.status=c}}class Ct extends Error{constructor(...e){super(...e),this.name="WebCryptoUnavailable",this.message="The WebCrypto API is unavailable. Please make sure your website uses https.",this.status=c}}class _t extends Error{constructor(...e){super(...e),this.name="UpdateUserHandlerMustBeFunction",this.message="Update user handler must be a function.",this.status=c}}var Ft={AppIdAlreadySet:Kt,AppIdMustBeString:xt,AppIdMissing:Rt,AppIdCannotBeBlank:Ot,WebCryptoUnavailable:Ct,UpdateUserHandlerMustBeFunction:_t};class Lt extends Error{constructor(...e){super(...e),this.name="SuccessUrlMissing",this.message="Success url missing to let Stripe know where to redirect users on successful payment.",this.status=c}}class jt extends Error{constructor(...e){super(...e),this.name="SuccessUrlMustBeString",this.message="Success url must be a string.",this.status=c}}class qt extends Error{constructor(e,...t){super(e,...t),this.name="SuccessUrlInvalid",this.message=e?"Success url must start with http or https.":"Success url invalid.",this.status=c}}class Vt extends Error{constructor(...e){super(...e),this.name="CancelUrlMissing",this.message="Cancel url missing to let Stripe know where to redirect users on canceled payment.",this.status=c}}class Ht extends Error{constructor(...e){super(...e),this.name="CancelUrlMustBeString",this.message="Cancel url must be a string.",this.status=c}}class Gt extends Error{constructor(e,...t){super(e,...t),this.name="CancelUrlInvalid",this.message=e?"Cancel url must start with http or https.":"Cancel url invalid.",this.status=c}}class Jt extends Error{constructor(...e){super(...e),this.name="StripeLibraryMissing",this.message="Stripe.js library missing. Be sure to include the script in your html file (https://stripe.com/docs/stripe-js#setup).",this.status=c}}class Wt extends Error{constructor(...e){super(...e),this.name="PaymentsDisabled",this.message="Payments on this app are disabled. Enable payments in the admin panel.",this.status=h}}class Yt extends Error{constructor(...e){super(...e),this.name="PriceIdOrPlanIdAllowed",this.message="Only one of priceId or planId allowed.",this.status=c}}class zt extends Error{constructor(...e){super(...e),this.name="PriceIdOrPlanIdMissing",this.message="Please provide a priceId or planId. You can create a product in the Stripe dashboard and find its priceId there.",this.status=c}}class Zt extends Error{constructor(...e){super(...e),this.name="SubscriptionPlanAlreadyPurchased",this.message="Subscription plan already purchased. Cancel subscription to purchase another.",this.status=f}}class Xt extends Error{constructor(...e){super(...e),this.name="StripeAccountNotConnected",this.message="Stripe account not connected. Connect a Stripe account in the admin panel.",this.status=h}}class Qt extends Error{constructor(...e){super(...e),this.name="SubscriptionNotFound",this.message="Subscription not found. User must purchase a subscription.",this.status=d}}class $t extends Error{constructor(e,...t){super(...t),this.name="SubscriptionInactive",this.message="The user's subscription is inactive.",this.subscriptionStatus=e,this.status=d}}class es extends Error{constructor(...e){super(...e),this.name="SubscriptionNotPurchased",this.message="Subscription not purchased. User must purchase a subscription.",this.status=d}}class ts extends Error{constructor(...e){super(...e),this.name="SubscriptionAlreadyCanceled",this.message="Subscription already canceled. User must purchase a new subscription.",this.status=c}}class ss extends Error{constructor(...e){super(...e),this.name="TrialExpired",this.message="Trial expired. User must purchase a subscription.",this.status=d}}class as extends Error{constructor(e,...t){super(e,...t);const{status:s,type:a,message:r}=e;this.name="StripeError",this.message=r,this.type=a,this.status=s}}var rs={SuccessUrlMissing:Lt,SuccessUrlMustBeString:jt,SuccessUrlInvalid:qt,CancelUrlMissing:Vt,CancelUrlMustBeString:Ht,CancelUrlInvalid:Gt,StripeJsLibraryMissing:Jt,PaymentsDisabled:Wt,PriceIdOrPlanIdAllowed:Yt,PriceIdOrPlanIdMissing:zt,SubscriptionPlanAlreadyPurchased:Zt,StripeAccountNotConnected:Xt,SubscriptionNotFound:Qt,SubscriptionInactive:$t,SubscriptionNotPurchased:es,SubscriptionAlreadyCanceled:ts,TrialExpired:ss,StripeError:as};function ns(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function is(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ns(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class os extends Error{constructor(...e){super(...e),this.name="AppIdNotSet",this.message="App ID not set yet. Make sure to configure app ID.",this.status=c}}class cs extends Error{constructor(...e){super(...e),this.name="ServiceUnavailable",this.message="Service unavailable.",this.status=w}}class us extends Error{constructor(...e){super(...e),this.name="ParamsMustBeObject",this.message="Parameters passed to function must be placed inside an object.",this.status=c}}class ds extends Error{constructor(e,...t){super(e,...t);const s=Math.floor(e/1e3);this.name="TooManyRequests",this.message="Too many requests in a row. Please try again in ".concat(s," second").concat(1!==s?"s":"","."),this.status=m}}var hs=is(is(is(is(is({},ie),Dt),Ft),rs),{},{AppIdNotSet:os,InternalServerError:class extends cs{constructor(...e){super(...e),this.status=p}},ServiceUnavailable:cs,Timeout:class extends cs{constructor(...e){super(...e),this.status=g}},Reconnecting:class extends cs{constructor(...e){super(...e),this.message="Reconnecting."}},UnknownServiceUnavailable:class extends cs{constructor(e,...t){super(e,...t),console.error("Userbase error. Please report this to support@userbase.com.\n\n",e)}},ParamsMustBeObject:us,TooManyRequests:ds});let ls=null,fs=null,ms=!1;var ps="2.8.0",ws=()=>{if(!ls)throw new hs.AppIdNotSet;return ls},gs=()=>fs,ys=()=>window._userbaseEndpoint||"https://v1.userbase.com/v1",bs=({appId:e,updateUserHandler:t,allowServerSideEncryption:s})=>{if(ls&&ls!==e)throw new hs.AppIdAlreadySet(ls);ls=e,fs=t,ms=s},vs=e=>e?window._USERBASE_STRIPE_PRODUCTION_PUBLISHABLE_KEY||"pk_live_jI6lbsAIQlu2u4uTkDXFrSEW":window._USERBASE_STRIPE_TEST_PUBLISHABLE_KEY||"pk_test_rYANrLdNfdJXJ2d808wW4pqY",Ms=()=>ms;class Ss extends Error{constructor(e,t,s,...a){super(e,t,s,...a),this.response={data:e,status:t,statusText:s},this.message="Request failed with status code "+t}}class Is extends Error{constructor(e,...t){super(e,...t),this.message="timeout of ".concat(e,"ms exceeded")}}const Ps=(e,t,s,a=1e4)=>{e.timeout=a,e.onload=()=>((e,t,s)=>{let a;try{a=JSON.parse(e.response)}catch(t){a=e.response}e.status>=200&&e.status<300?t(a):s(new Ss(a,e.status,e.statusText))})(e,t,s),e.onerror=()=>s(new hs.ServiceUnavailable),e.ontimeout=()=>s(new Is(a))};var Es=(e,t,s,a,r,n,i,o,c)=>new Promise((u,d)=>{const h=new XMLHttpRequest,l="".concat(ys(),"/api/auth/sign-up?appId=").concat(ws(),"&userbaseJsVersion=").concat(ps),f=JSON.stringify({username:e,passwordToken:t,ecKeyData:s,passwordSalts:a,keySalts:r,email:n,profile:i,passwordBasedBackup:o,sessionLength:c});h.open("POST",l),h.setRequestHeader("Content-Type","application/json"),h.send(f),Ps(h,u,d)}),Bs=e=>new Promise((t,s)=>{const a=new XMLHttpRequest,r="".concat(ys(),"/api/auth/get-password-salts?appId=").concat(ws(),"&username=").concat(encodeURIComponent(e),"&userbaseJsVersion=").concat(ps);a.open("GET",r),a.send(),Ps(a,t,s)}),Ns=async(e,t,s)=>new Promise((a,r)=>{const n=new XMLHttpRequest,i="".concat(ys(),"/api/auth/sign-in?appId=").concat(ws(),"&userbaseJsVersion=").concat(ps),o=JSON.stringify({username:e,passwordToken:t,sessionLength:s});n.open("POST",i),n.setRequestHeader("Content-Type","application/json"),n.send(o),Ps(n,a,r)}),Us=(e,t)=>new Promise((s,a)=>{const r=new XMLHttpRequest,n="".concat(ys(),"/api/auth/sign-in-with-session?appId=").concat(ws(),"&sessionId=").concat(e,"&userbaseJsVersion=").concat(ps),i=JSON.stringify({sessionLength:t});r.open("POST",n),r.setRequestHeader("Content-Type","application/json"),r.send(i),Ps(r,s,a)}),As=async()=>new Promise((e,t)=>{const s=new XMLHttpRequest,a="".concat(ys(),"/api/auth/server-public-key?&userbaseJsVersion=").concat(ps);s.open("GET",a),s.responseType="arraybuffer",s.send(),Ps(s,e,t)}),Ts=e=>new Promise((t,s)=>{const a=new XMLHttpRequest,r="".concat(ys(),"/api/public-key?appId=").concat(ws(),"&username=").concat(encodeURIComponent(e),"&userbaseJsVersion=").concat(ps);a.open("GET",r),a.send(),Ps(a,t,s)}),ks=s(2),Ds=s.n(ks);function Ks(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function xs(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ks(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ks(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const Rs=e=>(...t)=>{try{return e(...t)}catch(e){console.warn("Error accessing browser storage. Defaulting to memory.\n\n",e)}},Os=(e,t)=>"userbaseSeed.".concat(e,".").concat(t),Cs=Rs((e,t,s,a,r,n)=>{const i={username:t,signedIn:s,sessionId:a,creationDate:r,expirationDate:n},o=JSON.stringify(i);"local"===e?localStorage.setItem("userbaseCurrentSession",o):"session"===e&&sessionStorage.setItem("userbaseCurrentSession",o)});var _s={signInSession:(e,t,s,a,r)=>{Cs(e,t,!0,s,a,r)},signOutSession:(e,t)=>{Cs(e,t,!1)},getCurrentSession:Rs(()=>{const e=sessionStorage.getItem("userbaseCurrentSession");if(e){if(!JSON.parse(e).signedIn){const e=localStorage.getItem("userbaseCurrentSession");if(e){const t=JSON.parse(e);if(t.signedIn)return xs(xs({},t),{},{rememberMe:"local"})}}return xs(xs({},JSON.parse(e)),{},{rememberMe:"session"})}const t=localStorage.getItem("userbaseCurrentSession");return t&&xs(xs({},JSON.parse(t)),{},{rememberMe:"local"})}),saveSeedString:Rs((e,t,s,a)=>{"local"===e?localStorage.setItem(Os(t,s),a):"session"===e&&sessionStorage.setItem(Os(t,s),a)}),removeSeedString:Rs((e,t)=>{const s=Os(e,t);sessionStorage.removeItem(s),localStorage.removeItem(s)}),getSeedString:Rs((e,t)=>{const s=Os(e,t);return sessionStorage.getItem(s)||localStorage.getItem(s)}),removeCurrentSession:Rs(()=>{sessionStorage.removeItem("userbaseCurrentSession"),localStorage.removeItem("userbaseCurrentSession")})};const Fs=(e,t)=>{const s=t?new Uint8Array(e):new Uint16Array(e),a=s.length;let r="",n=10240;for(var i=0;i<a;i+=n){i+n>a&&(n=a-i);const e=s.subarray(i,i+n);r+=String.fromCharCode.apply(null,e)}return r},Ls=(e,t=!1)=>{let s=new ArrayBuffer(e.length*(t?1:2)),a=t?new Uint8Array(s):new Uint16Array(s);for(let t=0,s=e.length;t<s;t++)a[t]=e.charCodeAt(t);return s},js=(e,t)=>{const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s.buffer},qs=async e=>await window.crypto.subtle.digest({name:"SHA-256"},e);var Vs={BYTE_SIZE:32,HASH_ALGORITHM_NAME:"SHA-256",hash:qs,hashBase64String:async e=>{const t=i.a.decode(e),s=await qs(t);return i.a.encode(s)},hashString:async e=>{const t=Ls(e),s=await qs(t);return i.a.encode(s)}};const Hs=["deriveKey","deriveBits"],Gs=async e=>await window.crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,Hs),Js=Vs.BYTE_SIZE,Ws=(e,t)=>({name:"HKDF",info:Ls(e),hash:Vs.HASH_ALGORITHM_NAME,salt:t});var Ys={importHkdfKeyFromString:async e=>{const t=Ls(e);return await Gs(t)},importHkdfKey:Gs,generateSalt:()=>window.crypto.getRandomValues(new Uint8Array(Js)),getParams:Ws,getPasswordToken:async(e,t)=>{const s=await window.crypto.subtle.deriveBits(Ws("password-token",t),e,256);return i.a.encode(s)}};const zs=["encrypt","decrypt"],Zs=()=>"undefined"!=typeof window?window:self,Xs=()=>({name:"AES-GCM",length:256}),Qs=e=>({name:"AES-GCM",tagLength:128,iv:e}),$s=()=>window.crypto.getRandomValues(new Uint8Array(12)),ea=e=>{const t=e.byteLength-12;return{ciphertextArrayBuffer:e.slice(0,t),iv:e.slice(t)}},ta=async()=>await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,zs),sa=async e=>await Zs().crypto.subtle.importKey("raw",e,{name:"AES-GCM"},!0,zs),aa=async e=>await Zs().crypto.subtle.exportKey("raw",e),ra=async(e,t)=>{const s=$s(),a=await Zs().crypto.subtle.encrypt(Qs(s),e,t);return js(a,s)},na=async(e,t)=>{const s=Ls(t),a=await ra(e,s);return i.a.encode(a)},ia=async(e,t)=>{const{ciphertextArrayBuffer:s,iv:a}=ea(t);return await Zs().crypto.subtle.decrypt(Qs(a),e,s)},oa=async(e,t)=>{const s=i.a.decode(t),a=await ia(e,s);return Fs(a)};var ca={getEncryptionKeyParams:Xs,getCiphertextParams:Qs,generateIv:$s,sliceEncryptedArrayBuffer:ea,importKeyFromMaster:async(e,t,s="encryption")=>await window.crypto.subtle.deriveKey(Ys.getParams(s,t),e,{name:"AES-GCM",length:256},!0,zs),generateKey:ta,getKeyStringFromKey:async e=>{const t=await window.crypto.subtle.exportKey("raw",e);return i.a.encode(t)},getKeyFromKeyString:async e=>{const t=i.a.decode(e);return await sa(t)},getRawKeyFromKey:aa,getKeyFromRawKey:sa,encrypt:ra,encryptJson:async(e,t)=>{const s=JSON.stringify(t);return await na(e,s)},encryptString:na,decrypt:ia,decryptJson:async(e,t)=>{const s=await oa(e,t);return JSON.parse(s)},decryptString:oa,getPasswordBasedEncryptionKey:async(e,t)=>await window.crypto.subtle.deriveKey(Ys.getParams("password-based-encryption",t),e,{name:"AES-GCM",length:256},!1,zs),generateAndEncryptKeyEncryptionKey:async e=>{const t=await ta(),s=await aa(t);return[t,await ra(e,s)]},RAW_KEY_TYPE:"raw",KEY_WILL_BE_USED_TO:zs},ua=s(10),da=s.n(ua);const ha=["encrypt"],la=(e=>{if(e.length%2!=0)throw new Error("Hex string must be even length");const t=e.length/2,s=[];for(let a=0;a<t;a++){const t=2*a,r=e.substring(t,t+2),n=parseInt(r,16);s.push(n)}return new Uint8Array(s)})("ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"),fa=[2];let ma=null;const pa=e=>((e,t)=>(e.setPrivateKey(t),e.generateKeys(),e))(da.a.createDiffieHellman(la,fa),e),wa=async(e,t)=>{const s=pa(e).computeSecret(t),a=await Vs.hash(s);return await ca.getKeyFromRawKey(a)};var ga={getPublicKey:e=>pa(e).getPublicKey(),getSharedKey:wa,getSharedKeyWithServer:async e=>await wa(e,new Uint8Array(await(async()=>ma||(ma=await As(),ma))())),importKeyFromMaster:async(e,t)=>{const s=await window.crypto.subtle.deriveKey(Ys.getParams("diffie-hellman",t),e,ca.getEncryptionKeyParams(),!0,ha);return await ca.getRawKeyFromKey(s)}};const ya=["sign","verify"],ba=["sign"],va=["verify"],Ma={name:"ECDSA",namedCurve:"P-256"},Sa={name:"ECDSA",hash:{name:Vs.HASH_ALGORITHM_NAME}},Ia=async e=>await window.crypto.subtle.exportKey("spki",e),Pa=async e=>{const t=await Ia(e);return i.a.encode(t)},Ea=async(e,t)=>await ca.importKeyFromMaster(e,t,"ecdsa-key-encryption-key"),Ba=async(e,t)=>await window.crypto.subtle.sign(Sa,e,t),Na=async(e,t,s)=>await window.crypto.subtle.verify(Sa,e,t,s);var Ua={generateEcdsaKeyData:async e=>{const t=await(async()=>await window.crypto.subtle.generateKey(Ma,!0,ya))(),s=Ys.generateSalt(),a=await Ea(e,s),r=await(async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);return Ls(JSON.stringify(t))})(t.privateKey),n=await ca.encrypt(a,r);return{ecdsaPrivateKey:t.privateKey,ecdsaPublicKey:await Pa(t.publicKey),encryptedEcdsaPrivateKey:i.a.encode(n),ecdsaKeyEncryptionKeySalt:i.a.encode(s)}},importEcdsaKeyEncryptionKeyFromMaster:Ea,getPrivateKeyFromRawPrivateKey:async e=>{const t=JSON.parse(Fs(e));return await window.crypto.subtle.importKey("jwk",t,Ma,!0,ba)},getPublicKeyFromRawPublicKey:async e=>await window.crypto.subtle.importKey("spki",e,Ma,!0,va),getRawPublicKeyFromPublicKey:Ia,getPublicKeyStringFromPublicKey:Pa,getPublicKeyFromPrivateKey:async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);delete t.d,t.key_ops=va;return await window.crypto.subtle.importKey("jwk",t,Ma,!0,va)},sign:Ba,signString:async(e,t)=>{const s=Ls(t),a=await Ba(e,s);return i.a.encode(a)},verify:Na,verifyString:async(e,t,s)=>{const a=Ls(s),r=i.a.decode(t);return await Na(e,r,a)}};const Aa=["deriveKey","deriveBits"],Ta={name:"ECDH",namedCurve:"P-256"},ka=async()=>await window.crypto.subtle.generateKey(Ta,!0,Aa),Da=async e=>await window.crypto.subtle.exportKey("spki",e),Ka=async(e,t)=>await ca.importKeyFromMaster(e,t,"ecdh-key-encryption-key");var xa={generateKeyPair:ka,generateEcdhKeyData:async(e,t)=>{const s=await ka(),a=Ys.generateSalt(),r=await Ka(e,a),n=await(async e=>{const t=await window.crypto.subtle.exportKey("jwk",e);return Ls(JSON.stringify(t))})(s.privateKey),o=await ca.encrypt(r,n),c=await Da(s.publicKey),u=await Ua.sign(t,c);return{ecdhPrivateKey:s.privateKey,ecdhPublicKey:i.a.encode(c),encryptedEcdhPrivateKey:i.a.encode(o),signedEcdhPublicKey:i.a.encode(u),ecdhKeyEncryptionKeySalt:i.a.encode(a)}},importEcdhKeyEncryptionKeyFromMaster:Ka,getPrivateKeyFromRawPrivateKey:async e=>{const t=JSON.parse(Fs(e));return await window.crypto.subtle.importKey("jwk",t,Ta,!0,Aa)},getRawPublicKeyFromPublicKey:Da,getPublicKeyFromRawPublicKey:async e=>await window.crypto.subtle.importKey("spki",e,Ta,!0,[]),computeSharedKeyEncryptionKey:async(e,t)=>await window.crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:e},t,ca.getEncryptionKeyParams(),!1,ca.KEY_WILL_BE_USED_TO)};const Ra=["sign"],Oa=["sign","verify"],Ca=async(e,t)=>await window.crypto.subtle.sign({name:"HMAC"},e,t);var _a={importKeyFromMaster:async(e,t)=>await window.crypto.subtle.deriveKey(Ys.getParams("authentication",t),e,{name:"HMAC",hash:{name:Vs.HASH_ALGORITHM_NAME},length:512},!1,Ra),importKeyFromRawBits:async e=>await window.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:Vs.HASH_ALGORITHM_NAME},length:256},!1,Oa),sign:Ca,signString:async(e,t)=>{const s=await Ca(e,Ls(t));return i.a.encode(s)}},Fa=s(11),La=s.n(Fa);var ja={generateSeed:()=>window.crypto.getRandomValues(new Uint8Array(32)),aesGcm:ca,diffieHellman:ga,ecdsa:Ua,ecdh:xa,sha256:Vs,hmac:_a,hkdf:Ys,scrypt:{generateSalt:()=>window.crypto.getRandomValues(new Uint8Array(16)),hash:async(e,t,s=La.a.scrypt)=>{const a=new Uint8Array(Ls(e)),r=await s(a,t,16384,8,1,32);return i.a.encode(r)}}};const qa=e=>e.split(":")[0],Va=e=>{const t=(e=>"http://"===e.substring(0,"http://".length)?e.substring("http://".length):"https://"===e.substring(0,"https://".length)?e.substring("https://".length):e)(e);return("https"===qa(e)?"wss://":"ws://")+t},Ha=e=>2*e.length,Ga=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function Ja(){let e=[],t=0;this.getLength=()=>e.length-t,this.isEmpty=()=>0===e.length,this.enqueue=t=>(e.push(t),this.getLength()),this.dequeue=()=>{const s=e[t];return t+=1,2*t>e.length&&(e=e.slice(t),t=0),s},this.peek=()=>e[t]}const Wa=()=>{const e=URL.createObjectURL(new Blob(["(",function(){self.onmessage=function(e){const{compress:t,decompress:s,data:a}=e.data,r=function(){function e(e,t){if(!r[e]){r[e]={};for(var s=0;s<e.length;s++)r[e][e.charAt(s)]=s}return r[e][t]}var t=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},n={compressToBase64:function(e){if(null==e)return"";var t=n._compress(e,6,(function(e){return s.charAt(e)}));switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,(function(a){return e(s,t.charAt(a))}))},compressToUTF16:function(e){return null==e?"":n._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=n.compress(e),s=new Uint8Array(2*t.length),a=0,r=t.length;r>a;a++){var i=t.charCodeAt(a);s[2*a]=i>>>8,s[2*a+1]=i%256}return s},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var s=new Array(e.length/2),a=0,r=s.length;r>a;a++)s[a]=256*e[2*a]+e[2*a+1];var i=[];return s.forEach((function(e){i.push(t(e))})),n.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,(function(e){return a.charAt(e)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,(function(s){return e(a,t.charAt(s))})))},compress:function(e){return n._compress(e,16,(function(e){return t(e)}))},_compress:function(e,t,s){if(null==e)return"";var a,r,n,i={},o={},c="",u="",d="",h=2,l=3,f=2,m=[],p=0,w=0;for(n=0;n<e.length;n+=1)if(c=e.charAt(n),Object.prototype.hasOwnProperty.call(i,c)||(i[c]=l++,o[c]=!0),u=d+c,Object.prototype.hasOwnProperty.call(i,u))d=u;else{if(Object.prototype.hasOwnProperty.call(o,d)){if(d.charCodeAt(0)<256){for(a=0;f>a;a++)p<<=1,w==t-1?(w=0,m.push(s(p)),p=0):w++;for(r=d.charCodeAt(0),a=0;8>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}else{for(r=1,a=0;f>a;a++)p=p<<1|r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r=0;for(r=d.charCodeAt(0),a=0;16>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}0==--h&&(h=Math.pow(2,f),f++),delete o[d]}else for(r=i[d],a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;0==--h&&(h=Math.pow(2,f),f++),i[u]=l++,d=String(c)}if(""!==d){if(Object.prototype.hasOwnProperty.call(o,d)){if(d.charCodeAt(0)<256){for(a=0;f>a;a++)p<<=1,w==t-1?(w=0,m.push(s(p)),p=0):w++;for(r=d.charCodeAt(0),a=0;8>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}else{for(r=1,a=0;f>a;a++)p=p<<1|r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r=0;for(r=d.charCodeAt(0),a=0;16>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1}0==--h&&(h=Math.pow(2,f),f++),delete o[d]}else for(r=i[d],a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(r=2,a=0;f>a;a++)p=p<<1|1&r,w==t-1?(w=0,m.push(s(p)),p=0):w++,r>>=1;for(;;){if(p<<=1,w==t-1){m.push(s(p));break}w++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(e,s,a){var r,n,i,o,c,u,d,h=[],l=4,f=4,m=3,p="",w=[],g={val:a(0),position:s,index:1};for(r=0;3>r;r+=1)h[r]=r;for(i=0,c=Math.pow(2,2),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;switch(i){case 0:for(i=0,c=Math.pow(2,8),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;d=t(i);break;case 1:for(i=0,c=Math.pow(2,16),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;d=t(i);break;case 2:return""}for(h[3]=d,n=d,w.push(d);;){if(g.index>e)return"";for(i=0,c=Math.pow(2,m),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;switch(d=i){case 0:for(i=0,c=Math.pow(2,8),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;h[f++]=t(i),d=f-1,l--;break;case 1:for(i=0,c=Math.pow(2,16),u=1;u!=c;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=s,g.val=a(g.index++)),i|=(o>0?1:0)*u,u<<=1;h[f++]=t(i),d=f-1,l--;break;case 2:return w.join("")}if(0==l&&(l=Math.pow(2,m),m++),h[d])p=h[d];else{if(d!==f)return null;p=n+n.charAt(0)}w.push(p),h[f++]=n+p.charAt(0),n=p,0==--l&&(l=Math.pow(2,m),m++)}}};return n}();t?postMessage(r.compress(a)):s&&postMessage(r.decompress(a))}}.toString(),")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t},Ya=async e=>{const t=Wa();return new Promise(s=>{t.onmessage=e=>{s(e.data),t.terminate()},t.postMessage({compress:!0,data:e})})},za=async e=>{const t=Wa();return new Promise(s=>{t.onmessage=e=>{s(e.data),t.terminate()},t.postMessage({decompress:!0,data:e})})},Za=async(e,t,s,a,r,n)=>new Promise((i,o)=>{const c=new XMLHttpRequest,u="".concat(ys(),"/api/bundle-chunk?userbaseJsVersion=").concat(ps,"&")+"userId=".concat(e,"&")+"databaseId=".concat(t,"&")+"seqNo=".concat(s,"&")+"bundleId=".concat(a,"&")+"chunkNumber=".concat(r);c.open("POST",u),c.send(new Uint8Array(n)),Ps(c,i,o,3e4)});function Xa(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Qa(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Xa(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Xa(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const $a=Ds()();class er extends Error{constructor(e,t,...s){super(...s),this.name="RequestFailed: ".concat(e),this.message=t.message,this.status=t.status||"timeout"===t.message&&g,this.response=t.status&&t}}class tr extends Error{constructor(e,t,s,...a){super(...a),this.name="WebSocket error",this.message=e,this.username=t,this.e=s}}var sr=new class{constructor(){this.init()}init(e,t,s,a,r,n,i,o){this.pingTimeout&&clearTimeout(this.pingTimeout);for(const e of Object.keys(this))delete this[e];this.ws=null,this.connected=!1,this.resolveConnection=e,this.rejectConnection=t,this.connectionResolved=!1,this.session={username:s&&s.username,sessionId:s&&s.sessionId,creationDate:s&&s.creationDate,expirationDate:s&&s.expirationDate,userId:s&&s.userId,authToken:s&&s.authToken},this.seedString=a,this.changePassword=n,this.keys={init:!1,salts:{}},this.userData={stripeData:{}},this.rememberMe=r,this.requests={},this.state=i||{dbNameToHash:{},databases:{},databasesByDbId:{},shareTokenIdToDbId:{}},this.encryptionMode=o}connect(e,t=null,s,a,r,n){if(this.connected)throw new tr("Web Socket already connected",this.session.username);return new Promise((i,c)=>{let u=!1;const d=setTimeout(()=>{this.connected||this.reconnecting||(u=!0,c(new tr("timeout")))},1e4),h="".concat(Va(ys()),"/api?appId=").concat(ws(),"&sessionId=").concat(e.sessionId,"&clientId=").concat($a,"&userbaseJsVersion=").concat(ps),l=new WebSocket(h);l.onopen=async()=>{u||clearTimeout(d)},l.onmessage=async r=>{if(!u)try{const u=JSON.parse(r.data);switch(u.route){case"Ping":{this.heartbeat();const e="Pong";this.ws.send(JSON.stringify({action:e}));break}case"Connection":{const{encryptionMode:o}=u;if(this.init(i,c,e,t,s,a,n,o),this.ws=l,this.heartbeat(),this.connected=!0,t){const{keySalts:e,validationMessage:t,ecKeyData:s,encryptedValidationMessage:a}=u;this.keys.salts=e,this.validationMessage=t,this.ecKeyData=s,a&&(this.encryptedValidationMessage=new Uint8Array(a.data));try{await this.setKeys(this.seedString);const e=await this.validateKey();this.userData=e}catch(r){throw r&&"OperationError"===r.name||r instanceof DOMException?new Error("Invalid seed"):r}this.keys.init=!0}this.resolveConnection(),this.connectionResolved=!0;break}case"ApplyTransactions":{const e=u.dbId,t=u.dbNameHash,s=u.isOwner?this.state.databases[t]:this.state.databasesByDbId[e];if(!s)throw new Error("Missing database");s.applyTransactionsQueue.isEmpty()?s.applyTransactionsQueue.enqueue(null):await new Promise(e=>{const t=e;s.applyTransactionsQueue.enqueue(t)});if((u.dbNameHash&&(u.dbKey||u.plaintextDbKey)||u.shareTokenEncryptedDbKey)&&(!s.dbKeyString||!s.dbKey)){const e=u.plaintextDbKey||(u.dbKey?await ja.aesGcm.decryptString(this.keys.encryptionKey,u.dbKey):await s.decryptShareTokenEncryptedDbKey(u.shareTokenEncryptedDbKey,u.shareTokenEncryptionKeySalt));s.dbKeyString=e,s.dbKey=await ja.aesGcm.getKeyFromKeyString(e)}if(!s.dbKey)throw new Error("Missing db key");if(u.writers){s.attributionEnabled=!0;for(const{userId:e,username:t}of u.writers)s.usernamesByUserId.set(e,t)}if(u.waitForFullBundle){s.finishedWaitingForBundle||await new Promise(e=>s.finishedWaitingForBundle=e);try{const e=await this.rebuildBundle(s,u.bundleSeqNo,u.encryptedBundleEncryptionKey);await s.applyBundle(e,u.bundleSeqNo)}catch(r){throw window.alert("Oops! Something went wrong. Please contact the site administrator with this issue (".concat(e,").\n\n")+r),r}}const a=u.transactionLog;if(await s.applyTransactions(a,u.ownerId,e,t),u.buildBundle&&this.buildBundle(s),s.applyTransactionsQueue.dequeue(),!s.applyTransactionsQueue.isEmpty()){s.applyTransactionsQueue.peek()()}break}case"DownloadBundleChunk":{const{dbId:e,dbNameHash:t,isOwner:s,bundleSeqNo:a,isFirstChunk:r,isLastChunk:n,chunk:i}=u,o=s?this.state.databases[t]:this.state.databasesByDbId[e];if(!o)throw new Error("Missing database");r&&(o.bundleChunks[a]=[]),o.bundleChunks[a].push(i),n&&(o.finishedWaitingForBundle?o.finishedWaitingForBundle():o.finishedWaitingForBundle=!0);break}case"UpdatedUser":this.handleUpdateUser(u.updatedUser);break;case"SignOut":case"UpdateUser":case"DeleteUser":case"CreateDatabase":case"OpenDatabase":case"OpenDatabaseByDatabaseId":case"GetDatabases":case"GetDatabaseUsers":case"Insert":case"Update":case"Delete":case"BatchTransaction":case"InitBundleUpload":case"CompleteBundleUpload":case"GenerateFileId":case"UploadFileChunk":case"CompleteFileUpload":case"GetChunk":case"ValidateKey":case"GetPasswordSalts":case"PurchaseSubscription":case"CancelSubscription":case"ResumeSubscription":case"UpdatePaymentMethod":case"ShareDatabase":case"ShareDatabaseToken":case"AuthenticateShareToken":case"SaveDatabase":case"ModifyDatabasePermissions":case"VerifyUser":{const e=u.requestId;if(!e)return console.warn("Missing request id");const t=this.requests[e];if(!t)return console.warn("Request ".concat(e," no longer exists!"));if(!t.promiseResolve||!t.promiseReject)return;const s=u.response;return s&&s.status===o?t.promiseResolve(s):t.promiseReject(s)}default:console.log("Received unknown message from backend:"+JSON.stringify(u))}}catch(r){this.connectionResolved?console.warn("Error handling message: ",r):(this.close(),c(new tr(r.message,e.username,r)))}},l.onclose=async o=>{if(u)return;const d=o.code===y,h=o.code===b;if(d||h||!o.wasClean){const o=d&&!r?0:r?r+1e3:1e3;this.reconnecting=!0,await this.reconnect(i,c,e,this.seedString||t,s,a,o,!this.reconnected&&n)}else o.code===v?c(new tr("Web Socket already connected",e.username,o)):this.init()},l.onerror=()=>{}})}async reconnect(e,t,s,a,r,n,i,o){try{const t=Math.min(i,3e4);console.log("Connection to server lost. Attempting to reconnect in ".concat(t/1e3," second").concat(1e3!==t?"s":"","..."));const c=[],u=[];e(await new Promise((e,d)=>setTimeout(async()=>{try{const t=o||{dbNameToHash:Qa({},this.state.dbNameToHash),databases:Qa({},this.state.databases),databasesByDbId:Qa({},this.state.databasesByDbId),shareTokenIdToDbId:Qa({},this.state.shareTokenIdToDbId)};for(const e in t.databases)t.databases[e].init=!1,t.databases[e].finishedWaitingForBundle=!1,c.push(e);for(const e in t.databasesByDbId)t.databasesByDbId[e].init=!1,t.databasesByDbId[e].finishedWaitingForBundle=!1,u.push(e);this.init(),this.reconnecting=!0;const d=await this.connect(s,a,r,n,i,t);this.reconnected=!0,o||(await this.reopenDatabases(c,u,1e3),console.log("Reconnected!")),e(d)}catch(e){d(e)}},t)))}catch(e){t(e)}}async reopenDatabases(e,t,s){try{const s=[];for(const t of e){const e=this.state.databases[t];if(!e.init){const a="OpenDatabase",r={dbNameHash:t,reopenAtSeqNo:e.lastSeqNo};s.push(this.request(a,r))}}for(const e of t){const t=this.state.databasesByDbId[e];if(!t.init){const a=t.shareTokenHkdfKey,r=a?await this.authenticateShareToken(t.shareTokenId,a):{},n="OpenDatabaseByDatabaseId",i=Qa({databaseId:e,reopenAtSeqNo:t.lastSeqNo},r);s.push(this.request(n,i))}}await Promise.all(s)}catch(a){await new Promise(a=>setTimeout(async()=>{await this.reopenDatabases(e,t,s+1e3),a()},Math.min(s,3e4)))}}heartbeat(){clearTimeout(this.pingTimeout);this.pingTimeout=setTimeout(()=>{this.ws&&this.ws.close(b)},33e3)}close(e){this.ws?this.ws.close(e):this.init()}async signOut(){const e=this.session.username,t=this.connectionResolved,s=this.rejectConnection;try{_s.signOutSession(this.rememberMe,e);const a=this.session.sessionId;if(this.reconnecting)throw new hs.Reconnecting;const r="SignOut",n={sessionId:a};await this.request(r,n),this.close(),!t&&s&&s(new tr("Canceled",e))}catch(a){throw!t&&s&&s(new tr("Canceled",e)),a}}async setKeys(e){if(this.keys.init)return;if(!e)throw new tr("Missing seed",this.session.username);if(!this.keys.salts)throw new tr("Missing salts",this.session.username);this.seedString||(this.seedString=e);const t=i.a.decode(e),s=await ja.hkdf.importHkdfKey(t),a=this.keys.salts;if(this.keys.encryptionKey=await ja.aesGcm.importKeyFromMaster(s,i.a.decode(a.encryptionKeySalt)),this.keys.hmacKey=await ja.hmac.importKeyFromMaster(s,i.a.decode(a.hmacKeySalt)),a.ecdsaKeyEncryptionKeySalt){const e=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(s,i.a.decode(a.ecdsaKeyEncryptionKeySalt)),t=i.a.decode(this.ecKeyData.encryptedEcdsaPrivateKey),r=await ja.aesGcm.decrypt(e,t);this.keys.ecdsaPrivateKey=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(r);const n=await ja.ecdh.importEcdhKeyEncryptionKeyFromMaster(s,i.a.decode(a.ecdhKeyEncryptionKeySalt)),o=i.a.decode(this.ecKeyData.encryptedEcdhPrivateKey),c=await ja.aesGcm.decrypt(n,o);this.keys.ecdhPrivateKey=await ja.ecdh.getPrivateKeyFromRawPrivateKey(c)}else a.dhKeySalt&&(this.keys.dhPrivateKey=await ja.diffieHellman.importKeyFromMaster(s,i.a.decode(a.dhKeySalt)));if(a.dhKeySalt||a.ecdsaKeyWrapperSalt){const e=await ja.ecdsa.generateEcdsaKeyData(s),t=await ja.ecdh.generateEcdhKeyData(s,e.ecdsaPrivateKey);this.keys.ecdsaPrivateKey=e.ecdsaPrivateKey,this.keys.ecdhPrivateKey=t.ecdhPrivateKey,delete e.ecdsaPrivateKey,delete t.ecdhPrivateKey,this.newEcKeyData={ecdsaKeyData:e,ecdhKeyData:t}}}async validateKey(){let e;if(this.keys.ecdsaPrivateKey&&!this.keys.dhPrivateKey)e=await ja.ecdsa.sign(this.keys.ecdsaPrivateKey,i.a.decode(this.validationMessage));else if(this.keys.dhPrivateKey){const t=await ja.diffieHellman.getSharedKeyWithServer(this.keys.dhPrivateKey);e=await ja.aesGcm.decrypt(t,this.encryptedValidationMessage),delete this.keys.dhPrivateKey}const t={validationMessage:i.a.encode(e),ecKeyData:this.newEcKeyData};return(await this.request("ValidateKey",t)).data}async request(e,t){const s=Ds()();this.requests[s]={};const a=this.watch(s);this.ws.send(JSON.stringify({requestId:s,action:e,params:t}));try{return await a}catch(t){throw t.status===m?new hs.TooManyRequests(t.data.retryDelay):new er(e,t)}}async watch(e){const t=await new Promise((t,s)=>{this.requests[e].promiseResolve=t,this.requests[e].promiseReject=s,setTimeout(()=>{s(new Error("timeout"))},3e4)});return delete this.requests[e],t}async rebuildBundle(e,t,s){const a=[];for(let s=0;s<e.bundleChunks[t].length;s++){const r=e.bundleChunks[t][s],n=Ls(r);a.push(n)}const r=(e=>{const t=e.map(e=>e.byteLength),s=t.reduce((e,t)=>e+t),a=new Uint8Array(s);let r=0;for(let s=0;s<e.length;s++)a.set(new Uint8Array(e[s]),r),r+=t[s];return{buffer:a.buffer,byteLengths:t}})(a).buffer,{encrypted:n,plaintextMetadata:o}=JSON.parse(Fs(r)),c=await ja.aesGcm.decrypt(e.dbKey,i.a.decode(s)),u=await ja.aesGcm.getKeyFromRawKey(c),d=await ja.aesGcm.decrypt(u,Ls(n)),h=Fs(d),[l,f]=await Promise.all([za(h),za(o)]),m=Qa(Qa({},JSON.parse(l)),JSON.parse(f));return delete e.bundleChunks[t],m}async uploadBundle(e,t,s,a,r){let n=0,i=0,o=[];for(;n<r.byteLength;){const c=r.slice(n,n+524288);if(o.push(Za(e,t,s,a,i,c)),10===o.length){try{await Promise.all(o)}catch(e){return 0}o=[]}i+=1,n+=524288}try{await Promise.all(o)}catch(e){return 0}return i}async initBundleUpload(e,t,s){const a={dbId:e,seqNo:t};let r;try{r=await this.request("InitBundleUpload",a)}catch(e){return{}}const{bundleId:n}=r.data,[o,c]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(s);return{bundleId:n,bundleEncryptionKey:o,encryptedBundleEncryptionKey:i.a.encode(c)}}orderedItems(e,t){const s=[];for(let a=0;a<t.array.length;a++){const r=t.array[a].itemId;s.push(e[r])}return s}prepareBundle(e){const{items:t,itemsIndex:s,itemsPlaintextMetadata:a}=e;return{encrypted:JSON.stringify({items:this.orderedItems(t,s),itemsIndex:s.array}),plaintextMetadata:JSON.stringify({itemsPlaintextMetadata:this.orderedItems(a,s)})}}async buildBundle(e){const t=e.dbId,s=e.lastSeqNo,a=e.dbKey,r=this.session.userId;if(e.bundledAtSeqNo&&e.bundledAtSeqNo>=s)return;e.bundledAtSeqNo=s;const n=this.prepareBundle(e),i=e.attributionEnabled?[...e.usernamesByUserId.keys()].join(","):void 0,{bundleId:o,bundleEncryptionKey:c,encryptedBundleEncryptionKey:u}=await this.initBundleUpload(t,s,a);if(!o)return;const[d,h]=await Promise.all([Ya(n.encrypted),Ya(n.plaintextMetadata)]),l=Ls(d),f=await ja.aesGcm.encrypt(c,l);n.encrypted=Fs(f),n.plaintextMetadata=h;const m=Ls(JSON.stringify(n)),p=await this.uploadBundle(r,t,s,o,m);if(!p)return;const w={dbId:t,seqNo:s,bundleId:o,writers:i,numChunks:p,encryptedBundleEncryptionKey:u};try{await this.request("CompleteBundleUpload",w)}catch(e){return}}buildUserResult({username:e,userId:t,authToken:s,email:a,profile:r,protectedProfile:n,usedTempPassword:i,changePassword:o,passwordChanged:c,userData:u}){const d={username:e,userId:t,authToken:s};if(a&&(d.email=a),r&&(d.profile=r),n&&(d.protectedProfile=n),i&&(d.usedTempPassword=i),o&&(d.changePassword=o),c&&(d.passwordChanged=c),u){const{creationDate:e,stripeData:t}=u;if(e&&(d.creationDate=e),t){const{paymentsMode:e,subscriptionStatus:s,cancelSubscriptionAt:a,subscriptionPlanId:r,trialExpirationDate:n}=t;e&&(d.paymentsMode=e),s&&(d.subscriptionStatus=s),a&&(d.cancelSubscriptionAt=a),r&&(d.subscriptionPlanId=r),n&&(d.trialExpirationDate=n)}}return d}handleUpdateUser(e){if(this.session&&this.session.userId===e.userId){this.session.username=e.username,this.userData=e.userData;const t=gs();t&&t({user:this.buildUserResult(Qa({authToken:this.session.authToken},e))})}}async rotateKeys(e,t){const{keySalts:s,ecKeyData:a}=t,{ecdsaKeyData:r,ecdhKeyData:n}=a;s.ecdsaKeyEncryptionKeySalt=r.ecdsaKeyEncryptionKeySalt,s.ecdhKeyEncryptionKeySalt=n.ecdhKeyEncryptionKeySalt,this.keys.salts=s,this.ecKeyData=Qa(Qa({},r),n),await this.setKeys(e),this.keys.init=!0}async authenticateShareToken(e,t){const s={shareTokenId:e};let a;try{a=await this.request("AuthenticateShareToken",s)}catch(e){if(e.response&&"ShareTokenNotFound"===e.response.data)throw new hs.ShareTokenNotFound;throw e}const{databaseId:r,shareTokenAuthKeyData:n,validationMessage:o}=a.data;let c;try{const e=i.a.decode(n.shareTokenEcdsaKeyEncryptionKeySalt),s=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(t,e),a=i.a.decode(n.shareTokenEncryptedEcdsaPrivateKey),r=await ja.aesGcm.decrypt(s,a);c=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(r)}catch(e){throw new hs.ShareTokenInvalid}const u=await ja.ecdsa.sign(c,i.a.decode(o));return{databaseId:r,validationMessage:o,signedValidationMessage:i.a.encode(u)}}};function ar(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function rr(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ar(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ar(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const nr={local:!0,session:!0,none:!0},ir="Device not recognized. This temporary password can only be used to sign in from a device you've signed in from before.",or="Device not recognized. Forgot password only works from a device you've signed in from before.",cr=e=>{if(e.response){if("Domain not whitelisted"===e.response.data)throw new hs.DomainNotWhitelisted(window.location.origin);if("App ID not valid"===e.response.data)throw new hs.AppIdNotValid;if("UserNotFound"===e.response.data)throw new hs.UserNotFound;if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout},ur=async(e,t,s,a)=>{try{await sr.connect(e,t,s,a)}catch(e){if(cr(e),"Web Socket already connected"===e.message)throw new hs.UserAlreadySignedIn(e.username);throw e}},dr=e=>{if(e.response&&"UsernameTooLong"===e.response.data.error)throw new hs.UsernameTooLong(e.response.data.maxLen);if(e.response&&"PasswordAttemptLimitExceeded"===e.response.data.error)throw new hs.PasswordAttemptLimitExceeded(e.response.data.delay)},hr=e=>{if(e.response&&e.response.data){const t=e.response.data;switch(t.error){case"SessionLengthTooShort":throw new hs.SessionLengthTooShort(t.minLen);case"SessionLengthTooLong":throw new hs.SessionLengthTooLong(t.maxLen)}}},lr=(e,t)=>{if(cr(e),dr(e),e.response){const s=e.response.data;switch(s){case"UsernameAlreadyExists":throw new hs.UsernameAlreadyExists(t);case"TrialExceededLimit":throw new hs.TrialExceededLimit;case"CurrentPasswordIncorrect":throw new hs.CurrentPasswordIncorrect}switch(s.error){case"EmailNotValid":throw new hs.EmailNotValid;case"ProfileMustBeObject":throw new hs.ProfileMustBeObject;case"ProfileKeyTooLong":throw new hs.ProfileKeyTooLong(s.maxLen,s.key);case"ProfileValueMustBeString":throw new hs.ProfileValueMustBeString(s.key,s.value);case"ProfileValueCannotBeBlank":throw new hs.ProfileValueCannotBeBlank(s.key);case"ProfileValueTooLong":throw new hs.ProfileValueTooLong(s.maxLen,s.key,s.value);case"ProfileHasTooManyKeys":throw new hs.ProfileHasTooManyKeys(s.maxKeys);case"ProfileCannotBeEmpty":throw new hs.ProfileCannotBeEmpty}}throw e},fr=e=>e&&60*e*60*1e3,mr=e=>{if("string"!=typeof e)throw new hs.UsernameMustBeString;if(0===e.length)throw new hs.UsernameCannotBeBlank},pr=e=>{if("string"!=typeof e)throw new hs.PasswordMustBeString;if(0===e.length)throw new hs.PasswordCannotBeBlank;if(e.length<6)throw new hs.PasswordTooShort(6);if(e.length>1e3)throw new hs.PasswordTooLong(1e3)},wr=e=>{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"username"))throw new hs.UsernameMissing;if(!Ga(e,"password"))throw new hs.PasswordMissing;if(mr(e.username),pr(e.password),Ga(e,"rememberMe")&&!nr[e.rememberMe])throw new hs.RememberMeValueNotValid(nr);if(Ga(e,"sessionLength")&&"number"!=typeof e.sessionLength)throw new hs.SessionLengthMustBeNumber},gr=async(e,t,s)=>{const a=ja.scrypt.generateSalt(),r=await ja.scrypt.hash(e,a,s),n=await ja.hkdf.importHkdfKeyFromString(r),o=ja.hkdf.generateSalt(),c=await ja.hkdf.getPasswordToken(n,o),u=ja.hkdf.generateSalt(),d=await ja.aesGcm.getPasswordBasedEncryptionKey(n,u),h=await ja.aesGcm.encrypt(d,t);return{passwordToken:c,passwordSalts:{passwordSalt:i.a.encode(a),passwordTokenSalt:i.a.encode(o)},passwordBasedBackup:{passwordBasedEncryptionKeySalt:i.a.encode(u),passwordEncryptedSeed:i.a.encode(h)}}},yr=async e=>{const t=await ja.hkdf.importHkdfKey(e),s=ja.hkdf.generateSalt(),a=ja.hkdf.generateSalt(),r={encryptionKeySalt:i.a.encode(s),hmacKeySalt:i.a.encode(a)},n=await ja.ecdsa.generateEcdsaKeyData(t),o=await ja.ecdh.generateEcdhKeyData(t,n.ecdsaPrivateKey);delete n.ecdsaPrivateKey,delete o.ecdhPrivateKey;return{ecKeyData:{ecdsaKeyData:n,ecdhKeyData:o},keySalts:r}},br=e=>{if("object"!=typeof e)throw new hs.ProfileMustBeObject;let t=!1;for(const s in e){t=!0;const a=e[s];if("string"!=typeof a)throw new hs.ProfileValueMustBeString(s,a);if(!a)throw new hs.ProfileValueCannotBeBlank(s)}if(!t)throw new hs.ProfileCannotBeEmpty},vr=async()=>{try{const e="GetPasswordSalts";return(await sr.request(e)).data}catch(e){throw cr(e),e}},Mr=async(e,t,s)=>{const{passwordSalt:a,passwordTokenSalt:r}=t,n=await ja.scrypt.hash(e,new Uint8Array(i.a.decode(a)),s),o=await ja.hkdf.importHkdfKeyFromString(n);return{passwordHkdfKey:o,passwordToken:await ja.hkdf.getPasswordToken(o,i.a.decode(r))}},Sr=async(e,t)=>{let s;try{const a=_s.getCurrentSession();if(!a)return{};const{signedIn:r,sessionId:n,creationDate:i,expirationDate:o,rememberMe:c}=a;s=a.username;const u=_s.getSeedString(e,s);if(!r||!u||new Date>new Date(o))return{lastUsedUsername:s};let d;try{d=await Us(n,t)}catch(e){if(cr(e),hr(e),e.response&&"Session invalid"===e.response.data)return{lastUsedUsername:s};throw e}const{userId:h,authToken:l,username:f,email:m,profile:p,protectedProfile:w}=d;if(f!==s&&(_s.saveSeedString(c,e,f,u),_s.removeSeedString(e,s)),_s.signInSession(c,f,n,i,d.expirationDate),sr.connectionResolved){if(sr.session.sessionId===n)return{user:sr.buildUserResult({username:f,userId:h,authToken:sr.session.authToken,email:m,profile:p,protectedProfile:w,userData:sr.userData})};throw new hs.UserAlreadySignedIn(sr.session.username)}const g=rr(rr({},a),{},{username:f,userId:h,authToken:l});return await ur(g,u,c),{user:sr.buildUserResult({username:f,userId:h,authToken:l,email:m,profile:p,protectedProfile:w,userData:sr.userData})}}catch(e){if("Invalid seed"===e.message)return{lastUsedUsername:s};throw cr(e),e}},Ir=async(e,t)=>{const s=_s.getSeedString(e,t);if(!s)throw new hs.KeyNotFound(or);const a=i.a.decode(s);return await ja.hkdf.importHkdfKey(a)};var Pr={signUp:async e=>{try{(e=>{if(wr(e),e.profile&&br(e.profile),e.email&&"string"!=typeof e.email)throw new hs.EmailNotValid})(e);const{password:t,profile:s,passwordHashAlgo:a,rememberMe:r="session"}=e,n=e.username.toLowerCase(),o=e.email&&e.email.toLowerCase(),c=ws(),u=await ja.generateSeed(),d=fr(e.sessionLength),{sessionId:h,creationDate:l,expirationDate:f,userId:m,authToken:p}=await(async(e,t,s,a,r,n,i)=>{const{passwordToken:o,passwordSalts:c,passwordBasedBackup:u}=await gr(t,s,a),{ecKeyData:d,keySalts:h}=await yr(s);try{return await Es(e,o,d,c,h,r,n,u,i)}catch(t){hr(t),lr(t,e)}})(n,t,u,a,o,s,d),w={username:n,userId:m,sessionId:h,creationDate:l,expirationDate:f,authToken:p},g=i.a.encode(u);return _s.saveSeedString(r,c,n,g),_s.signInSession(r,n,h,l,f),await ur(w,g,r),sr.buildUserResult({username:n,userId:m,authToken:p,email:o,profile:s,userData:sr.userData})}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameAlreadyExists":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"UsernameTooLong":case"PasswordMissing":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"PasswordMustBeString":case"EmailNotValid":case"ProfileMustBeObject":case"ProfileCannotBeEmpty":case"ProfileHasTooManyKeys":case"ProfileKeyTooLong":case"ProfileValueMustBeString":case"ProfileValueCannotBeBlank":case"ProfileValueTooLong":case"RememberMeValueNotValid":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"TrialExceededLimit":case"AppIdNotSet":case"AppIdNotValid":case"DomainNotWhitelisted":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},signOut:async()=>{try{if(!sr.session.username)throw new hs.UserNotSignedIn;try{await sr.signOut()}catch(e){throw cr(e),e}}catch(e){switch(e.name){case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},signIn:async e=>{try{wr(e);const t=e.username.toLowerCase(),{password:s,passwordHashAlgo:a,rememberMe:r="session"}=e,n=ws(),o=await(async e=>{try{return await Bs(e)}catch(e){if(cr(e),dr(e),e.response&&"User not found"===e.response.data)throw new hs.UsernameOrPasswordMismatch;throw e}})(t),{passwordHkdfKey:c,passwordToken:u}=await Mr(s,o,a),d=fr(e.sessionLength),h=await(async(e,t,s)=>{try{return await Ns(e,t,s)}catch(e){if(cr(e),dr(e),hr(e),e.response&&"Invalid password"===e.response.data)throw new hs.UsernameOrPasswordMismatch;if(e.response&&"User pending deletion"===e.response.data)throw new hs.UserPendingDeletion;throw e}})(t,u,d),{userId:l,email:f,profile:m,passwordBasedBackup:p,protectedProfile:w,usedTempPassword:g,changePassword:y}=h,b=rr(rr({},h.session),{},{username:t,userId:l});let v;if(!y){const e=_s.getSeedString(n,t);let s;if(!e&&g)throw new hs.KeyNotFound(ir);g||(s=await(async(e,t)=>{const{passwordBasedEncryptionKeySalt:s,passwordEncryptedSeed:a}=t,r=await ja.aesGcm.getPasswordBasedEncryptionKey(e,i.a.decode(s)),n=await ja.aesGcm.decrypt(r,i.a.decode(a));return i.a.encode(n)})(c,p),_s.saveSeedString(r,n,t,s)),v=s||e}_s.signInSession(r,t,b.sessionId,b.creationDate,b.expirationDate);try{await ur(b,v,r,y)}catch(e){if(g&&"Invalid seed"===e.message)throw new hs.KeyNotFound(ir);throw e}return sr.buildUserResult({username:t,userId:l,authToken:b.authToken,email:f,profile:m,protectedProfile:w,usedTempPassword:g,changePassword:y,userData:sr.userData})}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameOrPasswordMismatch":case"UserPendingDeletion":case"UsernameCannotBeBlank":case"UsernameTooLong":case"UsernameMustBeString":case"PasswordMissing":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"PasswordMustBeString":case"PasswordAttemptLimitExceeded":case"RememberMeValueNotValid":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"KeyNotFound":case"AppIdNotSet":case"AppIdNotValid":case"DomainNotWhitelisted":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},init:async e=>{try{if(!window.crypto.subtle)throw new hs.WebCryptoUnavailable;if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"appId"))throw new hs.AppIdMissing;if("string"!=typeof e.appId)throw new hs.AppIdMustBeString;if(0===e.appId.length)throw new hs.AppIdCannotBeBlank;if(Ga(e,"updateUserHandler")&&"function"!=typeof e.updateUserHandler)throw new hs.UpdateUserHandlerMustBeFunction;if(Ga(e,"sessionLength")&&"number"!=typeof e.sessionLength)throw new hs.SessionLengthMustBeNumber;if(Ga(e,"allowServerSideEncryption")&&"boolean"!=typeof e.allowServerSideEncryption)throw new hs.AllowServerSideEncryptionMustBeBoolean;bs(e);return await Sr(e.appId,fr(e.sessionLength))}catch(e){switch(e.name){case"WebCryptoUnavailable":case"ParamsMustBeObject":case"AppIdMissing":case"AppIdAlreadySet":case"AppIdMustBeString":case"AppIdCannotBeBlank":case"AppIdNotValid":case"DomainNotWhitelisted":case"UpdateUserHandlerMustBeFunction":case"SessionLengthMustBeNumber":case"SessionLengthTooShort":case"SessionLengthTooLong":case"AllowServerSideEncryptionMustBeBoolean":case"UserAlreadySignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},updateUser:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if((e=>{if(!(Ga(e,"username")||Ga(e,"newPassword")||Ga(e,"email")||Ga(e,"profile")))throw new hs.ParamsMissing;const{username:t,currentPassword:s,newPassword:a,email:r,profile:n}=e;if(Ga(e,"username")&&mr(t),Ga(e,"newPassword")){if(!Ga(e,"currentPassword"))throw new hs.CurrentPasswordMissing;pr(s),pr(a)}if(r&&"string"!=typeof r)throw new hs.EmailNotValid;n&&br(n)})(e),sr.reconnecting)throw new hs.Reconnecting;if(!sr.connectionResolved)throw new hs.UserNotSignedIn;const t=sr.session.userId,s=e.newPassword&&!sr.keys.init&&sr.changePassword&&await ja.generateSeed(),a="UpdateUser",r=await(async(e,t)=>{if(e.username&&(e.username=e.username.toLowerCase()),e.newPassword){const[s,a,r]=await Promise.all([vr(),gr(e.newPassword,t||i.a.decode(sr.seedString)),t&&yr(t)]),{passwordToken:n}=await Mr(e.currentPassword,s,e.passwordHashAlgo);e.currentPasswordToken=n,delete e.currentPassword,e.passwordToken=a.passwordToken,e.passwordSalts=a.passwordSalts,e.passwordBasedBackup=a.passwordBasedBackup,delete e.newPassword,r&&(e.newKeyData=r)}return e.email?e.email=e.email.toLowerCase():Ga(e,"email")&&(e.email=!1),!e.profile&&Ga(e,"profile")&&(e.profile=!1),e})(rr({},e),s);if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.connectionResolved)throw new hs.UserNotSignedIn;if(!sr.session||t!==sr.session.userId)throw new hs.ServiceUnavailable;try{r.username&&_s.saveSeedString(sr.rememberMe,ws(),r.username,sr.seedString);const e=(await sr.request(a,r)).data.updatedUser;if(sr.handleUpdateUser(e),s&&sr.session&&t===sr.session.userId){const t=i.a.encode(s);await sr.rotateKeys(t,r.newKeyData),_s.saveSeedString(sr.rememberMe,ws(),e.username,t);const{sessionId:a,creationDate:n,expirationDate:o}=sr.session;_s.signInSession(sr.rememberMe,e.username,a,n,o)}}catch(e){lr(e,r.username)}}catch(e){switch(e.name){case"ParamsMustBeObject":case"ParamsMissing":case"UsernameAlreadyExists":case"UsernameMustBeString":case"UsernameCannotBeBlank":case"UsernameTooLong":case"CurrentPasswordMissing":case"CurrentPasswordIncorrect":case"PasswordAttemptLimitExceeded":case"PasswordMustBeString":case"PasswordCannotBeBlank":case"PasswordTooShort":case"PasswordTooLong":case"EmailNotValid":case"ProfileMustBeObject":case"ProfileCannotBeEmpty":case"ProfileHasTooManyKeys":case"ProfileKeyTooLong":case"ProfileValueMustBeString":case"ProfileValueCannotBeBlank":case"ProfileValueTooLong":case"AppIdNotSet":case"AppIdNotValid":case"UserNotFound":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},deleteUser:async()=>{try{(()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init)throw new hs.UserNotSignedIn})();const e=sr.session.username;_s.removeSeedString(ws(),e),_s.removeCurrentSession();try{const e="DeleteUser";await sr.request(e)}catch(e){throw cr(e),e}sr.close()}catch(e){switch(e.name){case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},forgotPassword:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Ga(e,"deleteEndToEndEncryptedData")&&"boolean"!=typeof e.deleteEndToEndEncryptedData)throw new hs.DeleteEndToEndEncryptedDataMustBeBoolean;if(!Ga(e,"username"))throw new hs.UsernameMissing;mr(e.username);const t=e.username.toLowerCase(),s=ws(),a="".concat(Va(ys()),"/api/auth/forgot-password?appId=").concat(s,"&username=").concat(encodeURIComponent(t),"&userbaseJsVersion=").concat(ps),r=new WebSocket(a+(Ga(e,"deleteEndToEndEncryptedData")?"&deleteEndToEndEncryptedData=".concat(e.deleteEndToEndEncryptedData):""));await new Promise((e,a)=>{setTimeout(()=>a(new hs.Timeout),15e3),r.onerror=()=>a(new hs.ServiceUnavailable),r.onmessage=async n=>{try{const o=JSON.parse(n.data);switch(o.route){case"ReceiveEncryptedToken":{const e=await Ir(s,t),a=new Uint8Array(o.encryptedForgotPasswordToken.data),n=await ja.diffieHellman.importKeyFromMaster(e,i.a.decode(o.dhKeySalt)),c=await ja.diffieHellman.getSharedKeyWithServer(n);let u;try{u=i.a.encode(await ja.aesGcm.decrypt(c,a))}catch(e){throw new hs.KeyNotFound(or)}r.send(JSON.stringify({action:"ForgotPassword",params:{forgotPasswordToken:u}}));break}case"ReceiveToken":{const e=await Ir(s,t),{ecdsaKeyEncryptionKeySalt:a,encryptedEcdsaPrivateKey:n,forgotPasswordToken:c}=o,u=await ja.ecdsa.importEcdsaKeyEncryptionKeyFromMaster(e,i.a.decode(a));let d;try{const e=await ja.aesGcm.decrypt(u,i.a.decode(n));d=await ja.ecdsa.getPrivateKeyFromRawPrivateKey(e)}catch(e){throw new hs.KeyNotFound(or)}const h=i.a.encode(await ja.ecdsa.sign(d,i.a.decode(c)));r.send(JSON.stringify({action:"ForgotPassword",params:{signedForgotPasswordToken:h}}));break}case"SuccessfullyForgotPassword":e();break;case"Error":{const e=o.data;switch(e.name){case"UsernameTooLong":throw new hs.UsernameTooLong(e.maxLen);case"AppIdNotValid":throw new hs.AppIdNotValid;case"UserNotFound":throw new hs.UserNotFound;case"UserEmailNotFound":throw new hs.UserEmailNotFound;default:throw o.status===p?new hs.ServiceUnavailable:new hs.UnknownServiceUnavailable(e)}}case"Ping":break;default:a(new Error("Received unknown message from userbase-server: ".concat(n.data)))}}catch(n){a(n)}}}),r.close()}catch(e){switch(e.name){case"ParamsMustBeObject":case"UsernameMissing":case"UsernameMustBeString":case"UsernameCannotBeBlank":case"UsernameTooLong":case"AppIdNotSet":case"AppIdNotValid":case"KeyNotFound":case"UserNotFound":case"UserEmailNotFound":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}},Er=s(12),Br=s.n(Er);function Nr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Ur(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(s),!0).forEach((function(t){r()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Nr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const Ar={"end-to-end":!0,"server-side":!0},Tr=()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init||!Ar[sr.encryptionMode])throw new hs.UserNotSignedIn},kr=e=>{if(e.response){if("UserNotFound"===e.response.data)throw new hs.UserNotFound;if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout};class Dr{constructor(e){this.startSeqNo=e,this.txSeqNo=null,this.transactions={},this.promiseResolve=null,this.promiseReject=null,this.index=null}getStartSeqNo(){return this.startSeqNo}getIndex(){return this.index}setIndex(e){this.index=e}async getResult(e){this.txSeqNo=e;const t=new Promise((e,t)=>{this.promiseResolve=e,this.promiseReject=t,setTimeout(()=>{t(new Error("timeout"))},3e4)});return this.verifyPromise(),t}verifyPromise(){(this.txSeqNo||0==this.txSeqNo)&&this.promiseResolve&&this.promiseReject&&this.transactions[this.txSeqNo]&&("Success"==this.transactions[this.txSeqNo]?this.promiseResolve():this.promiseReject(this.transactions[this.txSeqNo]))}addTransaction(e,t){this.transactions[e.seqNo]||(this.transactions[e.seqNo]=t,this.verifyPromise())}}class Kr{constructor(e,t,s,a){this.onChange=xr(e),this.items={},this.itemsPlaintextMetadata={},this.fileIds={};this.itemsIndex=new Br.a([],(e,t)=>e.seqNo<t.seqNo||e.seqNo===t.seqNo&&e.operationIndex<t.operationIndex?-1:e.seqNo>t.seqNo||e.seqNo===t.seqNo&&e.operationIndex>t.operationIndex?1:0),this.unverifiedTransactions=[],this.lastSeqNo=0,this.init=!1,this.dbKey=null,this.receivedMessage=t,this.usernamesByUserId=new Map,this.attributionEnabled=!1,this.shareTokenId=s,this.shareTokenHkdfKey=a,this.applyTransactionsQueue=new Ja,this.bundleChunks={}}async applyTransactions(e,t,s,a){for(let s=0;s<e.length;s++){const a=e[s],r=a.seqNo;if(r!==this.lastSeqNo+1){console.warn("Client attempted to apply transaction with seq no ".concat(r," when last seq no is ").concat(this.lastSeqNo));continue}const n=await this.applyTransaction(this.dbKey,a,t);this.lastSeqNo=r;for(let t=0;t<this.unverifiedTransactions.length;t++)!this.unverifiedTransactions[t]||r<this.unverifiedTransactions[t].getStartSeqNo()||this.unverifiedTransactions[t].addTransaction(e[s],n);this.init&&"Success"===n&&this.onChange(this.getItems())}this.init||(this.init=!0,this.dbId=s,this.dbNameHash=a,this.onChange(this.getItems()),this.receivedMessage())}async applyBundle(e,t){if(0===this.lastSeqNo){for(let t=0;t<e.itemsIndex.length;t++){const s=e.itemsIndex[t],a=e.itemsIndex[t].itemId,r=e.items[t],n=e.itemsPlaintextMetadata[t];r.file&&r.file.fileEncryptionKeyString&&(r.file.fileEncryptionKey=await ja.aesGcm.getKeyFromKeyString(r.file.fileEncryptionKeyString),this.fileIds[r.file.fileId]=a),this.items[a]=r,this.itemsPlaintextMetadata[a]=n,this.itemsIndex.insert(s)}this.lastSeqNo=t}else console.warn("Client attempted to apply bundle when last seq no is ".concat(this.lastSeqNo))}async applyTransaction(e,t,s){const a=t.seqNo,r=t.command;switch(r){case"Insert":try{const s=await ja.aesGcm.decryptJson(e,t.record),r=s.id,n=s.item,i=this.attributionFromTransaction(t),o=t.writeAccess;return this.validateInsert(r),this.applyInsert(r,a,n,i,o)}catch(e){return e}case"Update":try{const a=await ja.aesGcm.decryptJson(e,t.record),r=a.id,n=a.item,i=this.attributionFromTransaction(t),o=a.__v,c=t.writeAccess;return this.validateUpdate(r,o,i,s,c,"updateItem"),this.applyUpdate(r,n,o,i,c)}catch(e){return e}case"Delete":try{const a=await ja.aesGcm.decryptJson(e,t.record),r=a.id,n=this.attributionFromTransaction(t),i=a.__v;return this.validateUpdateOrDelete(r,i,n,s,"deleteItem"),this.applyDelete(r)}catch(e){return e}case"BatchTransaction":try{const r=t.operations,n=this.attributionFromTransaction(t),i=[];for(const t of r)i.push(t.record&&ja.aesGcm.decryptJson(e,t.record));const o=await Promise.all(i);return this.validateBatchTransaction(r,o,n,s),this.applyBatchTransaction(a,r,o,n)}catch(e){return e}case"UploadFile":try{const a=await ja.aesGcm.decrypt(e,i.a.decode(t.fileEncryptionKey)),r=await ja.aesGcm.getKeyFromRawKey(a),n=await ja.aesGcm.getKeyStringFromKey(r),o=await ja.aesGcm.decryptJson(r,t.fileMetadata),c=o.itemId,u=o.__v,{fileName:d,fileSize:h,fileType:l}=o,f=t.fileId,m=this.attributionFromTransaction(t);return this.validateUploadFile(c,u,m,s,"uploadFile"),this.applyUploadFile(c,m,u,r,n,d,f,h,l)}catch(e){return e}case"Rollback":return;default:return void console.warn("Unknown command: ".concat(r))}}attributionFromTransaction(e){if(this.attributionEnabled)return{timestamp:e.timestamp,userId:e.userId}}validateInsert(e){if(this.items[e])throw new hs.ItemAlreadyExists}validateUpdate(e,t,s,a,r,n){this.validateUpdateOrDelete(e,t,s,a,n);const{createdBy:i}=this.itemsPlaintextMetadata[e];if(r||!1===r){if(!i)return;const e=i.userId,t=s.userId;if(e!==t&&t!==a)throw new hs.WriteAccessParamNotAllowed}}validateUpdateOrDelete(e,t,s,a,r){if(!this.items[e])throw new hs.ItemDoesNotExist;if(t<=this.getItemVersionNumber(e))throw new hs.ItemUpdateConflict;this.validateAccessPermissions(e,s,a,r)}validateUploadFile(e,t,s,a,r){if(!this.items[e])throw new hs.ItemDoesNotExist;if(t<=this.getFileVersionNumber(e))throw new hs.FileUploadConflict;this.validateAccessPermissions(e,s,a,r)}validateAccessPermissions(e,t,s,a){const{createdBy:r,writeAccess:n}=this.itemsPlaintextMetadata[e];if(r&&t&&n){const e=r.userId,i=t.userId;let o=!1;const{onlyCreator:c,users:u}=n;if(i===s||i===e)o=!0;else if(!c&&u)for(const{userId:e}of u)if(o=i===e,o)break;if(!o)throw new hs.TransactionUnauthorized(a)}}itemExists(e){return Ga(this.items,e)}applyInsert(e,t,s,a,r,n){const i={seqNo:t};if("number"==typeof n&&(i.operationIndex=n),this.items[e]=Ur(Ur({},i),{},{record:s,__v:0}),this.itemsPlaintextMetadata[e]={createdBy:a,writeAccess:r},this.itemsIndex.insert(Ur(Ur({},i),{},{itemId:e})),r&&r.users)for(const{userId:e,username:t}of r.users)this.usernamesByUserId.set(e,t);return"Success"}applyUpdate(e,t,s,a,r){if(this.items[e].record=t,this.items[e].__v=s,this.itemsPlaintextMetadata[e].updatedBy=a,!1===r)delete this.itemsPlaintextMetadata[e].writeAccess;else if(r&&(this.itemsPlaintextMetadata[e].writeAccess=r,r.users))for(const{userId:e,username:t}of r.users)this.usernamesByUserId.set(e,t);return"Success"}applyUploadFile(e,t,s,a,r,n,i,o,c){const u=this.items[e].file;return u&&delete this.fileIds[u.fileId],this.items[e].file={fileName:n,fileId:i,fileSize:o,fileType:c,fileEncryptionKey:a,fileEncryptionKeyString:r,__v:s},this.itemsPlaintextMetadata[e].fileUploadedBy=t,this.fileIds[i]=e,"Success"}applyDelete(e){return this.itemsIndex.remove(this.items[e]),delete this.items[e],delete this.itemsPlaintextMetadata[e],"Success"}validateBatchTransaction(e,t,s,a){const r={};for(let n=0;n<e.length;n++){const i=e[n],{command:o,writeAccess:c}=i,u=t[n].id,d=t[n].__v;if(r[u])throw new hs.OperationsConflict;switch(r[u]=!0,o){case"Insert":this.validateInsert(u);break;case"Update":this.validateUpdate(u,d,s,a,c,o);break;case"Delete":this.validateUpdateOrDelete(u,d,s,a,o)}}}applyBatchTransaction(e,t,s,a){for(let r=0;r<t.length;r++){const n=t[r],i=s[r].id,o=s[r].item,c=s[r].__v,u=n.writeAccess;switch(n.command){case"Insert":this.applyInsert(i,e,o,a,u,r);break;case"Update":this.applyUpdate(i,o,c,a,u);break;case"Delete":this.applyDelete(i,c)}}return"Success"}registerUnverifiedTransaction(){const e=new Dr(this.lastSeqNo),t=this.unverifiedTransactions.push(e);return e.setIndex(t-1),e}unregisterUnverifiedTransaction(e){delete this.unverifiedTransactions[e.getIndex()]}getItems(){const e=[];for(let t=0;t<this.itemsIndex.array.length;t++){const s=this.itemsIndex.array[t].itemId,a={itemId:s,item:this.items[s].record};if(this.items[s].file){const{fileId:e,fileName:t,fileSize:r}=this.items[s].file;a.fileId=e,a.fileName=t,a.fileSize=r}for(const e of["createdBy","updatedBy","fileUploadedBy"])if(this.itemsPlaintextMetadata[s][e]){const{timestamp:t,userId:r}=this.itemsPlaintextMetadata[s][e],n={timestamp:t},i=this.usernamesByUserId.get(r);null==i?n.userDeleted=!0:n.username=i,a[e]=n}if(this.itemsPlaintextMetadata[s].writeAccess){const{onlyCreator:e,users:t}=this.itemsPlaintextMetadata[s].writeAccess,r={};if(e&&(r.onlyCreator=e),t){r.users=[];for(const{userId:e}of t){const t=this.usernamesByUserId.get(e);t&&r.users.push({username:t})}}a.writeAccess=r}e.push(a)}return e}getItemVersionNumber(e){return this.items[e].__v}getFileVersionNumber(e){return this.items[e].file&&this.items[e].file.__v}async decryptShareTokenEncryptedDbKey(e,t){const s=await ja.aesGcm.importKeyFromMaster(this.shareTokenHkdfKey,i.a.decode(t));return await ja.aesGcm.decryptString(s,e)}}const xr=e=>t=>{try{e(t)}catch(e){console.error("There was an error in your changeHandler.\n\n",e)}},Rr=(e,t,s)=>{e.onChange=xr(t);const a=e.receivedMessage;return e.receivedMessage=()=>{a(),s()},!!e.init&&(e.onChange(e.getItems()),e.receivedMessage(),!0)},Or=e=>{const t=e.slice(0,36),s=Fs(t,!0);if(!s||36!==s.length)throw new hs.ShareTokenInvalid;return s},Cr=async(e,t,s)=>{let a,r;try{a=(e=>{const t=i.a.decode(e);return{shareTokenId:Or(t),shareTokenSeed:t.slice(36)}})(e),r=await ja.hkdf.importHkdfKey(a.shareTokenSeed)}catch(e){throw new hs.ShareTokenInvalid}const{shareTokenId:n}=a,{databaseId:o,validationMessage:c,signedValidationMessage:u}=await sr.authenticateShareToken(n,r);sr.state.shareTokenIdToDbId[n]=o,await _r(o,t,s,n,r,c,u)},_r=async(e,t,s,a,r,n,i)=>{const o=sr.state.databasesByDbId[e];if(o){if(Rr(o,t,s))return}else sr.state.databasesByDbId[e]=new Kr(t,s,a,r);const c={databaseId:e,validationMessage:n,signedValidationMessage:i};await sr.request("OpenDatabaseByDatabaseId",c)},Fr=async(e,t)=>{try{let s,a;const r=new Promise((e,t)=>{s=e,a=setTimeout(()=>t(new Error("timeout")),3e4)}),{dbNameHash:n,newDatabaseParams:i,databaseId:o,shareToken:c}=t;try{n?await(async(e,t,s,a)=>{const r=sr.state.databases[e];if(r){if(Rr(r,s,a))return}else sr.state.databases[e]=new Kr(s,a);const n={dbNameHash:e,newDatabaseParams:t};await sr.request("OpenDatabase",n)})(n,i,e,s):o?await _r(o,e,s):c&&await Cr(c,e,s),await r}catch(e){if(clearTimeout(a),e.response&&e.response.data){const t=e.response.data;if("Database already creating"===t)throw new hs.DatabaseAlreadyOpening;if("Database is owned by user"===t){if(o)throw new hs.DatabaseIdNotAllowedForOwnDatabase;if(c)throw new hs.ShareTokenNotAllowedForOwnDatabase}else if("Database key not found"===t||"Database not found"===t)throw new hs.DatabaseNotFound;switch(t.name){case"SubscriptionNotFound":throw new hs.SubscriptionNotFound;case"SubscriptionInactive":throw new hs.SubscriptionInactive(t.subscriptionStatus);case"TrialExpired":throw new hs.TrialExpired}}throw e}}catch(e){throw kr(e),e}},Lr=e=>{if("server-side"===e&&!Ms())throw new hs.ServerSideEncryptionNotEnabledInClient},jr=e=>{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Ga(e,"databaseName")){if((e=>{if("string"!=typeof e)throw new hs.DatabaseNameMustBeString;if(0===e.length)throw new hs.DatabaseNameCannotBeBlank;if(e.length>100)throw new hs.DatabaseNameTooLong(100)})(e.databaseName),Ga(e,"databaseId"))throw new hs.DatabaseIdNotAllowed;if(Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;if(!e.allowVerifiedUsersDatabase&&"__userbase_verified_users"===e.databaseName)throw new hs.DatabaseNameRestricted("__userbase_verified_users")}else if(Ga(e,"databaseId")){if((e=>{if("string"!=typeof e)throw new hs.DatabaseIdMustBeString;if(0===e.length)throw new hs.DatabaseIdCannotBeBlank;if(36!==e.length)throw new hs.DatabaseIdInvalidLength(36)})(e.databaseId),Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed}else{if(!Ga(e,"shareToken"))throw new hs.DatabaseNameMissing;if("string"!=typeof e.shareToken)throw new hs.ShareTokenInvalid}if(Ga(e,"encryptionMode")&&!Ar[e.encryptionMode])throw new hs.EncryptionModeNotValid(Ar);Tr()},qr=async e=>{try{if(jr(e),!Ga(e,"changeHandler"))throw new hs.ChangeHandlerMissing;const{databaseName:t,databaseId:s,shareToken:a,changeHandler:r,encryptionMode:n=sr.encryptionMode}=e;if("function"!=typeof r)throw new hs.ChangeHandlerMustBeFunction;if(Lr(n),t){const e="server-side"===n?t:sr.state.dbNameToHash[t]||await ja.hmac.signString(sr.keys.hmacKey,t);"end-to-end"===n&&(sr.state.dbNameToHash[t]=e);const s={dbNameHash:e,newDatabaseParams:await(async(e,t)=>{const s=Ds()(),a=await ja.aesGcm.generateKey(),r=await ja.aesGcm.getKeyStringFromKey(a),[n,i]=await Promise.all([ja.aesGcm.encryptString(sr.keys.encryptionKey,r),ja.aesGcm.encryptString(a,e)]),o={dbId:s,encryptedDbKey:n,encryptedDbName:i,attribution:!0};return"server-side"===t&&(o.plaintextDbKey=r),o.fingerprint=await ln(),o})(t,n)};await Fr(r,s)}else if(s){const e={databaseId:s};await Fr(r,e)}else{const e={shareToken:a};await Fr(r,e)}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseAlreadyOpening":case"DatabaseNameMustBeString":case"DatabaseNameMissing":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"DatabaseIdNotAllowedForOwnDatabase":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"ShareTokenNotFound":case"ShareTokenNotAllowedForOwnDatabase":case"DatabaseNotFound":case"ChangeHandlerMissing":case"ChangeHandlerMustBeFunction":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"SubscriptionNotFound":case"SubscriptionInactive":case"TrialExpired":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Vr=(e,t,s,a="end-to-end")=>{Lr(a);const r=s&&Or(i.a.decode(s)),n="server-side"===a?e:sr.state.dbNameToHash[e],o=e?sr.state.databases[n]:sr.state.databasesByDbId[t||sr.state.shareTokenIdToDbId[r]];if(!o||!o.init)throw new hs.DatabaseNotOpen;return o},Hr=async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Insert",a=await Gr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemAlreadyExists":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Gr=async(e,t)=>{if(!Ga(t,"item"))throw new hs.ItemMissing;const{item:s,itemId:a,writeAccess:r}=t;if(Ga(t,"itemId")){if("string"!=typeof a)throw new hs.ItemIdMustBeString;if(0===a.length)throw new hs.ItemIdCannotBeBlank;if(a.length>100)throw new hs.ItemIdTooLong(100)}const n=JSON.stringify(s);if(!n)throw new hs.ItemInvalid;if(Ha(n)>10240)throw new hs.ItemTooLarge(10);const i=a||Ds()(),o={id:i,item:s};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,i),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,o),writeAccess:r}},Jr=async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Update",a=await Wr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemDoesNotExist":case"ItemUpdateConflict":case"WriteAccessParamNotAllowed":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},Wr=async(e,t)=>{if(!Ga(t,"item"))throw new hs.ItemMissing;if(!Ga(t,"itemId"))throw new hs.ItemIdMissing;!t.writeAccess&&Ga(t,"writeAccess")&&(t.writeAccess=!1);const{item:s,itemId:a,writeAccess:r}=t;if("string"!=typeof a)throw new hs.ItemIdMustBeString;if(0===a.length)throw new hs.ItemIdCannotBeBlank;if(a.length>100)throw new hs.ItemIdTooLong(100);if(!e.itemExists(a))throw new hs.ItemDoesNotExist;const n=JSON.stringify(s);if(!n)throw new hs.ItemInvalid;if(Ha(n)>10240)throw new hs.ItemTooLarge(10);const i={id:a,item:s,__v:e.getItemVersionNumber(a)+1};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,a),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,i),writeAccess:r}},Yr=async(e,t)=>{if(!Ga(t,"itemId"))throw new hs.ItemIdMissing;const{itemId:s}=t;if("string"!=typeof s)throw new hs.ItemIdMustBeString;if(0===s.length)throw new hs.ItemIdCannotBeBlank;if(s.length>100)throw new hs.ItemIdTooLong(100);if(!e.itemExists(s))throw new hs.ItemDoesNotExist;const a={id:s,__v:e.getItemVersionNumber(s)+1};return{itemKey:await ja.hmac.signString(sr.keys.hmacKey,s),encryptedItem:await ja.aesGcm.encryptJson(e.dbKey,a)}},zr=async(e,t,s)=>{try{const a=e.registerUnverifiedTransaction(),r=Ur(Ur({},s),{},{dbId:e.dbId,dbNameHash:e.dbNameHash}),n=(await sr.request(t,r)).data.sequenceNo;return await a.getResult(n),e.unregisterUnverifiedTransaction(a),n}catch(e){if(kr(e),e.response){if("DatabaseIsReadOnly"===e.response.data.name)throw new hs.DatabaseIsReadOnly;if("UserNotFound"===e.response.data.message)throw new hs.UserNotFound(e.response.data.username)}throw e}},Zr=async(e,t,s,a,r,n,i,o)=>{const c=await(async e=>{const t=new FileReader;return new Promise((s,a)=>{t.onload=e=>{e.target.error?a(e.target.error):s(e.target.result)},t.readAsArrayBuffer(e)})})(t),[u,d]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(r),h=await ja.aesGcm.encrypt(u,c),l={dbId:s,chunkNumber:n,fileId:a,chunk:Fs(new Uint8Array(h)),chunkEncryptionKey:Fs(new Uint8Array(d))},f=(async(e,t,s,a)=>{await e,t.bytesTransferred+=a,s&&s(Ur({},t))})(sr.request("UploadFileChunk",l),i,o,t.size);e.push(f),10===e.length&&(await Promise.all(e),e.length=0)},Xr=async(e,t,s,a)=>{try{const r="GetChunk",n={dbId:e,fileId:t,chunkNumber:s},i=(await sr.request(r,n)).data,o=new Uint8Array(new Uint16Array(Ls(i.chunk))).buffer,c=new Uint8Array(new Uint16Array(Ls(i.chunkEncryptionKey))).buffer,u=await ja.aesGcm.decrypt(a,c),d=await ja.aesGcm.getKeyFromRawKey(u);return await ja.aesGcm.decrypt(d,o)}catch(e){throw kr(e),e}},Qr=async(e,t,s)=>{const{username:a,senderUsername:r,verificationValues:n}=s,{sentSignature:o,receivedSignature:c,senderEcdsaPublicKey:u}=n,d=t[a]&&t[a].record.fingerprint,h=i.a.decode(u),l=t[r]&&t[r].record.fingerprint||await hn(h),f=await ja.ecdsa.getPublicKeyFromRawPublicKey(h),m=await rn(e,d),p=await ja.ecdsa.verifyString(f,o,m),w=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(n.recipientEcdsaPublicKey)),g=await rn(e,l),y=await ja.ecdsa.verifyString(w,c,g);return p&&y},$r=async(e,t,s,a,r)=>{const{mySentSignature:n,myReceivedSignature:o}=r,c=await rn(e,t),u=await ja.ecdsa.verifyString(a,o,c);if(!u)return u;const d=await rn(e,s),h=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(r.mySenderEcdsaPublicKey));return await ja.ecdsa.verifyString(h,n,d)&&u},en=async(e,t,s,a,r)=>{const{sentSignature:n,receivedSignature:o}=r,c=await rn(e,t),u=await ja.ecdsa.verifyString(a,n,c);if(!u)return u;const d=await rn(e,s),h=await ja.ecdsa.getPublicKeyFromRawPublicKey(i.a.decode(r.recipientEcdsaPublicKey)),l=await ja.ecdsa.verifyString(h,o,d);return u&&l},tn=async(e,t,s,a,r)=>{const n=await ja.ecdsa.getPublicKeyFromPrivateKey(sr.keys.ecdsaPrivateKey),i=await ln();for(let o=0;o<t.length;o++){const c=t[o],{username:u,isOwner:d,senderUsername:h,verificationValues:l}=c;try{const a=s[u]&&s[u].record.fingerprint,f=l.isChild,m=r===u;if(a)if(f)t[o].verified=await en(e,a,i,n,l);else if(m){const r=await $r(e,a,i,n,l);if(r&&h){const a=await Qr(e,s,c);t[o].verified=a}else t[o].verified=r}else if(d)t[o].verified=d;else{const a=await Qr(e,s,c);t[o].verified=a}}catch(e){}delete t[o].senderUsername,d||(l&&l.isChild?t[o].receivedFromUsername=a:h&&(t[o].receivedFromUsername=h)),delete t[o].verificationValues}return t},sn=async(e,t,s,a,r)=>{const{databaseId:n,databaseNameHash:o,isOwner:c,readOnly:u,resharingAllowed:d,senderUsername:h}=e;let l,f;if(e.encryptedDbKey||e.plaintextDbKey){const s=e.plaintextDbKey||await ja.aesGcm.decryptString(t,e.encryptedDbKey);if(l=await ja.aesGcm.getKeyFromKeyString(s),f=await ja.aesGcm.decryptString(l,e.databaseName),c&&"__userbase_verified_users"===f)return null}else{if(e.wrappedDbKey)return null;{let a;try{const{ephemeralPublicKey:t,signedEphemeralPublicKey:r,sharedEncryptedDbKey:n}=e;a=i.a.decode(e.senderEcdsaPublicKey);const o=await ja.ecdsa.getPublicKeyFromRawPublicKey(a);if(!await ja.ecdsa.verify(o,i.a.decode(r),i.a.decode(t)))throw new hs.ServiceUnavailable;const c=await ja.ecdh.getPublicKeyFromRawPublicKey(i.a.decode(t)),u=await ja.ecdh.computeSharedKeyEncryptionKey(c,s),d=await ja.aesGcm.decryptString(u,n);l=await ja.aesGcm.getKeyFromKeyString(d),f=await ja.aesGcm.decryptString(l,e.databaseName)}catch(e){return null}const r=await hn(a),n=await nn(l,r),c=await ja.aesGcm.getKeyStringFromKey(l),u="SaveDatabase",d={databaseNameHash:o,encryptedDbKey:await ja.aesGcm.encryptString(t,c),receivedSignature:n};sr.request(u,d)}}const m={databaseName:f,databaseId:n,isOwner:c,readOnly:u,resharingAllowed:d,encryptionMode:e.plaintextDbKey?"server-side":"end-to-end"},p=await(async(e,t,s,a,r,n)=>{const i=[],o={databaseId:e,databaseNameHash:t};let c=await sr.request("GetDatabaseUsers",o);for(i.push(...await tn(s,c.data.users,a,r,n));c.data.nextPageTokenLessThanUserId||c.data.nextPageTokenMoreThanUserId;)o.nextPageTokenLessThanUserId=c.data.nextPageTokenLessThanUserId,o.nextPageTokenMoreThanUserId=c.data.nextPageTokenMoreThanUserId,c=await sr.request("GetDatabaseUsers",o),i.push(...await tn(s,c.data.users,a,r,n));return i})(n,o,l,a,r,h);return c||(e=>{for(let t=0;t<e.length;t++){if(e[t].isOwner)return!0}return!1})(p)?(m.users=p,!c&&h&&(m.receivedFromUsername=h),m):null},an=async(e,t,s="end-to-end")=>{let a;Lr(s);try{a=Vr(e,t,null,s)}catch(r){const n="GetDatabases",i=e?{dbNameHash:"server-side"===s?e:await ja.hmac.signString(sr.keys.hmacKey,e)}:{databaseId:t},o=(await sr.request(n,i)).data.databases;if(!o||!o.length)throw new hs.DatabaseNotFound;a=o[0],a.dbNameHash=a.databaseNameHash,a.dbId=a.databaseId}return a},rn=async(e,t)=>{const s=await ja.aesGcm.getRawKeyFromKey(e),a=await ja.sha256.hash(s),r=await ja.hmac.importKeyFromRawBits(a);return await ja.hmac.signString(r,t)},nn=async(e,t)=>{const s=await rn(e,t);return await ja.ecdsa.signString(sr.keys.ecdsaPrivateKey,s)},on=async e=>{let t;return e.dbKey?t=await ja.aesGcm.getKeyStringFromKey(e.dbKey):(t=e.plaintextDbKey||await ja.aesGcm.decryptString(sr.keys.encryptionKey,e.encryptedDbKey),e.dbKey=await ja.aesGcm.getKeyFromKeyString(t)),t},cn=async(e,t,s,a,r)=>{const{databaseName:n,databaseId:o}=e,c=e.username.toLowerCase();try{const[e,u,d]=await Promise.all([Ts(c),a&&fn(),an(n,o,r)]);if(!e.ecdhPublicKey||!e.ecdsaPublicKey)throw new hs.UserUnableToReceiveDatabase;const h=i.a.decode(e.ecdsaPublicKey),l=await hn(h);a&&await(async(e,t,s)=>{let a,r;const n=Object.keys(s);for(let i=0;i<n.length;i++){const o=n[i],c=s[o].record.fingerprint;if(e===o&&t===c){a=c;break}c===t&&(r=!0)}if(!a&&r)throw new hs.UserMustBeReverified;if(!a)throw new hs.UserNotVerified})(c,l,u);const f=await ja.ecdsa.getPublicKeyFromRawPublicKey(h),{signedEcdhPublicKey:m,ecdhPublicKey:p}=e;if(!await ja.ecdsa.verify(f,i.a.decode(m),i.a.decode(p)))throw new hs.ServiceUnavailable;const w=await ja.ecdh.getPublicKeyFromRawPublicKey(i.a.decode(e.ecdhPublicKey)),g=await ja.ecdh.generateKeyPair(),y=await ja.ecdh.getRawPublicKeyFromPublicKey(g.publicKey),b=await ja.ecdsa.sign(sr.keys.ecdsaPrivateKey,y),v=await ja.ecdh.computeSharedKeyEncryptionKey(w,g.privateKey),M=await on(d),S=await ja.aesGcm.encryptString(v,M),I="ShareDatabase",P={databaseId:d.dbId,databaseNameHash:d.dbNameHash,username:c,readOnly:t,resharingAllowed:s,sharedEncryptedDbKey:S,ephemeralPublicKey:i.a.encode(y),signedEphemeralPublicKey:i.a.encode(b),sentSignature:await nn(d.dbKey,l),recipientEcdsaPublicKey:e.ecdsaPublicKey};await sr.request(I,P)}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"SharingWithSelfNotAllowed":throw new hs.SharingWithSelfNotAllowed;case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"ResharingNotAllowed":throw new hs.ResharingNotAllowed("Must have permission to reshare the database with another user");case"ResharingWithWriteAccessNotAllowed":throw new hs.ResharingWithWriteAccessNotAllowed;case"UserNotFound":throw new hs.UserNotFound;case"DatabaseAlreadyShared":return}throw e}},un=e=>{if("string"!=typeof e)throw new hs.UsernameMustBeString;if(0===e.length)throw new hs.UsernameCannotBeBlank},dn=e=>{if(Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;if(Ga(e,"username")&&un(e.username),Ga(e,"readOnly")&&"boolean"!=typeof e.readOnly)throw new hs.ReadOnlyMustBeBoolean;if(Ga(e,"resharingAllowed")&&"boolean"!=typeof e.resharingAllowed)throw new hs.ResharingAllowedMustBeBoolean;if(Ga(e,"requireVerified")&&"boolean"!=typeof e.requireVerified)throw new hs.RequireVerifiedMustBeBoolean},hn=async e=>{const t=await ja.sha256.hash(e);return i.a.encode(t)},ln=async()=>{const e=await ja.ecdsa.getPublicKeyFromPrivateKey(sr.keys.ecdsaPrivateKey),t=await ja.ecdsa.getRawPublicKeyFromPublicKey(e);return await hn(t)},fn=async()=>{await qr({databaseName:"__userbase_verified_users",changeHandler:()=>{},allowVerifiedUsersDatabase:!0,encryptionMode:"end-to-end"});const e=sr.state.dbNameToHash.__userbase_verified_users;return sr.state.databases[e].items};var mn={openDatabase:qr,getDatabases:async e=>{try{void 0!==e&&jr(e),Tr();const{encryptionKey:t,ecdhPrivateKey:s}=sr.keys,a=sr.session.username;if(e&&Ga(e,"shareToken"))throw new hs.ShareTokenNotAllowed;const r=e&&e.encryptionMode||sr.encryptionMode;Lr(r);try{const n=[],i="GetDatabases",o=e&&{databaseId:e.databaseId,dbNameHash:"server-side"===r?e.databaseName:e.databaseName&&await ja.hmac.signString(sr.keys.hmacKey,e.databaseName)};let[c,u]=await Promise.all([sr.request(i,o),fn()]),d=await Promise.all(c.data.databases.map(e=>sn(e,t,s,u,a)));for(n.push(...d);c.data.nextPageToken;){const e={nextPageToken:c.data.nextPageToken};c=await sr.request(i,e),d=await Promise.all(c.data.databases.map(e=>sn(e,t,s,u,a))),n.push(...d)}return{databases:n.filter(e=>null!==e)}}catch(e){throw kr(e),e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},insertItem:Hr,updateItem:Jr,deleteItem:async e=>{try{jr(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),s="Delete",a=await Yr(t,e);await zr(t,s,a)}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemDoesNotExist":case"ItemUpdateConflict":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},putTransaction:async e=>{try{if(jr(e),!Ga(e,"operations"))throw new hs.OperationsMissing;const{databaseName:t,databaseId:s,shareToken:a,operations:r,encryptionMode:n=sr.encryptionMode}=e;if(!Array.isArray(r))throw new hs.OperationsMustBeArray;const i=Vr(t,s,a,n),o="BatchTransaction",c=await Promise.all(r.map(e=>{const t=e.command;switch(t){case"Insert":return Gr(i,e);case"Update":return Wr(i,e);case"Delete":return Yr(i,e);default:throw new hs.CommandNotRecognized(t)}})),u=await Promise.all(c),d={operations:r.map((e,t)=>Ur({command:e.command},u[t]))};try{await zr(i,o,d)}catch(e){if(e.response&&"OperationsExceedLimit"===e.response.data.error)throw new hs.OperationsExceedLimit(e.response.data.limit);throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"OperationsMissing":case"OperationsMustBeArray":case"OperationsConflict":case"OperationsExceedLimit":case"CommandNotRecognized":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemMissing":case"ItemInvalid":case"ItemTooLarge":case"ItemAlreadyExists":case"ItemDoesNotExist":case"ItemUpdateConflict":case"WriteAccessParamNotAllowed":case"TransactionUnauthorized":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},uploadFile:async e=>{try{(e=>{if(jr(e),Ga(e,"progressHandler")&&"function"!=typeof e.progressHandler)throw new hs.ProgressHandlerMustBeFunction})(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),{dbId:s}=t;try{const{itemKey:a,fileMetadata:r}=await(async(e,t)=>{if(!Ga(e,"itemId"))throw new hs.ItemIdMissing;if(!Ga(e,"file"))throw new hs.FileMissing;const{itemId:s,file:a}=e;if("string"!=typeof s)throw new hs.ItemIdMustBeString;if(0===s.length)throw new hs.ItemIdCannotBeBlank;if(s.length>100)throw new hs.ItemIdTooLong(100);if(!t.itemExists(s))throw new hs.ItemDoesNotExist;if(!(a instanceof File))throw new hs.FileMustBeFile;if(0===a.size)throw new hs.FileCannotBeEmpty;const r=await ja.hmac.signString(sr.keys.hmacKey,s),n=t.getFileVersionNumber(s);return{itemKey:r,fileMetadata:{itemId:s,__v:void 0===n?0:n+1,fileName:a.name,fileSize:a.size,fileType:a.type}}})(e,t),[n,o]=await ja.aesGcm.generateAndEncryptKeyEncryptionKey(t.dbKey),c=await ja.aesGcm.encryptJson(n,r),{data:{fileId:u}}=await sr.request("GenerateFileId",{dbId:t.dbId}),d=e.file;let h=0,l=0,f=[];const m={bytesTransferred:0};for(;h<d.size;){const t=d.slice(h,h+524288);await Zr(f,t,s,u,n,l,m,e.progressHandler),l+=1,h+=524288}await Promise.all(f),await(async(e,t,s,a,r)=>{const n={dbId:e.dbId,fileId:t,itemKey:s,fileMetadata:a,fileEncryptionKey:i.a.encode(r)};await zr(e,"CompleteFileUpload",n)})(t,u,a,c,o)}catch(e){if(kr(e),e.response&&"DatabaseIsReadOnly"===e.response.data)throw new hs.DatabaseIsReadOnly;throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"ItemIdMissing":case"ItemIdMustBeString":case"ItemIdCannotBeBlank":case"ItemIdTooLong":case"ItemDoesNotExist":case"TransactionUnauthorized":case"FileMustBeFile":case"FileCannotBeEmpty":case"FileMissing":case"FileUploadConflict":case"ProgressHandlerMustBeFunction":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},getFile:async e=>{try{(e=>{if(jr(e),!Ga(e,"fileId"))throw new hs.FileIdMissing;const{fileId:t,range:s}=e;if("string"!=typeof t)throw new hs.FileIdMustBeString;if(0===t.length)throw new hs.FileIdCannotBeBlank;if(t.length>100)throw new hs.FileIdTooLong(100);if(Ga(e,"range")){if("object"!=typeof s)throw new hs.RangeMustBeObject;if(!Ga(s,"start"))throw new hs.RangeMissingStart;if(!Ga(s,"end"))throw new hs.RangeMissingEnd;const{start:e,end:t}=s;if("number"!=typeof e)throw new hs.RangeStartMustBeNumber;if("number"!=typeof t)throw new hs.RangeEndMustBeNumber;if(e<0)throw new hs.RangeStartMustBeGreaterThanZero;if(t<=e)throw new hs.RangeEndMustBeGreaterThanRangeStart}})(e);const t=Vr(e.databaseName,e.databaseId,e.shareToken,e.encryptionMode||sr.encryptionMode),{dbId:s}=t,{fileId:a,range:r}=e,n=t.fileIds[a],i=t.items[n];if(!i||!i.file)throw new hs.FileNotFound;const{file:{fileName:o,fileSize:c,fileType:u,fileEncryptionKey:d}}=i;if(r&&r.end>c)throw new hs.RangeEndMustBeLessThanFileSize;const h=r?await(async(e,t,s,a)=>{const{start:r,end:n}=a,i=[],o=Math.floor(r/524288),c=Math.floor(n/524288)-(n%524288==0?1:0);let u=o;for(;u<=c;){let a=await Xr(e,t,u,s);u===o&&u===c&&n%524288?a=a.slice(r%524288,n%524288):u===o?a=a.slice(r%524288):u===c&&n%524288&&(a=a.slice(0,n%524288)),i.push(a),u+=1}return i})(s,a,d,r):await(async(e,t,s,a)=>{const r=[];let n=0;const i=a<524288?0:Math.floor(a/524288)-(a%524288==0?1:0);for(;n<=i;){const a=await Xr(e,t,n,s);r.push(a),n+=1}return r})(s,a,d,c);return{file:new File(h,o,{type:u})}}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNotOpen":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"ShareTokenInvalid":case"DatabaseIsReadOnly":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"FileIdMissing":case"FileIdMustBeString":case"FileIdCannotBeBlank":case"FileIdTooLong":case"FileNotFound":case"RangeMustBeObject":case"RangeMissingStart":case"RangeMissingEnd":case"RangeStartMustBeNumber":case"RangeEndMustBeNumber":case"RangeStartMustBeGreaterThanZero":case"RangeEndMustBeGreaterThanRangeStart":case"RangeEndMustBeLessThanFileSize":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},shareDatabase:async e=>{try{jr(e),dn(e);const t=!Ga(e,"readOnly")||e.readOnly,s=!!Ga(e,"resharingAllowed")&&e.resharingAllowed,a=!Ga(e,"requireVerified")||e.requireVerified,r=e.encryptionMode||sr.encryptionMode;Lr(r);let n={};return Ga(e,"username")?await cn(e,t,s,a,r):n.shareToken=await(async(e,t,s)=>{try{const{databaseName:a,databaseId:r}=e;if(Ga(e,"requireVerified"))throw new hs.RequireVerifiedParamNotNecessary;if(Ga(e,"resharingAllowed"))throw new hs.ResharingAllowedParamNotAllowed("when retrieving a share token");const n=ja.generateSeed(),o=await ja.hkdf.importHkdfKey(n),c=ja.hkdf.generateSalt(),u=await ja.aesGcm.importKeyFromMaster(o,c),d=await an(a,r,s),h=await on(d),l=await ja.aesGcm.encryptString(u,h),{ecdsaPublicKey:f,encryptedEcdsaPrivateKey:m,ecdsaKeyEncryptionKeySalt:p}=await ja.ecdsa.generateEcdsaKeyData(o),w="ShareDatabaseToken",g={databaseId:d.dbId,databaseNameHash:d.dbNameHash,readOnly:t,keyData:{shareTokenEncryptedDbKey:l,shareTokenEncryptionKeySalt:i.a.encode(c),shareTokenPublicKey:f,shareTokenEncryptedEcdsaPrivateKey:m,shareTokenEcdsaKeyEncryptionKeySalt:p}},y=await sr.request(w,g),{shareTokenId:b}=y.data,v=Ls(b,!0);return i.a.encode(js(v,n))}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"ResharingNotAllowed":throw new hs.ResharingNotAllowed("Only the owner can generate a share token")}throw e}})(e,t,r),n}catch(e){switch(e.name){case"ParamsMustBeObject":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"DatabaseNotFound":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"ReadOnlyMustBeBoolean":case"ResharingAllowedMustBeBoolean":case"ResharingNotAllowed":case"ResharingWithWriteAccessNotAllowed":case"ResharingAllowedParamNotAllowed":case"RequireVerifiedMustBeBoolean":case"RequireVerifiedParamNotNecessary":case"SharingWithSelfNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"UserUnableToReceiveDatabase":case"UserNotFound":case"UserNotVerified":case"UserMustBeReverified":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},modifyDatabasePermissions:async e=>{try{if(jr(e),dn(e),!Ga(e,"username"))throw new hs.UsernameMissing;if(Ga(e,"revoke")){if("boolean"!=typeof e.revoke)throw new hs.RevokeMustBeBoolean;if(e.revoke){if(Ga(e,"readOnly"))throw new hs.ReadOnlyParamNotAllowed;if(Ga(e,"resharingAllowed"))throw new hs.ResharingAllowedParamNotAllowed("when revoking access to a database")}}else if(!Ga(e,"readOnly")&&!Ga(e,"resharingAllowed"))throw new hs.ParamsMissing;const{databaseName:t,databaseId:s,readOnly:a,resharingAllowed:r,revoke:n,encryptionMode:i=sr.encryptionMode}=e,o=e.username.toLowerCase();try{const e=await an(t,s,i),c="ModifyDatabasePermissions",u={databaseId:e.dbId,databaseNameHash:e.dbNameHash,username:o,readOnly:a,resharingAllowed:r,revoke:n};await sr.request(c,u)}catch(e){if(kr(e),e.response&&e.response.data)switch(e.response.data.message){case"SharingWithSelfNotAllowed":throw new hs.ModifyingOwnPermissionsNotAllowed;case"ModifyingOwnerPermissionsNotAllowed":throw new hs.ModifyingOwnerPermissionsNotAllowed;case"ResharingNotAllowed":throw new hs.ModifyingPermissionsNotAllowed;case"ResharingWithWriteAccessNotAllowed":throw new hs.GrantingWriteAccessNotAllowed;case"DatabaseNotFound":throw new hs.DatabaseNotFound;case"UserNotFound":throw new hs.UserNotFound}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"ParamsMissing":case"DatabaseNameMissing":case"DatabaseNameMustBeString":case"DatabaseNameCannotBeBlank":case"DatabaseNameTooLong":case"DatabaseNameRestricted":case"DatabaseIdMustBeString":case"DatabaseIdCannotBeBlank":case"DatabaseIdInvalidLength":case"DatabaseIdNotAllowed":case"ShareTokenNotAllowed":case"DatabaseNotFound":case"EncryptionModeNotValid":case"ServerSideEncryptionNotEnabledInClient":case"UsernameMissing":case"UsernameCannotBeBlank":case"UsernameMustBeString":case"ReadOnlyMustBeBoolean":case"ReadOnlyParamNotAllowed":case"ResharingAllowedMustBeBoolean":case"ResharingAllowedParamNotAllowed":case"RevokeMustBeBoolean":case"ModifyingOwnPermissionsNotAllowed":case"ModifyingOwnerPermissionsNotAllowed":case"ModifyingPermissionsNotAllowed":case"GrantingWriteAccessNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"UserNotFound":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},getVerificationMessage:async()=>{try{Tr();const e=sr.session.username,t=await ln();return{verificationMessage:((e,t)=>btoa(JSON.stringify({username:e,fingerprint:t})))(e,t)}}catch(e){switch(e.name){case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},verifyUser:async e=>{try{if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(Tr(),!Ga(e,"verificationMessage"))throw new hs.VerificationMessageMissing;const{verificationMessage:t}=e;if("string"!=typeof t)throw new hs.VerificationMessageMustBeString;if(0===t.length)throw new hs.VerificationMessageCannotBeBlank;const{username:s,fingerprint:a}=(e=>{try{const{username:t,fingerprint:s}=JSON.parse(atob(e));if(un(t),!s)throw new hs.VerificationMessageInvalid;return{username:t,fingerprint:s}}catch(e){throw new hs.VerificationMessageInvalid}})(t);if(s===sr.session.username||a===await ln())throw new hs.VerifyingSelfNotAllowed;await fn();const r="__userbase_verified_users",n=!0,i=s,o={fingerprint:a};try{await Hr({databaseName:r,itemId:i,item:o,allowVerifiedUsersDatabase:n})}catch(e){if("ItemAlreadyExists"!==e.name)throw e;await Jr({databaseName:r,itemId:i,item:o,allowVerifiedUsersDatabase:n})}}catch(e){switch(e.name){case"ParamsMustBeObject":case"VerificationMessageMissing":case"VerificationMessageMustBeString":case"VerificationMessageCannotBeBlank":case"VerificationMessageInvalid":case"VerifyingSelfNotAllowed":case"UserMustChangePassword":case"UserNotSignedIn":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}};const pn=()=>{if(sr.reconnecting)throw new hs.Reconnecting;if(!sr.keys.init&&sr.changePassword)throw new hs.UserMustChangePassword;if(!sr.keys.init)throw new hs.UserNotSignedIn},wn=e=>{if(e.response){if(e.response.status===p)throw new hs.InternalServerError;if(e.response.status===g)throw new hs.Timeout}else if(e.message&&-1!==e.message.indexOf("timeout"))throw new hs.Timeout},gn=e=>{pn();const t=sr.userData.stripeData;if(!t.stripeAccountId)throw new hs.StripeAccountNotConnected;if("disabled"===t.paymentsMode)throw new hs.PaymentsDisabled;if(!Ga(window,"Stripe"))throw new hs.StripeJsLibraryMissing;if("object"!=typeof e)throw new hs.ParamsMustBeObject;if(!Ga(e,"successUrl"))throw new hs.SuccessUrlMissing;if("string"!=typeof e.successUrl)throw new hs.SuccessUrlMustBeString;const s=qa(e.successUrl);if("http"!==s&&"https"!==s){const e=!0;throw new hs.SuccessUrlInvalid(e)}if(!Ga(e,"cancelUrl"))throw new hs.CancelUrlMissing;if("string"!=typeof e.cancelUrl)throw new hs.CancelUrlMustBeString;const a=qa(e.cancelUrl);if("http"!==a&&"https"!==a){const e=!0;throw new hs.CancelUrlInvalid(e)}},yn=()=>{pn();const e=sr.userData.stripeData;if(!e.stripeAccountId)throw new hs.StripeAccountNotConnected;if("disabled"===e.paymentsMode)throw new hs.PaymentsDisabled;if("canceled"===e.subscriptionStatus)throw new hs.SubscriptionAlreadyCanceled};var bn={purchaseSubscription:async e=>{try{const t=sr.userData.stripeData;if(!t.cancelSubscriptionAt&&t.subscriptionStatus&&"canceled"!==t.subscriptionStatus)throw new hs.SubscriptionPlanAlreadyPurchased;gn(e);try{const s="PurchaseSubscription",a=(await sr.request(s,e)).data,r=vs("prod"===t.paymentsMode),n=await window.Stripe(r,{stripeAccount:t.stripeAccountId}).redirectToCheckout({sessionId:a});if(n.error)throw n.error}catch(e){if(wn(e),e.response)switch(e.response.data){case"PriceIdOrPlanIdAllowed":throw new hs.PriceIdOrPlanIdAllowed;case"PriceIdOrPlanIdMissing":throw new hs.PriceIdOrPlanIdMissing;case"SubscriptionPlanAlreadyPurchased":throw new hs.SubscriptionPlanAlreadyPurchased;case"SuccessUrlInvalid":throw new hs.SuccessUrlInvalid;case"CancelUrlInvalid":throw new hs.CancelUrlInvalid;default:if(e.response.data&&"StripeError"===e.response.data.name)throw new hs.StripeError(e.response.data)}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"SuccessUrlMissing":case"SuccessUrlMustBeString":case"SuccessUrlInvalid":case"CancelUrlMissing":case"CancelUrlMustBeString":case"CancelUrlInvalid":case"StripeError":case"StripeJsLibraryMissing":case"PriceIdOrPlanIdAllowed":case"PriceIdOrPlanIdMissing":case"SubscriptionPlanAlreadyPurchased":case"StripeAccountNotConnected":case"PaymentsDisabled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},cancelSubscription:async()=>{try{yn();try{const e="CancelSubscription",t=(await sr.request(e)).data;return sr.userData.stripeData.cancelSubscriptionAt=t,{cancelSubscriptionAt:t}}catch(e){if(wn(e),e.response&&"SubscriptionNotFound"===e.response.data)throw new hs.SubscriptionNotFound;throw e}}catch(e){switch(e.name){case"SubscriptionNotFound":case"StripeAccountNotConnected":case"PaymentsDisabled":case"SubscriptionAlreadyCanceled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},resumeSubscription:async()=>{try{yn();try{const e="ResumeSubscription";await sr.request(e),delete sr.userData.stripeData.cancelSubscriptionAt}catch(e){if(wn(e),e.response&&"SubscriptionNotFound"===e.response.data)throw new hs.SubscriptionNotFound;throw e}}catch(e){switch(e.name){case"SubscriptionNotFound":case"StripeAccountNotConnected":case"PaymentsDisabled":case"SubscriptionAlreadyCanceled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}},updatePaymentMethod:async e=>{try{gn(e);const t=sr.userData.stripeData;if(!t.subscriptionStatus)throw new hs.SubscriptionNotPurchased;try{const s="UpdatePaymentMethod",a=(await sr.request(s,e)).data,r=vs("prod"===t.paymentsMode),n=await window.Stripe(r,{stripeAccount:t.stripeAccountId}).redirectToCheckout({sessionId:a});if(n.error)throw n.error}catch(e){if(wn(e),e.response){if("SuccessUrlInvalid"===e.response.data)throw new hs.SuccessUrlInvalid;if("CancelUrlInvalid"===e.response.data)throw new hs.CancelUrlInvalid}throw e}}catch(e){switch(e.name){case"ParamsMustBeObject":case"SuccessUrlMissing":case"SuccessUrlMustBeString":case"SuccessUrlInvalid":case"CancelUrlMissing":case"CancelUrlMustBeString":case"CancelUrlInvalid":case"StripeJsLibraryMissing":case"SubscriptionNotPurchased":case"StripeAccountNotConnected":case"PaymentsDisabled":case"UserMustChangePassword":case"UserNotSignedIn":case"TooManyRequests":case"ServiceUnavailable":throw e;default:throw new hs.UnknownServiceUnavailable(e)}}}};t.default={init:Pr.init,signUp:Pr.signUp,signIn:Pr.signIn,signOut:Pr.signOut,updateUser:Pr.updateUser,deleteUser:Pr.deleteUser,forgotPassword:Pr.forgotPassword,openDatabase:mn.openDatabase,insertItem:mn.insertItem,updateItem:mn.updateItem,deleteItem:mn.deleteItem,putTransaction:mn.putTransaction,uploadFile:mn.uploadFile,getFile:mn.getFile,getDatabases:mn.getDatabases,shareDatabase:mn.shareDatabase,modifyDatabasePermissions:mn.modifyDatabasePermissions,getVerificationMessage:mn.getVerificationMessage,verifyUser:mn.verifyUser,purchaseSubscription:bn.purchaseSubscription,cancelSubscription:bn.cancelSubscription,resumeSubscription:bn.resumeSubscription,updatePaymentMethod:bn.updatePaymentMethod}}]).default;
//# sourceMappingURL=userbase.js.map
